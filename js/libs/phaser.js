!function(e){if(GameGlobal){GameGlobal.p2=e();return}if(typeof exports=='object'){module.exports=e()}else if(typeof define=='function'&&false){define(e)}else{var f;typeof window!='undefined'?f=window:typeof global!='undefined'?f=global:typeof self!='undefined'&&(f=self)}}(function(){var R,module,exports;return(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=='function'&&require;if(!u&&a){return a(o,!0)}if(i){return i(o,!0)}throw new Error('Cannot find module \''+o+'\'');}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=='function'&&require;for(var o=0;o<r.length;o++){s(r[o])}return s})({1:[function(j,k,l){var m=j('./Scalar');k.exports=Line;function Line(){}Line.lineInt=function(a,b,c){c=c||0;var i=[0,0];var d,b1,c1,a2,b2,c2,det;d=a[1][1]-a[0][1];b1=a[0][0]-a[1][0];c1=d*a[0][0]+b1*a[0][1];a2=b[1][1]-b[0][1];b2=b[0][0]-b[1][0];c2=a2*b[0][0]+b2*b[0][1];det=d*b2-a2*b1;if(!m.eq(det,0,c)){i[0]=(b2*c1-b1*c2)/det;i[1]=(d*c2-a2*c1)/det}return i};Line.segmentsIntersect=function(a,b,c,d){var e=b[0]-a[0];var f=b[1]-a[1];var g=d[0]-c[0];var h=d[1]-c[1];if(g*f-h*e==0){return false}var s=(e*(c[1]-a[1])+f*(a[0]-c[0]))/(g*f-h*e);var t=(g*(a[1]-c[1])+h*(c[0]-a[0]))/(h*e-g*f);return(s>=0&&s<=1&&t>=0&&t<=1)}},{'./Scalar':4}],2:[function(g,h,i){h.exports=Point;function Point(){}Point.area=function(a,b,c){return(((b[0]-a[0])*(c[1]-a[1]))-((c[0]-a[0])*(b[1]-a[1])))};Point.left=function(a,b,c){return Point.area(a,b,c)>0};Point.leftOn=function(a,b,c){return Point.area(a,b,c)>=0};Point.right=function(a,b,c){return Point.area(a,b,c)<0};Point.rightOn=function(a,b,c){return Point.area(a,b,c)<=0};var j=[],tmpPoint2=[];Point.collinear=function(a,b,c,d){if(!d){return Point.area(a,b,c)==0}else{var e=j,bc=tmpPoint2;e[0]=b[0]-a[0];e[1]=b[1]-a[1];bc[0]=c[0]-b[0];bc[1]=c[1]-b[1];var f=e[0]*bc[0]+e[1]*bc[1],magA=Math.sqrt(e[0]*e[0]+e[1]*e[1]),magB=Math.sqrt(bc[0]*bc[0]+bc[1]*bc[1]),angle=Math.acos(f/(magA*magB));return angle<d}};Point.sqdist=function(a,b){var c=b[0]-a[0];var d=b[1]-a[1];return c*c+d*d}},{}],3:[function(o,q,r){var t=o('./Line'),Point=o('./Point'),Scalar=o('./Scalar');q.exports=Polygon;function Polygon(){this.vertices=[]}Polygon.prototype.at=function(i){var v=this.vertices,s=v.length;return v[i<0?i%s+s:i%s]};Polygon.prototype.first=function(){return this.vertices[0]};Polygon.prototype.last=function(){return this.vertices[this.vertices.length-1]};Polygon.prototype.clear=function(){this.vertices.length=0};Polygon.prototype.append=function(a,b,c){if(typeof(b)=='undefined'){throw new Error('From is not given!');}if(typeof(c)=='undefined'){throw new Error('To is not given!');}if(c-1<b){throw new Error('lol1');}if(c>a.vertices.length){throw new Error('lol2');}if(b<0){throw new Error('lol3');}for(var i=b;i<c;i++){this.vertices.push(a.vertices[i])}};Polygon.prototype.makeCCW=function(){var a=0,v=this.vertices;for(var i=1;i<this.vertices.length;++i){if(v[i][1]<v[a][1]||(v[i][1]==v[a][1]&&v[i][0]>v[a][0])){a=i}}if(!Point.left(this.at(a-1),this.at(a),this.at(a+1))){this.reverse()}};Polygon.prototype.reverse=function(){var a=[];for(var i=0,N=this.vertices.length;i!==N;i++){a.push(this.vertices.pop())}this.vertices=a};Polygon.prototype.isReflex=function(i){return Point.right(this.at(i-1),this.at(i),this.at(i+1))};var u=[],tmpLine2=[];Polygon.prototype.canSee=function(a,b){var p,dist,l1=u,l2=tmpLine2;if(Point.leftOn(this.at(a+1),this.at(a),this.at(b))&&Point.rightOn(this.at(a-1),this.at(a),this.at(b))){return false}dist=Point.sqdist(this.at(a),this.at(b));for(var i=0;i!==this.vertices.length;++i){if((i+1)%this.vertices.length===a||i===a){continue}if(Point.leftOn(this.at(a),this.at(b),this.at(i+1))&&Point.rightOn(this.at(a),this.at(b),this.at(i))){l1[0]=this.at(a);l1[1]=this.at(b);l2[0]=this.at(i);l2[1]=this.at(i+1);p=t.lineInt(l1,l2);if(Point.sqdist(this.at(a),p)<dist){return false}}}return true};Polygon.prototype.copy=function(i,j,a){var p=a||new Polygon();p.clear();if(i<j){for(var k=i;k<=j;k++){p.vertices.push(this.vertices[k])}}else{for(var k=0;k<=j;k++){p.vertices.push(this.vertices[k])}for(var k=i;k<this.vertices.length;k++){p.vertices.push(this.vertices[k])}}return p};Polygon.prototype.getCutEdges=function(){var a=[],tmp1=[],tmp2=[],tmpPoly=new Polygon();var b=Number.MAX_VALUE;for(var i=0;i<this.vertices.length;++i){if(this.isReflex(i)){for(var j=0;j<this.vertices.length;++j){if(this.canSee(i,j)){tmp1=this.copy(i,j,tmpPoly).getCutEdges();tmp2=this.copy(j,i,tmpPoly).getCutEdges();for(var k=0;k<tmp2.length;k++){tmp1.push(tmp2[k])}if(tmp1.length<b){a=tmp1;b=tmp1.length;a.push([this.at(i),this.at(j)])}}}}}return a};Polygon.prototype.decomp=function(){var a=this.getCutEdges();if(a.length>0){return this.slice(a)}else{return[this]}};Polygon.prototype.slice=function(a){if(a.length==0){return[this]}if(a instanceof Array&&a.length&&a[0]instanceof Array&&a[0].length==2&&a[0][0]instanceof Array){var b=[this];for(var i=0;i<a.length;i++){var c=a[i];for(var j=0;j<b.length;j++){var d=b[j];var e=d.slice(c);if(e){b.splice(j,1);b.push(e[0],e[1]);break}}}return b}else{var c=a;var i=this.vertices.indexOf(c[0]);var j=this.vertices.indexOf(c[1]);if(i!=-1&&j!=-1){return[this.copy(i,j),this.copy(j,i)]}else{return false}}};Polygon.prototype.isSimple=function(){var a=this.vertices;for(var i=0;i<a.length-1;i++){for(var j=0;j<i-1;j++){if(t.segmentsIntersect(a[i],a[i+1],a[j],a[j+1])){return false}}}for(var i=1;i<a.length-2;i++){if(t.segmentsIntersect(a[0],a[a.length-1],a[i],a[i+1])){return false}}return true};function getIntersectionPoint(a,b,c,d,e){e=e||0;var f=b[1]-a[1];var g=a[0]-b[0];var h=(f*a[0])+(g*a[1]);var i=d[1]-c[1];var j=c[0]-d[0];var k=(i*c[0])+(j*c[1]);var l=(f*j)-(i*g);if(!Scalar.eq(l,0,e)){return[((j*h)-(g*k))/l,((f*k)-(i*h))/l]}else{return[0,0]}}Polygon.prototype.quickDecomp=function(a,b,c,e,f,g){f=f||100;g=g||0;e=e||25;a=typeof(a)!='undefined'?a:[];b=b||[];c=c||[];var h=[0,0],lowerInt=[0,0],p=[0,0];var k=0,lowerDist=0,d=0,closestDist=0;var l=0,lowerIndex=0,closestIndex=0;var m=new Polygon(),upperPoly=new Polygon();var n=this,v=this.vertices;if(v.length<3){return a}g++;if(g>f){console.warn('quickDecomp: max level ('+f+') reached.');return a}for(var i=0;i<this.vertices.length;++i){if(n.isReflex(i)){b.push(n.vertices[i]);k=lowerDist=Number.MAX_VALUE;for(var j=0;j<this.vertices.length;++j){if(Point.left(n.at(i-1),n.at(i),n.at(j))&&Point.rightOn(n.at(i-1),n.at(i),n.at(j-1))){p=getIntersectionPoint(n.at(i-1),n.at(i),n.at(j),n.at(j-1));if(Point.right(n.at(i+1),n.at(i),p)){d=Point.sqdist(n.vertices[i],p);if(d<lowerDist){lowerDist=d;lowerInt=p;lowerIndex=j}}}if(Point.left(n.at(i+1),n.at(i),n.at(j+1))&&Point.rightOn(n.at(i+1),n.at(i),n.at(j))){p=getIntersectionPoint(n.at(i+1),n.at(i),n.at(j),n.at(j+1));if(Point.left(n.at(i-1),n.at(i),p)){d=Point.sqdist(n.vertices[i],p);if(d<k){k=d;h=p;l=j}}}}if(lowerIndex==(l+1)%this.vertices.length){p[0]=(lowerInt[0]+h[0])/2;p[1]=(lowerInt[1]+h[1])/2;c.push(p);if(i<l){m.append(n,i,l+1);m.vertices.push(p);upperPoly.vertices.push(p);if(lowerIndex!=0){upperPoly.append(n,lowerIndex,n.vertices.length)}upperPoly.append(n,0,i+1)}else{if(i!=0){m.append(n,i,n.vertices.length)}m.append(n,0,l+1);m.vertices.push(p);upperPoly.vertices.push(p);upperPoly.append(n,lowerIndex,i+1)}}else{if(lowerIndex>l){l+=this.vertices.length}closestDist=Number.MAX_VALUE;if(l<lowerIndex){return a}for(var j=lowerIndex;j<=l;++j){if(Point.leftOn(n.at(i-1),n.at(i),n.at(j))&&Point.rightOn(n.at(i+1),n.at(i),n.at(j))){d=Point.sqdist(n.at(i),n.at(j));if(d<closestDist){closestDist=d;closestIndex=j%this.vertices.length}}}if(i<closestIndex){m.append(n,i,closestIndex+1);if(closestIndex!=0){upperPoly.append(n,closestIndex,v.length)}upperPoly.append(n,0,i+1)}else{if(i!=0){m.append(n,i,v.length)}m.append(n,0,closestIndex+1);upperPoly.append(n,closestIndex,i+1)}}if(m.vertices.length<upperPoly.vertices.length){m.quickDecomp(a,b,c,e,f,g);upperPoly.quickDecomp(a,b,c,e,f,g)}else{upperPoly.quickDecomp(a,b,c,e,f,g);m.quickDecomp(a,b,c,e,f,g)}return a}}a.push(this);return a};Polygon.prototype.removeCollinearPoints=function(a){var b=0;for(var i=this.vertices.length-1;this.vertices.length>3&&i>=0;--i){if(Point.collinear(this.at(i-1),this.at(i),this.at(i+1),a)){this.vertices.splice(i%this.vertices.length,1);i--;b++}}return b}},{'./Line':1,'./Point':2,'./Scalar':4}],4:[function(d,e,f){e.exports=Scalar;function Scalar(){}Scalar.eq=function(a,b,c){c=c||0;return Math.abs(a-b)<c}},{}],5:[function(a,b,c){b.exports={Polygon:a('./Polygon'),Point:a('./Point')}},{'./Point':2,'./Polygon':3}],6:[function(a,b,c){b.exports={name:'p2',version:'0.7.1',description:'A JavaScript 2D physics engine.',author:'Stefan Hedman <schteppe@gmail.com> (http://steffe.se)',keywords:['p2.js','p2','physics','engine','2d'],main:'./src/p2.js',engines:{node:'*'},repository:{type:'git',url:'https://github.com/schteppe/p2.js.git'},bugs:{url:'https://github.com/schteppe/p2.js/issues'},licenses:[{type:'MIT'}],devDependencies:{grunt:'^0.4.5','grunt-contrib-jshint':'^0.11.2','grunt-contrib-nodeunit':'^0.4.1','grunt-contrib-uglify':'~0.4.0','grunt-contrib-watch':'~0.5.0','grunt-browserify':'~2.0.1','grunt-contrib-concat':'^0.4.0'},dependencies:{'poly-decomp':'0.1.1'}}},{}],7:[function(k,m,n){var o=k('../math/vec2'),Utils=k('../utils/Utils');m.exports=AABB;function AABB(a){this.lowerBound=o.create();if(a&&a.lowerBound){o.copy(this.lowerBound,a.lowerBound)}this.upperBound=o.create();if(a&&a.upperBound){o.copy(this.upperBound,a.upperBound)}}var q=o.create();AABB.prototype.setFromPoints=function(a,b,c,d){var l=this.lowerBound,u=this.upperBound;if(typeof(c)!=='number'){c=0}if(c!==0){o.rotate(l,a[0],c)}else{o.copy(l,a[0])}o.copy(u,l);var e=Math.cos(c),sinAngle=Math.sin(c);for(var i=1;i<a.length;i++){var p=a[i];if(c!==0){var x=p[0],y=p[1];q[0]=e*x-sinAngle*y;q[1]=sinAngle*x+e*y;p=q}for(var j=0;j<2;j++){if(p[j]>u[j]){u[j]=p[j]}if(p[j]<l[j]){l[j]=p[j]}}}if(b){o.add(this.lowerBound,this.lowerBound,b);o.add(this.upperBound,this.upperBound,b)}if(d){this.lowerBound[0]-=d;this.lowerBound[1]-=d;this.upperBound[0]+=d;this.upperBound[1]+=d}};AABB.prototype.copy=function(a){o.copy(this.lowerBound,a.lowerBound);o.copy(this.upperBound,a.upperBound)};AABB.prototype.extend=function(a){var i=2;while(i--){var l=a.lowerBound[i];if(this.lowerBound[i]>l){this.lowerBound[i]=l}var u=a.upperBound[i];if(this.upperBound[i]<u){this.upperBound[i]=u}}};AABB.prototype.overlaps=function(a){var b=this.lowerBound,u1=this.upperBound,l2=a.lowerBound,u2=a.upperBound;return((l2[0]<=u1[0]&&u1[0]<=u2[0])||(b[0]<=u2[0]&&u2[0]<=u1[0]))&&((l2[1]<=u1[1]&&u1[1]<=u2[1])||(b[1]<=u2[1]&&u2[1]<=u1[1]))};AABB.prototype.containsPoint=function(a){var l=this.lowerBound,u=this.upperBound;return l[0]<=a[0]&&a[0]<=u[0]&&l[1]<=a[1]&&a[1]<=u[1]};AABB.prototype.overlapsRay=function(a){var t=0;var b=1/a.direction[0];var c=1/a.direction[1];var d=(this.lowerBound[0]-a.from[0])*b;var e=(this.upperBound[0]-a.from[0])*b;var f=(this.lowerBound[1]-a.from[1])*c;var g=(this.upperBound[1]-a.from[1])*c;var h=Math.max(Math.max(Math.min(d,e),Math.min(f,g)));var i=Math.min(Math.min(Math.max(d,e),Math.max(f,g)));if(i<0){return-1}if(h>i){return-1}return h}},{'../math/vec2':30,'../utils/Utils':57}],8:[function(e,f,g){var h=e('../math/vec2');var i=e('../objects/Body');f.exports=Broadphase;function Broadphase(a){this.type=a;this.result=[];this.world=null;this.boundingVolumeType=Broadphase.AABB}Broadphase.AABB=1;Broadphase.BOUNDING_CIRCLE=2;Broadphase.prototype.setWorld=function(a){this.world=a};Broadphase.prototype.getCollisionPairs=function(a){};var j=h.create();Broadphase.boundingRadiusCheck=function(a,b){h.sub(j,a.position,b.position);var c=h.squaredLength(j),r=a.boundingRadius+b.boundingRadius;return c<=r*r};Broadphase.aabbCheck=function(a,b){return a.getAABB().overlaps(b.getAABB())};Broadphase.prototype.boundingVolumeCheck=function(a,b){var c;switch(this.boundingVolumeType){case Broadphase.BOUNDING_CIRCLE:c=Broadphase.boundingRadiusCheck(a,b);break;case Broadphase.AABB:c=Broadphase.aabbCheck(a,b);break;default:throw new Error('Bounding volume type not recognized: '+this.boundingVolumeType);}return c};Broadphase.canCollide=function(a,b){var c=i.KINEMATIC;var d=i.STATIC;if(a.type===d&&b.type===d){return false}if((a.type===c&&b.type===d)||(a.type===d&&b.type===c)){return false}if(a.type===c&&b.type===c){return false}if(a.sleepState===i.SLEEPING&&b.sleepState===i.SLEEPING){return false}if((a.sleepState===i.SLEEPING&&b.type===d)||(b.sleepState===i.SLEEPING&&a.type===d)){return false}return true};Broadphase.NAIVE=1;Broadphase.SAP=2},{'../math/vec2':30,'../objects/Body':31}],9:[function(f,g,h){var k=f('../shapes/Circle'),Plane=f('../shapes/Plane'),Shape=f('../shapes/Shape'),Particle=f('../shapes/Particle'),Broadphase=f('../collision/Broadphase'),vec2=f('../math/vec2');g.exports=NaiveBroadphase;function NaiveBroadphase(){Broadphase.call(this,Broadphase.NAIVE)}NaiveBroadphase.prototype=new Broadphase();NaiveBroadphase.prototype.constructor=NaiveBroadphase;NaiveBroadphase.prototype.getCollisionPairs=function(a){var b=a.bodies,result=this.result;result.length=0;for(var i=0,Ncolliding=b.length;i!==Ncolliding;i++){var c=b[i];for(var j=0;j<i;j++){var d=b[j];if(Broadphase.canCollide(c,d)&&this.boundingVolumeCheck(c,d)){result.push(c,d)}}}return result};NaiveBroadphase.prototype.aabbQuery=function(a,c,d){d=d||[];var e=a.bodies;for(var i=0;i<e.length;i++){var b=e[i];if(b.aabbNeedsUpdate){b.updateAABB()}if(b.aabb.overlaps(c)){d.push(b)}}return d}},{'../collision/Broadphase':8,'../math/vec2':30,'../shapes/Circle':39,'../shapes/Particle':43,'../shapes/Plane':44,'../shapes/Shape':45}],10:[function(x,y,z){var A=x('../math/vec2'),sub=A.sub,add=A.add,dot=A.dot,Utils=x('../utils/Utils'),ContactEquationPool=x('../utils/ContactEquationPool'),FrictionEquationPool=x('../utils/FrictionEquationPool'),TupleDictionary=x('../utils/TupleDictionary'),Equation=x('../equations/Equation'),ContactEquation=x('../equations/ContactEquation'),FrictionEquation=x('../equations/FrictionEquation'),Circle=x('../shapes/Circle'),Convex=x('../shapes/Convex'),Shape=x('../shapes/Shape'),Body=x('../objects/Body'),Box=x('../shapes/Box');y.exports=Narrowphase;var B=A.fromValues(0,1);var C=A.fromValues(0,0),tmp2=A.fromValues(0,0),tmp3=A.fromValues(0,0),tmp4=A.fromValues(0,0),tmp5=A.fromValues(0,0),tmp6=A.fromValues(0,0),tmp7=A.fromValues(0,0),tmp8=A.fromValues(0,0),tmp9=A.fromValues(0,0),tmp10=A.fromValues(0,0),tmp11=A.fromValues(0,0),tmp12=A.fromValues(0,0),tmp13=A.fromValues(0,0),tmp14=A.fromValues(0,0),tmp15=A.fromValues(0,0),tmp16=A.fromValues(0,0),tmp17=A.fromValues(0,0),tmp18=A.fromValues(0,0),tmpArray=[];function Narrowphase(){this.contactEquations=[];this.frictionEquations=[];this.enableFriction=true;this.enabledEquations=true;this.slipForce=10.0;this.frictionCoefficient=0.3;this.surfaceVelocity=0;this.contactEquationPool=new ContactEquationPool({size:32});this.frictionEquationPool=new FrictionEquationPool({size:64});this.restitution=0;this.stiffness=Equation.DEFAULT_STIFFNESS;this.relaxation=Equation.DEFAULT_RELAXATION;this.frictionStiffness=Equation.DEFAULT_STIFFNESS;this.frictionRelaxation=Equation.DEFAULT_RELAXATION;this.enableFrictionReduction=true;this.collidingBodiesLastStep=new TupleDictionary();this.contactSkinSize=0.01}var D=A.create();var E=A.create();Narrowphase.prototype.bodiesOverlap=function(a,b){var c=D;var d=E;for(var k=0,Nshapesi=a.shapes.length;k!==Nshapesi;k++){var e=a.shapes[k];a.toWorldFrame(c,e.position);for(var l=0,Nshapesj=b.shapes.length;l!==Nshapesj;l++){var f=b.shapes[l];b.toWorldFrame(d,f.position);if(this[e.type|f.type](a,e,c,e.angle+a.angle,b,f,d,f.angle+b.angle,true)){return true}}}return false};Narrowphase.prototype.collidedLastStep=function(a,b){var c=a.id|0,id2=b.id|0;return!!this.collidingBodiesLastStep.get(c,id2)};Narrowphase.prototype.reset=function(){this.collidingBodiesLastStep.reset();var a=this.contactEquations;var l=a.length;while(l--){var b=a[l],id1=b.bodyA.id,id2=b.bodyB.id;this.collidingBodiesLastStep.set(id1,id2,true)}var c=this.contactEquations,fe=this.frictionEquations;for(var i=0;i<c.length;i++){this.contactEquationPool.release(c[i])}for(var i=0;i<fe.length;i++){this.frictionEquationPool.release(fe[i])}this.contactEquations.length=this.frictionEquations.length=0};Narrowphase.prototype.createContactEquation=function(a,b,d,e){var c=this.contactEquationPool.get();c.bodyA=a;c.bodyB=b;c.shapeA=d;c.shapeB=e;c.restitution=this.restitution;c.firstImpact=!this.collidedLastStep(a,b);c.stiffness=this.stiffness;c.relaxation=this.relaxation;c.needsUpdate=true;c.enabled=this.enabledEquations;c.offset=this.contactSkinSize;return c};Narrowphase.prototype.createFrictionEquation=function(a,b,d,e){var c=this.frictionEquationPool.get();c.bodyA=a;c.bodyB=b;c.shapeA=d;c.shapeB=e;c.setSlipForce(this.slipForce);c.frictionCoefficient=this.frictionCoefficient;c.relativeVelocity=this.surfaceVelocity;c.enabled=this.enabledEquations;c.needsUpdate=true;c.stiffness=this.frictionStiffness;c.relaxation=this.frictionRelaxation;c.contactEquations.length=0;return c};Narrowphase.prototype.createFrictionFromContact=function(c){var a=this.createFrictionEquation(c.bodyA,c.bodyB,c.shapeA,c.shapeB);A.copy(a.contactPointA,c.contactPointA);A.copy(a.contactPointB,c.contactPointB);A.rotate90cw(a.t,c.normalA);a.contactEquations.push(c);return a};Narrowphase.prototype.createFrictionFromAverage=function(a){var c=this.contactEquations[this.contactEquations.length-1];var b=this.createFrictionEquation(c.bodyA,c.bodyB,c.shapeA,c.shapeB);var d=c.bodyA;var e=c.bodyB;A.set(b.contactPointA,0,0);A.set(b.contactPointB,0,0);A.set(b.t,0,0);for(var i=0;i!==a;i++){c=this.contactEquations[this.contactEquations.length-1-i];if(c.bodyA===d){A.add(b.t,b.t,c.normalA);A.add(b.contactPointA,b.contactPointA,c.contactPointA);A.add(b.contactPointB,b.contactPointB,c.contactPointB)}else{A.sub(b.t,b.t,c.normalA);A.add(b.contactPointA,b.contactPointA,c.contactPointB);A.add(b.contactPointB,b.contactPointB,c.contactPointA)}b.contactEquations.push(c)}var f=1/a;A.scale(b.contactPointA,b.contactPointA,f);A.scale(b.contactPointB,b.contactPointB,f);A.normalize(b.t,b.t);A.rotate90cw(b.t,b.t);return b};Narrowphase.prototype[Shape.LINE|Shape.CONVEX]=Narrowphase.prototype.convexLine=function(a,b,c,d,e,f,g,h,i){if(i){return false}else{return 0}};Narrowphase.prototype[Shape.LINE|Shape.BOX]=Narrowphase.prototype.lineBox=function(a,b,c,d,e,f,g,h,i){if(i){return false}else{return 0}};function setConvexToCapsuleShapeMiddle(a,b){A.set(a.vertices[0],-b.length*0.5,-b.radius);A.set(a.vertices[1],b.length*0.5,-b.radius);A.set(a.vertices[2],b.length*0.5,b.radius);A.set(a.vertices[3],-b.length*0.5,b.radius)}var F=new Box({width:1,height:1}),convexCapsule_tempVec=A.create();Narrowphase.prototype[Shape.CAPSULE|Shape.CONVEX]=Narrowphase.prototype[Shape.CAPSULE|Shape.BOX]=Narrowphase.prototype.convexCapsule=function(a,b,c,d,e,f,g,h,i){var j=convexCapsule_tempVec;A.set(j,f.length/2,0);A.rotate(j,j,h);A.add(j,j,g);var k=this.circleConvex(e,f,j,h,a,b,c,d,i,f.radius);A.set(j,-f.length/2,0);A.rotate(j,j,h);A.add(j,j,g);var l=this.circleConvex(e,f,j,h,a,b,c,d,i,f.radius);if(i&&(k||l)){return true}var r=F;setConvexToCapsuleShapeMiddle(r,f);var m=this.convexConvex(a,b,c,d,e,r,g,h,i);return m+k+l};Narrowphase.prototype[Shape.CAPSULE|Shape.LINE]=Narrowphase.prototype.lineCapsule=function(a,b,c,d,e,f,g,h,i){if(i){return false}else{return 0}};var G=A.create();var H=A.create();var I=new Box({width:1,height:1});Narrowphase.prototype[Shape.CAPSULE|Shape.CAPSULE]=Narrowphase.prototype.capsuleCapsule=function(a,b,c,d,e,f,g,h,k){var l;var m=G,circlePosj=H;var n=0;for(var i=0;i<2;i++){A.set(m,(i===0?-1:1)*b.length/2,0);A.rotate(m,m,d);A.add(m,m,c);for(var j=0;j<2;j++){A.set(circlePosj,(j===0?-1:1)*f.length/2,0);A.rotate(circlePosj,circlePosj,h);A.add(circlePosj,circlePosj,g);if(this.enableFrictionReduction){l=this.enableFriction;this.enableFriction=false}var o=this.circleCircle(a,b,m,d,e,f,circlePosj,h,k,b.radius,f.radius);if(this.enableFrictionReduction){this.enableFriction=l}if(k&&o){return true}n+=o}}if(this.enableFrictionReduction){l=this.enableFriction;this.enableFriction=false}var p=I;setConvexToCapsuleShapeMiddle(p,b);var q=this.convexCapsule(a,p,c,d,e,f,g,h,k);if(this.enableFrictionReduction){this.enableFriction=l}if(k&&q){return true}n+=q;if(this.enableFrictionReduction){var l=this.enableFriction;this.enableFriction=false}setConvexToCapsuleShapeMiddle(p,f);var r=this.convexCapsule(e,p,g,h,a,b,c,d,k);if(this.enableFrictionReduction){this.enableFriction=l}if(k&&r){return true}n+=r;if(this.enableFrictionReduction){if(n&&this.enableFriction){this.frictionEquations.push(this.createFrictionFromAverage(n))}}return n};Narrowphase.prototype[Shape.LINE|Shape.LINE]=Narrowphase.prototype.lineLine=function(a,b,c,d,e,f,g,h,i){if(i){return false}else{return 0}};Narrowphase.prototype[Shape.PLANE|Shape.LINE]=Narrowphase.prototype.planeLine=function(a,b,e,f,g,h,j,k,l){var m=C,worldVertex1=tmp2,worldVertex01=tmp3,worldVertex11=tmp4,worldEdge=tmp5,worldEdgeUnit=tmp6,dist=tmp7,worldNormal=tmp8,worldTangent=tmp9,verts=tmpArray,numContacts=0;A.set(m,-h.length/2,0);A.set(worldVertex1,h.length/2,0);A.rotate(worldVertex01,m,k);A.rotate(worldVertex11,worldVertex1,k);add(worldVertex01,worldVertex01,j);add(worldVertex11,worldVertex11,j);A.copy(m,worldVertex01);A.copy(worldVertex1,worldVertex11);sub(worldEdge,worldVertex1,m);A.normalize(worldEdgeUnit,worldEdge);A.rotate90cw(worldTangent,worldEdgeUnit);A.rotate(worldNormal,B,f);verts[0]=m;verts[1]=worldVertex1;for(var i=0;i<verts.length;i++){var v=verts[i];sub(dist,v,e);var d=dot(dist,worldNormal);if(d<0){if(l){return true}var c=this.createContactEquation(a,g,b,h);numContacts++;A.copy(c.normalA,worldNormal);A.normalize(c.normalA,c.normalA);A.scale(dist,worldNormal,d);sub(c.contactPointA,v,dist);sub(c.contactPointA,c.contactPointA,a.position);sub(c.contactPointB,v,j);add(c.contactPointB,c.contactPointB,j);sub(c.contactPointB,c.contactPointB,g.position);this.contactEquations.push(c);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}}}}if(l){return false}if(!this.enableFrictionReduction){if(numContacts&&this.enableFriction){this.frictionEquations.push(this.createFrictionFromAverage(numContacts))}}return numContacts};Narrowphase.prototype[Shape.PARTICLE|Shape.CAPSULE]=Narrowphase.prototype.particleCapsule=function(a,b,c,d,e,f,g,h,i){return this.circleLine(a,b,c,d,e,f,g,h,i,f.radius,0)};Narrowphase.prototype[Shape.CIRCLE|Shape.LINE]=Narrowphase.prototype.circleLine=function(a,b,e,f,g,h,j,k,l,m,n){var m=m||0,n=typeof(n)!=='undefined'?n:b.radius,orthoDist=C,lineToCircleOrthoUnit=tmp2,projectedPoint=tmp3,centerDist=tmp4,worldTangent=tmp5,worldEdge=tmp6,worldEdgeUnit=tmp7,worldVertex0=tmp8,worldVertex1=tmp9,worldVertex01=tmp10,worldVertex11=tmp11,dist=tmp12,lineToCircle=tmp13,lineEndToLineRadius=tmp14,verts=tmpArray;A.set(worldVertex0,-h.length/2,0);A.set(worldVertex1,h.length/2,0);A.rotate(worldVertex01,worldVertex0,k);A.rotate(worldVertex11,worldVertex1,k);add(worldVertex01,worldVertex01,j);add(worldVertex11,worldVertex11,j);A.copy(worldVertex0,worldVertex01);A.copy(worldVertex1,worldVertex11);sub(worldEdge,worldVertex1,worldVertex0);A.normalize(worldEdgeUnit,worldEdge);A.rotate90cw(worldTangent,worldEdgeUnit);sub(dist,e,worldVertex0);var d=dot(dist,worldTangent);sub(centerDist,worldVertex0,j);sub(lineToCircle,e,j);var o=n+m;if(Math.abs(d)<o){A.scale(orthoDist,worldTangent,d);sub(projectedPoint,e,orthoDist);A.scale(lineToCircleOrthoUnit,worldTangent,dot(worldTangent,lineToCircle));A.normalize(lineToCircleOrthoUnit,lineToCircleOrthoUnit);A.scale(lineToCircleOrthoUnit,lineToCircleOrthoUnit,m);add(projectedPoint,projectedPoint,lineToCircleOrthoUnit);var p=dot(worldEdgeUnit,projectedPoint);var q=dot(worldEdgeUnit,worldVertex0);var r=dot(worldEdgeUnit,worldVertex1);if(p>q&&p<r){if(l){return true}var c=this.createContactEquation(a,g,b,h);A.scale(c.normalA,orthoDist,-1);A.normalize(c.normalA,c.normalA);A.scale(c.contactPointA,c.normalA,n);add(c.contactPointA,c.contactPointA,e);sub(c.contactPointA,c.contactPointA,a.position);sub(c.contactPointB,projectedPoint,j);add(c.contactPointB,c.contactPointB,j);sub(c.contactPointB,c.contactPointB,g.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1}}verts[0]=worldVertex0;verts[1]=worldVertex1;for(var i=0;i<verts.length;i++){var v=verts[i];sub(dist,v,e);if(A.squaredLength(dist)<Math.pow(o,2)){if(l){return true}var c=this.createContactEquation(a,g,b,h);A.copy(c.normalA,dist);A.normalize(c.normalA,c.normalA);A.scale(c.contactPointA,c.normalA,n);add(c.contactPointA,c.contactPointA,e);sub(c.contactPointA,c.contactPointA,a.position);sub(c.contactPointB,v,j);A.scale(lineEndToLineRadius,c.normalA,-m);add(c.contactPointB,c.contactPointB,lineEndToLineRadius);add(c.contactPointB,c.contactPointB,j);sub(c.contactPointB,c.contactPointB,g.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1}}return 0};Narrowphase.prototype[Shape.CIRCLE|Shape.CAPSULE]=Narrowphase.prototype.circleCapsule=function(a,b,c,d,e,f,g,h,i){return this.circleLine(a,b,c,d,e,f,g,h,i,f.radius)};Narrowphase.prototype[Shape.CIRCLE|Shape.CONVEX]=Narrowphase.prototype[Shape.CIRCLE|Shape.BOX]=Narrowphase.prototype.circleConvex=function(a,b,d,e,f,g,h,j,k,l){var l=typeof(l)==='number'?l:b.radius;var m=C,worldVertex1=tmp2,worldEdge=tmp3,worldEdgeUnit=tmp4,worldNormal=tmp5,centerDist=tmp6,convexToCircle=tmp7,orthoDist=tmp8,projectedPoint=tmp9,dist=tmp10,worldVertex=tmp11,closestEdge=-1,closestEdgeDistance=null,closestEdgeOrthoDist=tmp12,closestEdgeProjectedPoint=tmp13,candidate=tmp14,candidateDist=tmp15,minCandidate=tmp16,found=false,minCandidateDistance=Number.MAX_VALUE;var n=0;var o=g.vertices;for(var i=0;i!==o.length+1;i++){var p=o[i%o.length],v1=o[(i+1)%o.length];A.rotate(m,p,j);A.rotate(worldVertex1,v1,j);add(m,m,h);add(worldVertex1,worldVertex1,h);sub(worldEdge,worldVertex1,m);A.normalize(worldEdgeUnit,worldEdge);A.rotate90cw(worldNormal,worldEdgeUnit);A.scale(candidate,worldNormal,-b.radius);add(candidate,candidate,d);if(pointInConvex(candidate,g,h,j)){A.sub(candidateDist,m,candidate);var q=Math.abs(A.dot(candidateDist,worldNormal));if(q<minCandidateDistance){A.copy(minCandidate,candidate);minCandidateDistance=q;A.scale(closestEdgeProjectedPoint,worldNormal,q);A.add(closestEdgeProjectedPoint,closestEdgeProjectedPoint,candidate);found=true}}}if(found){if(k){return true}var c=this.createContactEquation(a,f,b,g);A.sub(c.normalA,minCandidate,d);A.normalize(c.normalA,c.normalA);A.scale(c.contactPointA,c.normalA,l);add(c.contactPointA,c.contactPointA,d);sub(c.contactPointA,c.contactPointA,a.position);sub(c.contactPointB,closestEdgeProjectedPoint,h);add(c.contactPointB,c.contactPointB,h);sub(c.contactPointB,c.contactPointB,f.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1}if(l>0){for(var i=0;i<o.length;i++){var r=o[i];A.rotate(worldVertex,r,j);add(worldVertex,worldVertex,h);sub(dist,worldVertex,d);if(A.squaredLength(dist)<Math.pow(l,2)){if(k){return true}var c=this.createContactEquation(a,f,b,g);A.copy(c.normalA,dist);A.normalize(c.normalA,c.normalA);A.scale(c.contactPointA,c.normalA,l);add(c.contactPointA,c.contactPointA,d);sub(c.contactPointA,c.contactPointA,a.position);sub(c.contactPointB,worldVertex,h);add(c.contactPointB,c.contactPointB,h);sub(c.contactPointB,c.contactPointB,f.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1}}}return 0};var J=A.create(),pic_worldVertex1=A.create(),pic_r0=A.create(),pic_r1=A.create();function pointInConvex(a,b,c,d){var e=J,worldVertex1=pic_worldVertex1,r0=pic_r0,r1=pic_r1,point=a,verts=b.vertices,lastCross=null;for(var i=0;i!==verts.length+1;i++){var f=verts[i%verts.length],v1=verts[(i+1)%verts.length];A.rotate(e,f,d);A.rotate(worldVertex1,v1,d);add(e,e,c);add(worldVertex1,worldVertex1,c);sub(r0,e,point);sub(r1,worldVertex1,point);var g=A.crossLength(r0,r1);if(lastCross===null){lastCross=g}if(g*lastCross<=0){return false}lastCross=g}return true}Narrowphase.prototype[Shape.PARTICLE|Shape.CONVEX]=Narrowphase.prototype[Shape.PARTICLE|Shape.BOX]=Narrowphase.prototype.particleConvex=function(a,b,e,f,g,h,j,k,l){var m=C,worldVertex1=tmp2,worldEdge=tmp3,worldEdgeUnit=tmp4,worldTangent=tmp5,centerDist=tmp6,convexToparticle=tmp7,orthoDist=tmp8,projectedPoint=tmp9,dist=tmp10,worldVertex=tmp11,closestEdge=-1,closestEdgeDistance=null,closestEdgeOrthoDist=tmp12,closestEdgeProjectedPoint=tmp13,r0=tmp14,r1=tmp15,localPoint=tmp16,candidateDist=tmp17,minEdgeNormal=tmp18,minCandidateDistance=Number.MAX_VALUE;var n=0,found=false,verts=h.vertices;if(!pointInConvex(e,h,j,k)){return 0}if(l){return true}var o=null;for(var i=0;i!==verts.length+1;i++){var p=verts[i%verts.length],v1=verts[(i+1)%verts.length];A.rotate(m,p,k);A.rotate(worldVertex1,v1,k);add(m,m,j);add(worldVertex1,worldVertex1,j);sub(worldEdge,worldVertex1,m);A.normalize(worldEdgeUnit,worldEdge);A.rotate90cw(worldTangent,worldEdgeUnit);sub(dist,e,m);var d=dot(dist,worldTangent);sub(centerDist,m,j);sub(convexToparticle,e,j);A.sub(candidateDist,m,e);var q=Math.abs(A.dot(candidateDist,worldTangent));if(q<minCandidateDistance){minCandidateDistance=q;A.scale(closestEdgeProjectedPoint,worldTangent,q);A.add(closestEdgeProjectedPoint,closestEdgeProjectedPoint,e);A.copy(minEdgeNormal,worldTangent);found=true}}if(found){var c=this.createContactEquation(a,g,b,h);A.scale(c.normalA,minEdgeNormal,-1);A.normalize(c.normalA,c.normalA);A.set(c.contactPointA,0,0);add(c.contactPointA,c.contactPointA,e);sub(c.contactPointA,c.contactPointA,a.position);sub(c.contactPointB,closestEdgeProjectedPoint,j);add(c.contactPointB,c.contactPointB,j);sub(c.contactPointB,c.contactPointB,g.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1}return 0};Narrowphase.prototype[Shape.CIRCLE]=Narrowphase.prototype.circleCircle=function(a,b,d,e,f,g,h,i,j,k,l){var m=C,k=k||b.radius,l=l||g.radius;sub(m,d,h);var r=k+l;if(A.squaredLength(m)>Math.pow(r,2)){return 0}if(j){return true}var c=this.createContactEquation(a,f,b,g);sub(c.normalA,h,d);A.normalize(c.normalA,c.normalA);A.scale(c.contactPointA,c.normalA,k);A.scale(c.contactPointB,c.normalA,-l);add(c.contactPointA,c.contactPointA,d);sub(c.contactPointA,c.contactPointA,a.position);add(c.contactPointB,c.contactPointB,h);sub(c.contactPointB,c.contactPointB,f.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1};Narrowphase.prototype[Shape.PLANE|Shape.CONVEX]=Narrowphase.prototype[Shape.PLANE|Shape.BOX]=Narrowphase.prototype.planeConvex=function(a,b,e,f,g,h,j,k,l){var m=C,worldNormal=tmp2,dist=tmp3;var n=0;A.rotate(worldNormal,B,f);for(var i=0;i!==h.vertices.length;i++){var v=h.vertices[i];A.rotate(m,v,k);add(m,m,j);sub(dist,m,e);if(dot(dist,worldNormal)<=0){if(l){return true}n++;var c=this.createContactEquation(a,g,b,h);sub(dist,m,e);A.copy(c.normalA,worldNormal);var d=dot(dist,c.normalA);A.scale(dist,c.normalA,d);sub(c.contactPointB,m,g.position);sub(c.contactPointA,m,dist);sub(c.contactPointA,c.contactPointA,a.position);this.contactEquations.push(c);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}}}}if(this.enableFrictionReduction){if(this.enableFriction&&n){this.frictionEquations.push(this.createFrictionFromAverage(n))}}return n};Narrowphase.prototype[Shape.PARTICLE|Shape.PLANE]=Narrowphase.prototype.particlePlane=function(a,b,e,f,g,h,i,j,k){var l=C,worldNormal=tmp2;j=j||0;sub(l,e,i);A.rotate(worldNormal,B,j);var d=dot(l,worldNormal);if(d>0){return 0}if(k){return true}var c=this.createContactEquation(g,a,h,b);A.copy(c.normalA,worldNormal);A.scale(l,c.normalA,d);sub(c.contactPointA,e,l);sub(c.contactPointA,c.contactPointA,g.position);sub(c.contactPointB,e,a.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1};Narrowphase.prototype[Shape.CIRCLE|Shape.PARTICLE]=Narrowphase.prototype.circleParticle=function(a,b,d,e,f,g,h,i,j){var k=C;sub(k,h,d);if(A.squaredLength(k)>Math.pow(b.radius,2)){return 0}if(j){return true}var c=this.createContactEquation(a,f,b,g);A.copy(c.normalA,k);A.normalize(c.normalA,c.normalA);A.scale(c.contactPointA,c.normalA,b.radius);add(c.contactPointA,c.contactPointA,d);sub(c.contactPointA,c.contactPointA,a.position);sub(c.contactPointB,h,f.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}return 1};var K=new Circle({radius:1}),planeCapsule_tmp1=A.create(),planeCapsule_tmp2=A.create(),planeCapsule_tmp3=A.create();Narrowphase.prototype[Shape.PLANE|Shape.CAPSULE]=Narrowphase.prototype.planeCapsule=function(a,b,c,d,e,f,g,h,i){var j=planeCapsule_tmp1,end2=planeCapsule_tmp2,circle=K,dst=planeCapsule_tmp3;A.set(j,-f.length/2,0);A.rotate(j,j,h);add(j,j,g);A.set(end2,f.length/2,0);A.rotate(end2,end2,h);add(end2,end2,g);circle.radius=f.radius;var k;if(this.enableFrictionReduction){k=this.enableFriction;this.enableFriction=false}var l=this.circlePlane(e,circle,j,0,a,b,c,d,i),numContacts2=this.circlePlane(e,circle,end2,0,a,b,c,d,i);if(this.enableFrictionReduction){this.enableFriction=k}if(i){return l||numContacts2}else{var m=l+numContacts2;if(this.enableFrictionReduction){if(m){this.frictionEquations.push(this.createFrictionFromAverage(m))}}return m}};Narrowphase.prototype[Shape.CIRCLE|Shape.PLANE]=Narrowphase.prototype.circlePlane=function(a,b,c,e,f,g,h,i,j){var k=a,circleShape=b,circleOffset=c,planeBody=f,shapeB=g,planeOffset=h,planeAngle=i;planeAngle=planeAngle||0;var l=C,worldNormal=tmp2,temp=tmp3;sub(l,circleOffset,planeOffset);A.rotate(worldNormal,B,planeAngle);var d=dot(worldNormal,l);if(d>circleShape.radius){return 0}if(j){return true}var m=this.createContactEquation(planeBody,k,g,b);A.copy(m.normalA,worldNormal);A.scale(m.contactPointB,m.normalA,-circleShape.radius);add(m.contactPointB,m.contactPointB,circleOffset);sub(m.contactPointB,m.contactPointB,k.position);A.scale(temp,m.normalA,d);sub(m.contactPointA,l,temp);add(m.contactPointA,m.contactPointA,planeOffset);sub(m.contactPointA,m.contactPointA,planeBody.position);this.contactEquations.push(m);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(m))}return 1};Narrowphase.prototype[Shape.CONVEX]=Narrowphase.prototype[Shape.CONVEX|Shape.BOX]=Narrowphase.prototype[Shape.BOX]=Narrowphase.prototype.convexConvex=function(a,b,e,f,g,h,l,m,n,o){var p=C,worldPoint=tmp2,worldPoint0=tmp3,worldPoint1=tmp4,worldEdge=tmp5,projected=tmp6,penetrationVec=tmp7,dist=tmp8,worldNormal=tmp9,numContacts=0,o=typeof(o)==='number'?o:0;var q=Narrowphase.findSeparatingAxis(b,e,f,h,l,m,p);if(!q){return 0}sub(dist,l,e);if(dot(p,dist)>0){A.scale(p,p,-1)}var r=Narrowphase.getClosestEdge(b,f,p,true),closestEdge2=Narrowphase.getClosestEdge(h,m,p);if(r===-1||closestEdge2===-1){return 0}for(var k=0;k<2;k++){var s=r,closestEdgeB=closestEdge2,shapeA=b,shapeB=h,offsetA=e,offsetB=l,angleA=f,angleB=m,bodyA=a,bodyB=g;if(k===0){var t;t=s;s=closestEdgeB;closestEdgeB=t;t=shapeA;shapeA=shapeB;shapeB=t;t=offsetA;offsetA=offsetB;offsetB=t;t=angleA;angleA=angleB;angleB=t;t=bodyA;bodyA=bodyB;bodyB=t}for(var j=closestEdgeB;j<closestEdgeB+2;j++){var v=shapeB.vertices[(j+shapeB.vertices.length)%shapeB.vertices.length];A.rotate(worldPoint,v,angleB);add(worldPoint,worldPoint,offsetB);var u=0;for(var i=s-1;i<s+2;i++){var w=shapeA.vertices[(i+shapeA.vertices.length)%shapeA.vertices.length],v1=shapeA.vertices[(i+1+shapeA.vertices.length)%shapeA.vertices.length];A.rotate(worldPoint0,w,angleA);A.rotate(worldPoint1,v1,angleA);add(worldPoint0,worldPoint0,offsetA);add(worldPoint1,worldPoint1,offsetA);sub(worldEdge,worldPoint1,worldPoint0);A.rotate90cw(worldNormal,worldEdge);A.normalize(worldNormal,worldNormal);sub(dist,worldPoint,worldPoint0);var d=dot(worldNormal,dist);if((i===s&&d<=o)||(i!==s&&d<=0)){u++}}if(u>=3){if(n){return true}var c=this.createContactEquation(bodyA,bodyB,shapeA,shapeB);numContacts++;var w=shapeA.vertices[(s)%shapeA.vertices.length],v1=shapeA.vertices[(s+1)%shapeA.vertices.length];A.rotate(worldPoint0,w,angleA);A.rotate(worldPoint1,v1,angleA);add(worldPoint0,worldPoint0,offsetA);add(worldPoint1,worldPoint1,offsetA);sub(worldEdge,worldPoint1,worldPoint0);A.rotate90cw(c.normalA,worldEdge);A.normalize(c.normalA,c.normalA);sub(dist,worldPoint,worldPoint0);var d=dot(c.normalA,dist);A.scale(penetrationVec,c.normalA,d);sub(c.contactPointA,worldPoint,offsetA);sub(c.contactPointA,c.contactPointA,penetrationVec);add(c.contactPointA,c.contactPointA,offsetA);sub(c.contactPointA,c.contactPointA,bodyA.position);sub(c.contactPointB,worldPoint,offsetB);add(c.contactPointB,c.contactPointB,offsetB);sub(c.contactPointB,c.contactPointB,bodyB.position);this.contactEquations.push(c);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}}}}}if(this.enableFrictionReduction){if(this.enableFriction&&numContacts){this.frictionEquations.push(this.createFrictionFromAverage(numContacts))}}return numContacts};var L=A.fromValues(0,0);Narrowphase.projectConvexOntoAxis=function(a,b,c,d,e){var f=null,min=null,v,value,localAxis=L;A.rotate(localAxis,d,-c);for(var i=0;i<a.vertices.length;i++){v=a.vertices[i];value=dot(v,localAxis);if(f===null||value>f){f=value}if(min===null||value<min){min=value}}if(min>f){var t=min;min=f;f=t}var g=dot(b,d);A.set(e,min+g,f+g)};var M=A.fromValues(0,0),fsa_tmp2=A.fromValues(0,0),fsa_tmp3=A.fromValues(0,0),fsa_tmp4=A.fromValues(0,0),fsa_tmp5=A.fromValues(0,0),fsa_tmp6=A.fromValues(0,0);Narrowphase.findSeparatingAxis=function(d,e,f,g,h,k,l){var m=null,overlap=false,found=false,edge=M,worldPoint0=fsa_tmp2,worldPoint1=fsa_tmp3,normal=fsa_tmp4,span1=fsa_tmp5,span2=fsa_tmp6;if(d instanceof Box&&g instanceof Box){for(var j=0;j!==2;j++){var c=d,angle=f;if(j===1){c=g;angle=k}for(var i=0;i!==2;i++){if(i===0){A.set(normal,0,1)}else if(i===1){A.set(normal,1,0)}if(angle!==0){A.rotate(normal,normal,angle)}Narrowphase.projectConvexOntoAxis(d,e,f,normal,span1);Narrowphase.projectConvexOntoAxis(g,h,k,normal,span2);var a=span1,b=span2,swapped=false;if(span1[0]>span2[0]){b=span1;a=span2;swapped=true}var n=b[0]-a[1];overlap=(n<=0);if(m===null||n>m){A.copy(l,normal);m=n;found=overlap}}}}else{for(var j=0;j!==2;j++){var c=d,angle=f;if(j===1){c=g;angle=k}for(var i=0;i!==c.vertices.length;i++){A.rotate(worldPoint0,c.vertices[i],angle);A.rotate(worldPoint1,c.vertices[(i+1)%c.vertices.length],angle);sub(edge,worldPoint1,worldPoint0);A.rotate90cw(normal,edge);A.normalize(normal,normal);Narrowphase.projectConvexOntoAxis(d,e,f,normal,span1);Narrowphase.projectConvexOntoAxis(g,h,k,normal,span2);var a=span1,b=span2,swapped=false;if(span1[0]>span2[0]){b=span1;a=span2;swapped=true}var n=b[0]-a[1];overlap=(n<=0);if(m===null||n>m){A.copy(l,normal);m=n;found=overlap}}}}return found};var O=A.fromValues(0,0),gce_tmp2=A.fromValues(0,0),gce_tmp3=A.fromValues(0,0);Narrowphase.getClosestEdge=function(c,a,b,e){var f=O,edge=gce_tmp2,normal=gce_tmp3;A.rotate(f,b,-a);if(e){A.scale(f,f,-1)}var g=-1,N=c.vertices.length,maxDot=-1;for(var i=0;i!==N;i++){sub(edge,c.vertices[(i+1)%N],c.vertices[i%N]);A.rotate90cw(normal,edge);A.normalize(normal,normal);var d=dot(normal,f);if(g===-1||d>maxDot){g=i%N;maxDot=d}}return g};var P=A.create(),circleHeightfield_dist=A.create(),circleHeightfield_v0=A.create(),circleHeightfield_v1=A.create(),circleHeightfield_minCandidate=A.create(),circleHeightfield_worldNormal=A.create(),circleHeightfield_minCandidateNormal=A.create();Narrowphase.prototype[Shape.CIRCLE|Shape.HEIGHTFIELD]=Narrowphase.prototype.circleHeightfield=function(a,b,e,f,g,h,j,k,l,m){var n=h.heights,m=m||b.radius,w=h.elementWidth,dist=circleHeightfield_dist,candidate=P,minCandidate=circleHeightfield_minCandidate,minCandidateNormal=circleHeightfield_minCandidateNormal,worldNormal=circleHeightfield_worldNormal,v0=circleHeightfield_v0,v1=circleHeightfield_v1;var o=Math.floor((e[0]-m-j[0])/w),idxB=Math.ceil((e[0]+m-j[0])/w);if(o<0){o=0}if(idxB>=n.length){idxB=n.length-1}var p=n[o],min=n[idxB];for(var i=o;i<idxB;i++){if(n[i]<min){min=n[i]}if(n[i]>p){p=n[i]}}if(e[1]-m>p){return l?false:0}var q=false;for(var i=o;i<idxB;i++){A.set(v0,i*w,n[i]);A.set(v1,(i+1)*w,n[i+1]);A.add(v0,v0,j);A.add(v1,v1,j);A.sub(worldNormal,v1,v0);A.rotate(worldNormal,worldNormal,Math.PI/2);A.normalize(worldNormal,worldNormal);A.scale(candidate,worldNormal,-m);A.add(candidate,candidate,e);A.sub(dist,candidate,v0);var d=A.dot(dist,worldNormal);if(candidate[0]>=v0[0]&&candidate[0]<v1[0]&&d<=0){if(l){return true}q=true;A.scale(dist,worldNormal,-d);A.add(minCandidate,candidate,dist);A.copy(minCandidateNormal,worldNormal);var c=this.createContactEquation(g,a,h,b);A.copy(c.normalA,minCandidateNormal);A.scale(c.contactPointB,c.normalA,-m);add(c.contactPointB,c.contactPointB,e);sub(c.contactPointB,c.contactPointB,a.position);A.copy(c.contactPointA,minCandidate);A.sub(c.contactPointA,c.contactPointA,g.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}}}q=false;if(m>0){for(var i=o;i<=idxB;i++){A.set(v0,i*w,n[i]);A.add(v0,v0,j);A.sub(dist,e,v0);if(A.squaredLength(dist)<Math.pow(m,2)){if(l){return true}q=true;var c=this.createContactEquation(g,a,h,b);A.copy(c.normalA,dist);A.normalize(c.normalA,c.normalA);A.scale(c.contactPointB,c.normalA,-m);add(c.contactPointB,c.contactPointB,e);sub(c.contactPointB,c.contactPointB,a.position);sub(c.contactPointA,v0,j);add(c.contactPointA,c.contactPointA,j);sub(c.contactPointA,c.contactPointA,g.position);this.contactEquations.push(c);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(c))}}}}if(q){return 1}return 0};var Q=A.create(),convexHeightfield_v1=A.create(),convexHeightfield_tilePos=A.create(),convexHeightfield_tempConvexShape=new Convex({vertices:[A.create(),A.create(),A.create(),A.create()]});Narrowphase.prototype[Shape.BOX|Shape.HEIGHTFIELD]=Narrowphase.prototype[Shape.CONVEX|Shape.HEIGHTFIELD]=Narrowphase.prototype.convexHeightfield=function(a,b,c,d,e,f,g,h,j){var k=f.heights,w=f.elementWidth,v0=Q,v1=convexHeightfield_v1,tilePos=convexHeightfield_tilePos,tileConvex=convexHeightfield_tempConvexShape;var l=Math.floor((a.aabb.lowerBound[0]-g[0])/w),idxB=Math.ceil((a.aabb.upperBound[0]-g[0])/w);if(l<0){l=0}if(idxB>=k.length){idxB=k.length-1}var m=k[l],min=k[idxB];for(var i=l;i<idxB;i++){if(k[i]<min){min=k[i]}if(k[i]>m){m=k[i]}}if(a.aabb.lowerBound[1]>m){return j?false:0}var n=false;var o=0;for(var i=l;i<idxB;i++){A.set(v0,i*w,k[i]);A.set(v1,(i+1)*w,k[i+1]);A.add(v0,v0,g);A.add(v1,v1,g);var p=100;A.set(tilePos,(v1[0]+v0[0])*0.5,(v1[1]+v0[1]-p)*0.5);A.sub(tileConvex.vertices[0],v1,tilePos);A.sub(tileConvex.vertices[1],v0,tilePos);A.copy(tileConvex.vertices[2],tileConvex.vertices[1]);A.copy(tileConvex.vertices[3],tileConvex.vertices[0]);tileConvex.vertices[2][1]-=p;tileConvex.vertices[3][1]-=p;o+=this.convexConvex(a,b,c,d,e,tileConvex,tilePos,0,j)}return o}},{'../equations/ContactEquation':21,'../equations/Equation':22,'../equations/FrictionEquation':23,'../math/vec2':30,'../objects/Body':31,'../shapes/Box':37,'../shapes/Circle':39,'../shapes/Convex':40,'../shapes/Shape':45,'../utils/ContactEquationPool':48,'../utils/FrictionEquationPool':49,'../utils/TupleDictionary':56,'../utils/Utils':57}],11:[function(j,k,m){k.exports=Ray;var n=j('../math/vec2');var o=j('../collision/RaycastResult');var p=j('../shapes/Shape');var q=j('../collision/AABB');function Ray(b){b=b||{};this.from=b.from?n.fromValues(b.from[0],b.from[1]):n.create();this.to=b.to?n.fromValues(b.to[0],b.to[1]):n.create();this.checkCollisionResponse=b.checkCollisionResponse!==undefined?b.checkCollisionResponse:true;this.skipBackfaces=!!b.skipBackfaces;this.collisionMask=b.collisionMask!==undefined?b.collisionMask:-1;this.collisionGroup=b.collisionGroup!==undefined?b.collisionGroup:-1;this.mode=b.mode!==undefined?b.mode:Ray.ANY;this.callback=b.callback||function(a){};this.direction=n.create();this.length=1;this.update()}Ray.prototype.constructor=Ray;Ray.CLOSEST=1;Ray.ANY=2;Ray.ALL=4;Ray.prototype.update=function(){var d=this.direction;n.sub(d,this.to,this.from);this.length=n.length(d);n.normalize(d,d)};Ray.prototype.intersectBodies=function(a,b){for(var i=0,l=b.length;!a.shouldStop(this)&&i<l;i++){var c=b[i];var d=c.getAABB();if(d.overlapsRay(this)>=0||d.containsPoint(this.from)){this.intersectBody(a,c)}}};var r=n.create();Ray.prototype.intersectBody=function(a,b){var c=this.checkCollisionResponse;if(c&&!b.collisionResponse){return}var d=r;for(var i=0,N=b.shapes.length;i<N;i++){var e=b.shapes[i];if(c&&!e.collisionResponse){continue}if((this.collisionGroup&e.collisionMask)===0||(e.collisionGroup&this.collisionMask)===0){continue}n.rotate(d,e.position,b.angle);n.add(d,d,b.position);var f=e.angle+b.angle;this.intersectShape(a,e,f,d,b);if(a.shouldStop(this)){break}}};Ray.prototype.intersectShape=function(a,b,c,d,e){var f=this.from;var g=distanceFromIntersectionSquared(f,this.direction,d);if(g>b.boundingRadius*b.boundingRadius){return}this._currentBody=e;this._currentShape=b;b.raycast(a,this,d,c);this._currentBody=this._currentShape=null};Ray.prototype.getAABB=function(a){var b=this.to;var c=this.from;n.set(a.lowerBound,Math.min(b[0],c[0]),Math.min(b[1],c[1]));n.set(a.upperBound,Math.max(b[0],c[0]),Math.max(b[1],c[1]))};var s=n.create();Ray.prototype.reportIntersection=function(a,b,c,d){var e=this.from;var f=this.to;var g=this._currentShape;var h=this._currentBody;if(this.skipBackfaces&&n.dot(c,this.direction)>0){return}switch(this.mode){case Ray.ALL:a.set(c,g,h,b,d);this.callback(a);break;case Ray.CLOSEST:if(b<a.fraction||!a.hasHit()){a.set(c,g,h,b,d)}break;case Ray.ANY:a.set(c,g,h,b,d);break}};var t=n.create(),intersect=n.create();function distanceFromIntersectionSquared(a,b,c){n.sub(t,c,a);var d=n.dot(t,b);n.scale(intersect,b,d);n.add(intersect,intersect,a);return n.squaredDistance(c,intersect)}},{'../collision/AABB':7,'../collision/RaycastResult':12,'../math/vec2':30,'../shapes/Shape':45}],12:[function(f,g,h){var i=f('../math/vec2');var j=f('../collision/Ray');g.exports=RaycastResult;function RaycastResult(){this.normal=i.create();this.shape=null;this.body=null;this.faceIndex=-1;this.fraction=-1;this.isStopped=false}RaycastResult.prototype.reset=function(){i.set(this.normal,0,0);this.shape=null;this.body=null;this.faceIndex=-1;this.fraction=-1;this.isStopped=false};RaycastResult.prototype.getHitDistance=function(a){return i.distance(a.from,a.to)*this.fraction};RaycastResult.prototype.hasHit=function(){return this.fraction!==-1};RaycastResult.prototype.getHitPoint=function(a,b){i.lerp(a,b.from,b.to,this.fraction)};RaycastResult.prototype.stop=function(){this.isStopped=true};RaycastResult.prototype.shouldStop=function(a){return this.isStopped||(this.fraction!==-1&&a.mode===j.ANY)};RaycastResult.prototype.set=function(a,b,c,d,e){i.copy(this.normal,a);this.shape=b;this.body=c;this.fraction=d;this.faceIndex=e}},{'../collision/Ray':11,'../math/vec2':30}],13:[function(k,m,n){var o=k('../utils/Utils'),Broadphase=k('../collision/Broadphase');m.exports=SAPBroadphase;function SAPBroadphase(){Broadphase.call(this,Broadphase.SAP);this.axisList=[];this.axisIndex=0;var b=this;this._addBodyHandler=function(e){b.axisList.push(e.body)};this._removeBodyHandler=function(e){var a=b.axisList.indexOf(e.body);if(a!==-1){b.axisList.splice(a,1)}}}SAPBroadphase.prototype=new Broadphase();SAPBroadphase.prototype.constructor=SAPBroadphase;SAPBroadphase.prototype.setWorld=function(a){this.axisList.length=0;o.appendArray(this.axisList,a.bodies);a.off('addBody',this._addBodyHandler).off('removeBody',this._removeBodyHandler);a.on('addBody',this._addBodyHandler).on('removeBody',this._removeBodyHandler);this.world=a};SAPBroadphase.sortAxisList=function(a,b){b=b|0;for(var i=1,l=a.length;i<l;i++){var v=a[i];for(var j=i-1;j>=0;j--){if(a[j].aabb.lowerBound[b]<=v.aabb.lowerBound[b]){break}a[j+1]=a[j]}a[j+1]=v}return a};SAPBroadphase.prototype.sortList=function(){var a=this.axisList,axisIndex=this.axisIndex;SAPBroadphase.sortAxisList(a,axisIndex)};SAPBroadphase.prototype.getCollisionPairs=function(a){var c=this.axisList,result=this.result,axisIndex=this.axisIndex;result.length=0;var l=c.length;while(l--){var b=c[l];if(b.aabbNeedsUpdate){b.updateAABB()}}this.sortList();for(var i=0,N=c.length|0;i!==N;i++){var d=c[i];for(var j=i+1;j<N;j++){var e=c[j];var f=(e.aabb.lowerBound[axisIndex]<=d.aabb.upperBound[axisIndex]);if(!f){break}if(Broadphase.canCollide(d,e)&&this.boundingVolumeCheck(d,e)){result.push(d,e)}}}return result};SAPBroadphase.prototype.aabbQuery=function(a,c,d){d=d||[];this.sortList();var e=this.axisIndex;var f='x';if(e===1){f='y'}if(e===2){f='z'}var g=this.axisList;var h=c.lowerBound[f];var j=c.upperBound[f];for(var i=0;i<g.length;i++){var b=g[i];if(b.aabbNeedsUpdate){b.updateAABB()}if(b.aabb.overlaps(c)){d.push(b)}}return d}},{'../collision/Broadphase':8,'../utils/Utils':57}],14:[function(e,f,g){f.exports=Constraint;var h=e('../utils/Utils');function Constraint(a,b,c,d){this.type=c;d=h.defaults(d,{collideConnected:true,wakeUpBodies:true});this.equations=[];this.bodyA=a;this.bodyB=b;this.collideConnected=d.collideConnected;if(d.wakeUpBodies){if(a){a.wakeUp()}if(b){b.wakeUp()}}}Constraint.prototype.update=function(){throw new Error('method update() not implmemented in this Constraint subclass!');};Constraint.DISTANCE=1;Constraint.GEAR=2;Constraint.LOCK=3;Constraint.PRISMATIC=4;Constraint.REVOLUTE=5;Constraint.prototype.setStiffness=function(a){var b=this.equations;for(var i=0;i!==b.length;i++){var c=b[i];c.stiffness=a;c.needsUpdate=true}};Constraint.prototype.setRelaxation=function(a){var b=this.equations;for(var i=0;i!==b.length;i++){var c=b[i];c.relaxation=a;c.needsUpdate=true}}},{'../utils/Utils':57}],15:[function(m,o,p){var q=m('./Constraint'),Equation=m('../equations/Equation'),vec2=m('../math/vec2'),Utils=m('../utils/Utils');o.exports=DistanceConstraint;function DistanceConstraint(b,c,d){d=Utils.defaults(d,{localAnchorA:[0,0],localAnchorB:[0,0]});q.call(this,b,c,q.DISTANCE,d);this.localAnchorA=vec2.fromValues(d.localAnchorA[0],d.localAnchorA[1]);this.localAnchorB=vec2.fromValues(d.localAnchorB[0],d.localAnchorB[1]);var e=this.localAnchorA;var f=this.localAnchorB;this.distance=0;if(typeof(d.distance)==='number'){this.distance=d.distance}else{var g=vec2.create(),worldAnchorB=vec2.create(),r=vec2.create();vec2.rotate(g,e,b.angle);vec2.rotate(worldAnchorB,f,c.angle);vec2.add(r,c.position,worldAnchorB);vec2.sub(r,r,g);vec2.sub(r,r,b.position);this.distance=vec2.length(r)}var h;if(typeof(d.maxForce)==='undefined'){h=Number.MAX_VALUE}else{h=d.maxForce}var i=new Equation(b,c,-h,h);this.equations=[i];this.maxForce=h;var r=vec2.create();var j=vec2.create();var k=vec2.create();var l=this;i.computeGq=function(){var a=this.bodyA,c=this.bodyB,xi=a.position,xj=c.position;vec2.rotate(j,e,a.angle);vec2.rotate(k,f,c.angle);vec2.add(r,xj,k);vec2.sub(r,r,j);vec2.sub(r,r,xi);return vec2.length(r)-l.distance};this.setMaxForce(h);this.upperLimitEnabled=false;this.upperLimit=1;this.lowerLimitEnabled=false;this.lowerLimit=0;this.position=0}DistanceConstraint.prototype=new q();DistanceConstraint.prototype.constructor=DistanceConstraint;var n=vec2.create();var s=vec2.create();var t=vec2.create();DistanceConstraint.prototype.update=function(){var a=this.equations[0],bodyA=this.bodyA,bodyB=this.bodyB,distance=this.distance,xi=bodyA.position,xj=bodyB.position,normalEquation=this.equations[0],G=a.G;vec2.rotate(s,this.localAnchorA,bodyA.angle);vec2.rotate(t,this.localAnchorB,bodyB.angle);vec2.add(n,xj,t);vec2.sub(n,n,s);vec2.sub(n,n,xi);this.position=vec2.length(n);var b=false;if(this.upperLimitEnabled){if(this.position>this.upperLimit){normalEquation.maxForce=0;normalEquation.minForce=-this.maxForce;this.distance=this.upperLimit;b=true}}if(this.lowerLimitEnabled){if(this.position<this.lowerLimit){normalEquation.maxForce=this.maxForce;normalEquation.minForce=0;this.distance=this.lowerLimit;b=true}}if((this.lowerLimitEnabled||this.upperLimitEnabled)&&!b){normalEquation.enabled=false;return}normalEquation.enabled=true;vec2.normalize(n,n);var c=vec2.crossLength(s,n),rjxn=vec2.crossLength(t,n);G[0]=-n[0];G[1]=-n[1];G[2]=-c;G[3]=n[0];G[4]=n[1];G[5]=rjxn};DistanceConstraint.prototype.setMaxForce=function(a){var b=this.equations[0];b.minForce=-a;b.maxForce=a};DistanceConstraint.prototype.getMaxForce=function(){var a=this.equations[0];return a.maxForce}},{'../equations/Equation':22,'../math/vec2':30,'../utils/Utils':57,'./Constraint':14}],16:[function(d,e,f){var g=d('./Constraint'),Equation=d('../equations/Equation'),AngleLockEquation=d('../equations/AngleLockEquation'),vec2=d('../math/vec2');e.exports=GearConstraint;function GearConstraint(a,b,c){c=c||{};g.call(this,a,b,g.GEAR,c);this.ratio=c.ratio!==undefined?c.ratio:1;this.angle=c.angle!==undefined?c.angle:b.angle-this.ratio*a.angle;c.angle=this.angle;c.ratio=this.ratio;this.equations=[new AngleLockEquation(a,b,c)];if(c.maxTorque!==undefined){this.setMaxTorque(c.maxTorque)}}GearConstraint.prototype=new g();GearConstraint.prototype.constructor=GearConstraint;GearConstraint.prototype.update=function(){var a=this.equations[0];if(a.ratio!==this.ratio){a.setRatio(this.ratio)}a.angle=this.angle};GearConstraint.prototype.setMaxTorque=function(a){this.equations[0].setMaxTorque(a)};GearConstraint.prototype.getMaxTorque=function(a){return this.equations[0].maxForce}},{'../equations/AngleLockEquation':20,'../equations/Equation':22,'../math/vec2':30,'./Constraint':14}],17:[function(f,h,j){var k=f('./Constraint'),vec2=f('../math/vec2'),Equation=f('../equations/Equation');h.exports=LockConstraint;function LockConstraint(a,b,c){c=c||{};k.call(this,a,b,k.LOCK,c);var d=(typeof(c.maxForce)==='undefined'?Number.MAX_VALUE:c.maxForce);var e=c.localAngleB||0;var x=new Equation(a,b,-d,d),y=new Equation(a,b,-d,d),rot=new Equation(a,b,-d,d);var l=vec2.create(),g=vec2.create(),that=this;x.computeGq=function(){vec2.rotate(l,that.localOffsetB,a.angle);vec2.sub(g,b.position,a.position);vec2.sub(g,g,l);return g[0]};y.computeGq=function(){vec2.rotate(l,that.localOffsetB,a.angle);vec2.sub(g,b.position,a.position);vec2.sub(g,g,l);return g[1]};var r=vec2.create(),t=vec2.create();rot.computeGq=function(){vec2.rotate(r,that.localOffsetB,b.angle-that.localAngleB);vec2.scale(r,r,-1);vec2.sub(g,a.position,b.position);vec2.add(g,g,r);vec2.rotate(t,r,-Math.PI/2);vec2.normalize(t,t);return vec2.dot(g,t)};this.localOffsetB=vec2.create();if(c.localOffsetB){vec2.copy(this.localOffsetB,c.localOffsetB)}else{vec2.sub(this.localOffsetB,b.position,a.position);vec2.rotate(this.localOffsetB,this.localOffsetB,-a.angle)}this.localAngleB=0;if(typeof(c.localAngleB)==='number'){this.localAngleB=c.localAngleB}else{this.localAngleB=b.angle-a.angle}this.equations.push(x,y,rot);this.setMaxForce(d)}LockConstraint.prototype=new k();LockConstraint.prototype.constructor=LockConstraint;LockConstraint.prototype.setMaxForce=function(a){var b=this.equations;for(var i=0;i<this.equations.length;i++){b[i].maxForce=a;b[i].minForce=-a}};LockConstraint.prototype.getMaxForce=function(){return this.equations[0].maxForce};var l=vec2.create();var r=vec2.create();var t=vec2.create();var m=vec2.fromValues(1,0);var n=vec2.fromValues(0,1);LockConstraint.prototype.update=function(){var x=this.equations[0],y=this.equations[1],rot=this.equations[2],bodyA=this.bodyA,bodyB=this.bodyB;vec2.rotate(l,this.localOffsetB,bodyA.angle);vec2.rotate(r,this.localOffsetB,bodyB.angle-this.localAngleB);vec2.scale(r,r,-1);vec2.rotate(t,r,Math.PI/2);vec2.normalize(t,t);x.G[0]=-1;x.G[1]=0;x.G[2]=-vec2.crossLength(l,m);x.G[3]=1;y.G[0]=0;y.G[1]=-1;y.G[2]=-vec2.crossLength(l,n);y.G[4]=1;rot.G[0]=-t[0];rot.G[1]=-t[1];rot.G[3]=t[0];rot.G[4]=t[1];rot.G[5]=vec2.crossLength(r,t)}},{'../equations/Equation':22,'../math/vec2':30,'./Constraint':14}],18:[function(l,m,n){var o=l('./Constraint'),ContactEquation=l('../equations/ContactEquation'),Equation=l('../equations/Equation'),vec2=l('../math/vec2'),RotationalLockEquation=l('../equations/RotationalLockEquation');m.exports=PrismaticConstraint;function PrismaticConstraint(a,b,c){c=c||{};o.call(this,a,b,o.PRISMATIC,c);var d=vec2.fromValues(0,0),localAxisA=vec2.fromValues(1,0),localAnchorB=vec2.fromValues(0,0);if(c.localAnchorA){vec2.copy(d,c.localAnchorA)}if(c.localAxisA){vec2.copy(localAxisA,c.localAxisA)}if(c.localAnchorB){vec2.copy(localAnchorB,c.localAnchorB)}this.localAnchorA=d;this.localAnchorB=localAnchorB;this.localAxisA=localAxisA;var e=this.maxForce=typeof(c.maxForce)!=='undefined'?c.maxForce:Number.MAX_VALUE;var f=new Equation(a,b,-e,e);var g=new vec2.create(),rj=new vec2.create(),gg=new vec2.create(),t=new vec2.create();f.computeGq=function(){return vec2.dot(gg,t)};f.updateJacobian=function(){var G=this.G,xi=a.position,xj=b.position;vec2.rotate(g,d,a.angle);vec2.rotate(rj,localAnchorB,b.angle);vec2.add(gg,xj,rj);vec2.sub(gg,gg,xi);vec2.sub(gg,gg,g);vec2.rotate(t,localAxisA,a.angle+Math.PI/2);G[0]=-t[0];G[1]=-t[1];G[2]=-vec2.crossLength(g,t)+vec2.crossLength(t,gg);G[3]=t[0];G[4]=t[1];G[5]=vec2.crossLength(rj,t)};this.equations.push(f);if(!c.disableRotationalLock){var h=new RotationalLockEquation(a,b,-e,e);this.equations.push(h)}this.position=0;this.velocity=0;this.lowerLimitEnabled=typeof(c.lowerLimit)!=='undefined'?true:false;this.upperLimitEnabled=typeof(c.upperLimit)!=='undefined'?true:false;this.lowerLimit=typeof(c.lowerLimit)!=='undefined'?c.lowerLimit:0;this.upperLimit=typeof(c.upperLimit)!=='undefined'?c.upperLimit:1;this.upperLimitEquation=new ContactEquation(a,b);this.lowerLimitEquation=new ContactEquation(a,b);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=e;this.motorEquation=new Equation(a,b);this.motorEnabled=false;this.motorSpeed=0;var i=this;var j=this.motorEquation;var k=j.computeGW;j.computeGq=function(){return 0};j.computeGW=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,vi=bi.velocity,vj=bj.velocity,wi=bi.angularVelocity,wj=bj.angularVelocity;return this.gmult(G,vi,wi,vj,wj)+i.motorSpeed}}PrismaticConstraint.prototype=new o();PrismaticConstraint.prototype.constructor=PrismaticConstraint;var p=vec2.create(),worldAnchorA=vec2.create(),worldAnchorB=vec2.create(),orientedAnchorA=vec2.create(),orientedAnchorB=vec2.create(),tmp=vec2.create();PrismaticConstraint.prototype.update=function(){var a=this.equations,trans=a[0],upperLimit=this.upperLimit,lowerLimit=this.lowerLimit,upperLimitEquation=this.upperLimitEquation,lowerLimitEquation=this.lowerLimitEquation,bodyA=this.bodyA,bodyB=this.bodyB,localAxisA=this.localAxisA,localAnchorA=this.localAnchorA,localAnchorB=this.localAnchorB;trans.updateJacobian();vec2.rotate(p,localAxisA,bodyA.angle);vec2.rotate(orientedAnchorA,localAnchorA,bodyA.angle);vec2.add(worldAnchorA,orientedAnchorA,bodyA.position);vec2.rotate(orientedAnchorB,localAnchorB,bodyB.angle);vec2.add(worldAnchorB,orientedAnchorB,bodyB.position);var b=this.position=vec2.dot(worldAnchorB,p)-vec2.dot(worldAnchorA,p);if(this.motorEnabled){var G=this.motorEquation.G;G[0]=p[0];G[1]=p[1];G[2]=vec2.crossLength(p,orientedAnchorB);G[3]=-p[0];G[4]=-p[1];G[5]=-vec2.crossLength(p,orientedAnchorA)}if(this.upperLimitEnabled&&b>upperLimit){vec2.scale(upperLimitEquation.normalA,p,-1);vec2.sub(upperLimitEquation.contactPointA,worldAnchorA,bodyA.position);vec2.sub(upperLimitEquation.contactPointB,worldAnchorB,bodyB.position);vec2.scale(tmp,p,upperLimit);vec2.add(upperLimitEquation.contactPointA,upperLimitEquation.contactPointA,tmp);if(a.indexOf(upperLimitEquation)===-1){a.push(upperLimitEquation)}}else{var c=a.indexOf(upperLimitEquation);if(c!==-1){a.splice(c,1)}}if(this.lowerLimitEnabled&&b<lowerLimit){vec2.scale(lowerLimitEquation.normalA,p,1);vec2.sub(lowerLimitEquation.contactPointA,worldAnchorA,bodyA.position);vec2.sub(lowerLimitEquation.contactPointB,worldAnchorB,bodyB.position);vec2.scale(tmp,p,lowerLimit);vec2.sub(lowerLimitEquation.contactPointB,lowerLimitEquation.contactPointB,tmp);if(a.indexOf(lowerLimitEquation)===-1){a.push(lowerLimitEquation)}}else{var c=a.indexOf(lowerLimitEquation);if(c!==-1){a.splice(c,1)}}};PrismaticConstraint.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};PrismaticConstraint.prototype.disableMotor=function(){if(!this.motorEnabled){return}var i=this.equations.indexOf(this.motorEquation);this.equations.splice(i,1);this.motorEnabled=false};PrismaticConstraint.prototype.setLimits=function(a,b){if(typeof(a)==='number'){this.lowerLimit=a;this.lowerLimitEnabled=true}else{this.lowerLimit=a;this.lowerLimitEnabled=false}if(typeof(b)==='number'){this.upperLimit=b;this.upperLimitEnabled=true}else{this.upperLimit=b;this.upperLimitEnabled=false}}},{'../equations/ContactEquation':21,'../equations/Equation':22,'../equations/RotationalLockEquation':24,'../math/vec2':30,'./Constraint':14}],19:[function(h,j,k){var l=h('./Constraint'),Equation=h('../equations/Equation'),RotationalVelocityEquation=h('../equations/RotationalVelocityEquation'),RotationalLockEquation=h('../equations/RotationalLockEquation'),vec2=h('../math/vec2');j.exports=RevoluteConstraint;var m=vec2.create(),worldPivotB=vec2.create(),xAxis=vec2.fromValues(1,0),yAxis=vec2.fromValues(0,1),g=vec2.create();function RevoluteConstraint(a,b,c){c=c||{};l.call(this,a,b,l.REVOLUTE,c);var d=this.maxForce=typeof(c.maxForce)!=='undefined'?c.maxForce:Number.MAX_VALUE;this.pivotA=vec2.create();this.pivotB=vec2.create();if(c.worldPivot){vec2.sub(this.pivotA,c.worldPivot,a.position);vec2.sub(this.pivotB,c.worldPivot,b.position);vec2.rotate(this.pivotA,this.pivotA,-a.angle);vec2.rotate(this.pivotB,this.pivotB,-b.angle)}else{vec2.copy(this.pivotA,c.localPivotA);vec2.copy(this.pivotB,c.localPivotB)}var e=this.equations=[new Equation(a,b,-d,d),new Equation(a,b,-d,d)];var x=e[0];var y=e[1];var f=this;x.computeGq=function(){vec2.rotate(m,f.pivotA,a.angle);vec2.rotate(worldPivotB,f.pivotB,b.angle);vec2.add(g,b.position,worldPivotB);vec2.sub(g,g,a.position);vec2.sub(g,g,m);return vec2.dot(g,xAxis)};y.computeGq=function(){vec2.rotate(m,f.pivotA,a.angle);vec2.rotate(worldPivotB,f.pivotB,b.angle);vec2.add(g,b.position,worldPivotB);vec2.sub(g,g,a.position);vec2.sub(g,g,m);return vec2.dot(g,yAxis)};y.minForce=x.minForce=-d;y.maxForce=x.maxForce=d;this.motorEquation=new RotationalVelocityEquation(a,b);this.motorEnabled=false;this.angle=0;this.lowerLimitEnabled=false;this.upperLimitEnabled=false;this.lowerLimit=0;this.upperLimit=0;this.upperLimitEquation=new RotationalLockEquation(a,b);this.lowerLimitEquation=new RotationalLockEquation(a,b);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}RevoluteConstraint.prototype=new l();RevoluteConstraint.prototype.constructor=RevoluteConstraint;RevoluteConstraint.prototype.setLimits=function(a,b){if(typeof(a)==='number'){this.lowerLimit=a;this.lowerLimitEnabled=true}else{this.lowerLimit=a;this.lowerLimitEnabled=false}if(typeof(b)==='number'){this.upperLimit=b;this.upperLimitEnabled=true}else{this.upperLimit=b;this.upperLimitEnabled=false}};RevoluteConstraint.prototype.update=function(){var a=this.bodyA,bodyB=this.bodyB,pivotA=this.pivotA,pivotB=this.pivotB,eqs=this.equations,normal=eqs[0],tangent=eqs[1],x=eqs[0],y=eqs[1],upperLimit=this.upperLimit,lowerLimit=this.lowerLimit,upperLimitEquation=this.upperLimitEquation,lowerLimitEquation=this.lowerLimitEquation;var b=this.angle=bodyB.angle-a.angle;if(this.upperLimitEnabled&&b>upperLimit){upperLimitEquation.angle=upperLimit;if(eqs.indexOf(upperLimitEquation)===-1){eqs.push(upperLimitEquation)}}else{var c=eqs.indexOf(upperLimitEquation);if(c!==-1){eqs.splice(c,1)}}if(this.lowerLimitEnabled&&b<lowerLimit){lowerLimitEquation.angle=lowerLimit;if(eqs.indexOf(lowerLimitEquation)===-1){eqs.push(lowerLimitEquation)}}else{var c=eqs.indexOf(lowerLimitEquation);if(c!==-1){eqs.splice(c,1)}}vec2.rotate(m,pivotA,a.angle);vec2.rotate(worldPivotB,pivotB,bodyB.angle);x.G[0]=-1;x.G[1]=0;x.G[2]=-vec2.crossLength(m,xAxis);x.G[3]=1;x.G[4]=0;x.G[5]=vec2.crossLength(worldPivotB,xAxis);y.G[0]=0;y.G[1]=-1;y.G[2]=-vec2.crossLength(m,yAxis);y.G[3]=0;y.G[4]=1;y.G[5]=vec2.crossLength(worldPivotB,yAxis)};RevoluteConstraint.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};RevoluteConstraint.prototype.disableMotor=function(){if(!this.motorEnabled){return}var i=this.equations.indexOf(this.motorEquation);this.equations.splice(i,1);this.motorEnabled=false};RevoluteConstraint.prototype.setMotorSpeed=function(a){if(!this.motorEnabled){return}var i=this.equations.indexOf(this.motorEquation);this.equations[i].relativeVelocity=a};RevoluteConstraint.prototype.getMotorSpeed=function(){if(!this.motorEnabled){return false}return this.motorEquation.relativeVelocity}},{'../equations/Equation':22,'../equations/RotationalLockEquation':24,'../equations/RotationalVelocityEquation':25,'../math/vec2':30,'./Constraint':14}],20:[function(d,e,f){var g=d('./Equation'),vec2=d('../math/vec2');e.exports=AngleLockEquation;function AngleLockEquation(a,b,c){c=c||{};g.call(this,a,b,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=c.angle||0;this.ratio=typeof(c.ratio)==='number'?c.ratio:1;this.setRatio(this.ratio)}AngleLockEquation.prototype=new g();AngleLockEquation.prototype.constructor=AngleLockEquation;AngleLockEquation.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};AngleLockEquation.prototype.setRatio=function(a){var G=this.G;G[2]=a;G[5]=-1;this.ratio=a};AngleLockEquation.prototype.setMaxTorque=function(a){this.maxForce=a;this.minForce=-a}},{'../math/vec2':30,'./Equation':22}],21:[function(i,j,k){var l=i('./Equation'),vec2=i('../math/vec2');j.exports=ContactEquation;function ContactEquation(a,b){l.call(this,a,b,0,Number.MAX_VALUE);this.contactPointA=vec2.create();this.penetrationVec=vec2.create();this.contactPointB=vec2.create();this.normalA=vec2.create();this.restitution=0;this.firstImpact=false;this.shapeA=null;this.shapeB=null}ContactEquation.prototype=new l();ContactEquation.prototype.constructor=ContactEquation;ContactEquation.prototype.computeB=function(a,b,h){var c=this.bodyA,bj=this.bodyB,ri=this.contactPointA,rj=this.contactPointB,xi=c.position,xj=bj.position;var d=this.penetrationVec,n=this.normalA,G=this.G;var e=vec2.crossLength(ri,n),rjxn=vec2.crossLength(rj,n);G[0]=-n[0];G[1]=-n[1];G[2]=-e;G[3]=n[0];G[4]=n[1];G[5]=rjxn;vec2.add(d,xj,rj);vec2.sub(d,d,xi);vec2.sub(d,d,ri);var f,Gq;if(this.firstImpact&&this.restitution!==0){Gq=0;f=(1/b)*(1+this.restitution)*this.computeGW()}else{Gq=vec2.dot(n,d)+this.offset;f=this.computeGW()}var g=this.computeGiMf();var B=-Gq*a-f*b-h*g;return B};var m=vec2.create();var o=vec2.create();var p=vec2.create();ContactEquation.prototype.getVelocityAlongNormal=function(){this.bodyA.getVelocityAtPoint(m,this.contactPointA);this.bodyB.getVelocityAtPoint(o,this.contactPointB);vec2.subtract(p,m,o);return vec2.dot(this.normalA,p)}},{'../math/vec2':30,'./Equation':22}],22:[function(f,g,j){g.exports=Equation;var l=f('../math/vec2'),Utils=f('../utils/Utils'),Body=f('../objects/Body');function Equation(a,b,c,d){this.minForce=typeof(c)==='undefined'?-Number.MAX_VALUE:c;this.maxForce=typeof(d)==='undefined'?Number.MAX_VALUE:d;this.bodyA=a;this.bodyB=b;this.stiffness=Equation.DEFAULT_STIFFNESS;this.relaxation=Equation.DEFAULT_RELAXATION;this.G=new Utils.ARRAY_TYPE(6);for(var i=0;i<6;i++){this.G[i]=0}this.offset=0;this.a=0;this.b=0;this.epsilon=0;this.timeStep=1/60;this.needsUpdate=true;this.multiplier=0;this.relativeVelocity=0;this.enabled=true}Equation.prototype.constructor=Equation;Equation.DEFAULT_STIFFNESS=1e6;Equation.DEFAULT_RELAXATION=4;Equation.prototype.update=function(){var k=this.stiffness,d=this.relaxation,h=this.timeStep;this.a=4.0/(h*(1+4*d));this.b=(4.0*d)/(1+4*d);this.epsilon=4.0/(h*h*k*(1+4*d));this.needsUpdate=false};Equation.prototype.gmult=function(G,a,b,c,d){return G[0]*a[0]+G[1]*a[1]+G[2]*b+G[3]*c[0]+G[4]*c[1]+G[5]*d};Equation.prototype.computeB=function(a,b,h){var c=this.computeGW();var d=this.computeGq();var e=this.computeGiMf();return-d*a-c*b-e*h};var m=l.create(),qj=l.create();Equation.prototype.computeGq=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,xi=bi.position,xj=bj.position,ai=bi.angle,aj=bj.angle;return this.gmult(G,m,ai,qj,aj)+this.offset};Equation.prototype.computeGW=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,vi=bi.velocity,vj=bj.velocity,wi=bi.angularVelocity,wj=bj.angularVelocity;return this.gmult(G,vi,wi,vj,wj)+this.relativeVelocity};Equation.prototype.computeGWlambda=function(){var G=this.G,bi=this.bodyA,bj=this.bodyB,vi=bi.vlambda,vj=bj.vlambda,wi=bi.wlambda,wj=bj.wlambda;return this.gmult(G,vi,wi,vj,wj)};var n=l.create(),iMfj=l.create();Equation.prototype.computeGiMf=function(){var a=this.bodyA,bj=this.bodyB,fi=a.force,ti=a.angularForce,fj=bj.force,tj=bj.angularForce,invMassi=a.invMassSolve,invMassj=bj.invMassSolve,invIi=a.invInertiaSolve,invIj=bj.invInertiaSolve,G=this.G;l.scale(n,fi,invMassi);l.multiply(n,a.massMultiplier,n);l.scale(iMfj,fj,invMassj);l.multiply(iMfj,bj.massMultiplier,iMfj);return this.gmult(G,n,ti*invIi,iMfj,tj*invIj)};Equation.prototype.computeGiMGt=function(){var a=this.bodyA,bj=this.bodyB,invMassi=a.invMassSolve,invMassj=bj.invMassSolve,invIi=a.invInertiaSolve,invIj=bj.invInertiaSolve,G=this.G;return G[0]*G[0]*invMassi*a.massMultiplier[0]+G[1]*G[1]*invMassi*a.massMultiplier[1]+G[2]*G[2]*invIi+G[3]*G[3]*invMassj*bj.massMultiplier[0]+G[4]*G[4]*invMassj*bj.massMultiplier[1]+G[5]*G[5]*invIj};var o=l.create(),addToWlambda_Gi=l.create(),addToWlambda_Gj=l.create(),addToWlambda_ri=l.create(),addToWlambda_rj=l.create(),addToWlambda_Mdiag=l.create();Equation.prototype.addToWlambda=function(a){var b=this.bodyA,bj=this.bodyB,temp=o,Gi=addToWlambda_Gi,Gj=addToWlambda_Gj,ri=addToWlambda_ri,rj=addToWlambda_rj,invMassi=b.invMassSolve,invMassj=bj.invMassSolve,invIi=b.invInertiaSolve,invIj=bj.invInertiaSolve,Mdiag=addToWlambda_Mdiag,G=this.G;Gi[0]=G[0];Gi[1]=G[1];Gj[0]=G[3];Gj[1]=G[4];l.scale(temp,Gi,invMassi*a);l.multiply(temp,temp,b.massMultiplier);l.add(b.vlambda,b.vlambda,temp);b.wlambda+=invIi*G[2]*a;l.scale(temp,Gj,invMassj*a);l.multiply(temp,temp,bj.massMultiplier);l.add(bj.vlambda,bj.vlambda,temp);bj.wlambda+=invIj*G[5]*a};Equation.prototype.computeInvC=function(a){return 1.0/(this.computeGiMGt()+a)}},{'../math/vec2':30,'../objects/Body':31,'../utils/Utils':57}],23:[function(e,f,g){var i=e('../math/vec2'),Equation=e('./Equation'),Utils=e('../utils/Utils');f.exports=FrictionEquation;function FrictionEquation(a,b,c){Equation.call(this,a,b,-c,c);this.contactPointA=i.create();this.contactPointB=i.create();this.t=i.create();this.contactEquations=[];this.shapeA=null;this.shapeB=null;this.frictionCoefficient=0.3}FrictionEquation.prototype=new Equation();FrictionEquation.prototype.constructor=FrictionEquation;FrictionEquation.prototype.setSlipForce=function(a){this.maxForce=a;this.minForce=-a};FrictionEquation.prototype.getSlipForce=function(){return this.maxForce};FrictionEquation.prototype.computeB=function(a,b,h){var c=this.bodyA,bj=this.bodyB,ri=this.contactPointA,rj=this.contactPointB,t=this.t,G=this.G;G[0]=-t[0];G[1]=-t[1];G[2]=-i.crossLength(ri,t);G[3]=t[0];G[4]=t[1];G[5]=i.crossLength(rj,t);var d=this.computeGW(),GiMf=this.computeGiMf();var B=-d*b-h*GiMf;return B}},{'../math/vec2':30,'../utils/Utils':57,'./Equation':22}],24:[function(d,e,f){var g=d('./Equation'),vec2=d('../math/vec2');e.exports=RotationalLockEquation;function RotationalLockEquation(a,b,c){c=c||{};g.call(this,a,b,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=c.angle||0;var G=this.G;G[2]=1;G[5]=-1}RotationalLockEquation.prototype=new g();RotationalLockEquation.prototype.constructor=RotationalLockEquation;var h=vec2.create(),worldVectorB=vec2.create(),xAxis=vec2.fromValues(1,0),yAxis=vec2.fromValues(0,1);RotationalLockEquation.prototype.computeGq=function(){vec2.rotate(h,xAxis,this.bodyA.angle+this.angle);vec2.rotate(worldVectorB,yAxis,this.bodyB.angle);return vec2.dot(h,worldVectorB)}},{'../math/vec2':30,'./Equation':22}],25:[function(e,f,g){var i=e('./Equation'),vec2=e('../math/vec2');f.exports=RotationalVelocityEquation;function RotationalVelocityEquation(a,b){i.call(this,a,b,-Number.MAX_VALUE,Number.MAX_VALUE);this.relativeVelocity=1;this.ratio=1}RotationalVelocityEquation.prototype=new i();RotationalVelocityEquation.prototype.constructor=RotationalVelocityEquation;RotationalVelocityEquation.prototype.computeB=function(a,b,h){var G=this.G;G[2]=-1;G[5]=this.ratio;var c=this.computeGiMf();var d=this.computeGW();var B=-d*b-h*c;return B}},{'../math/vec2':30,'./Equation':22}],26:[function(e,f,g){var h=function(){};f.exports=h;h.prototype={constructor:h,on:function(a,b,c){b.context=c||this;if(this._listeners===undefined){this._listeners={}}var d=this._listeners;if(d[a]===undefined){d[a]=[]}if(d[a].indexOf(b)===-1){d[a].push(b)}return this},has:function(a,b){if(this._listeners===undefined){return false}var c=this._listeners;if(b){if(c[a]!==undefined&&c[a].indexOf(b)!==-1){return true}}else if(c[a]!==undefined){return true}return false},off:function(a,b){if(this._listeners===undefined){return this}var c=this._listeners;var d=c[a].indexOf(b);if(d!==-1){c[a].splice(d,1)}return this},emit:function(a){if(this._listeners===undefined){return this}var b=this._listeners;var c=b[a.type];if(c!==undefined){a.target=this;for(var i=0,l=c.length;i<l;i++){var d=c[i];d.call(d.context,a)}}return this}}},{}],27:[function(d,e,f){var g=d('./Material');var h=d('../equations/Equation');e.exports=ContactMaterial;function ContactMaterial(a,b,c){c=c||{};if(!(a instanceof g)||!(b instanceof g)){throw new Error('First two arguments must be Material instances.');}this.id=ContactMaterial.idCounter++;this.materialA=a;this.materialB=b;this.friction=typeof(c.friction)!=='undefined'?Number(c.friction):0.3;this.restitution=typeof(c.restitution)!=='undefined'?Number(c.restitution):0;this.stiffness=typeof(c.stiffness)!=='undefined'?Number(c.stiffness):h.DEFAULT_STIFFNESS;this.relaxation=typeof(c.relaxation)!=='undefined'?Number(c.relaxation):h.DEFAULT_RELAXATION;this.frictionStiffness=typeof(c.frictionStiffness)!=='undefined'?Number(c.frictionStiffness):h.DEFAULT_STIFFNESS;this.frictionRelaxation=typeof(c.frictionRelaxation)!=='undefined'?Number(c.frictionRelaxation):h.DEFAULT_RELAXATION;this.surfaceVelocity=typeof(c.surfaceVelocity)!=='undefined'?Number(c.surfaceVelocity):0;this.contactSkinSize=0.005}ContactMaterial.idCounter=0},{'../equations/Equation':22,'./Material':28}],28:[function(b,c,d){c.exports=Material;function Material(a){this.id=a||Material.idCounter++}Material.idCounter=0},{}],29:[function(w,x,y){var z={};z.GetArea=function(p){if(p.length<6){return 0}var l=p.length-2;var a=0;for(var i=0;i<l;i+=2){a+=(p[i+2]-p[i])*(p[i+1]+p[i+3])}a+=(p[0]-p[l])*(p[l+1]+p[1]);return-a*0.5};z.Triangulate=function(p){var n=p.length>>1;if(n<3){return[]}var a=[];var b=[];for(var i=0;i<n;i++){b.push(i)}var i=0;var c=n;while(c>3){var d=b[(i+0)%c];var e=b[(i+1)%c];var f=b[(i+2)%c];var g=p[2*d],ay=p[2*d+1];var h=p[2*e],by=p[2*e+1];var k=p[2*f],cy=p[2*f+1];var l=false;if(z._convex(g,ay,h,by,k,cy)){l=true;for(var j=0;j<c;j++){var m=b[j];if(m==d||m==e||m==f){continue}if(z._PointInTriangle(p[2*m],p[2*m+1],g,ay,h,by,k,cy)){l=false;break}}}if(l){a.push(d,e,f);b.splice((i+1)%c,1);c--;i=0}else if(i++>3*c){break}}a.push(b[0],b[1],b[2]);return a};z._PointInTriangle=function(a,b,c,d,e,f,g,h){var i=g-c;var j=h-d;var k=e-c;var l=f-d;var m=a-c;var n=b-d;var o=i*i+j*j;var p=i*k+j*l;var q=i*m+j*n;var r=k*k+l*l;var s=k*m+l*n;var t=1/(o*r-p*p);var u=(r*q-p*s)*t;var v=(o*s-p*q)*t;return(u>=0)&&(v>=0)&&(u+v<1)};z._convex=function(a,b,c,d,e,f){return(b-d)*(e-c)+(c-a)*(f-d)>=0};x.exports=z},{}],30:[function(i,j,k){var l=j.exports={};var m=i('../utils/Utils');l.crossLength=function(a,b){return a[0]*b[1]-a[1]*b[0]};l.crossVZ=function(a,b,c){l.rotate(a,b,-Math.PI/2);l.scale(a,a,c);return a};l.crossZV=function(a,b,c){l.rotate(a,c,Math.PI/2);l.scale(a,a,b);return a};l.rotate=function(b,a,d){if(d!==0){var c=Math.cos(d),s=Math.sin(d),x=a[0],y=a[1];b[0]=c*x-s*y;b[1]=s*x+c*y}else{b[0]=a[0];b[1]=a[1]}};l.rotate90cw=function(b,a){var x=a[0];var y=a[1];b[0]=y;b[1]=-x};l.toLocalFrame=function(a,b,c,d){l.copy(a,b);l.sub(a,a,c);l.rotate(a,a,-d)};l.toGlobalFrame=function(a,b,c,d){l.copy(a,b);l.rotate(a,a,d);l.add(a,a,c)};l.vectorToLocalFrame=function(a,b,c){l.rotate(a,b,-c)};l.vectorToGlobalFrame=function(a,b,c){l.rotate(a,b,c)};l.centroid=function(d,a,b,c){l.add(d,a,b);l.add(d,d,c);l.scale(d,d,1/3);return d};l.create=function(){var a=new m.ARRAY_TYPE(2);a[0]=0;a[1]=0;return a};l.clone=function(a){var b=new m.ARRAY_TYPE(2);b[0]=a[0];b[1]=a[1];return b};l.fromValues=function(x,y){var a=new m.ARRAY_TYPE(2);a[0]=x;a[1]=y;return a};l.copy=function(b,a){b[0]=a[0];b[1]=a[1];return b};l.set=function(a,x,y){a[0]=x;a[1]=y;return a};l.add=function(c,a,b){c[0]=a[0]+b[0];c[1]=a[1]+b[1];return c};l.subtract=function(c,a,b){c[0]=a[0]-b[0];c[1]=a[1]-b[1];return c};l.sub=l.subtract;l.multiply=function(c,a,b){c[0]=a[0]*b[0];c[1]=a[1]*b[1];return c};l.mul=l.multiply;l.divide=function(c,a,b){c[0]=a[0]/b[0];c[1]=a[1]/b[1];return c};l.div=l.divide;l.scale=function(c,a,b){c[0]=a[0]*b;c[1]=a[1]*b;return c};l.distance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)};l.dist=l.distance;l.squaredDistance=function(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y};l.sqrDist=l.squaredDistance;l.length=function(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)};l.len=l.length;l.squaredLength=function(a){var x=a[0],y=a[1];return x*x+y*y};l.sqrLen=l.squaredLength;l.negate=function(b,a){b[0]=-a[0];b[1]=-a[1];return b};l.normalize=function(b,a){var x=a[0],y=a[1];var c=x*x+y*y;if(c>0){c=1/Math.sqrt(c);b[0]=a[0]*c;b[1]=a[1]*c}return b};l.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};l.str=function(a){return'vec2('+a[0]+', '+a[1]+')'};l.lerp=function(c,a,b,t){var d=a[0],ay=a[1];c[0]=d+t*(b[0]-d);c[1]=ay+t*(b[1]-ay);return c};l.reflect=function(a,b,c){var d=b[0]*c[0]+b[1]*c[1];a[0]=b[0]-2*c[0]*d;a[1]=b[1]-2*c[1]*d};l.getLineSegmentsIntersection=function(a,b,c,d,e){var t=l.getLineSegmentsIntersectionFraction(b,c,d,e);if(t<0){return false}else{a[0]=b[0]+(t*(c[0]-b[0]));a[1]=b[1]+(t*(c[1]-b[1]));return true}};l.getLineSegmentsIntersectionFraction=function(a,b,c,d){var e=b[0]-a[0];var f=b[1]-a[1];var g=d[0]-c[0];var h=d[1]-c[1];var s,t;s=(-f*(a[0]-c[0])+e*(a[1]-c[1]))/(-g*f+e*h);t=(g*(a[1]-c[1])-h*(a[0]-c[0]))/(-g*f+e*h);if(s>=0&&s<=1&&t>=0&&t<=1){return t}return-1}},{'../utils/Utils':57}],31:[function(n,o,q){var t=n('../math/vec2'),decomp=n('poly-decomp'),Convex=n('../shapes/Convex'),RaycastResult=n('../collision/RaycastResult'),Ray=n('../collision/Ray'),AABB=n('../collision/AABB'),EventEmitter=n('../events/EventEmitter');o.exports=Body;function Body(a){a=a||{};EventEmitter.call(this);this.id=a.id||++Body._idCounter;this.world=null;this.shapes=[];this.mass=a.mass||0;this.invMass=0;this.inertia=0;this.invInertia=0;this.invMassSolve=0;this.invInertiaSolve=0;this.fixedRotation=!!a.fixedRotation;this.fixedX=!!a.fixedX;this.fixedY=!!a.fixedY;this.massMultiplier=t.create();this.position=t.fromValues(0,0);if(a.position){t.copy(this.position,a.position)}this.interpolatedPosition=t.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=t.fromValues(0,0);this.previousAngle=0;this.velocity=t.fromValues(0,0);if(a.velocity){t.copy(this.velocity,a.velocity)}this.vlambda=t.fromValues(0,0);this.wlambda=0;this.angle=a.angle||0;this.angularVelocity=a.angularVelocity||0;this.force=t.create();if(a.force){t.copy(this.force,a.force)}this.angularForce=a.angularForce||0;this.damping=typeof(a.damping)==='number'?a.damping:0.1;this.angularDamping=typeof(a.angularDamping)==='number'?a.angularDamping:0.1;this.type=Body.STATIC;if(typeof(a.type)!=='undefined'){this.type=a.type}else if(!a.mass){this.type=Body.STATIC}else{this.type=Body.DYNAMIC}this.boundingRadius=0;this.aabb=new AABB();this.aabbNeedsUpdate=true;this.allowSleep=a.allowSleep!==undefined?a.allowSleep:true;this.wantsToSleep=false;this.sleepState=Body.AWAKE;this.sleepSpeedLimit=a.sleepSpeedLimit!==undefined?a.sleepSpeedLimit:0.2;this.sleepTimeLimit=a.sleepTimeLimit!==undefined?a.sleepTimeLimit:1;this.gravityScale=a.gravityScale!==undefined?a.gravityScale:1;this.collisionResponse=a.collisionResponse!==undefined?a.collisionResponse:true;this.idleTime=0;this.timeLastSleepy=0;this.ccdSpeedThreshold=a.ccdSpeedThreshold!==undefined?a.ccdSpeedThreshold:-1;this.ccdIterations=a.ccdIterations!==undefined?a.ccdIterations:10;this.concavePath=null;this._wakeUpAfterNarrowphase=false;this.updateMassProperties()}Body.prototype=new EventEmitter();Body.prototype.constructor=Body;Body._idCounter=0;Body.prototype.updateSolveMassProperties=function(){if(this.sleepState===Body.SLEEPING||this.type===Body.KINEMATIC){this.invMassSolve=0;this.invInertiaSolve=0}else{this.invMassSolve=this.invMass;this.invInertiaSolve=this.invInertia}};Body.prototype.setDensity=function(a){var b=this.getArea();this.mass=b*a;this.updateMassProperties()};Body.prototype.getArea=function(){var a=0;for(var i=0;i<this.shapes.length;i++){a+=this.shapes[i].area}return a};Body.prototype.getAABB=function(){if(this.aabbNeedsUpdate){this.updateAABB()}return this.aabb};var u=new AABB(),tmp=t.create();Body.prototype.updateAABB=function(){var a=this.shapes,N=a.length,offset=tmp,bodyAngle=this.angle;for(var i=0;i!==N;i++){var b=a[i],angle=b.angle+bodyAngle;t.rotate(offset,b.position,bodyAngle);t.add(offset,offset,this.position);b.computeAABB(u,offset,angle);if(i===0){this.aabb.copy(u)}else{this.aabb.extend(u)}}this.aabbNeedsUpdate=false};Body.prototype.updateBoundingRadius=function(){var a=this.shapes,N=a.length,radius=0;for(var i=0;i!==N;i++){var b=a[i],offset=t.length(b.position),r=b.boundingRadius;if(offset+r>radius){radius=offset+r}}this.boundingRadius=radius};Body.prototype.addShape=function(a,b,c){if(a.body){throw new Error('A shape can only be added to one body.');}a.body=this;if(b){t.copy(a.position,b)}else{t.set(a.position,0,0)}a.angle=c||0;this.shapes.push(a);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=true};Body.prototype.removeShape=function(a){var b=this.shapes.indexOf(a);if(b!==-1){this.shapes.splice(b,1);this.aabbNeedsUpdate=true;a.body=null;return true}else{return false}};Body.prototype.updateMassProperties=function(){if(this.type===Body.STATIC||this.type===Body.KINEMATIC){this.mass=Number.MAX_VALUE;this.invMass=0;this.inertia=Number.MAX_VALUE;this.invInertia=0}else{var a=this.shapes,N=a.length,m=this.mass/N,I=0;if(!this.fixedRotation){for(var i=0;i<N;i++){var b=a[i],r2=t.squaredLength(b.position),Icm=b.computeMomentOfInertia(m);I+=Icm+m*r2}this.inertia=I;this.invInertia=I>0?1/I:0}else{this.inertia=Number.MAX_VALUE;this.invInertia=0}this.invMass=1/this.mass;t.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};var w=t.create();Body.prototype.applyForce=function(a,b){t.add(this.force,this.force,a);if(b){var c=t.crossLength(b,a);this.angularForce+=c}};var x=t.create();var y=t.create();var z=t.create();Body.prototype.applyForceLocal=function(a,b){b=b||z;var c=x;var d=y;this.vectorToWorldFrame(c,a);this.vectorToWorldFrame(d,b);this.applyForce(c,d)};var A=t.create();Body.prototype.applyImpulse=function(a,b){if(this.type!==Body.DYNAMIC){return}var c=A;t.scale(c,a,this.invMass);t.multiply(c,this.massMultiplier,c);t.add(this.velocity,c,this.velocity);if(b){var d=t.crossLength(b,a);d*=this.invInertia;this.angularVelocity+=d}};var B=t.create();var C=t.create();var D=t.create();Body.prototype.applyImpulseLocal=function(a,b){b=b||D;var c=B;var d=C;this.vectorToWorldFrame(c,a);this.vectorToWorldFrame(d,b);this.applyImpulse(c,d)};Body.prototype.toLocalFrame=function(a,b){t.toLocalFrame(a,b,this.position,this.angle)};Body.prototype.toWorldFrame=function(a,b){t.toGlobalFrame(a,b,this.position,this.angle)};Body.prototype.vectorToLocalFrame=function(a,b){t.vectorToLocalFrame(a,b,this.angle)};Body.prototype.vectorToWorldFrame=function(a,b){t.vectorToGlobalFrame(a,b,this.angle)};Body.prototype.fromPolygon=function(a,b){b=b||{};for(var i=this.shapes.length;i>=0;--i){this.removeShape(this.shapes[i])}var p=new decomp.Polygon();p.vertices=a;p.makeCCW();if(typeof(b.removeCollinearPoints)==='number'){p.removeCollinearPoints(b.removeCollinearPoints)}if(typeof(b.skipSimpleCheck)==='undefined'){if(!p.isSimple()){return false}}this.concavePath=p.vertices.slice(0);for(var i=0;i<this.concavePath.length;i++){var v=[0,0];t.copy(v,this.concavePath[i]);this.concavePath[i]=v}var d;if(b.optimalDecomp){d=p.decomp()}else{d=p.quickDecomp()}var e=t.create();for(var i=0;i!==d.length;i++){var c=new Convex({vertices:d[i].vertices});for(var j=0;j!==c.vertices.length;j++){var v=c.vertices[j];t.sub(v,v,c.centerOfMass)}t.scale(e,c.centerOfMass,1);c.updateTriangles();c.updateCenterOfMass();c.updateBoundingRadius();this.addShape(c,e)}this.adjustCenterOfMass();this.aabbNeedsUpdate=true;return true};var E=t.fromValues(0,0),adjustCenterOfMass_tmp2=t.fromValues(0,0),adjustCenterOfMass_tmp3=t.fromValues(0,0),adjustCenterOfMass_tmp4=t.fromValues(0,0);Body.prototype.adjustCenterOfMass=function(){var a=adjustCenterOfMass_tmp2,sum=adjustCenterOfMass_tmp3,cm=adjustCenterOfMass_tmp4,totalArea=0;t.set(sum,0,0);for(var i=0;i!==this.shapes.length;i++){var s=this.shapes[i];t.scale(a,s.position,s.area);t.add(sum,sum,a);totalArea+=s.area}t.scale(cm,sum,1/totalArea);for(var i=0;i!==this.shapes.length;i++){var s=this.shapes[i];t.sub(s.position,s.position,cm)}t.add(this.position,this.position,cm);for(var i=0;this.concavePath&&i<this.concavePath.length;i++){t.sub(this.concavePath[i],this.concavePath[i],cm)}this.updateMassProperties();this.updateBoundingRadius()};Body.prototype.setZeroForce=function(){t.set(this.force,0.0,0.0);this.angularForce=0.0};Body.prototype.resetConstraintVelocity=function(){var b=this,vlambda=b.vlambda;t.set(vlambda,0,0);b.wlambda=0};Body.prototype.addConstraintVelocity=function(){var b=this,v=b.velocity;t.add(v,v,b.vlambda);b.angularVelocity+=b.wlambda};Body.prototype.applyDamping=function(a){if(this.type===Body.DYNAMIC){var v=this.velocity;t.scale(v,v,Math.pow(1.0-this.damping,a));this.angularVelocity*=Math.pow(1.0-this.angularDamping,a)}};Body.prototype.wakeUp=function(){var s=this.sleepState;this.sleepState=Body.AWAKE;this.idleTime=0;if(s!==Body.AWAKE){this.emit(Body.wakeUpEvent)}};Body.prototype.sleep=function(){this.sleepState=Body.SLEEPING;this.angularVelocity=0;this.angularForce=0;t.set(this.velocity,0,0);t.set(this.force,0,0);this.emit(Body.sleepEvent)};Body.prototype.sleepTick=function(a,b,c){if(!this.allowSleep||this.type===Body.SLEEPING){return}this.wantsToSleep=false;var d=this.sleepState,speedSquared=t.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),speedLimitSquared=Math.pow(this.sleepSpeedLimit,2);if(speedSquared>=speedLimitSquared){this.idleTime=0;this.sleepState=Body.AWAKE}else{this.idleTime+=c;this.sleepState=Body.SLEEPY}if(this.idleTime>this.sleepTimeLimit){if(!b){this.sleep()}else{this.wantsToSleep=true}}};Body.prototype.overlaps=function(a){return this.world.overlapKeeper.bodiesAreOverlapping(this,a)};var F=t.create();var G=t.create();Body.prototype.integrate=function(a){var b=this.invMass,f=this.force,pos=this.position,velo=this.velocity;t.copy(this.previousPosition,this.position);this.previousAngle=this.angle;if(!this.fixedRotation){this.angularVelocity+=this.angularForce*this.invInertia*a}t.scale(F,f,a*b);t.multiply(F,this.massMultiplier,F);t.add(velo,F,velo);if(!this.integrateToTimeOfImpact(a)){t.scale(G,velo,a);t.add(pos,pos,G);if(!this.fixedRotation){this.angle+=this.angularVelocity*a}}this.aabbNeedsUpdate=true};var H=new RaycastResult();var J=new Ray({mode:Ray.ALL});var K=t.create();var L=t.create();var M=t.create();var O=t.create();Body.prototype.integrateToTimeOfImpact=function(b){if(this.ccdSpeedThreshold<0||t.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2)){return false}t.normalize(K,this.velocity);t.scale(L,this.velocity,b);t.add(L,L,this.position);t.sub(M,L,this.position);var c=this.angularVelocity*b;var d=t.length(M);var e=1;var f;var g=this;H.reset();J.callback=function(a){if(a.body===g){return}f=a.body;a.getHitPoint(L,J);t.sub(M,L,g.position);e=t.length(M)/d;a.stop()};t.copy(J.from,this.position);t.copy(J.to,L);J.update();this.world.raycast(H,J);if(!f){return false}var h=this.angle;t.copy(O,this.position);var i=0;var j=0;var k=0;var l=e;while(l>=j&&i<this.ccdIterations){i++;k=(l-j)/2;t.scale(G,M,e);t.add(this.position,O,G);this.angle=h+c*e;this.updateAABB();var m=this.aabb.overlaps(f.aabb)&&this.world.narrowphase.bodiesOverlap(this,f);if(m){j=k}else{l=k}}e=k;t.copy(this.position,O);this.angle=h;t.scale(G,M,e);t.add(this.position,this.position,G);if(!this.fixedRotation){this.angle+=c*e}return true};Body.prototype.getVelocityAtPoint=function(a,b){t.crossVZ(a,b,this.angularVelocity);t.subtract(a,this.velocity,a);return a};Body.sleepyEvent={type:'sleepy'};Body.sleepEvent={type:'sleep'};Body.wakeUpEvent={type:'wakeup'};Body.DYNAMIC=1;Body.STATIC=2;Body.KINEMATIC=4;Body.AWAKE=0;Body.SLEEPY=1;Body.SLEEPING=2},{'../collision/AABB':7,'../collision/Ray':11,'../collision/RaycastResult':12,'../events/EventEmitter':26,'../math/vec2':30,'../shapes/Convex':40,'poly-decomp':5}],32:[function(g,h,i){var j=g('../math/vec2');var m=g('./Spring');var n=g('../utils/Utils');h.exports=LinearSpring;function LinearSpring(a,b,c){c=c||{};m.call(this,a,b,c);this.localAnchorA=j.fromValues(0,0);this.localAnchorB=j.fromValues(0,0);if(c.localAnchorA){j.copy(this.localAnchorA,c.localAnchorA)}if(c.localAnchorB){j.copy(this.localAnchorB,c.localAnchorB)}if(c.worldAnchorA){this.setWorldAnchorA(c.worldAnchorA)}if(c.worldAnchorB){this.setWorldAnchorB(c.worldAnchorB)}var d=j.create();var e=j.create();this.getWorldAnchorA(d);this.getWorldAnchorB(e);var f=j.distance(d,e);this.restLength=typeof(c.restLength)==='number'?c.restLength:f}LinearSpring.prototype=new m();LinearSpring.prototype.constructor=LinearSpring;LinearSpring.prototype.setWorldAnchorA=function(a){this.bodyA.toLocalFrame(this.localAnchorA,a)};LinearSpring.prototype.setWorldAnchorB=function(a){this.bodyB.toLocalFrame(this.localAnchorB,a)};LinearSpring.prototype.getWorldAnchorA=function(a){this.bodyA.toWorldFrame(a,this.localAnchorA)};LinearSpring.prototype.getWorldAnchorB=function(a){this.bodyB.toWorldFrame(a,this.localAnchorB)};var o=j.create(),applyForce_r_unit=j.create(),applyForce_u=j.create(),applyForce_f=j.create(),applyForce_worldAnchorA=j.create(),applyForce_worldAnchorB=j.create(),applyForce_ri=j.create(),applyForce_rj=j.create(),applyForce_tmp=j.create();LinearSpring.prototype.applyForce=function(){var k=this.stiffness,d=this.damping,l=this.restLength,bodyA=this.bodyA,bodyB=this.bodyB,r=o,r_unit=applyForce_r_unit,u=applyForce_u,f=applyForce_f,tmp=applyForce_tmp;var a=applyForce_worldAnchorA,worldAnchorB=applyForce_worldAnchorB,ri=applyForce_ri,rj=applyForce_rj;this.getWorldAnchorA(a);this.getWorldAnchorB(worldAnchorB);j.sub(ri,a,bodyA.position);j.sub(rj,worldAnchorB,bodyB.position);j.sub(r,worldAnchorB,a);var b=j.len(r);j.normalize(r_unit,r);j.sub(u,bodyB.velocity,bodyA.velocity);j.crossZV(tmp,bodyB.angularVelocity,rj);j.add(u,u,tmp);j.crossZV(tmp,bodyA.angularVelocity,ri);j.sub(u,u,tmp);j.scale(f,r_unit,-k*(b-l)-d*j.dot(u,r_unit));j.sub(bodyA.force,bodyA.force,f);j.add(bodyB.force,bodyB.force,f);var c=j.crossLength(ri,f);var e=j.crossLength(rj,f);bodyA.angularForce-=c;bodyB.angularForce+=e}},{'../math/vec2':30,'../utils/Utils':57,'./Spring':34}],33:[function(e,f,g){var h=e('../math/vec2');var i=e('./Spring');f.exports=RotationalSpring;function RotationalSpring(a,b,c){c=c||{};i.call(this,a,b,c);this.restAngle=typeof(c.restAngle)==='number'?c.restAngle:b.angle-a.angle}RotationalSpring.prototype=new i();RotationalSpring.prototype.constructor=RotationalSpring;RotationalSpring.prototype.applyForce=function(){var k=this.stiffness,d=this.damping,l=this.restAngle,bodyA=this.bodyA,bodyB=this.bodyB,x=bodyB.angle-bodyA.angle,u=bodyB.angularVelocity-bodyA.angularVelocity;var a=-k*(x-l)-d*u*0;bodyA.angularForce-=a;bodyB.angularForce+=a}},{'../math/vec2':30,'./Spring':34}],34:[function(d,e,f){var g=d('../math/vec2');var h=d('../utils/Utils');e.exports=Spring;function Spring(a,b,c){c=h.defaults(c,{stiffness:100,damping:1});this.stiffness=c.stiffness;this.damping=c.damping;this.bodyA=a;this.bodyB=b}Spring.prototype.applyForce=function(){}},{'../math/vec2':30,'../utils/Utils':57}],35:[function(d,e,f){var g=d('../math/vec2');var h=d('../utils/Utils');var j=d('../constraints/Constraint');var k=d('../equations/FrictionEquation');var l=d('../objects/Body');e.exports=TopDownVehicle;function TopDownVehicle(a,b){b=b||{};this.chassisBody=a;this.wheels=[];this.groundBody=new l({mass:0});this.world=null;var c=this;this.preStepCallback=function(){c.update()}}TopDownVehicle.prototype.addToWorld=function(a){this.world=a;a.addBody(this.groundBody);a.on('preStep',this.preStepCallback);for(var i=0;i<this.wheels.length;i++){var b=this.wheels[i];a.addConstraint(b)}};TopDownVehicle.prototype.removeFromWorld=function(){var a=this.world;a.removeBody(this.groundBody);a.off('preStep',this.preStepCallback);for(var i=0;i<this.wheels.length;i++){var b=this.wheels[i];a.removeConstraint(b)}this.world=null};TopDownVehicle.prototype.addWheel=function(a){var b=new WheelConstraint(this,a);this.wheels.push(b);return b};TopDownVehicle.prototype.update=function(){for(var i=0;i<this.wheels.length;i++){this.wheels[i].update()}};function WheelConstraint(a,b){b=b||{};this.vehicle=a;this.forwardEquation=new k(a.chassisBody,a.groundBody);this.sideEquation=new k(a.chassisBody,a.groundBody);this.steerValue=0;this.engineForce=0;this.setSideFriction(b.sideFriction!==undefined?b.sideFriction:5);this.localForwardVector=g.fromValues(0,1);if(b.localForwardVector){g.copy(this.localForwardVector,b.localForwardVector)}this.localPosition=g.fromValues(0,0);if(b.localPosition){g.copy(this.localPosition,b.localPosition)}j.apply(this,a.chassisBody,a.groundBody);this.equations.push(this.forwardEquation,this.sideEquation);this.setBrakeForce(0)}WheelConstraint.prototype=new j();WheelConstraint.prototype.setBrakeForce=function(a){this.forwardEquation.setSlipForce(a)};WheelConstraint.prototype.setSideFriction=function(a){this.sideEquation.setSlipForce(a)};var m=g.create();var n=g.create();WheelConstraint.prototype.getSpeed=function(){this.vehicle.chassisBody.vectorToWorldFrame(n,this.localForwardVector);this.vehicle.chassisBody.getVelocityAtPoint(m,n);return g.dot(m,n)};var o=g.create();WheelConstraint.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector);g.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2);this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t);g.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue);g.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue);this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition);g.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB);this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition);g.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA);g.normalize(o,this.forwardEquation.t);g.scale(o,o,this.engineForce);this.vehicle.chassisBody.applyForce(o,this.forwardEquation.contactPointA)}},{'../constraints/Constraint':14,'../equations/FrictionEquation':23,'../math/vec2':30,'../objects/Body':31,'../utils/Utils':57}],36:[function(a,b,c){var d=b.exports={AABB:a('./collision/AABB'),AngleLockEquation:a('./equations/AngleLockEquation'),Body:a('./objects/Body'),Broadphase:a('./collision/Broadphase'),Capsule:a('./shapes/Capsule'),Circle:a('./shapes/Circle'),Constraint:a('./constraints/Constraint'),ContactEquation:a('./equations/ContactEquation'),ContactEquationPool:a('./utils/ContactEquationPool'),ContactMaterial:a('./material/ContactMaterial'),Convex:a('./shapes/Convex'),DistanceConstraint:a('./constraints/DistanceConstraint'),Equation:a('./equations/Equation'),EventEmitter:a('./events/EventEmitter'),FrictionEquation:a('./equations/FrictionEquation'),FrictionEquationPool:a('./utils/FrictionEquationPool'),GearConstraint:a('./constraints/GearConstraint'),GSSolver:a('./solver/GSSolver'),Heightfield:a('./shapes/Heightfield'),Line:a('./shapes/Line'),LockConstraint:a('./constraints/LockConstraint'),Material:a('./material/Material'),Narrowphase:a('./collision/Narrowphase'),NaiveBroadphase:a('./collision/NaiveBroadphase'),Particle:a('./shapes/Particle'),Plane:a('./shapes/Plane'),Pool:a('./utils/Pool'),RevoluteConstraint:a('./constraints/RevoluteConstraint'),PrismaticConstraint:a('./constraints/PrismaticConstraint'),Ray:a('./collision/Ray'),RaycastResult:a('./collision/RaycastResult'),Box:a('./shapes/Box'),RotationalVelocityEquation:a('./equations/RotationalVelocityEquation'),SAPBroadphase:a('./collision/SAPBroadphase'),Shape:a('./shapes/Shape'),Solver:a('./solver/Solver'),Spring:a('./objects/Spring'),TopDownVehicle:a('./objects/TopDownVehicle'),LinearSpring:a('./objects/LinearSpring'),RotationalSpring:a('./objects/RotationalSpring'),Utils:a('./utils/Utils'),World:a('./world/World'),vec2:a('./math/vec2'),version:a('../package.json').version};Object.defineProperty(d,'Rectangle',{get:function(){console.warn('The Rectangle class has been renamed to Box.');return this.Box}})},{'../package.json':6,'./collision/AABB':7,'./collision/Broadphase':8,'./collision/NaiveBroadphase':9,'./collision/Narrowphase':10,'./collision/Ray':11,'./collision/RaycastResult':12,'./collision/SAPBroadphase':13,'./constraints/Constraint':14,'./constraints/DistanceConstraint':15,'./constraints/GearConstraint':16,'./constraints/LockConstraint':17,'./constraints/PrismaticConstraint':18,'./constraints/RevoluteConstraint':19,'./equations/AngleLockEquation':20,'./equations/ContactEquation':21,'./equations/Equation':22,'./equations/FrictionEquation':23,'./equations/RotationalVelocityEquation':25,'./events/EventEmitter':26,'./material/ContactMaterial':27,'./material/Material':28,'./math/vec2':30,'./objects/Body':31,'./objects/LinearSpring':32,'./objects/RotationalSpring':33,'./objects/Spring':34,'./objects/TopDownVehicle':35,'./shapes/Box':37,'./shapes/Capsule':38,'./shapes/Circle':39,'./shapes/Convex':40,'./shapes/Heightfield':41,'./shapes/Line':42,'./shapes/Particle':43,'./shapes/Plane':44,'./shapes/Shape':45,'./solver/GSSolver':46,'./solver/Solver':47,'./utils/ContactEquationPool':48,'./utils/FrictionEquationPool':49,'./utils/Pool':55,'./utils/Utils':57,'./world/World':61}],37:[function(f,g,i){var j=f('../math/vec2'),Shape=f('./Shape'),Convex=f('./Convex');g.exports=Box;function Box(a){if(typeof(arguments[0])==='number'&&typeof(arguments[1])==='number'){a={width:arguments[0],height:arguments[1]};console.warn('The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })')}a=a||{};var b=this.width=a.width||1;var c=this.height=a.height||1;var d=[j.fromValues(-b/2,-c/2),j.fromValues(b/2,-c/2),j.fromValues(b/2,c/2),j.fromValues(-b/2,c/2)];var e=[j.fromValues(1,0),j.fromValues(0,1)];a.vertices=d;a.axes=e;a.type=Shape.BOX;Convex.call(this,a)}Box.prototype=new Convex();Box.prototype.constructor=Box;Box.prototype.computeMomentOfInertia=function(a){var w=this.width,h=this.height;return a*(h*h+w*w)/12};Box.prototype.updateBoundingRadius=function(){var w=this.width,h=this.height;this.boundingRadius=Math.sqrt(w*w+h*h)/2};var k=j.create(),corner2=j.create(),corner3=j.create(),corner4=j.create();Box.prototype.computeAABB=function(a,b,c){a.setFromPoints(this.vertices,b,c,0)};Box.prototype.updateArea=function(){this.area=this.width*this.height}},{'../math/vec2':30,'./Convex':40,'./Shape':45}],38:[function(x,z,A){var B=x('./Shape'),vec2=x('../math/vec2');z.exports=Capsule;function Capsule(a){if(typeof(arguments[0])==='number'&&typeof(arguments[1])==='number'){a={length:arguments[0],radius:arguments[1]};console.warn('The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })')}a=a||{};this.length=a.length||1;this.radius=a.radius||1;a.type=B.CAPSULE;B.call(this,a)}Capsule.prototype=new B();Capsule.prototype.constructor=Capsule;Capsule.prototype.computeMomentOfInertia=function(a){var r=this.radius,w=this.length+r,h=r*2;return a*(h*h+w*w)/12};Capsule.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};Capsule.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+this.radius*2*this.length};var r=vec2.create();Capsule.prototype.computeAABB=function(a,b,c){var d=this.radius;vec2.set(r,this.length/2,0);if(c!==0){vec2.rotate(r,r,c)}vec2.set(a.upperBound,Math.max(r[0]+d,-r[0]+d),Math.max(r[1]+d,-r[1]+d));vec2.set(a.lowerBound,Math.min(r[0]-d,-r[0]-d),Math.min(r[1]-d,-r[1]-d));vec2.add(a.lowerBound,a.lowerBound,b);vec2.add(a.upperBound,a.upperBound,b)};var C=vec2.create();var D=vec2.create();var E=vec2.create();var F=vec2.create();var G=vec2.fromValues(0,1);Capsule.prototype.raycast=function(d,e,f,g){var h=e.from;var j=e.to;var k=e.direction;var l=C;var m=D;var n=E;var o=F;var p=this.length/2;for(var i=0;i<2;i++){var y=this.radius*(i*2-1);vec2.set(n,-p,y);vec2.set(o,p,y);vec2.toGlobalFrame(n,n,f,g);vec2.toGlobalFrame(o,o,f,g);var q=vec2.getLineSegmentsIntersectionFraction(h,j,n,o);if(q>=0){vec2.rotate(m,G,g);vec2.scale(m,m,(i*2-1));e.reportIntersection(d,q,m,-1);if(d.shouldStop(e)){return}}}var r=Math.pow(this.radius,2)+Math.pow(p,2);for(var i=0;i<2;i++){vec2.set(n,p*(i*2-1),0);vec2.toGlobalFrame(n,n,f,g);var a=Math.pow(j[0]-h[0],2)+Math.pow(j[1]-h[1],2);var b=2*((j[0]-h[0])*(h[0]-n[0])+(j[1]-h[1])*(h[1]-n[1]));var c=Math.pow(h[0]-n[0],2)+Math.pow(h[1]-n[1],2)-Math.pow(this.radius,2);var q=Math.pow(b,2)-4*a*c;if(q<0){continue}else if(q===0){vec2.lerp(l,h,j,q);if(vec2.squaredDistance(l,f)>r){vec2.sub(m,l,n);vec2.normalize(m,m);e.reportIntersection(d,q,m,-1);if(d.shouldStop(e)){return}}}else{var s=Math.sqrt(q);var t=1/(2*a);var u=(-b-s)*t;var v=(-b+s)*t;if(u>=0&&u<=1){vec2.lerp(l,h,j,u);if(vec2.squaredDistance(l,f)>r){vec2.sub(m,l,n);vec2.normalize(m,m);e.reportIntersection(d,u,m,-1);if(d.shouldStop(e)){return}}}if(v>=0&&v<=1){vec2.lerp(l,h,j,v);if(vec2.squaredDistance(l,f)>r){vec2.sub(m,l,n);vec2.normalize(m,m);e.reportIntersection(d,v,m,-1);if(d.shouldStop(e)){return}}}}}}},{'../math/vec2':30,'./Shape':45}],39:[function(p,q,s){var t=p('./Shape'),vec2=p('../math/vec2');q.exports=Circle;function Circle(a){if(typeof(arguments[0])==='number'){a={radius:arguments[0]};console.warn('The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })')}a=a||{};this.radius=a.radius||1;a.type=t.CIRCLE;t.call(this,a)}Circle.prototype=new t();Circle.prototype.constructor=Circle;Circle.prototype.computeMomentOfInertia=function(a){var r=this.radius;return a*r*r/2};Circle.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};Circle.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};Circle.prototype.computeAABB=function(a,b,c){var r=this.radius;vec2.set(a.upperBound,r,r);vec2.set(a.lowerBound,-r,-r);if(b){vec2.add(a.lowerBound,a.lowerBound,b);vec2.add(a.upperBound,a.upperBound,b)}};var u=vec2.create();var v=vec2.create();Circle.prototype.raycast=function(d,e,f,g){var h=e.from,to=e.to,r=this.radius;var a=Math.pow(to[0]-h[0],2)+Math.pow(to[1]-h[1],2);var b=2*((to[0]-h[0])*(h[0]-f[0])+(to[1]-h[1])*(h[1]-f[1]));var c=Math.pow(h[0]-f[0],2)+Math.pow(h[1]-f[1],2)-Math.pow(r,2);var i=Math.pow(b,2)-4*a*c;var j=u;var k=v;if(i<0){return}else if(i===0){vec2.lerp(j,h,to,i);vec2.sub(k,j,f);vec2.normalize(k,k);e.reportIntersection(d,i,k,-1)}else{var l=Math.sqrt(i);var m=1/(2*a);var n=(-b-l)*m;var o=(-b+l)*m;if(n>=0&&n<=1){vec2.lerp(j,h,to,n);vec2.sub(k,j,f);vec2.normalize(k,k);e.reportIntersection(d,n,k,-1);if(d.shouldStop(e)){return}}if(o>=0&&o<=1){vec2.lerp(j,h,to,o);vec2.sub(k,j,f);vec2.normalize(k,k);e.reportIntersection(d,o,k,-1)}}}},{'../math/vec2':30,'./Shape':45}],40:[function(o,p,q){var r=o('./Shape'),vec2=o('../math/vec2'),polyk=o('../math/polyk'),decomp=o('poly-decomp');p.exports=Convex;function Convex(a){if(Array.isArray(arguments[0])){a={vertices:arguments[0],axes:arguments[1]};console.warn('The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })')}a=a||{};this.vertices=[];var b=a.vertices!==undefined?a.vertices:[];for(var i=0;i<b.length;i++){var v=vec2.create();vec2.copy(v,b[i]);this.vertices.push(v)}this.axes=[];if(a.axes){for(var i=0;i<a.axes.length;i++){var c=vec2.create();vec2.copy(c,a.axes[i]);this.axes.push(c)}}else{for(var i=0;i<this.vertices.length;i++){var d=this.vertices[i];var e=this.vertices[(i+1)%this.vertices.length];var f=vec2.create();vec2.sub(f,e,d);vec2.rotate90cw(f,f);vec2.normalize(f,f);this.axes.push(f)}}this.centerOfMass=vec2.fromValues(0,0);this.triangles=[];if(this.vertices.length){this.updateTriangles();this.updateCenterOfMass()}this.boundingRadius=0;a.type=r.CONVEX;r.call(this,a);this.updateBoundingRadius();this.updateArea();if(this.area<0){throw new Error('Convex vertices must be given in conter-clockwise winding.');}}Convex.prototype=new r();Convex.prototype.constructor=Convex;var s=vec2.create();var u=vec2.create();Convex.prototype.projectOntoLocalAxis=function(a,b){var c=null,min=null,v,value,a=s;for(var i=0;i<this.vertices.length;i++){v=this.vertices[i];value=vec2.dot(v,a);if(c===null||value>c){c=value}if(min===null||value<min){min=value}}if(min>c){var t=min;min=c;c=t}vec2.set(b,min,c)};Convex.prototype.projectOntoWorldAxis=function(a,b,c,d){var e=u;this.projectOntoLocalAxis(a,d);if(c!==0){vec2.rotate(e,a,c)}else{e=a}var f=vec2.dot(b,e);vec2.set(d,d[0]+f,d[1]+f)};Convex.prototype.updateTriangles=function(){this.triangles.length=0;var a=[];for(var i=0;i<this.vertices.length;i++){var v=this.vertices[i];a.push(v[0],v[1])}var b=polyk.Triangulate(a);for(var i=0;i<b.length;i+=3){var c=b[i],id2=b[i+1],id3=b[i+2];this.triangles.push([c,id2,id3])}};var w=vec2.create(),updateCenterOfMass_centroid_times_mass=vec2.create(),updateCenterOfMass_a=vec2.create(),updateCenterOfMass_b=vec2.create(),updateCenterOfMass_c=vec2.create(),updateCenterOfMass_ac=vec2.create(),updateCenterOfMass_ca=vec2.create(),updateCenterOfMass_cb=vec2.create(),updateCenterOfMass_n=vec2.create();Convex.prototype.updateCenterOfMass=function(){var d=this.triangles,verts=this.vertices,cm=this.centerOfMass,centroid=w,n=updateCenterOfMass_n,a=updateCenterOfMass_a,b=updateCenterOfMass_b,c=updateCenterOfMass_c,ac=updateCenterOfMass_ac,ca=updateCenterOfMass_ca,cb=updateCenterOfMass_cb,centroid_times_mass=updateCenterOfMass_centroid_times_mass;vec2.set(cm,0,0);var e=0;for(var i=0;i!==d.length;i++){var t=d[i],a=verts[t[0]],b=verts[t[1]],c=verts[t[2]];vec2.centroid(centroid,a,b,c);var m=Convex.triangleArea(a,b,c);e+=m;vec2.scale(centroid_times_mass,centroid,m);vec2.add(cm,cm,centroid_times_mass)}vec2.scale(cm,cm,1/e)};Convex.prototype.computeMomentOfInertia=function(c){var d=0.0,numer=0.0,N=this.vertices.length;for(var j=N-1,i=0;i<N;j=i,i++){var e=this.vertices[j];var f=this.vertices[i];var a=Math.abs(vec2.crossLength(e,f));var b=vec2.dot(f,f)+vec2.dot(f,e)+vec2.dot(e,e);d+=a*b;numer+=a}return(c/6.0)*(d/numer)};Convex.prototype.updateBoundingRadius=function(){var a=this.vertices,r2=0;for(var i=0;i!==a.length;i++){var b=vec2.squaredLength(a[i]);if(b>r2){r2=b}}this.boundingRadius=Math.sqrt(r2)};Convex.triangleArea=function(a,b,c){return(((b[0]-a[0])*(c[1]-a[1]))-((c[0]-a[0])*(b[1]-a[1])))*0.5};Convex.prototype.updateArea=function(){this.updateTriangles();this.area=0;var d=this.triangles,verts=this.vertices;for(var i=0;i!==d.length;i++){var t=d[i],a=verts[t[0]],b=verts[t[1]],c=verts[t[2]];var m=Convex.triangleArea(a,b,c);this.area+=m}};Convex.prototype.computeAABB=function(a,b,c){a.setFromPoints(this.vertices,b,c,0)};var x=vec2.create();var y=vec2.create();var z=vec2.create();Convex.prototype.raycast=function(a,b,c,d){var e=x;var f=y;var g=z;var h=this.vertices;vec2.toLocalFrame(e,b.from,c,d);vec2.toLocalFrame(f,b.to,c,d);var n=h.length;for(var i=0;i<n&&!a.shouldStop(b);i++){var j=h[i];var k=h[(i+1)%n];var l=vec2.getLineSegmentsIntersectionFraction(e,f,j,k);if(l>=0){vec2.sub(g,k,j);vec2.rotate(g,g,-Math.PI/2+d);vec2.normalize(g,g);b.reportIntersection(a,l,g,i)}}}},{'../math/polyk':29,'../math/vec2':30,'./Shape':45,'poly-decomp':5}],41:[function(r,u,w){var x=r('./Shape'),vec2=r('../math/vec2'),Utils=r('../utils/Utils');u.exports=Heightfield;function Heightfield(a){if(Array.isArray(arguments[0])){a={heights:arguments[0]};if(typeof(arguments[1])==='object'){for(var b in arguments[1]){a[b]=arguments[1][b]}}console.warn('The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })')}a=a||{};this.heights=a.heights?a.heights.slice(0):[];this.maxValue=a.maxValue||null;this.minValue=a.minValue||null;this.elementWidth=a.elementWidth||0.1;if(a.maxValue===undefined||a.minValue===undefined){this.updateMaxMinValues()}a.type=x.HEIGHTFIELD;x.call(this,a)}Heightfield.prototype=new x();Heightfield.prototype.constructor=Heightfield;Heightfield.prototype.updateMaxMinValues=function(){var a=this.heights;var b=a[0];var c=a[0];for(var i=0;i!==a.length;i++){var v=a[i];if(v>b){b=v}if(v<c){c=v}}this.maxValue=b;this.minValue=c};Heightfield.prototype.computeMomentOfInertia=function(a){return Number.MAX_VALUE};Heightfield.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};Heightfield.prototype.updateArea=function(){var a=this.heights,area=0;for(var i=0;i<a.length-1;i++){area+=(a[i]+a[i+1])/2*this.elementWidth}this.area=area};var y=[vec2.create(),vec2.create(),vec2.create(),vec2.create()];Heightfield.prototype.computeAABB=function(a,b,c){vec2.set(y[0],0,this.maxValue);vec2.set(y[1],this.elementWidth*this.heights.length,this.maxValue);vec2.set(y[2],this.elementWidth*this.heights.length,this.minValue);vec2.set(y[3],0,this.minValue);a.setFromPoints(y,b,c)};Heightfield.prototype.getLineSegment=function(a,b,i){var c=this.heights;var d=this.elementWidth;vec2.set(a,i*d,c[i]);vec2.set(b,(i+1)*d,c[i+1])};Heightfield.prototype.getSegmentIndex=function(a){return Math.floor(a[0]/this.elementWidth)};Heightfield.prototype.getClampedSegmentIndex=function(a){var i=this.getSegmentIndex(a);i=Math.min(this.heights.length,Math.max(i,0));return i};var z=vec2.create();var A=vec2.create();var B=vec2.create();var C=vec2.create();var D=vec2.create();var E=vec2.create();var F=vec2.fromValues(0,1);function getLineSegmentsIntersection(a,b,c,d,e){var f,s1_y,s2_x,s2_y;f=c[0]-b[0];s1_y=c[1]-b[1];s2_x=e[0]-d[0];s2_y=e[1]-d[1];var s,t;s=(-s1_y*(b[0]-d[0])+f*(b[1]-d[1]))/(-s2_x*s1_y+f*s2_y);t=(s2_x*(b[1]-d[1])-s2_y*(b[0]-d[0]))/(-s2_x*s1_y+f*s2_y);if(s>=0&&s<=1&&t>=0&&t<=1){var g=b[0]+(t*f);var h=b[1]+(t*s1_y);a[0]=g;a[1]=h;return t}return-1}Heightfield.prototype.raycast=function(a,b,c,d){var e=b.from;var f=b.to;var g=b.direction;var h=z;var j=A;var k=B;var l=C;var m=D;var n=E;vec2.toLocalFrame(m,e,c,d);vec2.toLocalFrame(n,f,c,d);var o=this.getClampedSegmentIndex(m);var p=this.getClampedSegmentIndex(n);if(o>p){var q=o;o=p;p=q}for(var i=0;i<this.heights.length-1;i++){this.getLineSegment(k,l,i);var t=vec2.getLineSegmentsIntersectionFraction(m,n,k,l);if(t>=0){vec2.sub(j,l,k);vec2.rotate(j,j,d+Math.PI/2);vec2.normalize(j,j);b.reportIntersection(a,t,j,-1);if(a.shouldStop(b)){return}}}}},{'../math/vec2':30,'../utils/Utils':57,'./Shape':45}],42:[function(l,m,n){var o=l('./Shape'),vec2=l('../math/vec2');m.exports=Line;function Line(a){if(typeof(arguments[0])==='number'){a={length:arguments[0]};console.warn('The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })')}a=a||{};this.length=a.length||1;a.type=o.LINE;o.call(this,a)}Line.prototype=new o();Line.prototype.constructor=Line;Line.prototype.computeMomentOfInertia=function(a){return a*Math.pow(this.length,2)/12};Line.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var p=[vec2.create(),vec2.create()];Line.prototype.computeAABB=function(a,b,c){var d=this.length/2;vec2.set(p[0],-d,0);vec2.set(p[1],d,0);a.setFromPoints(p,b,c,0)};var q=vec2.create();var r=vec2.create();var s=vec2.create();var t=vec2.create();var u=vec2.fromValues(0,1);Line.prototype.raycast=function(a,b,c,d){var e=b.from;var f=b.to;var g=s;var h=t;var i=this.length/2;vec2.set(g,-i,0);vec2.set(h,i,0);vec2.toGlobalFrame(g,g,c,d);vec2.toGlobalFrame(h,h,c,d);var j=vec2.getLineSegmentsIntersectionFraction(g,h,e,f);if(j>=0){var k=r;vec2.rotate(k,u,d);b.reportIntersection(a,j,k,-1)}}},{'../math/vec2':30,'./Shape':45}],43:[function(d,e,f){var g=d('./Shape'),vec2=d('../math/vec2');e.exports=Particle;function Particle(a){a=a||{};a.type=g.PARTICLE;g.call(this,a)}Particle.prototype=new g();Particle.prototype.constructor=Particle;Particle.prototype.computeMomentOfInertia=function(a){return 0};Particle.prototype.updateBoundingRadius=function(){this.boundingRadius=0};Particle.prototype.computeAABB=function(a,b,c){vec2.copy(a.lowerBound,b);vec2.copy(a.upperBound,b)}},{'../math/vec2':30,'./Shape':45}],44:[function(p,q,r){var s=p('./Shape'),vec2=p('../math/vec2'),Utils=p('../utils/Utils');q.exports=Plane;function Plane(a){a=a||{};a.type=s.PLANE;s.call(this,a)}Plane.prototype=new s();Plane.prototype.constructor=Plane;Plane.prototype.computeMomentOfInertia=function(a){return 0};Plane.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};Plane.prototype.computeAABB=function(b,c,d){var a=d%(2*Math.PI);var e=vec2.set;var f=1e7;var g=b.lowerBound;var h=b.upperBound;e(g,-f,-f);e(h,f,f);if(a===0){h[1]=0}else if(a===Math.PI/2){g[0]=0}else if(a===Math.PI){g[1]=0}else if(a===3*Math.PI/2){h[0]=0}};Plane.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var u=vec2.create();var v=vec2.create();var w=vec2.create();var x=vec2.create();var y=vec2.create();Plane.prototype.raycast=function(a,b,c,d){var e=b.from;var f=b.to;var g=b.direction;var h=u;var i=v;var j=w;var k=x;var l=y;vec2.set(k,0,1);vec2.rotate(k,k,d);vec2.sub(l,e,c);var m=vec2.dot(l,k);vec2.sub(l,f,c);var n=vec2.dot(l,k);if(m*n>0){return}if(vec2.squaredDistance(e,f)<m*m){return}var o=vec2.dot(k,g);vec2.sub(h,e,c);var t=-vec2.dot(k,h)/o/b.length;b.reportIntersection(a,t,k,-1)}},{'../math/vec2':30,'../utils/Utils':57,'./Shape':45}],45:[function(e,f,g){f.exports=Shape;var h=e('../math/vec2');function Shape(a){a=a||{};this.body=null;this.position=h.fromValues(0,0);if(a.position){h.copy(this.position,a.position)}this.angle=a.angle||0;this.type=a.type||0;this.id=Shape.idCounter++;this.boundingRadius=0;this.collisionGroup=a.collisionGroup!==undefined?a.collisionGroup:1;this.collisionResponse=a.collisionResponse!==undefined?a.collisionResponse:true;this.collisionMask=a.collisionMask!==undefined?a.collisionMask:1;this.material=a.material||null;this.area=0;this.sensor=a.sensor!==undefined?a.sensor:false;if(this.type){this.updateBoundingRadius()}this.updateArea()}Shape.idCounter=0;Shape.CIRCLE=1;Shape.PARTICLE=2;Shape.PLANE=4;Shape.CONVEX=8;Shape.LINE=16;Shape.BOX=32;Shape.CAPSULE=64;Shape.HEIGHTFIELD=128;Shape.prototype.computeMomentOfInertia=function(a){};Shape.prototype.updateBoundingRadius=function(){};Shape.prototype.updateArea=function(){};Shape.prototype.computeAABB=function(a,b,c){};Shape.prototype.raycast=function(a,b,c,d){}},{'../math/vec2':30}],46:[function(m,n,o){var p=m('../math/vec2'),Solver=m('./Solver'),Utils=m('../utils/Utils'),FrictionEquation=m('../equations/FrictionEquation');n.exports=GSSolver;function GSSolver(a){Solver.call(this,a,Solver.GS);a=a||{};this.iterations=a.iterations||10;this.tolerance=a.tolerance||1e-7;this.arrayStep=30;this.lambda=new Utils.ARRAY_TYPE(this.arrayStep);this.Bs=new Utils.ARRAY_TYPE(this.arrayStep);this.invCs=new Utils.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=false;this.frictionIterations=a.frictionIterations!==undefined?0:a.frictionIterations;this.usedIterations=0}GSSolver.prototype=new Solver();GSSolver.prototype.constructor=GSSolver;function setArrayZero(a){var l=a.length;while(l--){a[l]=+0.0}}GSSolver.prototype.solve=function(h,a){this.sortEquations();var d=0,maxIter=this.iterations,maxFrictionIter=this.frictionIterations,equations=this.equations,Neq=equations.length,tolSquared=Math.pow(this.tolerance*Neq,2),bodies=a.bodies,Nbodies=a.bodies.length,add=p.add,set=p.set,useZeroRHS=this.useZeroRHS,lambda=this.lambda;this.usedIterations=0;if(Neq){for(var i=0;i!==Nbodies;i++){var b=bodies[i];b.updateSolveMassProperties()}}if(lambda.length<Neq){lambda=this.lambda=new Utils.ARRAY_TYPE(Neq+this.arrayStep);this.Bs=new Utils.ARRAY_TYPE(Neq+this.arrayStep);this.invCs=new Utils.ARRAY_TYPE(Neq+this.arrayStep)}setArrayZero(lambda);var e=this.invCs,Bs=this.Bs,lambda=this.lambda;for(var i=0;i!==equations.length;i++){var c=equations[i];if(c.timeStep!==h||c.needsUpdate){c.timeStep=h;c.update()}Bs[i]=c.computeB(c.a,c.b,h);e[i]=c.computeInvC(c.epsilon)}var q,B,c,deltalambdaTot,i,j;if(Neq!==0){for(i=0;i!==Nbodies;i++){var b=bodies[i];b.resetConstraintVelocity()}if(maxFrictionIter){for(d=0;d!==maxFrictionIter;d++){deltalambdaTot=0.0;for(j=0;j!==Neq;j++){c=equations[j];var g=GSSolver.iterateEquation(j,c,c.epsilon,Bs,e,lambda,useZeroRHS,h,d);deltalambdaTot+=Math.abs(g)}this.usedIterations++;if(deltalambdaTot*deltalambdaTot<=tolSquared){break}}GSSolver.updateMultipliers(equations,lambda,1/h);for(j=0;j!==Neq;j++){var l=equations[j];if(l instanceof FrictionEquation){var f=0.0;for(var k=0;k!==l.contactEquations.length;k++){f+=l.contactEquations[k].multiplier}f*=l.frictionCoefficient/l.contactEquations.length;l.maxForce=f;l.minForce=-f}}}for(d=0;d!==maxIter;d++){deltalambdaTot=0.0;for(j=0;j!==Neq;j++){c=equations[j];var g=GSSolver.iterateEquation(j,c,c.epsilon,Bs,e,lambda,useZeroRHS,h,d);deltalambdaTot+=Math.abs(g)}this.usedIterations++;if(deltalambdaTot*deltalambdaTot<=tolSquared){break}}for(i=0;i!==Nbodies;i++){bodies[i].addConstraintVelocity()}GSSolver.updateMultipliers(equations,lambda,1/h)}};GSSolver.updateMultipliers=function(a,b,c){var l=a.length;while(l--){a[l].multiplier=b[l]*c}};GSSolver.iterateEquation=function(j,a,b,c,d,e,f,g,h){var B=c[j],invC=d[j],lambdaj=e[j],GWlambda=a.computeGWlambda();var i=a.maxForce,minForce=a.minForce;if(f){B=0}var k=invC*(B-GWlambda-b*lambdaj);var l=lambdaj+k;if(l<minForce*g){k=minForce*g-lambdaj}else if(l>i*g){k=i*g-lambdaj}e[j]+=k;a.addToWlambda(k);return k}},{'../equations/FrictionEquation':23,'../math/vec2':30,'../utils/Utils':57,'./Solver':47}],47:[function(c,d,e){var f=c('../utils/Utils'),EventEmitter=c('../events/EventEmitter');d.exports=Solver;function Solver(a,b){a=a||{};EventEmitter.call(this);this.type=b;this.equations=[];this.equationSortFunction=a.equationSortFunction||false}Solver.prototype=new EventEmitter();Solver.prototype.constructor=Solver;Solver.prototype.solve=function(a,b){throw new Error('Solver.solve should be implemented by subclasses!');};var g={bodies:[]};Solver.prototype.solveIsland=function(a,b){this.removeAllEquations();if(b.equations.length){this.addEquations(b.equations);g.bodies.length=0;b.getBodies(g.bodies);if(g.bodies.length){this.solve(a,g)}}};Solver.prototype.sortEquations=function(){if(this.equationSortFunction){this.equations.sort(this.equationSortFunction)}};Solver.prototype.addEquation=function(a){if(a.enabled){this.equations.push(a)}};Solver.prototype.addEquations=function(a){for(var i=0,N=a.length;i!==N;i++){var b=a[i];if(b.enabled){this.equations.push(b)}}};Solver.prototype.removeEquation=function(a){var i=this.equations.indexOf(a);if(i!==-1){this.equations.splice(i,1)}};Solver.prototype.removeAllEquations=function(){this.equations.length=0};Solver.GS=1;Solver.ISLAND=2},{'../events/EventEmitter':26,'../utils/Utils':57}],48:[function(b,c,d){var e=b('../equations/ContactEquation');var f=b('./Pool');c.exports=ContactEquationPool;function ContactEquationPool(){f.apply(this,arguments)}ContactEquationPool.prototype=new f();ContactEquationPool.prototype.constructor=ContactEquationPool;ContactEquationPool.prototype.create=function(){return new e()};ContactEquationPool.prototype.destroy=function(a){a.bodyA=a.bodyB=null;return this}},{'../equations/ContactEquation':21,'./Pool':55}],49:[function(b,c,d){var e=b('../equations/FrictionEquation');var f=b('./Pool');c.exports=FrictionEquationPool;function FrictionEquationPool(){f.apply(this,arguments)}FrictionEquationPool.prototype=new f();FrictionEquationPool.prototype.constructor=FrictionEquationPool;FrictionEquationPool.prototype.create=function(){return new e()};FrictionEquationPool.prototype.destroy=function(a){a.bodyA=a.bodyB=null;return this}},{'../equations/FrictionEquation':23,'./Pool':55}],50:[function(b,c,d){var e=b('../world/IslandNode');var f=b('./Pool');c.exports=IslandNodePool;function IslandNodePool(){f.apply(this,arguments)}IslandNodePool.prototype=new f();IslandNodePool.prototype.constructor=IslandNodePool;IslandNodePool.prototype.create=function(){return new e()};IslandNodePool.prototype.destroy=function(a){a.reset();return this}},{'../world/IslandNode':60,'./Pool':55}],51:[function(b,c,d){var e=b('../world/Island');var f=b('./Pool');c.exports=IslandPool;function IslandPool(){f.apply(this,arguments)}IslandPool.prototype=new f();IslandPool.prototype.constructor=IslandPool;IslandPool.prototype.create=function(){return new e()};IslandPool.prototype.destroy=function(a){a.reset();return this}},{'../world/Island':58,'./Pool':55}],52:[function(i,j,k){var m=i('./TupleDictionary');var n=i('./OverlapKeeperRecord');var o=i('./OverlapKeeperRecordPool');var p=i('./Utils');j.exports=OverlapKeeper;function OverlapKeeper(){this.overlappingShapesLastState=new m();this.overlappingShapesCurrentState=new m();this.recordPool=new o({size:16});this.tmpDict=new m();this.tmpArray1=[]}OverlapKeeper.prototype.tick=function(){var a=this.overlappingShapesLastState;var b=this.overlappingShapesCurrentState;var l=a.keys.length;while(l--){var c=a.keys[l];var d=a.getByKey(c);var e=b.getByKey(c);if(d){this.recordPool.release(d)}}a.reset();a.copy(b);b.reset()};OverlapKeeper.prototype.setOverlapping=function(a,b,c,d){var e=this.overlappingShapesLastState;var f=this.overlappingShapesCurrentState;if(!f.get(b.id,d.id)){var g=this.recordPool.get();g.set(a,b,c,d);f.set(b.id,d.id,g)}};OverlapKeeper.prototype.getNewOverlaps=function(a){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,a)};OverlapKeeper.prototype.getEndOverlaps=function(a){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,a)};OverlapKeeper.prototype.bodiesAreOverlapping=function(a,b){var c=this.overlappingShapesCurrentState;var l=c.keys.length;while(l--){var d=c.keys[l];var e=c.data[d];if((e.bodyA===a&&e.bodyB===b)||e.bodyA===b&&e.bodyB===a){return true}}return false};OverlapKeeper.prototype.getDiff=function(a,b,c){var c=c||[];var d=a;var e=b;c.length=0;var l=e.keys.length;while(l--){var f=e.keys[l];var g=e.data[f];if(!g){throw new Error('Key '+f+' had no data!');}var h=d.data[f];if(!h){c.push(g)}}return c};OverlapKeeper.prototype.isNewOverlap=function(a,b){var c=a.id|0,idB=b.id|0;var d=this.overlappingShapesLastState;var e=this.overlappingShapesCurrentState;return!d.get(c,idB)&&!!e.get(c,idB)};OverlapKeeper.prototype.getNewBodyOverlaps=function(a){this.tmpArray1.length=0;var b=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(b,a)};OverlapKeeper.prototype.getEndBodyOverlaps=function(a){this.tmpArray1.length=0;var b=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(b,a)};OverlapKeeper.prototype.getBodyDiff=function(a,b){b=b||[];var c=this.tmpDict;var l=a.length;while(l--){var d=a[l];c.set(d.bodyA.id|0,d.bodyB.id|0,d)}l=c.keys.length;while(l--){var d=c.getByKey(c.keys[l]);if(d){b.push(d.bodyA,d.bodyB)}}c.reset();return b}},{'./OverlapKeeperRecord':53,'./OverlapKeeperRecordPool':54,'./TupleDictionary':56,'./Utils':57}],53:[function(e,f,g){f.exports=OverlapKeeperRecord;function OverlapKeeperRecord(a,b,c,d){this.shapeA=b;this.shapeB=d;this.bodyA=a;this.bodyB=c}OverlapKeeperRecord.prototype.set=function(a,b,c,d){OverlapKeeperRecord.call(this,a,b,c,d)}},{}],54:[function(b,c,d){var e=b('./OverlapKeeperRecord');var f=b('./Pool');c.exports=OverlapKeeperRecordPool;function OverlapKeeperRecordPool(){f.apply(this,arguments)}OverlapKeeperRecordPool.prototype=new f();OverlapKeeperRecordPool.prototype.constructor=OverlapKeeperRecordPool;OverlapKeeperRecordPool.prototype.create=function(){return new e()};OverlapKeeperRecordPool.prototype.destroy=function(a){a.bodyA=a.bodyB=a.shapeA=a.shapeB=null;return this}},{'./OverlapKeeperRecord':53,'./Pool':55}],55:[function(c,d,e){d.exports=Pool;function Pool(a){a=a||{};this.objects=[];if(a.size!==undefined){this.resize(a.size)}}Pool.prototype.resize=function(a){var b=this.objects;while(b.length>a){b.pop()}while(b.length<a){b.push(this.create())}return this};Pool.prototype.get=function(){var a=this.objects;return a.length?a.pop():this.create()};Pool.prototype.release=function(a){this.destroy(a);this.objects.push(a);return this}},{}],56:[function(c,d,e){var f=c('./Utils');d.exports=TupleDictionary;function TupleDictionary(){this.data={};this.keys=[]}TupleDictionary.prototype.getKey=function(a,b){a=a|0;b=b|0;if((a|0)===(b|0)){return-1}return((a|0)>(b|0)?(a<<16)|(b&0xFFFF):(b<<16)|(a&0xFFFF))|0};TupleDictionary.prototype.getByKey=function(a){a=a|0;return this.data[a]};TupleDictionary.prototype.get=function(i,j){return this.data[this.getKey(i,j)]};TupleDictionary.prototype.set=function(i,j,a){if(!a){throw new Error('No data!');}var b=this.getKey(i,j);if(!this.data[b]){this.keys.push(b)}this.data[b]=a;return b};TupleDictionary.prototype.reset=function(){var a=this.data,keys=this.keys;var l=keys.length;while(l--){delete a[keys[l]]}keys.length=0};TupleDictionary.prototype.copy=function(a){this.reset();f.appendArray(this.keys,a.keys);var l=a.keys.length;while(l--){var b=a.keys[l];this.data[b]=a.data[b]}}},{'./Utils':57}],57:[function(d,e,f){e.exports=Utils;function Utils(){}Utils.appendArray=function(a,b){if(b.length<150000){a.push.apply(a,b)}else{for(var i=0,len=b.length;i!==len;++i){a.push(b[i])}}};Utils.splice=function(a,b,c){c=c||1;for(var i=b,len=a.length-c;i<len;i++){a[i]=a[i+c]}a.length=len};if(typeof P2_ARRAY_TYPE!=='undefined'){Utils.ARRAY_TYPE=P2_ARRAY_TYPE}else if(typeof Float32Array!=='undefined'){Utils.ARRAY_TYPE=Float32Array}else{Utils.ARRAY_TYPE=Array}Utils.extend=function(a,b){for(var c in b){a[c]=b[c]}};Utils.defaults=function(a,b){a=a||{};for(var c in b){if(!(c in a)){a[c]=b[c]}}return a}},{}],58:[function(d,e,f){var g=d('../objects/Body');e.exports=Island;function Island(){this.equations=[];this.bodies=[]}Island.prototype.reset=function(){this.equations.length=this.bodies.length=0};var h=[];Island.prototype.getBodies=function(a){var b=a||[],eqs=this.equations;h.length=0;for(var i=0;i!==eqs.length;i++){var c=eqs[i];if(h.indexOf(c.bodyA.id)===-1){b.push(c.bodyA);h.push(c.bodyA.id)}if(h.indexOf(c.bodyB.id)===-1){b.push(c.bodyB);h.push(c.bodyB.id)}}return b};Island.prototype.wantsToSleep=function(){for(var i=0;i<this.bodies.length;i++){var b=this.bodies[i];if(b.type===g.DYNAMIC&&!b.wantsToSleep){return false}}return true};Island.prototype.sleep=function(){for(var i=0;i<this.bodies.length;i++){var b=this.bodies[i];b.sleep()}return true}},{'../objects/Body':31}],59:[function(h,l,m){var n=h('../math/vec2'),Island=h('./Island'),IslandNode=h('./IslandNode'),IslandNodePool=h('./../utils/IslandNodePool'),IslandPool=h('./../utils/IslandPool'),Body=h('../objects/Body');l.exports=IslandManager;function IslandManager(a){this.nodePool=new IslandNodePool({size:16});this.islandPool=new IslandPool({size:8});this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}IslandManager.getUnvisitedNode=function(a){var b=a.length;for(var i=0;i!==b;i++){var c=a[i];if(!c.visited&&c.body.type===Body.DYNAMIC){return c}}return false};IslandManager.prototype.visit=function(a,b,c){b.push(a.body);var d=a.equations.length;for(var i=0;i!==d;i++){var e=a.equations[i];if(c.indexOf(e)===-1){c.push(e)}}};IslandManager.prototype.bfs=function(a,b,c){var d=this.queue;d.length=0;d.push(a);a.visited=true;this.visit(a,b,c);while(d.length){var e=d.pop();var f;while((f=IslandManager.getUnvisitedNode(e.neighbors))){f.visited=true;this.visit(f,b,c);if(f.body.type===Body.DYNAMIC){d.push(f)}}}};IslandManager.prototype.split=function(a){var b=a.bodies,nodes=this.nodes,equations=this.equations;while(nodes.length){this.nodePool.release(nodes.pop())}for(var i=0;i!==b.length;i++){var c=this.nodePool.get();c.body=b[i];nodes.push(c)}for(var k=0;k!==equations.length;k++){var d=equations[k],i=b.indexOf(d.bodyA),j=b.indexOf(d.bodyB),ni=nodes[i],nj=nodes[j];ni.neighbors.push(nj);nj.neighbors.push(ni);ni.equations.push(d);nj.equations.push(d)}var e=this.islands;for(var i=0;i<e.length;i++){this.islandPool.release(e[i])}e.length=0;var f;while((f=IslandManager.getUnvisitedNode(nodes))){var g=this.islandPool.get();this.bfs(f,g.bodies,g.equations);e.push(g)}return e}},{'../math/vec2':30,'../objects/Body':31,'./../utils/IslandNodePool':50,'./../utils/IslandPool':51,'./Island':58,'./IslandNode':60}],60:[function(b,c,d){c.exports=IslandNode;function IslandNode(a){this.body=a;this.neighbors=[];this.equations=[];this.visited=false}IslandNode.prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=false;this.body=null}},{}],61:[function(B,C,D){var E=B('../solver/GSSolver'),Solver=B('../solver/Solver'),Ray=B('../collision/Ray'),vec2=B('../math/vec2'),Circle=B('../shapes/Circle'),Convex=B('../shapes/Convex'),Line=B('../shapes/Line'),Plane=B('../shapes/Plane'),Capsule=B('../shapes/Capsule'),Particle=B('../shapes/Particle'),EventEmitter=B('../events/EventEmitter'),Body=B('../objects/Body'),Shape=B('../shapes/Shape'),LinearSpring=B('../objects/LinearSpring'),Material=B('../material/Material'),ContactMaterial=B('../material/ContactMaterial'),DistanceConstraint=B('../constraints/DistanceConstraint'),Constraint=B('../constraints/Constraint'),LockConstraint=B('../constraints/LockConstraint'),RevoluteConstraint=B('../constraints/RevoluteConstraint'),PrismaticConstraint=B('../constraints/PrismaticConstraint'),GearConstraint=B('../constraints/GearConstraint'),pkg=B('../../package.json'),Broadphase=B('../collision/Broadphase'),AABB=B('../collision/AABB'),SAPBroadphase=B('../collision/SAPBroadphase'),Narrowphase=B('../collision/Narrowphase'),Utils=B('../utils/Utils'),OverlapKeeper=B('../utils/OverlapKeeper'),IslandManager=B('./IslandManager'),RotationalSpring=B('../objects/RotationalSpring');C.exports=World;function World(a){EventEmitter.apply(this);a=a||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=a.solver||new E();this.narrowphase=new Narrowphase(this);this.islandManager=new IslandManager();this.gravity=vec2.fromValues(0,-9.78);if(a.gravity){vec2.copy(this.gravity,a.gravity)}this.frictionGravity=vec2.length(this.gravity)||10;this.useWorldGravityAsFrictionGravity=true;this.useFrictionGravityOnZeroGravity=true;this.broadphase=a.broadphase||new SAPBroadphase();this.broadphase.setWorld(this);this.constraints=[];this.defaultMaterial=new Material();this.defaultContactMaterial=new ContactMaterial(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.applySpringForces=true;this.applyDamping=true;this.applyGravity=true;this.solveConstraints=true;this.contactMaterials=[];this.time=0.0;this.accumulator=0;this.stepping=false;this.bodiesToBeRemoved=[];this.islandSplit=typeof(a.islandSplit)!=='undefined'?!!a.islandSplit:true;this.emitImpactEvent=true;this._constraintIdCounter=0;this._bodyIdCounter=0;this.postStepEvent={type:'postStep'};this.addBodyEvent={type:'addBody',body:null};this.removeBodyEvent={type:'removeBody',body:null};this.addSpringEvent={type:'addSpring',spring:null};this.impactEvent={type:'impact',bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null};this.postBroadphaseEvent={type:'postBroadphase',pairs:null};this.sleepMode=World.NO_SLEEPING;this.beginContactEvent={type:'beginContact',shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]};this.endContactEvent={type:'endContact',shapeA:null,shapeB:null,bodyA:null,bodyB:null};this.preSolveEvent={type:'preSolve',contactEquations:null,frictionEquations:null};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new OverlapKeeper()}World.prototype=new Object(EventEmitter.prototype);World.prototype.constructor=World;World.NO_SLEEPING=1;World.BODY_SLEEPING=2;World.ISLAND_SLEEPING=4;World.prototype.addConstraint=function(a){this.constraints.push(a)};World.prototype.addContactMaterial=function(a){this.contactMaterials.push(a)};World.prototype.removeContactMaterial=function(a){var b=this.contactMaterials.indexOf(a);if(b!==-1){Utils.splice(this.contactMaterials,b,1)}};World.prototype.getContactMaterial=function(a,b){var c=this.contactMaterials;for(var i=0,N=c.length;i!==N;i++){var d=c[i];if((d.materialA.id===a.id)&&(d.materialB.id===b.id)||(d.materialA.id===b.id)&&(d.materialB.id===a.id)){return d}}return false};World.prototype.removeConstraint=function(a){var b=this.constraints.indexOf(a);if(b!==-1){Utils.splice(this.constraints,b,1)}};var F=vec2.create(),step_runit=vec2.create(),step_u=vec2.create(),step_f=vec2.create(),step_fhMinv=vec2.create(),step_velodt=vec2.create(),step_mg=vec2.create(),xiw=vec2.fromValues(0,0),xjw=vec2.fromValues(0,0),zero=vec2.fromValues(0,0),interpvelo=vec2.fromValues(0,0);World.prototype.step=function(a,c,d){d=d||10;c=c||0;if(c===0){this.internalStep(a);this.time+=a}else{this.accumulator+=c;var e=0;while(this.accumulator>=a&&e<d){this.internalStep(a);this.time+=a;this.accumulator-=a;e++}var t=(this.accumulator%a)/a;for(var j=0;j!==this.bodies.length;j++){var b=this.bodies[j];vec2.lerp(b.interpolatedPosition,b.previousPosition,b.position,t);b.interpolatedAngle=b.previousAngle+t*(b.angle-b.previousAngle)}}};var G=[];World.prototype.internalStep=function(a){this.stepping=true;var d=this,Nsprings=this.springs.length,springs=this.springs,bodies=this.bodies,g=this.gravity,solver=this.solver,Nbodies=this.bodies.length,broadphase=this.broadphase,np=this.narrowphase,constraints=this.constraints,t0,t1,fhMinv=step_fhMinv,velodt=step_velodt,mg=step_mg,scale=vec2.scale,add=vec2.add,rotate=vec2.rotate,islandManager=this.islandManager;this.overlapKeeper.tick();this.lastTimeStep=a;if(this.useWorldGravityAsFrictionGravity){var f=vec2.length(this.gravity);if(!(f===0&&this.useFrictionGravityOnZeroGravity)){this.frictionGravity=f}}if(this.applyGravity){for(var i=0;i!==Nbodies;i++){var b=bodies[i],fi=b.force;if(b.type!==Body.DYNAMIC||b.sleepState===Body.SLEEPING){continue}vec2.scale(mg,g,b.mass*b.gravityScale);add(fi,fi,mg)}}if(this.applySpringForces){for(var i=0;i!==Nsprings;i++){var s=springs[i];s.applyForce()}}if(this.applyDamping){for(var i=0;i!==Nbodies;i++){var b=bodies[i];if(b.type===Body.DYNAMIC){b.applyDamping(a)}}}var h=broadphase.getCollisionPairs(this);var m=this.disabledBodyCollisionPairs;for(var i=m.length-2;i>=0;i-=2){for(var j=h.length-2;j>=0;j-=2){if((m[i]===h[j]&&m[i+1]===h[j+1])||(m[i+1]===h[j]&&m[i]===h[j+1])){h.splice(j,2)}}}var n=constraints.length;for(i=0;i!==n;i++){var c=constraints[i];if(!c.collideConnected){for(var j=h.length-2;j>=0;j-=2){if((c.bodyA===h[j]&&c.bodyB===h[j+1])||(c.bodyB===h[j]&&c.bodyA===h[j+1])){h.splice(j,2)}}}}this.postBroadphaseEvent.pairs=h;this.emit(this.postBroadphaseEvent);this.postBroadphaseEvent.pairs=null;np.reset(this);for(var i=0,Nresults=h.length;i!==Nresults;i+=2){var o=h[i],bj=h[i+1];for(var k=0,Nshapesi=o.shapes.length;k!==Nshapesi;k++){var p=o.shapes[k],xi=p.position,ai=p.angle;for(var l=0,Nshapesj=bj.shapes.length;l!==Nshapesj;l++){var q=bj.shapes[l],xj=q.position,aj=q.angle;var r=this.defaultContactMaterial;if(p.material&&q.material){var t=this.getContactMaterial(p.material,q.material);if(t){r=t}}this.runNarrowphase(np,o,p,xi,ai,bj,q,xj,aj,r,this.frictionGravity)}}}for(var i=0;i!==Nbodies;i++){var u=bodies[i];if(u._wakeUpAfterNarrowphase){u.wakeUp();u._wakeUpAfterNarrowphase=false}}if(this.has('endContact')){this.overlapKeeper.getEndOverlaps(G);var e=this.endContactEvent;var l=G.length;while(l--){var v=G[l];e.shapeA=v.shapeA;e.shapeB=v.shapeB;e.bodyA=v.bodyA;e.bodyB=v.bodyB;this.emit(e)}G.length=0}var w=this.preSolveEvent;w.contactEquations=np.contactEquations;w.frictionEquations=np.frictionEquations;this.emit(w);w.contactEquations=w.frictionEquations=null;var n=constraints.length;for(i=0;i!==n;i++){constraints[i].update()}if(np.contactEquations.length||np.frictionEquations.length||n){if(this.islandSplit){islandManager.equations.length=0;Utils.appendArray(islandManager.equations,np.contactEquations);Utils.appendArray(islandManager.equations,np.frictionEquations);for(i=0;i!==n;i++){Utils.appendArray(islandManager.equations,constraints[i].equations)}islandManager.split(this);for(var i=0;i!==islandManager.islands.length;i++){var x=islandManager.islands[i];if(x.equations.length){solver.solveIsland(a,x)}}}else{solver.addEquations(np.contactEquations);solver.addEquations(np.frictionEquations);for(i=0;i!==n;i++){solver.addEquations(constraints[i].equations)}if(this.solveConstraints){solver.solve(a,this)}solver.removeAllEquations()}}for(var i=0;i!==Nbodies;i++){var u=bodies[i];u.integrate(a)}for(var i=0;i!==Nbodies;i++){bodies[i].setZeroForce()}if(this.emitImpactEvent&&this.has('impact')){var y=this.impactEvent;for(var i=0;i!==np.contactEquations.length;i++){var z=np.contactEquations[i];if(z.firstImpact){y.bodyA=z.bodyA;y.bodyB=z.bodyB;y.shapeA=z.shapeA;y.shapeB=z.shapeB;y.contactEquation=z;this.emit(y)}}}if(this.sleepMode===World.BODY_SLEEPING){for(i=0;i!==Nbodies;i++){bodies[i].sleepTick(this.time,false,a)}}else if(this.sleepMode===World.ISLAND_SLEEPING&&this.islandSplit){for(i=0;i!==Nbodies;i++){bodies[i].sleepTick(this.time,true,a)}for(var i=0;i<this.islandManager.islands.length;i++){var x=this.islandManager.islands[i];if(x.wantsToSleep()){x.sleep()}}}this.stepping=false;var A=this.bodiesToBeRemoved;for(var i=0;i!==A.length;i++){this.removeBody(A[i])}A.length=0;this.emit(this.postStepEvent)};World.prototype.runNarrowphase=function(a,b,c,d,g,h,j,k,l,m,n){if(!((c.collisionGroup&j.collisionMask)!==0&&(j.collisionGroup&c.collisionMask)!==0)){return}vec2.rotate(xiw,d,b.angle);vec2.rotate(xjw,k,h.angle);vec2.add(xiw,xiw,b.position);vec2.add(xjw,xjw,h.position);var o=g+b.angle;var p=l+h.angle;a.enableFriction=m.friction>0;a.frictionCoefficient=m.friction;var q;if(b.type===Body.STATIC||b.type===Body.KINEMATIC){q=h.mass}else if(h.type===Body.STATIC||h.type===Body.KINEMATIC){q=b.mass}else{q=(b.mass*h.mass)/(b.mass+h.mass)}a.slipForce=m.friction*n*q;a.restitution=m.restitution;a.surfaceVelocity=m.surfaceVelocity;a.frictionStiffness=m.frictionStiffness;a.frictionRelaxation=m.frictionRelaxation;a.stiffness=m.stiffness;a.relaxation=m.relaxation;a.contactSkinSize=m.contactSkinSize;a.enabledEquations=b.collisionResponse&&h.collisionResponse&&c.collisionResponse&&j.collisionResponse;var r=a[c.type|j.type],numContacts=0;if(r){var s=c.sensor||j.sensor;var t=a.frictionEquations.length;if(c.type<j.type){numContacts=r.call(a,b,c,xiw,o,h,j,xjw,p,s)}else{numContacts=r.call(a,h,j,xjw,p,b,c,xiw,o,s)}var u=a.frictionEquations.length-t;if(numContacts){if(b.allowSleep&&b.type===Body.DYNAMIC&&b.sleepState===Body.SLEEPING&&h.sleepState===Body.AWAKE&&h.type!==Body.STATIC){var v=vec2.squaredLength(h.velocity)+Math.pow(h.angularVelocity,2);var w=Math.pow(h.sleepSpeedLimit,2);if(v>=w*2){b._wakeUpAfterNarrowphase=true}}if(h.allowSleep&&h.type===Body.DYNAMIC&&h.sleepState===Body.SLEEPING&&b.sleepState===Body.AWAKE&&b.type!==Body.STATIC){var x=vec2.squaredLength(b.velocity)+Math.pow(b.angularVelocity,2);var y=Math.pow(b.sleepSpeedLimit,2);if(x>=y*2){h._wakeUpAfterNarrowphase=true}}this.overlapKeeper.setOverlapping(b,c,h,j);if(this.has('beginContact')&&this.overlapKeeper.isNewOverlap(c,j)){var e=this.beginContactEvent;e.shapeA=c;e.shapeB=j;e.bodyA=b;e.bodyB=h;e.contactEquations.length=0;if(typeof(numContacts)==='number'){for(var i=a.contactEquations.length-numContacts;i<a.contactEquations.length;i++){e.contactEquations.push(a.contactEquations[i])}}this.emit(e)}if(typeof(numContacts)==='number'&&u>1){for(var i=a.frictionEquations.length-u;i<a.frictionEquations.length;i++){var f=a.frictionEquations[i];f.setSlipForce(f.getSlipForce()/u)}}}}};World.prototype.addSpring=function(a){this.springs.push(a);var b=this.addSpringEvent;b.spring=a;this.emit(b);b.spring=null};World.prototype.removeSpring=function(a){var b=this.springs.indexOf(a);if(b!==-1){Utils.splice(this.springs,b,1)}};World.prototype.addBody=function(a){if(this.bodies.indexOf(a)===-1){this.bodies.push(a);a.world=this;var b=this.addBodyEvent;b.body=a;this.emit(b);b.body=null}};World.prototype.removeBody=function(a){if(this.stepping){this.bodiesToBeRemoved.push(a)}else{a.world=null;var b=this.bodies.indexOf(a);if(b!==-1){Utils.splice(this.bodies,b,1);this.removeBodyEvent.body=a;a.resetConstraintVelocity();this.emit(this.removeBodyEvent);this.removeBodyEvent.body=null}}};World.prototype.getBodyById=function(a){var c=this.bodies;for(var i=0;i<c.length;i++){var b=c[i];if(b.id===a){return b}}return false};World.prototype.disableBodyCollision=function(a,b){this.disabledBodyCollisionPairs.push(a,b)};World.prototype.enableBodyCollision=function(a,b){var c=this.disabledBodyCollisionPairs;for(var i=0;i<c.length;i+=2){if((c[i]===a&&c[i+1]===b)||(c[i+1]===a&&c[i]===b)){c.splice(i,2);return}}};World.prototype.clear=function(){this.time=0;if(this.solver&&this.solver.equations.length){this.solver.removeAllEquations()}var a=this.constraints;for(var i=a.length-1;i>=0;i--){this.removeConstraint(a[i])}var b=this.bodies;for(var i=b.length-1;i>=0;i--){this.removeBody(b[i])}var c=this.springs;for(var i=c.length-1;i>=0;i--){this.removeSpring(c[i])}var d=this.contactMaterials;for(var i=d.length-1;i>=0;i--){this.removeContactMaterial(d[i])}World.apply(this)};var H=vec2.create(),hitTest_zero=vec2.fromValues(0,0),hitTest_tmp2=vec2.fromValues(0,0);World.prototype.hitTest=function(c,d,e){e=e||0;var f=new Body({position:c}),ps=new Particle(),px=c,pa=0,x=H,zero=hitTest_zero,tmp=hitTest_tmp2;f.addShape(ps);var n=this.narrowphase,result=[];for(var i=0,N=d.length;i!==N;i++){var b=d[i];for(var j=0,NS=b.shapes.length;j!==NS;j++){var s=b.shapes[j];vec2.rotate(x,s.position,b.angle);vec2.add(x,x,b.position);var a=s.angle+b.angle;if((s instanceof Circle&&n.circleParticle(b,s,x,a,f,ps,px,pa,true))||(s instanceof Convex&&n.particleConvex(f,ps,px,pa,b,s,x,a,true))||(s instanceof Plane&&n.particlePlane(f,ps,px,pa,b,s,x,a,true))||(s instanceof Capsule&&n.particleCapsule(f,ps,px,pa,b,s,x,a,true))||(s instanceof Particle&&vec2.squaredLength(vec2.sub(tmp,x,c))<e*e)){result.push(b)}}}return result};World.prototype.setGlobalStiffness=function(a){var b=this.constraints;for(var i=0;i!==b.length;i++){var c=b[i];for(var j=0;j!==c.equations.length;j++){var d=c.equations[j];d.stiffness=a;d.needsUpdate=true}}var e=this.contactMaterials;for(var i=0;i!==e.length;i++){var c=e[i];c.stiffness=c.frictionStiffness=a}var c=this.defaultContactMaterial;c.stiffness=c.frictionStiffness=a};World.prototype.setGlobalRelaxation=function(a){for(var i=0;i!==this.constraints.length;i++){var c=this.constraints[i];for(var j=0;j!==c.equations.length;j++){var b=c.equations[j];b.relaxation=a;b.needsUpdate=true}}for(var i=0;i!==this.contactMaterials.length;i++){var c=this.contactMaterials[i];c.relaxation=c.frictionRelaxation=a}var c=this.defaultContactMaterial;c.relaxation=c.frictionRelaxation=a};var I=new AABB();var J=[];World.prototype.raycast=function(a,b){b.getAABB(I);this.broadphase.aabbQuery(this,I,J);b.intersectBodies(a,J);J.length=0;return a.hasHit()}},{'../../package.json':6,'../collision/AABB':7,'../collision/Broadphase':8,'../collision/Narrowphase':10,'../collision/Ray':11,'../collision/SAPBroadphase':13,'../constraints/Constraint':14,'../constraints/DistanceConstraint':15,'../constraints/GearConstraint':16,'../constraints/LockConstraint':17,'../constraints/PrismaticConstraint':18,'../constraints/RevoluteConstraint':19,'../events/EventEmitter':26,'../material/ContactMaterial':27,'../material/Material':28,'../math/vec2':30,'../objects/Body':31,'../objects/LinearSpring':32,'../objects/RotationalSpring':33,'../shapes/Capsule':38,'../shapes/Circle':39,'../shapes/Convex':40,'../shapes/Line':42,'../shapes/Particle':43,'../shapes/Plane':44,'../shapes/Shape':45,'../solver/GSSolver':46,'../solver/Solver':47,'../utils/OverlapKeeper':52,'../utils/Utils':57,'./IslandManager':59}]},{},[36])(36)});(function(){var J=this;var K=K||{};K.DisplayObject=function(){this.position=new K.Point(0,0);this.scale=new K.Point(1,1);this.pivot=new K.Point(0,0);this.rotation=0;this.alpha=1;this.visible=true;this.hitArea=null;this.renderable=false;this.parent=null;this.worldAlpha=1;this.worldTransform=new Phaser.Matrix();this.worldPosition=new K.Point(0,0);this.worldScale=new K.Point(1,1);this.worldRotation=0;this.filterArea=null;this._sr=0;this._cr=1;this._bounds=new K.Rectangle(0,0,0,0);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=false;this._cacheIsDirty=false};K.DisplayObject.prototype={constructor:K.DisplayObject,destroy:function(){if(this.children){var i=this.children.length;while(i--){this.children[i].destroy()}this.children=[]}this.hitArea=null;this.parent=null;this.worldTransform=null;this.filterArea=null;this.renderable=false;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite();this._destroyTintedTexture()},updateTransform:function(e){if(!e&&!this.parent&&!this.game){return this}var p=this.parent;if(e){p=e}else if(!this.parent){p=this.game.world}var f=p.worldTransform;var g=this.worldTransform;var a,b,c,d,tx,ty;if(this.rotation%Phaser.Math.PI2){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}a=this._cr*this.scale.x;b=this._sr*this.scale.x;c=-this._sr*this.scale.y;d=this._cr*this.scale.y;tx=this.position.x;ty=this.position.y;if(this.pivot.x||this.pivot.y){tx-=this.pivot.x*a+this.pivot.y*c;ty-=this.pivot.x*b+this.pivot.y*d}g.a=a*f.a+b*f.c;g.b=a*f.b+b*f.d;g.c=c*f.a+d*f.c;g.d=c*f.b+d*f.d;g.tx=tx*f.a+ty*f.c+f.tx;g.ty=tx*f.b+ty*f.d+f.ty}else{a=this.scale.x;b=0;c=0;d=this.scale.y;tx=this.position.x-this.pivot.x*a;ty=this.position.y-this.pivot.y*d;g.a=a*f.a;g.b=a*f.b;g.c=d*f.c;g.d=d*f.d;g.tx=tx*f.a+ty*f.c+f.tx;g.ty=tx*f.b+ty*f.d+f.ty}a=g.a;b=g.b;c=g.c;d=g.d;var h=(a*d)-(b*c);if(a||b){var r=Math.sqrt((a*a)+(b*b));this.worldRotation=(b>0)?Math.acos(a/r):-Math.acos(a/r);this.worldScale.x=r;this.worldScale.y=h/r}else if(c||d){var s=Math.sqrt((c*c)+(d*d));this.worldRotation=Phaser.Math.HALF_PI-((d>0)?Math.acos(-c/s):-Math.acos(c/s));this.worldScale.x=h/s;this.worldScale.y=s}else{this.worldScale.x=0;this.worldScale.y=0}this.worldAlpha=this.alpha*p.worldAlpha;this.worldPosition.x=g.tx;this.worldPosition.y=g.ty;this._currentBounds=null;if(this.transformCallback){this.transformCallback.call(this.transformCallbackContext,g,f)}return this},preUpdate:function(){},generateTexture:function(a,b,c){var d=this.getLocalBounds();var e=new Phaser.RenderTexture(this.game,d.width|0,d.height|0,c,b,a);K.DisplayObject._tempMatrix.tx=-d.x;K.DisplayObject._tempMatrix.ty=-d.y;e.render(this,K.DisplayObject._tempMatrix);return e},updateCache:function(){this._generateCachedSprite();return this},toGlobal:function(a){this.updateTransform();return this.worldTransform.apply(a)},toLocal:function(a,b){if(b){a=b.toGlobal(a)}this.updateTransform();return this.worldTransform.applyInverse(a)},_renderCachedSprite:function(a){this._cachedSprite.worldAlpha=this.worldAlpha;if(a.gl){K.Sprite.prototype._renderWebGL.call(this._cachedSprite,a)}else{K.Sprite.prototype._renderCanvas.call(this._cachedSprite,a)}},_generateCachedSprite:function(){this._cacheAsBitmap=false;var a=this.getLocalBounds();a.width=Math.max(1,Math.ceil(a.width));a.height=Math.max(1,Math.ceil(a.height));this.updateTransform();if(!this._cachedSprite){var b=0;if(this.texture&&this.texture.baseTexture&&K._enableMultiTextureToggle){b=this.texture.baseTexture.textureIndex}var c=new Phaser.RenderTexture(this.game,a.width,a.height,undefined,undefined,undefined,undefined,b);this._cachedSprite=new K.Sprite(c);this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.texture.resize(a.width,a.height)}var d=this._filters;this._filters=null;this._cachedSprite.filters=d;K.DisplayObject._tempMatrix.tx=-a.x;K.DisplayObject._tempMatrix.ty=-a.y;this._cachedSprite.texture.render(this,K.DisplayObject._tempMatrix,true);this._cachedSprite.anchor.x=-(a.x/a.width);this._cachedSprite.anchor.y=-(a.y/a.height);this._filters=d;this._cacheAsBitmap=true},_destroyCachedSprite:function(){if(!this._cachedSprite){return}this._cachedSprite.texture.destroy(true);this._cachedSprite=null},_destroyTintedTexture:function(){if(!this.tintedTexture){return}Phaser.CanvasPool.removeByCanvas(this.tintedTexture);this.tintedTexture=null}};K.DisplayObject.prototype.displayObjectUpdateTransform=K.DisplayObject.prototype.updateTransform;Object.defineProperties(K.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(a){this.position.x=a}},y:{get:function(){return this.position.y},set:function(a){this.position.y=a}},worldVisible:{get:function(){if(!this.visible){return false}else{var a=this.parent;if(!a){return this.visible}else{do{if(!a.visible){return false}a=a.parent}while(a)}return true}}},mask:{get:function(){return this._mask},set:function(a){if(this._mask){this._mask.isMask=false}this._mask=a;if(a){this._mask.isMask=true}}},filters:{get:function(){return this._filters},set:function(a){if(Array.isArray(a)){var b=[];for(var i=0;i<a.length;i++){var c=a[i].passes;for(var j=0;j<c.length;j++){b.push(c[j])}}this._filterBlock={target:this,filterPasses:b}}this._filters=a;if(this.blendMode&&this.blendMode===K.blendModes.MULTIPLY){this.blendMode=K.blendModes.NORMAL}}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(a){if(this._cacheAsBitmap===a){return}if(a){this._generateCachedSprite()}else{this._destroyCachedSprite()}this._cacheAsBitmap=a}}});K.DisplayObjectContainer=function(){K.DisplayObject.call(this);this.children=[];this.ignoreChildInput=false};K.DisplayObjectContainer.prototype=Object.create(K.DisplayObject.prototype);K.DisplayObjectContainer.prototype.constructor=K.DisplayObjectContainer;K.DisplayObjectContainer.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)};K.DisplayObjectContainer.prototype.addChildAt=function(a,b){if(b>=0&&b<=this.children.length){if(a.parent){a.parent.removeChild(a)}a.parent=this;this.children.splice(b,0,a);return a}else{throw new Error(a+'addChildAt: The index '+b+' supplied is out of bounds '+this.children.length);}};K.DisplayObjectContainer.prototype.swapChildren=function(a,b){if(a===b){return}var c=this.getChildIndex(a);var d=this.getChildIndex(b);if(c<0||d<0){throw new Error('swapChildren: Both the supplied DisplayObjects must be a child of the caller.');}this.children[c]=b;this.children[d]=a};K.DisplayObjectContainer.prototype.getChildIndex=function(a){var b=this.children.indexOf(a);if(b===-1){throw new Error('The supplied DisplayObject must be a child of the caller');}return b};K.DisplayObjectContainer.prototype.setChildIndex=function(a,b){if(b<0||b>=this.children.length){throw new Error('The supplied index is out of bounds');}var c=this.getChildIndex(a);this.children.splice(c,1);this.children.splice(b,0,a)};K.DisplayObjectContainer.prototype.getChildAt=function(a){if(a<0||a>=this.children.length){throw new Error('getChildAt: Supplied index '+a+' does not exist in the child list, or the supplied DisplayObject must be a child of the caller');}return this.children[a]};K.DisplayObjectContainer.prototype.removeChild=function(a){var b=this.children.indexOf(a);if(b===-1){return}return this.removeChildAt(b)};K.DisplayObjectContainer.prototype.removeChildAt=function(a){var b=this.getChildAt(a);if(b){b.parent=undefined;this.children.splice(a,1)}return b};K.DisplayObjectContainer.prototype.bringChildToTop=function(a){if(a.parent!==this){return}return this.setChildIndex(a,this.children.length-1)};K.DisplayObjectContainer.prototype.sendChildToBack=function(a){if(a.parent!==this){return}return this.setChildIndex(a,0)};K.DisplayObjectContainer.prototype.removeChildren=function(a,b){if(a===undefined){a=0}if(b===undefined){b=this.children.length}var c=b-a;if(c>0&&c<=b){var d=this.children.splice(a,c);for(var i=0;i<d.length;i++){var e=d[i];e.parent=undefined}return d}else if(c===0&&this.children.length===0){return[]}else{throw new Error('removeChildren: Range Error, numeric values are outside the acceptable range');}};K.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible){return}this.displayObjectUpdateTransform();if(this._cacheAsBitmap){return}for(var i=0;i<this.children.length;i++){this.children[i].updateTransform()}};K.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=K.DisplayObjectContainer.prototype.updateTransform;K.DisplayObjectContainer.prototype.getBounds=function(e){var f=(e&&e instanceof K.DisplayObject);var g=true;if(!f){e=this}else if(e instanceof K.DisplayObjectContainer){g=e.contains(this)}else{g=false}var i;if(f){var h=e.worldTransform;e.worldTransform=Phaser.identityMatrix;for(i=0;i<e.children.length;i++){e.children[i].updateTransform()}}var j=Infinity;var k=Infinity;var l=-Infinity;var m=-Infinity;var n;var o;var p;var q=false;for(i=0;i<this.children.length;i++){var r=this.children[i];if(!r.visible){continue}q=true;n=this.children[i].getBounds();j=(j<n.x)?j:n.x;k=(k<n.y)?k:n.y;o=n.width+n.x;p=n.height+n.y;l=(l>o)?l:o;m=(m>p)?m:p}var s=this._bounds;if(!q){s=new K.Rectangle();var t=s.x;var u=s.width+s.x;var v=s.y;var w=s.height+s.y;var x=this.worldTransform;var a=x.a;var b=x.b;var c=x.c;var d=x.d;var y=x.tx;var z=x.ty;var A=a*u+c*w+y;var B=d*w+b*u+z;var C=a*t+c*w+y;var D=d*w+b*t+z;var E=a*t+c*v+y;var F=d*v+b*t+z;var G=a*u+c*v+y;var H=d*v+b*u+z;l=A;m=B;j=A;k=B;j=C<j?C:j;j=E<j?E:j;j=G<j?G:j;k=D<k?D:k;k=F<k?F:k;k=H<k?H:k;l=C>l?C:l;l=E>l?E:l;l=G>l?G:l;m=D>m?D:m;m=F>m?F:m;m=H>m?H:m}s.x=j;s.y=k;s.width=l-j;s.height=m-k;if(f){e.worldTransform=h;for(i=0;i<e.children.length;i++){e.children[i].updateTransform()}}if(!g){var I=e.getBounds();s.x-=I.x;s.y-=I.y}return s};K.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)};K.DisplayObjectContainer.prototype.contains=function(a){if(!a){return false}else if(a===this){return true}else{return this.contains(a.parent)}};K.DisplayObjectContainer.prototype._renderWebGL=function(a){if(!this.visible||this.alpha<=0){return}if(this._cacheAsBitmap){this._renderCachedSprite(a);return}var i;if(this._mask||this._filters){if(this._filters){a.spriteBatch.flush();a.filterManager.pushFilter(this._filterBlock)}if(this._mask){a.spriteBatch.stop();a.maskManager.pushMask(this.mask,a);a.spriteBatch.start()}for(i=0;i<this.children.length;i++){this.children[i]._renderWebGL(a)}a.spriteBatch.stop();if(this._mask){a.maskManager.popMask(this._mask,a)}if(this._filters){a.filterManager.popFilter()}a.spriteBatch.start()}else{for(i=0;i<this.children.length;i++){this.children[i]._renderWebGL(a)}}};K.DisplayObjectContainer.prototype._renderCanvas=function(a){if(this.visible===false||this.alpha===0){return}if(this._cacheAsBitmap){this._renderCachedSprite(a);return}if(this._mask){a.maskManager.pushMask(this._mask,a)}for(var i=0;i<this.children.length;i++){this.children[i]._renderCanvas(a)}if(this._mask){a.maskManager.popMask(a)}};Object.defineProperty(K.DisplayObjectContainer.prototype,'width',{get:function(){return this.getLocalBounds().width*this.scale.x},set:function(a){var b=this.getLocalBounds().width;if(b!==0){this.scale.x=a/b}else{this.scale.x=1}this._width=a}});Object.defineProperty(K.DisplayObjectContainer.prototype,'height',{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(a){var b=this.getLocalBounds().height;if(b!==0){this.scale.y=a/b}else{this.scale.y=1}this._height=a}});K.Sprite=function(a){K.DisplayObjectContainer.call(this);this.anchor=new K.Point(K.Sprite.defaultAnchor.x,K.Sprite.defaultAnchor.y);this.texture=a||K.Texture.emptyTexture;this._width=0;this._height=0;this.tint=0xFFFFFF;this.cachedTint=-1;this.tintedTexture=null;this.blendMode=K.blendModes.NORMAL;this.shader=null;this.exists=true;if(this.texture.baseTexture.hasLoaded){this.onTextureUpdate()}this.renderable=true};K.Sprite.defaultAnchor={x:0,y:0};K.Sprite.prototype=Object.create(K.DisplayObjectContainer.prototype);K.Sprite.prototype.constructor=K.Sprite;Object.defineProperty(K.Sprite.prototype,'width',{get:function(){return this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}});Object.defineProperty(K.Sprite.prototype,'height',{get:function(){return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height;this._height=a}});K.Sprite.prototype.setTexture=function(a,b){if(b){this.texture.baseTexture.destroy()}this.texture.baseTexture.skipRender=false;this.texture=a;this.texture.valid=true;this.cachedTint=-1};K.Sprite.prototype.onTextureUpdate=function(){if(this._width){this.scale.x=this._width/this.texture.frame.width}if(this._height){this.scale.y=this._height/this.texture.frame.height}};K.Sprite.prototype.getBounds=function(e){var f=this.texture.frame.width;var g=this.texture.frame.height;var h=f*(1-this.anchor.x);var i=f*-this.anchor.x;var j=g*(1-this.anchor.y);var k=g*-this.anchor.y;var l=e||this.worldTransform;var a=l.a;var b=l.b;var c=l.c;var d=l.d;var m=l.tx;var n=l.ty;var o=-Infinity;var p=-Infinity;var q=Infinity;var r=Infinity;if(b===0&&c===0){if(a<0){a*=-1;var s=h;h=-i;i=-s}if(d<0){d*=-1;var s=j;j=-k;k=-s}q=a*i+m;o=a*h+m;r=d*k+n;p=d*j+n}else{var t=a*i+c*k+m;var u=d*k+b*i+n;var v=a*h+c*k+m;var w=d*k+b*h+n;var x=a*h+c*j+m;var y=d*j+b*h+n;var z=a*i+c*j+m;var A=d*j+b*i+n;q=t<q?t:q;q=v<q?v:q;q=x<q?x:q;q=z<q?z:q;r=u<r?u:r;r=w<r?w:r;r=y<r?y:r;r=A<r?A:r;o=t>o?t:o;o=v>o?v:o;o=x>o?x:o;o=z>o?z:o;p=u>p?u:p;p=w>p?w:p;p=y>p?y:p;p=A>p?A:p}var B=this._bounds;B.x=q;B.width=o-q;B.y=r;B.height=p-r;this._currentBounds=B;return B};K.Sprite.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=Phaser.identityMatrix;for(var i=0;i<this.children.length;i++){this.children[i].updateTransform()}var b=this.getBounds();this.worldTransform=a;for(i=0;i<this.children.length;i++){this.children[i].updateTransform()}return b};K.Sprite.prototype._renderWebGL=function(a,b){if(!this.visible||this.alpha<=0||!this.renderable){return}var c=this.worldTransform;if(b){c=b}if(this._mask||this._filters){var d=a.spriteBatch;if(this._filters){d.flush();a.filterManager.pushFilter(this._filterBlock)}if(this._mask){d.stop();a.maskManager.pushMask(this.mask,a);d.start()}d.render(this);for(var i=0;i<this.children.length;i++){this.children[i]._renderWebGL(a)}d.stop();if(this._mask){a.maskManager.popMask(this._mask,a)}if(this._filters){a.filterManager.popFilter()}d.start()}else{a.spriteBatch.render(this);for(var i=0;i<this.children.length;i++){this.children[i]._renderWebGL(a,c)}}};K.Sprite.prototype._renderCanvas=function(f,g){if(!this.visible||this.alpha===0||!this.renderable||this.texture.crop.width<1||this.texture.crop.height<1){return}var h=this.worldTransform;if(g){h=g}if(this.blendMode!==f.currentBlendMode){f.currentBlendMode=this.blendMode;f.context.globalCompositeOperation=K.blendModesCanvas[f.currentBlendMode]}if(this._mask){f.maskManager.pushMask(this._mask,f)}if(!this.texture.valid){for(var i=0;i<this.children.length;i++){this.children[i]._renderCanvas(f)}if(this._mask){f.maskManager.popMask(f)}return}var j=this.texture.baseTexture.resolution/f.resolution;f.context.globalAlpha=this.worldAlpha;if(f.smoothProperty&&f.scaleMode!==this.texture.baseTexture.scaleMode){f.scaleMode=this.texture.baseTexture.scaleMode;f.context[f.smoothProperty]=(f.scaleMode===K.scaleModes.LINEAR)}var k=(this.texture.trim)?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width;var l=(this.texture.trim)?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;var m=(h.tx*f.resolution)+f.shakeX;var n=(h.ty*f.resolution)+f.shakeY;var o=this.texture.crop.width;var p=this.texture.crop.height;if(this.texture.rotated){var a=h.a;var b=h.b;var c=h.c;var d=h.d;var e=o;m=h.c*p+m;n=h.d*p+n;h.a=a*6.123233995736766e-17+ -c;h.b=b*6.123233995736766e-17+ -d;h.c=a+c*6.123233995736766e-17;h.d=b+d*6.123233995736766e-17;o=p;p=e}if(f.roundPixels){f.context.setTransform(h.a,h.b,h.c,h.d,m|0,n|0);k|=0;l|=0}else{f.context.setTransform(h.a,h.b,h.c,h.d,m,n)}k/=j;l/=j;o|=0;p|=0;if(!o||!p){return}if(this.tint!==0xFFFFFF){if(this.texture.requiresReTint||this.cachedTint!==this.tint){this.tintedTexture=K.CanvasTinter.getTintedTexture(this,this.tint);this.cachedTint=this.tint;this.texture.requiresReTint=false}f.context.drawImage(this.tintedTexture,0,0,o,p,k,l,o/j,p/j)}else{var q=this.texture.crop.x;var r=this.texture.crop.y;f.context.drawImage(this.texture.baseTexture.source,q,r,o,p,k,l,o/j,p/j)}for(var i=0;i<this.children.length;i++){this.children[i]._renderCanvas(f)}if(this._mask){f.maskManager.popMask(f)}};K.initDefaultShaders=function(){};K.CompileVertexShader=function(a,b){return K._CompileShader(a,b,a.VERTEX_SHADER)};K.CompileFragmentShader=function(a,b){return K._CompileShader(a,b,a.FRAGMENT_SHADER)};K._CompileShader=function(a,b,c){var d=b;if(Array.isArray(b)){d=b.join('\n')}var e=a.createShader(c);a.shaderSource(e,d);a.compileShader(e);if(!a.getShaderParameter(e,a.COMPILE_STATUS)){window.console.log(a.getShaderInfoLog(e));return null}return e};K.compileProgram=function(a,b,c){var d=K.CompileFragmentShader(a,c);var e=K.CompileVertexShader(a,b);var f=a.createProgram();a.attachShader(f,e);a.attachShader(f,d);a.linkProgram(f);if(!a.getProgramParameter(f,a.LINK_STATUS)){window.console.log(a.getProgramInfoLog(f));window.console.log('Could not initialise shaders')}return f};K.PixiShader=function(a){this._UID=Phaser._UID++;this.gl=a;this.program=null;this.fragmentSrc=null;this.textureCount=0;this.firstRun=true;this.dirty=true;this.attributes=[];this.init()};K.PixiShader.prototype.constructor=K.PixiShader;K.PixiShader.prototype.initMultitexShader=function(){var a=this.gl;this.MAX_TEXTURES=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);var b='\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n';for(var c=1;c<this.MAX_TEXTURES;++c){b+='\tif (vTextureIndex == '+c+'.0) {gl_FragColor = texture2D(uSamplerArray['+c+'], vTextureCoord) * vColor;return;}\n'}this.fragmentSrc=['// PixiShader Fragment Shader.','precision lowp float;','bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }','varying vec2 vTextureCoord;','varying vec4 vColor;','varying float vTextureIndex;','uniform sampler2D uSamplerArray['+this.MAX_TEXTURES+'];','const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);','const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);','void main(void) {',b,'   if(vTextureIndex >= '+this.MAX_TEXTURES+'.0) { gl_FragColor = BLUE;return;}','   if(isnan(vTextureIndex)) { gl_FragColor = RED;return;}','}'];var d=K.compileProgram(a,this.vertexSrc||K.PixiShader.defaultVertexSrc,this.fragmentSrc);a.useProgram(d);this.uSamplerArray=a.getUniformLocation(d,'uSamplerArray[0]');this.projectionVector=a.getUniformLocation(d,'projectionVector');this.offsetVector=a.getUniformLocation(d,'offsetVector');this.dimensions=a.getUniformLocation(d,'dimensions');this.aVertexPosition=a.getAttribLocation(d,'aVertexPosition');this.aTextureCoord=a.getAttribLocation(d,'aTextureCoord');this.colorAttribute=a.getAttribLocation(d,'aColor');this.aTextureIndex=a.getAttribLocation(d,'aTextureIndex');var e=[];var f=a.createTexture();a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,f);a.texImage2D(a.TEXTURE_2D,0,a.RGB,1,1,0,a.RGB,a.UNSIGNED_BYTE,null);for(var i=0;i<this.MAX_TEXTURES;++i){a.activeTexture(a.TEXTURE0+i);a.bindTexture(a.TEXTURE_2D,f);e.push(i)}a.activeTexture(a.TEXTURE0);a.uniform1iv(this.uSamplerArray,e);if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aTextureIndex];for(var g in this.uniforms){this.uniforms[g].uniformLocation=a.getUniformLocation(d,g)}this.initUniforms();this.program=d};K.PixiShader.prototype.initDefaultShader=function(){if(this.fragmentSrc===null){this.fragmentSrc=['precision lowp float;','varying vec2 vTextureCoord;','varying vec4 vColor;','varying float vTextureIndex;','uniform sampler2D uSampler;','void main(void) {','   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;','}']}var a=this.gl;var b=K.compileProgram(a,this.vertexSrc||K.PixiShader.defaultVertexSrc,this.fragmentSrc);a.useProgram(b);this.uSampler=a.getUniformLocation(b,'uSampler');this.projectionVector=a.getUniformLocation(b,'projectionVector');this.offsetVector=a.getUniformLocation(b,'offsetVector');this.dimensions=a.getUniformLocation(b,'dimensions');this.aVertexPosition=a.getAttribLocation(b,'aVertexPosition');this.aTextureCoord=a.getAttribLocation(b,'aTextureCoord');this.colorAttribute=a.getAttribLocation(b,'aColor');this.aTextureIndex=a.getAttribLocation(b,'aTextureIndex');if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aTextureIndex];for(var c in this.uniforms){this.uniforms[c].uniformLocation=a.getUniformLocation(b,c)}this.initUniforms();this.program=b};K.PixiShader.prototype.init=function(a){if(K._enableMultiTextureToggle&&!a){this.initMultitexShader()}else{this.initDefaultShader()}};K.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var a=this.gl;var b;for(var c in this.uniforms){b=this.uniforms[c];var d=b.type;if(d==='sampler2D'){b._init=false;if(b.value!==null){this.initSampler2D(b)}}else if(d==='mat2'||d==='mat3'||d==='mat4'){b.glMatrix=true;b.glValueLength=1;if(d==='mat2'){b.glFunc=a.uniformMatrix2fv}else if(d==='mat3'){b.glFunc=a.uniformMatrix3fv}else if(d==='mat4'){b.glFunc=a.uniformMatrix4fv}}else{b.glFunc=a['uniform'+d];if(d==='2f'||d==='2i'){b.glValueLength=2}else if(d==='3f'||d==='3i'){b.glValueLength=3}else if(d==='4f'||d==='4i'){b.glValueLength=4}else{b.glValueLength=1}}}};K.PixiShader.prototype.initSampler2D=function(a){if(!a.value||!a.value.baseTexture||!a.value.baseTexture.hasLoaded){return}var b=this.gl;b.activeTexture(b.TEXTURE0+this.textureCount);b.bindTexture(b.TEXTURE_2D,a.value.baseTexture._glTextures[b.id]);if(a.textureData){var c=a.textureData;var d=(c.magFilter)?c.magFilter:b.LINEAR;var e=(c.minFilter)?c.minFilter:b.LINEAR;var f=(c.wrapS)?c.wrapS:b.CLAMP_TO_EDGE;var g=(c.wrapT)?c.wrapT:b.CLAMP_TO_EDGE;var h=(c.luminance)?b.LUMINANCE:b.RGBA;if(c.repeat){f=b.REPEAT;g=b.REPEAT}b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!!c.flipY);if(c.width){var i=(c.width)?c.width:512;var j=(c.height)?c.height:2;var k=(c.border)?c.border:0;b.texImage2D(b.TEXTURE_2D,0,h,i,j,k,h,b.UNSIGNED_BYTE,null)}else{b.texImage2D(b.TEXTURE_2D,0,h,b.RGBA,b.UNSIGNED_BYTE,a.value.baseTexture.source)}b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,d);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,e);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,f);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,g)}b.uniform1i(a.uniformLocation,this.textureCount);a._init=true;this.textureCount++};K.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var a;var b=this.gl;for(var c in this.uniforms){a=this.uniforms[c];if(a.glValueLength===1){if(a.glMatrix===true){a.glFunc.call(b,a.uniformLocation,a.transpose,a.value)}else{a.glFunc.call(b,a.uniformLocation,a.value)}}else if(a.glValueLength===2){a.glFunc.call(b,a.uniformLocation,a.value.x,a.value.y)}else if(a.glValueLength===3){a.glFunc.call(b,a.uniformLocation,a.value.x,a.value.y,a.value.z)}else if(a.glValueLength===4){a.glFunc.call(b,a.uniformLocation,a.value.x,a.value.y,a.value.z,a.value.w)}else if(a.type==='sampler2D'){if(a._init){b.activeTexture(b['TEXTURE'+this.textureCount]);if(a.value.baseTexture._dirty[b.id]){K.instances[b.id].updateTexture(a.value.baseTexture)}else{b.bindTexture(b.TEXTURE_2D,a.value.baseTexture._glTextures[b.id])}b.uniform1i(a.uniformLocation,this.textureCount);this.textureCount++}else{this.initSampler2D(a)}}}};K.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};K.PixiShader.defaultVertexSrc=['// PixiShader Vertex Shader','// With multi-texture rendering','attribute vec2 aVertexPosition;','attribute vec2 aTextureCoord;','attribute vec4 aColor;','attribute float aTextureIndex;','uniform vec2 projectionVector;','uniform vec2 offsetVector;','varying vec2 vTextureCoord;','varying vec4 vColor;','varying float vTextureIndex;','const vec2 center = vec2(-1.0, 1.0);','void main(void) {','   if (aTextureIndex > 0.0) gl_Position = vec4(0.0);','   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);','   vTextureCoord = aTextureCoord;','   vColor = vec4(aColor.rgb * aColor.a, aColor.a);','   vTextureIndex = aTextureIndex;','}'];K.PixiFastShader=function(a){this._UID=Phaser._UID++;this.gl=a;this.program=null;if(K._enableMultiTextureToggle){var a=this.gl;this.MAX_TEXTURES=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);var b='\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n';for(var c=1;c<this.MAX_TEXTURES;++c){b+='\tif (vTextureIndex == '+c+'.0) { gl_FragColor = texture2D(uSamplerArray['+c+'], vTextureCoord) * vColor;return;}\n'}this.fragmentSrc=['// PixiFastShader Fragment Shader.','precision lowp float;','bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }','varying vec2 vTextureCoord;','varying float vColor;','varying float vTextureIndex;','uniform sampler2D uSamplerArray['+this.MAX_TEXTURES+'];','const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);','const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);','void main(void) {',b,'   if(vTextureIndex >= '+this.MAX_TEXTURES+'.0) { gl_FragColor = BLUE;return;}','   if(isnan(vTextureIndex)) {gl_FragColor = RED;return;}','}']}else{this.fragmentSrc=['// PixiFastShader Fragment Shader.','precision lowp float;','varying vec2 vTextureCoord;','varying float vColor;','varying float vTextureIndex;','uniform sampler2D uSampler;','void main(void) {','   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;','}']}this.vertexSrc=['// PixiFastShader Vertex Shader.','attribute vec2 aVertexPosition;','attribute vec2 aPositionCoord;','attribute vec2 aScale;','attribute float aRotation;','attribute vec2 aTextureCoord;','attribute float aColor;','attribute float aTextureIndex;','uniform vec2 projectionVector;','uniform vec2 offsetVector;','uniform mat3 uMatrix;','varying vec2 vTextureCoord;','varying float vColor;','varying float vTextureIndex;','const vec2 center = vec2(-1.0, 1.0);','void main(void) {','   vec2 v;','   vec2 sv = aVertexPosition * aScale;','   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);','   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);','   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;','   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);','   vTextureCoord = aTextureCoord;','   vTextureIndex = aTextureIndex;','   vColor = aColor;','}'];this.textureCount=0;this.init()};K.PixiFastShader.prototype.constructor=K.PixiFastShader;K.PixiFastShader.prototype.init=function(){var a=this.gl;var b=K.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b);this.uSampler=K._enableMultiTextureToggle?a.getUniformLocation(b,'uSamplerArray[0]'):a.getUniformLocation(b,'uSampler');if(K._enableMultiTextureToggle){var c=[];var d=a.createTexture();a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,d);a.texImage2D(a.TEXTURE_2D,0,a.RGB,1,1,0,a.RGB,a.UNSIGNED_BYTE,null);for(var i=0;i<this.MAX_TEXTURES;++i){a.activeTexture(a.TEXTURE0+i);a.bindTexture(a.TEXTURE_2D,d);c.push(i)}a.activeTexture(a.TEXTURE0);a.uniform1iv(this.uSampler,c)}this.projectionVector=a.getUniformLocation(b,'projectionVector');this.offsetVector=a.getUniformLocation(b,'offsetVector');this.dimensions=a.getUniformLocation(b,'dimensions');this.uMatrix=a.getUniformLocation(b,'uMatrix');this.aVertexPosition=a.getAttribLocation(b,'aVertexPosition');this.aPositionCoord=a.getAttribLocation(b,'aPositionCoord');this.aScale=a.getAttribLocation(b,'aScale');this.aRotation=a.getAttribLocation(b,'aRotation');this.aTextureCoord=a.getAttribLocation(b,'aTextureCoord');this.colorAttribute=a.getAttribLocation(b,'aColor');this.aTextureIndex=a.getAttribLocation(b,'aTextureIndex');if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute,this.aTextureIndex];this.program=b};K.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};K.StripShader=function(a){this._UID=Phaser._UID++;this.gl=a;this.program=null;if(K._enableMultiTextureToggle){var a=this.gl;this.MAX_TEXTURES=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);var b='\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord);return;}\n';for(var c=1;c<this.MAX_TEXTURES;++c){b+='\tif (vTextureIndex == '+c+'.0) { gl_FragColor = texture2D(uSamplerArray['+c+'], vTextureCoord) ;return;}\n'}this.fragmentSrc=['//StripShader Fragment Shader.','precision mediump float;','bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }','varying vec2 vTextureCoord;','varying float vTextureIndex;','uniform float alpha;','uniform sampler2D uSamplerArray['+this.MAX_TEXTURES+'];','const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);','const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);','void main(void) {',b,'   if(vTextureIndex >= '+this.MAX_TEXTURES+'.0) { gl_FragColor = BLUE;return;}','   if(isnan(vTextureIndex)) {gl_FragColor = RED;return;}','}']}else{this.fragmentSrc=['//StripShader Fragment Shader.','precision mediump float;','varying vec2 vTextureCoord;','varying float vTextureIndex;','uniform float alpha;','uniform sampler2D uSampler;','void main(void) {','   gl_FragColor = texture2D(uSampler, vTextureCoord);','}']}this.vertexSrc=['//StripShader Vertex Shader.','attribute vec2 aVertexPosition;','attribute vec2 aTextureCoord;','attribute float aTextureIndex;','uniform mat3 translationMatrix;','uniform vec2 projectionVector;','uniform vec2 offsetVector;','varying vec2 vTextureCoord;','varying float vTextureIndex;','void main(void) {','   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);','   v -= offsetVector.xyx;','   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);','   vTextureCoord = aTextureCoord;','   vTextureIndex = aTextureIndex;','}'];this.init()};K.StripShader.prototype.constructor=K.StripShader;K.StripShader.prototype.init=function(){var a=this.gl;var b=K.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b);this.uSampler=K._enableMultiTextureToggle?a.getUniformLocation(b,'uSamplerArray[0]'):a.getUniformLocation(b,'uSampler');if(K._enableMultiTextureToggle){var c=[];var d=a.createTexture();a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,d);a.texImage2D(a.TEXTURE_2D,0,a.RGB,1,1,0,a.RGB,a.UNSIGNED_BYTE,null);for(var i=0;i<this.MAX_TEXTURES;++i){a.activeTexture(a.TEXTURE0+i);a.bindTexture(a.TEXTURE_2D,d);c.push(i)}a.activeTexture(a.TEXTURE0);a.uniform1iv(this.uSampler,c)}this.projectionVector=a.getUniformLocation(b,'projectionVector');this.offsetVector=a.getUniformLocation(b,'offsetVector');this.colorAttribute=a.getAttribLocation(b,'aColor');this.aTextureIndex=a.getAttribLocation(b,'aTextureIndex');this.aVertexPosition=a.getAttribLocation(b,'aVertexPosition');this.aTextureCoord=a.getAttribLocation(b,'aTextureCoord');this.attributes=[this.aVertexPosition,this.aTextureCoord,this.aTextureIndex];this.translationMatrix=a.getUniformLocation(b,'translationMatrix');this.alpha=a.getUniformLocation(b,'alpha');this.program=b};K.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};K.PrimitiveShader=function(a){this._UID=Phaser._UID++;this.gl=a;this.program=null;this.fragmentSrc=['precision mediump float;','varying vec4 vColor;','void main(void) {','   gl_FragColor = vColor;','}'];this.vertexSrc=['attribute vec2 aVertexPosition;','attribute vec4 aColor;','uniform mat3 translationMatrix;','uniform vec2 projectionVector;','uniform vec2 offsetVector;','uniform float alpha;','uniform float flipY;','uniform vec3 tint;','varying vec4 vColor;','void main(void) {','   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);','   v -= offsetVector.xyx;','   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);','   vColor = aColor * vec4(tint * alpha, alpha);','}'];this.init()};K.PrimitiveShader.prototype.constructor=K.PrimitiveShader;K.PrimitiveShader.prototype.init=function(){var a=this.gl;var b=K.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b);this.projectionVector=a.getUniformLocation(b,'projectionVector');this.offsetVector=a.getUniformLocation(b,'offsetVector');this.tintColor=a.getUniformLocation(b,'tint');this.flipY=a.getUniformLocation(b,'flipY');this.aVertexPosition=a.getAttribLocation(b,'aVertexPosition');this.colorAttribute=a.getAttribLocation(b,'aColor');this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=a.getUniformLocation(b,'translationMatrix');this.alpha=a.getUniformLocation(b,'alpha');this.program=b};K.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};K.ComplexPrimitiveShader=function(a){this._UID=Phaser._UID++;this.gl=a;this.program=null;this.fragmentSrc=['precision mediump float;','varying vec4 vColor;','void main(void) {','   gl_FragColor = vColor;','}'];this.vertexSrc=['attribute vec2 aVertexPosition;','uniform mat3 translationMatrix;','uniform vec2 projectionVector;','uniform vec2 offsetVector;','uniform vec3 tint;','uniform float alpha;','uniform vec3 color;','uniform float flipY;','varying vec4 vColor;','void main(void) {','   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);','   v -= offsetVector.xyx;','   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);','   vColor = vec4(color * alpha * tint, alpha);','}'];this.init()};K.ComplexPrimitiveShader.prototype.constructor=K.ComplexPrimitiveShader;K.ComplexPrimitiveShader.prototype.init=function(){var a=this.gl;var b=K.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b);this.projectionVector=a.getUniformLocation(b,'projectionVector');this.offsetVector=a.getUniformLocation(b,'offsetVector');this.tintColor=a.getUniformLocation(b,'tint');this.color=a.getUniformLocation(b,'color');this.flipY=a.getUniformLocation(b,'flipY');this.aVertexPosition=a.getAttribLocation(b,'aVertexPosition');this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=a.getUniformLocation(b,'translationMatrix');this.alpha=a.getUniformLocation(b,'alpha');this.program=b};K.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};K.glContexts=[];K.instances=[];K._enableMultiTextureToggle=false;K.WebGLRenderer=function(a,b){this.game=a;if(!K.defaultRenderer){K.defaultRenderer=this}this.extensions={};this.type=Phaser.WEBGL;this.resolution=a.resolution;this.transparent=a.transparent;this.autoResize=false;this.preserveDrawingBuffer=a.preserveDrawingBuffer;this.clearBeforeRender=a.clearBeforeRender;this.powerPreference=a.powerPreference;this.width=a.width;this.height=a.height;this.view=a.canvas;this._contextOptions={alpha:this.transparent,antialias:a.antialias,failIfMajorPerformanceCaveat:b.failIfMajorPerformanceCaveat,premultipliedAlpha:this.transparent&&this.transparent!=='notMultiplied',stencil:true,preserveDrawingBuffer:this.preserveDrawingBuffer,powerPreference:a.powerPreference};this.projection=new K.Point();this.offset=new K.Point();this.shaderManager=new K.WebGLShaderManager();this.spriteBatch=new K.WebGLSpriteBatch(a);this.maskManager=new K.WebGLMaskManager();this.filterManager=new K.WebGLFilterManager();this.stencilManager=new K.WebGLStencilManager();this.blendModeManager=new K.WebGLBlendModeManager();this.renderSession={};this.currentBatchedTextures=[];this.renderSession.game=this.game;this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.renderSession.roundPixels=b.roundPixels||false;this.renderSession.maxTextureAvailableSpace=null;this.initContext();this.mapBlendModes()};K.WebGLRenderer.prototype.constructor=K.WebGLRenderer;K.WebGLRenderer.prototype.initContext=function(){var a=this.view.getContext('webgl',this._contextOptions)||this.view.getContext('experimental-webgl',this._contextOptions);this.gl=a;if(!a){throw new Error('This browser does not support webGL. Try using the canvas renderer');}this.maxTextures=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);this.maxTextureSize=this.gl.getParameter(a.MAX_TEXTURE_SIZE);this.glContextId=a.id=K.WebGLRenderer.glContextId++;K.glContexts[this.glContextId]=a;K.instances[this.glContextId]=this;a.disable(a.DEPTH_TEST);a.disable(a.CULL_FACE);a.enable(a.BLEND);this.shaderManager.setContext(a);this.spriteBatch.setContext(a);this.maskManager.setContext(a);this.filterManager.setContext(a);this.blendModeManager.setContext(a);this.stencilManager.setContext(a);this.renderSession.gl=this.gl;this.resize(this.width,this.height);this.extensions.compression={};var b=a.getExtension('WEBGL_compressed_texture_etc1')||a.getExtension('WEBKIT_WEBGL_compressed_texture_etc1');var c=a.getExtension('WEBGL_compressed_texture_pvrtc')||a.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc');var d=a.getExtension('WEBGL_compressed_texture_s3tc')||a.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc');if(b){this.extensions.compression.ETC1=b}if(c){this.extensions.compression.PVRTC=c}if(d){this.extensions.compression.S3TC=d}};K.WebGLRenderer.prototype.setTexturePriority=function(b){if(!K._enableMultiTextureToggle){console.warn('setTexturePriority error: Multi Texture support hasn\'t been enabled in the Phaser Game Config.');return}var c=function(a){--a;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;return++a};var d=this.gl;var e=d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS);var f=d.getParameter(d.MAX_TEXTURE_SIZE);var g=this.game.cache._cache.image;var h=null;for(var i=0;i<this.currentBatchedTextures.length;i++){h=this.currentBatchedTextures[i];if(!(h in g)){console.warn('setTexturePriority: There is no image "%s" in the image cache.',h);continue}g[h].base.textureIndex=0}var k=(f)-c(Math.max(this.width,this.height));this.currentBatchedTextures.length=0;for(var j=0;j<b.length;++j){h=b[j];if(!(h in g)){console.warn('setTexturePriority: There is no image "%s" in the image cache.',h);continue}var l=g[h].base;k-=c(Math.max(l.width,l.height));if(k<=0){l.textureIndex=0;console.warn('setTexturePriority: Image "%s" was given textureIndex=0 because there is no available texture space (%s).',h,k)}else{l.textureIndex=(1+(j%(e-1)))}this.currentBatchedTextures.push(h)}this.renderSession.maxTextureAvailableSpace=k;return this.currentBatchedTextures};K.WebGLRenderer.prototype.render=function(a){if(this.contextLost){return}var b=this.gl;b.viewport(0,0,this.width,this.height);b.bindFramebuffer(b.FRAMEBUFFER,null);if(this.game.clearBeforeRender){b.clearColor(a._bgColor.r,a._bgColor.g,a._bgColor.b,a._bgColor.a);b.clear(b.COLOR_BUFFER_BIT)}this.offset.x=this.game.camera._shake.x;this.offset.y=this.game.camera._shake.y;this.renderDisplayObject(a,this.projection)};K.WebGLRenderer.prototype.postRender=function(){this.gl.flush()};K.WebGLRenderer.prototype.renderDisplayObject=function(a,b,c,d){this.renderSession.blendModeManager.setBlendMode(K.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flipY=c?-1:1;this.renderSession.projection=b;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,c);a._renderWebGL(this.renderSession,d);this.spriteBatch.end()};K.WebGLRenderer.prototype.resize=function(a,b){this.width=a*this.resolution;this.height=b*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+'px';this.view.style.height=this.height/this.resolution+'px'}this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=-this.height/2/this.resolution};K.WebGLRenderer.prototype.updateCompressedTexture=function(a){if(!a.hasLoaded){return false}var b=this.gl;var c=a.source;if(!a._glTextures[b.id]){a._glTextures[b.id]=b.createTexture()}b.activeTexture(b.TEXTURE0+a.textureIndex);b.bindTexture(b.TEXTURE_2D,a._glTextures[b.id]);b.compressedTexImage2D(b.TEXTURE_2D,0,c.glExtensionFormat,c.width,c.height,0,c.textureData);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a.scaleMode===K.scaleModes.LINEAR?b.LINEAR:b.NEAREST);if(a.mipmap&&Phaser.Math.isPowerOfTwo(a.width,a.height)){b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a.scaleMode===K.scaleModes.LINEAR?b.LINEAR_MIPMAP_LINEAR:b.NEAREST_MIPMAP_NEAREST);b.generateMipmap(b.TEXTURE_2D)}else{b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a.scaleMode===K.scaleModes.LINEAR?b.LINEAR:b.NEAREST)}if(!a._powerOf2){b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)}else{b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT)}a._dirty[b.id]=false;return true};K.WebGLRenderer.prototype.updateTexture=function(a){if(!a.hasLoaded||!a.source){return false}if(a.source.compressionAlgorithm){return this.updateCompressedTexture(a)}var b=this.gl;if(!a._glTextures[b.id]){a._glTextures[b.id]=b.createTexture()}b.activeTexture(b.TEXTURE0+a.textureIndex);b.bindTexture(b.TEXTURE_2D,a._glTextures[b.id]);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a.source);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a.scaleMode===K.scaleModes.LINEAR?b.LINEAR:b.NEAREST);if(a.mipmap&&Phaser.Math.isPowerOfTwo(a.width,a.height)){b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a.scaleMode===K.scaleModes.LINEAR?b.LINEAR_MIPMAP_LINEAR:b.NEAREST_MIPMAP_NEAREST);b.generateMipmap(b.TEXTURE_2D)}else{b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a.scaleMode===K.scaleModes.LINEAR?b.LINEAR:b.NEAREST)}if(!a._powerOf2){b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)}else{b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT)}a._dirty[b.id]=false;return true};K.WebGLRenderer.prototype.destroy=function(){K.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null;Phaser.CanvasPool.remove(this);K.instances[this.glContextId]=null;K.WebGLRenderer.glContextId--};K.WebGLRenderer.prototype.mapBlendModes=function(){var a=this.gl;if(!K.blendModesWebGL){var b=[];var c=K.blendModes;b[c.NORMAL]=[a.ONE,a.ONE_MINUS_SRC_ALPHA];b[c.ADD]=[a.SRC_ALPHA,a.DST_ALPHA];b[c.MULTIPLY]=[a.DST_COLOR,a.ONE_MINUS_SRC_ALPHA];b[c.SCREEN]=[a.SRC_ALPHA,a.ONE];b[c.OVERLAY]=[a.ONE,a.ONE_MINUS_SRC_ALPHA];b[c.DARKEN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA];b[c.LIGHTEN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA];b[c.COLOR_DODGE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA];b[c.COLOR_BURN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA];b[c.HARD_LIGHT]=[a.ONE,a.ONE_MINUS_SRC_ALPHA];b[c.SOFT_LIGHT]=[a.ONE,a.ONE_MINUS_SRC_ALPHA];b[c.DIFFERENCE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA];b[c.EXCLUSION]=[a.ONE,a.ONE_MINUS_SRC_ALPHA];b[c.HUE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA];b[c.SATURATION]=[a.ONE,a.ONE_MINUS_SRC_ALPHA];b[c.COLOR]=[a.ONE,a.ONE_MINUS_SRC_ALPHA];b[c.LUMINOSITY]=[a.ONE,a.ONE_MINUS_SRC_ALPHA];K.blendModesWebGL=b}};K.WebGLRenderer.prototype.getMaxTextureUnit=function(){var a=this.gl;return a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS)};K.enableMultiTexture=function(){K._enableMultiTextureToggle=true};K.WebGLRenderer.glContextId=0;K.WebGLRenderer.textureArray=[];K.WebGLBlendModeManager=function(){this.currentBlendMode=99999};K.WebGLBlendModeManager.prototype.constructor=K.WebGLBlendModeManager;K.WebGLBlendModeManager.prototype.setContext=function(a){this.gl=a};K.WebGLBlendModeManager.prototype.setBlendMode=function(a){if(this.currentBlendMode===a){return false}this.currentBlendMode=a;var b=K.blendModesWebGL[this.currentBlendMode];if(b){this.gl.blendFunc(b[0],b[1])}return true};K.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};K.WebGLMaskManager=function(){};K.WebGLMaskManager.prototype.constructor=K.WebGLMaskManager;K.WebGLMaskManager.prototype.setContext=function(a){this.gl=a};K.WebGLMaskManager.prototype.pushMask=function(a,b){var c=b.gl;if(a.dirty){K.WebGLGraphics.updateGraphics(a,c)}if(a._webGL[c.id]===undefined||a._webGL[c.id].data===undefined||a._webGL[c.id].data.length===0){return}b.stencilManager.pushStencil(a,a._webGL[c.id].data[0],b)};K.WebGLMaskManager.prototype.popMask=function(a,b){var c=this.gl;if(a._webGL[c.id]===undefined||a._webGL[c.id].data===undefined||a._webGL[c.id].data.length===0){return}b.stencilManager.popStencil(a,a._webGL[c.id].data[0],b)};K.WebGLMaskManager.prototype.destroy=function(){this.gl=null};K.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=true;this.count=0};K.WebGLStencilManager.prototype.setContext=function(a){this.gl=a};K.WebGLStencilManager.prototype.pushStencil=function(a,b,c){var d=this.gl;this.bindGraphics(a,b,c);if(this.stencilStack.length===0){d.enable(d.STENCIL_TEST);d.clear(d.STENCIL_BUFFER_BIT);this.reverse=true;this.count=0}this.stencilStack.push(b);var e=this.count;d.colorMask(false,false,false,false);d.stencilFunc(d.ALWAYS,0,0xFF);d.stencilOp(d.KEEP,d.KEEP,d.INVERT);if(b.mode===1){d.drawElements(d.TRIANGLE_FAN,b.indices.length-4,d.UNSIGNED_SHORT,0);if(this.reverse){d.stencilFunc(d.EQUAL,0xFF-e,0xFF);d.stencilOp(d.KEEP,d.KEEP,d.DECR)}else{d.stencilFunc(d.EQUAL,e,0xFF);d.stencilOp(d.KEEP,d.KEEP,d.INCR)}d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,(b.indices.length-4)*2);if(this.reverse){d.stencilFunc(d.EQUAL,0xFF-(e+1),0xFF)}else{d.stencilFunc(d.EQUAL,e+1,0xFF)}this.reverse=!this.reverse}else{if(!this.reverse){d.stencilFunc(d.EQUAL,0xFF-e,0xFF);d.stencilOp(d.KEEP,d.KEEP,d.DECR)}else{d.stencilFunc(d.EQUAL,e,0xFF);d.stencilOp(d.KEEP,d.KEEP,d.INCR)}d.drawElements(d.TRIANGLE_STRIP,b.indices.length,d.UNSIGNED_SHORT,0);if(!this.reverse){d.stencilFunc(d.EQUAL,0xFF-(e+1),0xFF)}else{d.stencilFunc(d.EQUAL,e+1,0xFF)}}d.colorMask(true,true,true,true);d.stencilOp(d.KEEP,d.KEEP,d.KEEP);this.count++};K.WebGLStencilManager.prototype.bindGraphics=function(a,b,c){this._currentGraphics=a;var d=this.gl;var e=c.projection,offset=c.offset,shader;if(b.mode===1){shader=c.shaderManager.complexPrimitiveShader;c.shaderManager.setShader(shader);d.uniform1f(shader.flipY,c.flipY);d.uniformMatrix3fv(shader.translationMatrix,false,a.worldTransform.toArray(true));d.uniform2f(shader.projectionVector,e.x,-e.y);d.uniform2f(shader.offsetVector,-offset.x,-offset.y);d.uniform3fv(shader.tintColor,Phaser.Color.hexToRGBArray(a.tint));d.uniform3fv(shader.color,b.color);d.uniform1f(shader.alpha,a.worldAlpha*b.alpha);d.bindBuffer(d.ARRAY_BUFFER,b.buffer);d.vertexAttribPointer(shader.aVertexPosition,2,d.FLOAT,false,4*2,0);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,b.indexBuffer)}else{shader=c.shaderManager.primitiveShader;c.shaderManager.setShader(shader);d.uniformMatrix3fv(shader.translationMatrix,false,a.worldTransform.toArray(true));d.uniform1f(shader.flipY,c.flipY);d.uniform2f(shader.projectionVector,e.x,-e.y);d.uniform2f(shader.offsetVector,-offset.x,-offset.y);d.uniform3fv(shader.tintColor,Phaser.Color.hexToRGBArray(a.tint));d.uniform1f(shader.alpha,a.worldAlpha);d.bindBuffer(d.ARRAY_BUFFER,b.buffer);d.vertexAttribPointer(shader.aVertexPosition,2,d.FLOAT,false,4*6,0);d.vertexAttribPointer(shader.colorAttribute,4,d.FLOAT,false,4*6,2*4);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,b.indexBuffer)}};K.WebGLStencilManager.prototype.popStencil=function(a,b,c){var d=this.gl;this.stencilStack.pop();this.count--;if(this.stencilStack.length===0){d.disable(d.STENCIL_TEST)}else{var e=this.count;this.bindGraphics(a,b,c);d.colorMask(false,false,false,false);if(b.mode===1){this.reverse=!this.reverse;if(this.reverse){d.stencilFunc(d.EQUAL,0xFF-(e+1),0xFF);d.stencilOp(d.KEEP,d.KEEP,d.INCR)}else{d.stencilFunc(d.EQUAL,e+1,0xFF);d.stencilOp(d.KEEP,d.KEEP,d.DECR)}d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,(b.indices.length-4)*2);d.stencilFunc(d.ALWAYS,0,0xFF);d.stencilOp(d.KEEP,d.KEEP,d.INVERT);d.drawElements(d.TRIANGLE_FAN,b.indices.length-4,d.UNSIGNED_SHORT,0);if(!this.reverse){d.stencilFunc(d.EQUAL,0xFF-(e),0xFF)}else{d.stencilFunc(d.EQUAL,e,0xFF)}}else{if(!this.reverse){d.stencilFunc(d.EQUAL,0xFF-(e+1),0xFF);d.stencilOp(d.KEEP,d.KEEP,d.INCR)}else{d.stencilFunc(d.EQUAL,e+1,0xFF);d.stencilOp(d.KEEP,d.KEEP,d.DECR)}d.drawElements(d.TRIANGLE_STRIP,b.indices.length,d.UNSIGNED_SHORT,0);if(!this.reverse){d.stencilFunc(d.EQUAL,0xFF-(e),0xFF)}else{d.stencilFunc(d.EQUAL,e,0xFF)}}d.colorMask(true,true,true,true);d.stencilOp(d.KEEP,d.KEEP,d.KEEP)}};K.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null;this.gl=null};K.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var i=0;i<this.maxAttibs;i++){this.attribState[i]=false}this.stack=[]};K.WebGLShaderManager.prototype.constructor=K.WebGLShaderManager;K.WebGLShaderManager.prototype.setContext=function(a){this.gl=a;this.primitiveShader=new K.PrimitiveShader(a);this.complexPrimitiveShader=new K.ComplexPrimitiveShader(a);this.defaultShader=new K.PixiShader(a);this.fastShader=new K.PixiFastShader(a);this.stripShader=new K.StripShader(a);this.creatureShader=K.CreatureShader?new K.CreatureShader(a):null;this.setShader(this.defaultShader)};K.WebGLShaderManager.prototype.setAttribs=function(a){var i;for(i=0;i<this.tempAttribState.length;i++){this.tempAttribState[i]=false}for(i=0;i<a.length;i++){var b=a[i];this.tempAttribState[b]=true}var c=this.gl;for(i=0;i<this.attribState.length;i++){if(this.attribState[i]!==this.tempAttribState[i]){this.attribState[i]=this.tempAttribState[i];if(this.tempAttribState[i]){c.enableVertexAttribArray(i)}else{c.disableVertexAttribArray(i)}}}};K.WebGLShaderManager.prototype.setShader=function(a){if(this._currentId===a._UID){return false}this._currentId=a._UID;this.currentShader=a;this.gl.useProgram(a.program);this.setAttribs(a.attributes);return true};K.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();if(this.creatureShader){this.creatureShader.destroy()}this.gl=null};K.WebGLSpriteBatch=function(a){this.game=a;this.vertSize=5;this.size=2000;this.vertexSize=(4*2)+(4*2)+(4)+(4);var b=this.vertexSize*this.size*4;var c=this.size*6;this.vertices=new ArrayBuffer(b);this.positions=new Float32Array(this.vertices);this.colors=new Uint32Array(this.vertices);this.indices=new Uint16Array(c);this.lastIndexCount=0;for(var i=0,j=0;i<c;i+=6,j+=4){this.indices[i+0]=j+0;this.indices[i+1]=j+1;this.indices[i+2]=j+2;this.indices[i+3]=j+0;this.indices[i+4]=j+2;this.indices[i+5]=j+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=true;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=null};K.WebGLSpriteBatch.prototype.setContext=function(a){this.MAX_TEXTURES=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);this.gl=a;if(K._enableMultiTextureToggle){var b='\tif (vTextureIndex == 0.0) {gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n';for(var c=1;c<this.MAX_TEXTURES;++c){b+='\tif (vTextureIndex == '+c+'.0) {gl_FragColor = texture2D(uSamplerArray['+c+'], vTextureCoord) * vColor;return;}\n'}this.defaultShader=new Phaser.Filter(this.game,undefined,['//WebGLSpriteBatch Fragment Shader.','precision lowp float;','varying vec2 vTextureCoord;','varying vec4 vColor;','varying float vTextureIndex;','uniform sampler2D uSamplerArray['+this.MAX_TEXTURES+'];','void main(void) {',b,'\tgl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;','}'])}else{this.defaultShader=new Phaser.Filter(this.game,undefined,['//WebGLSpriteBatch Fragment Shader.','precision lowp float;','varying vec2 vTextureCoord;','varying vec4 vColor;','varying float vTextureIndex;','uniform sampler2D uSampler;','void main(void) {','   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;','}'])}this.vertexBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW);this.currentBlendMode=99999;var d=new K.PixiShader(a);d.fragmentSrc=this.defaultShader.fragmentSrc;d.uniforms={};d.init();this.defaultShader.shaders[a.id]=d};K.WebGLSpriteBatch.prototype.begin=function(a){this.renderSession=a;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};K.WebGLSpriteBatch.prototype.end=function(){this.flush()};K.WebGLSpriteBatch.prototype.render=function(e,f){var g=e.texture;if(K._enableMultiTextureToggle){var h=g.baseTexture;var j=this.gl;if(K.WebGLRenderer.textureArray[h.textureIndex]!=h){this.flush();j.activeTexture(j.TEXTURE0+h.textureIndex);j.bindTexture(j.TEXTURE_2D,h._glTextures[j.id]);K.WebGLRenderer.textureArray[h.textureIndex]=h}}var k=e.worldTransform;if(f){k=f}if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=g.baseTexture}var l=g._uvs;if(!l){return}var m=e.anchor.x;var n=e.anchor.y;var o,w1,h0,h1;if(g.trim){var p=g.trim;w1=p.x-m*p.width;o=w1+g.crop.width;h1=p.y-n*p.height;h0=h1+g.crop.height}else{o=(g.frame.width)*(1-m);w1=(g.frame.width)*-m;h0=g.frame.height*(1-n);h1=g.frame.height*-n}var i=this.currentBatchSize*this.vertexSize;var q=g.baseTexture.resolution;var r=g.baseTexture.textureIndex;var a=k.a/q;var b=k.b/q;var c=k.c/q;var d=k.d/q;var s=k.tx;var t=k.ty;var u=g.crop.height;if(g.rotated){var v=k.a;var w=k.b;var x=k.c;var y=k.d;var z=w1;var A=o;s=k.c*u+s;t=k.d*u+t;a=v*6.123233995736766e-17+ -x;b=w*6.123233995736766e-17+ -y;c=v+x*6.123233995736766e-17;d=w+y*6.123233995736766e-17;g._updateUvsInverted();o=h0;w1=h1;h0=A;h1=z}var B=this.colors;var C=this.positions;var D=e.tint;var E=(D>>16)+(D&0xff00)+((D&0xff)<<16)+(e.worldAlpha*255<<24);if(this.renderSession.roundPixels){C[i++]=a*w1+c*h1+s|0;C[i++]=d*h1+b*w1+t|0;C[i++]=l.x0;C[i++]=l.y0;B[i++]=E;C[i++]=r;C[i++]=a*o+c*h1+s|0;C[i++]=d*h1+b*o+t|0;C[i++]=l.x1;C[i++]=l.y1;B[i++]=E;C[i++]=r;C[i++]=a*o+c*h0+s|0;C[i++]=d*h0+b*o+t|0;C[i++]=l.x2;C[i++]=l.y2;B[i++]=E;C[i++]=r;C[i++]=a*w1+c*h0+s|0;C[i++]=d*h0+b*w1+t|0;C[i++]=l.x3;C[i++]=l.y3;B[i++]=E;C[i++]=r}else{C[i++]=a*w1+c*h1+s;C[i++]=d*h1+b*w1+t;C[i++]=l.x0;C[i++]=l.y0;B[i++]=E;C[i++]=r;C[i++]=a*o+c*h1+s;C[i++]=d*h1+b*o+t;C[i++]=l.x1;C[i++]=l.y1;B[i++]=E;C[i++]=r;C[i++]=a*o+c*h0+s;C[i++]=d*h0+b*o+t;C[i++]=l.x2;C[i++]=l.y2;B[i++]=E;C[i++]=r;C[i++]=a*w1+c*h0+s;C[i++]=d*h0+b*w1+t;C[i++]=l.x3;C[i++]=l.y3;B[i++]=E;C[i++]=r}this.sprites[this.currentBatchSize++]=e};K.WebGLSpriteBatch.prototype.renderTilingSprite=function(e){var f=e.tilingTexture;var g=e.texture.baseTexture.textureIndex;if(K._enableMultiTextureToggle){var j=f.baseTexture;var k=this.gl;if(K.WebGLRenderer.textureArray[g]!=j){this.flush();k.activeTexture(k.TEXTURE0+g);k.bindTexture(k.TEXTURE_2D,j._glTextures[k.id]);K.WebGLRenderer.textureArray[g]=j}}if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=f.baseTexture}if(!e._uvs){e._uvs=new K.TextureUvs()}var l=e._uvs;var w=f.baseTexture.width;var h=f.baseTexture.height;e.tilePosition.x%=w*e.tileScaleOffset.x;e.tilePosition.y%=h*e.tileScaleOffset.y;var m=e.tilePosition.x/(w*e.tileScaleOffset.x);var n=e.tilePosition.y/(h*e.tileScaleOffset.y);var o=(e.width/w)/(e.tileScale.x*e.tileScaleOffset.x);var p=(e.height/h)/(e.tileScale.y*e.tileScaleOffset.y);l.x0=0-m;l.y0=0-n;l.x1=(1*o)-m;l.y1=0-n;l.x2=(1*o)-m;l.y2=(1*p)-n;l.x3=0-m;l.y3=(1*p)-n;var q=e.tint;var r=(q>>16)+(q&0xff00)+((q&0xff)<<16)+(e.worldAlpha*255<<24);var s=this.positions;var t=this.colors;var u=e.width;var v=e.height;var x=e.anchor.x;var y=e.anchor.y;var z=u*(1-x);var A=u*-x;var B=v*(1-y);var C=v*-y;var i=this.currentBatchSize*this.vertexSize;var D=f.baseTexture.resolution;var E=e.worldTransform;var a=E.a/D;var b=E.b/D;var c=E.c/D;var d=E.d/D;var F=E.tx;var G=E.ty;s[i++]=a*A+c*C+F;s[i++]=d*C+b*A+G;s[i++]=l.x0;s[i++]=l.y0;t[i++]=r;s[i++]=g;s[i++]=(a*z+c*C+F);s[i++]=d*C+b*z+G;s[i++]=l.x1;s[i++]=l.y1;t[i++]=r;s[i++]=g;s[i++]=a*z+c*B+F;s[i++]=d*B+b*z+G;s[i++]=l.x2;s[i++]=l.y2;t[i++]=r;s[i++]=g;s[i++]=a*A+c*B+F;s[i++]=d*B+b*A+G;s[i++]=l.x3;s[i++]=l.y3;t[i++]=r;s[i++]=g;this.sprites[this.currentBatchSize++]=e};K.WebGLSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var a=this.gl;var b;if(this.dirty){this.dirty=false;b=this.defaultShader.shaders[a.id];a.activeTexture(a.TEXTURE0);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var c=this.vertexSize;a.vertexAttribPointer(b.aVertexPosition,2,a.FLOAT,false,c,0);a.vertexAttribPointer(b.aTextureCoord,2,a.FLOAT,false,c,8);a.vertexAttribPointer(b.colorAttribute,4,a.UNSIGNED_BYTE,true,c,16);a.vertexAttribPointer(b.aTextureIndex,1,a.FLOAT,false,c,20)}if(this.currentBatchSize>(this.size*0.5)){a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices)}else{a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);var d=this.positions.subarray(0,this.currentBatchSize*this.vertexSize);a.bufferSubData(a.ARRAY_BUFFER,0,d)}var e,nextBlendMode,nextShader;var f=0;var g=0;var h=null;var k=this.renderSession.blendModeManager.currentBlendMode;var l=null;var m=false;var n=false;var o;for(var i=0,j=this.currentBatchSize;i<j;i++){o=this.sprites[i];if(o.tilingTexture){e=o.tilingTexture.baseTexture}else{e=o.texture.baseTexture}nextBlendMode=o.blendMode;nextShader=o.shader||this.defaultShader;m=k!==nextBlendMode;n=l!==nextShader;var p=e.skipRender;if(p&&o.children.length>0){p=false}var q=K._enableMultiTextureToggle;var r=h!==e;if((!q&&r&&!p)||m||n){this.renderBatch(h,f,g);g=i;f=0;h=e;if(m){k=nextBlendMode;this.renderSession.blendModeManager.setBlendMode(k)}if(n){l=nextShader;b=l.shaders[a.id];if(!b){b=new K.PixiShader(a);b.fragmentSrc=l.fragmentSrc;b.uniforms=l.uniforms;b.init();l.shaders[a.id]=b}this.renderSession.shaderManager.setShader(b);if(b.dirty){b.syncUniforms()}var s=this.renderSession.projection;a.uniform2f(b.projectionVector,s.x,s.y);var t=this.renderSession.offset;a.uniform2f(b.offsetVector,t.x,t.y)}}f++}this.renderBatch(h,f,g);this.currentBatchSize=0};K.WebGLSpriteBatch.prototype.renderBatch=function(a,b,c){if(b===0){return}var d=this.gl;if(a._dirty[d.id]){if(!this.renderSession.renderer.updateTexture(a)){return}}else{d.bindTexture(d.TEXTURE_2D,a._glTextures[d.id])}d.drawElements(d.TRIANGLES,b*6,d.UNSIGNED_SHORT,c*6*2);this.renderSession.drawCount++};K.WebGLSpriteBatch.prototype.stop=function(){this.flush();this.dirty=true};K.WebGLSpriteBatch.prototype.start=function(){this.dirty=true};K.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};K.WebGLFastSpriteBatch=function(a){this.vertSize=11;this.maxSize=6000;this.size=this.maxSize;var b=this.size*4*this.vertSize;var c=this.maxSize*6;this.vertices=new Float32Array(b);this.indices=new Uint16Array(c);this.vertexBuffer=null;this.indexBuffer=null;this.lastIndexCount=0;for(var i=0,j=0;i<c;i+=6,j+=4){this.indices[i+0]=j+0;this.indices[i+1]=j+1;this.indices[i+2]=j+2;this.indices[i+3]=j+0;this.indices[i+4]=j+2;this.indices[i+5]=j+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(a)};K.WebGLFastSpriteBatch.prototype.constructor=K.WebGLFastSpriteBatch;K.WebGLFastSpriteBatch.prototype.setContext=function(a){this.gl=a;this.vertexBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW)};K.WebGLFastSpriteBatch.prototype.begin=function(a,b){this.renderSession=b;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=a.worldTransform.toArray(true);this.start()};K.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};K.WebGLFastSpriteBatch.prototype.render=function(a){var b=a.children;var c=b[0];if(!c.texture._uvs){return}this.currentBaseTexture=c.texture.baseTexture;if(c.blendMode!==this.renderSession.blendModeManager.currentBlendMode){this.flush();this.renderSession.blendModeManager.setBlendMode(c.blendMode)}var d=this.currentBaseTexture.textureIndex;var e=this.gl;e.activeTexture(e.TEXTURE0+d);e.bindTexture(e.TEXTURE_2D,this.currentBaseTexture._glTextures[e.id]);K.WebGLRenderer.textureArray[d]=this.currentBaseTexture;for(var i=0,j=b.length;i<j;i++){this.renderSprite(b[i])}this.flush()};K.WebGLFastSpriteBatch.prototype.renderSprite=function(a){var b=a.texture;var c=b.baseTexture;var d=this.gl;var e=a.texture.baseTexture.textureIndex;if(K.WebGLRenderer.textureArray[e]!=c&&c._glTextures[d.id]&&!a.texture.baseTexture.skipRender){this.flush();d.activeTexture(d.TEXTURE0+e);d.bindTexture(d.TEXTURE_2D,c._glTextures[d.id]);K.WebGLRenderer.textureArray[e]=c;if(!a.texture._uvs){return}}if(!a.visible){return}var f,vertices=this.vertices,width,height,w0,w1,h0,h1,index;f=a.texture._uvs;width=a.texture.frame.width;height=a.texture.frame.height;if(a.texture.trim){var g=a.texture.trim;w1=g.x-a.anchor.x*g.width;w0=w1+a.texture.crop.width;h1=g.y-a.anchor.y*g.height;h0=h1+a.texture.crop.height}else{w0=width*(1-a.anchor.x);w1=width*-a.anchor.x;h0=height*(1-a.anchor.y);h1=height*-a.anchor.y}index=this.currentBatchSize*4*this.vertSize;vertices[index++]=w1;vertices[index++]=h1;vertices[index++]=a.position.x;vertices[index++]=a.position.y;vertices[index++]=a.scale.x;vertices[index++]=a.scale.y;vertices[index++]=a.rotation;vertices[index++]=f.x0;vertices[index++]=f.y1;vertices[index++]=a.alpha;vertices[index++]=e;vertices[index++]=w0;vertices[index++]=h1;vertices[index++]=a.position.x;vertices[index++]=a.position.y;vertices[index++]=a.scale.x;vertices[index++]=a.scale.y;vertices[index++]=a.rotation;vertices[index++]=f.x1;vertices[index++]=f.y1;vertices[index++]=a.alpha;vertices[index++]=e;vertices[index++]=w0;vertices[index++]=h0;vertices[index++]=a.position.x;vertices[index++]=a.position.y;vertices[index++]=a.scale.x;vertices[index++]=a.scale.y;vertices[index++]=a.rotation;vertices[index++]=f.x2;vertices[index++]=f.y2;vertices[index++]=a.alpha;vertices[index++]=e;vertices[index++]=w1;vertices[index++]=h0;vertices[index++]=a.position.x;vertices[index++]=a.position.y;vertices[index++]=a.scale.x;vertices[index++]=a.scale.y;vertices[index++]=a.rotation;vertices[index++]=f.x3;vertices[index++]=f.y3;vertices[index++]=a.alpha;vertices[index++]=e;this.currentBatchSize++;if(this.currentBatchSize>=this.size){this.flush()}};K.WebGLFastSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var a=this.gl;if(!this.currentBaseTexture._glTextures[a.id]){this.renderSession.renderer.updateTexture(this.currentBaseTexture,a);return}if(this.currentBatchSize>(this.size*0.5)){a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices)}else{var b=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,b)}a.drawElements(a.TRIANGLES,this.currentBatchSize*6,a.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++};K.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};K.WebGLFastSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var b=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,b.x,b.y);a.uniformMatrix3fv(this.shader.uMatrix,false,this.matrix);var c=this.vertSize*4;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,false,c,0);a.vertexAttribPointer(this.shader.aPositionCoord,2,a.FLOAT,false,c,2*4);a.vertexAttribPointer(this.shader.aScale,2,a.FLOAT,false,c,4*4);a.vertexAttribPointer(this.shader.aRotation,1,a.FLOAT,false,c,6*4);a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,false,c,7*4);a.vertexAttribPointer(this.shader.colorAttribute,1,a.FLOAT,false,c,9*4);a.vertexAttribPointer(this.shader.aTextureIndex,1,a.FLOAT,false,c,10*4)};K.WebGLFilterManager=function(){this.filterStack=[];this.offsetX=0;this.offsetY=0};K.WebGLFilterManager.prototype.constructor=K.WebGLFilterManager;K.WebGLFilterManager.prototype.setContext=function(a){this.gl=a;this.texturePool=[];this.initShaderBuffers()};K.WebGLFilterManager.prototype.begin=function(a,b){this.renderSession=a;this.defaultShader=a.shaderManager.defaultShader;var c=this.renderSession.projection;this.width=c.x*2;this.height=-c.y*2;this.buffer=b};K.WebGLFilterManager.prototype.pushFilter=function(a){var b=this.gl;var c=this.renderSession.projection;var d=this.renderSession.offset;a._filterArea=a.target.filterArea||a.target.getBounds();a._previous_stencil_mgr=this.renderSession.stencilManager;this.renderSession.stencilManager=new K.WebGLStencilManager();this.renderSession.stencilManager.setContext(b);b.disable(b.STENCIL_TEST);this.filterStack.push(a);var e=a.filterPasses[0];this.offsetX+=a._filterArea.x;this.offsetY+=a._filterArea.y;var f=this.texturePool.pop();if(!f){f=new K.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)}else{f.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)}b.bindTexture(b.TEXTURE_2D,f.texture);var g=a._filterArea;var h=e.padding;g.x-=h;g.y-=h;g.width+=h*2;g.height+=h*2;if(g.x<0){g.x=0}if(g.width>this.width){g.width=this.width}if(g.y<0){g.y=0}if(g.height>this.height){g.height=this.height}b.bindFramebuffer(b.FRAMEBUFFER,f.frameBuffer);b.viewport(0,0,g.width*this.renderSession.resolution,g.height*this.renderSession.resolution);c.x=g.width/2;c.y=-g.height/2;d.x=-g.x;d.y=-g.y;b.colorMask(true,true,true,true);b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT);a._glFilterTexture=f};K.WebGLFilterManager.prototype.popFilter=function(){var a=this.gl;var b=this.filterStack.pop();var c=b._filterArea;var d=b._glFilterTexture;var e=this.renderSession.projection;var f=this.renderSession.offset;if(b.filterPasses.length>1){a.viewport(0,0,c.width*this.renderSession.resolution,c.height*this.renderSession.resolution);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=c.height;this.vertexArray[2]=c.width;this.vertexArray[3]=c.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=c.width;this.vertexArray[7]=0;a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=c.width/this.width;this.uvArray[5]=c.height/this.height;this.uvArray[6]=c.width/this.width;this.uvArray[7]=c.height/this.height;a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);var g=d;var h=this.texturePool.pop();if(!h){h=new K.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)}h.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution);a.bindFramebuffer(a.FRAMEBUFFER,h.frameBuffer);a.clear(a.COLOR_BUFFER_BIT);a.disable(a.BLEND);for(var i=0;i<b.filterPasses.length-1;i++){var j=b.filterPasses[i];a.bindFramebuffer(a.FRAMEBUFFER,h.frameBuffer);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,g.texture);this.applyFilterPass(j,c,c.width,c.height);var k=g;g=h;h=k}a.enable(a.BLEND);d=g;this.texturePool.push(h)}var l=b.filterPasses[b.filterPasses.length-1];this.offsetX-=c.x;this.offsetY-=c.y;var m=this.width;var n=this.height;var o=0;var p=0;var q=this.buffer;if(this.filterStack.length===0){a.colorMask(true,true,true,true)}else{var r=this.filterStack[this.filterStack.length-1];c=r._filterArea;m=c.width;n=c.height;o=c.x;p=c.y;q=r._glFilterTexture.frameBuffer}e.x=m/2;e.y=-n/2;f.x=o;f.y=p;c=b._filterArea;var x=c.x-o;var y=c.y-p;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=x;this.vertexArray[1]=y+c.height;this.vertexArray[2]=x+c.width;this.vertexArray[3]=y+c.height;this.vertexArray[4]=x;this.vertexArray[5]=y;this.vertexArray[6]=x+c.width;this.vertexArray[7]=y;a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=c.width/this.width;this.uvArray[5]=c.height/this.height;this.uvArray[6]=c.width/this.width;this.uvArray[7]=c.height/this.height;a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);a.viewport(0,0,m*this.renderSession.resolution,n*this.renderSession.resolution);a.bindFramebuffer(a.FRAMEBUFFER,q);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,d.texture);if(this.renderSession.stencilManager){this.renderSession.stencilManager.destroy()}this.renderSession.stencilManager=b._previous_stencil_mgr;b._previous_stencil_mgr=null;if(this.renderSession.stencilManager.count>0){a.enable(a.STENCIL_TEST)}else{a.disable(a.STENCIL_TEST)}this.applyFilterPass(l,c,m,n);this.texturePool.push(d);b._glFilterTexture=null};K.WebGLFilterManager.prototype.applyFilterPass=function(a,b,c,d){var e=this.gl;var f=a.shaders[e.id];if(!f){f=new K.PixiShader(e);f.fragmentSrc=a.fragmentSrc;f.uniforms=a.uniforms;f.init(true);a.shaders[e.id]=f}this.renderSession.shaderManager.setShader(f);e.uniform2f(f.projectionVector,c/2,-d/2);e.uniform2f(f.offsetVector,0,0);if(a.uniforms.dimensions){a.uniforms.dimensions.value[0]=this.width;a.uniforms.dimensions.value[1]=this.height;a.uniforms.dimensions.value[2]=this.vertexArray[0];a.uniforms.dimensions.value[3]=this.vertexArray[5]}f.syncUniforms();e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer);e.vertexAttribPointer(f.aVertexPosition,2,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer);e.vertexAttribPointer(f.aTextureCoord,2,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer);e.vertexAttribPointer(f.colorAttribute,2,e.FLOAT,false,0,0);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0);this.renderSession.drawCount++};K.WebGLFilterManager.prototype.initShaderBuffers=function(){var a=this.gl;this.vertexBuffer=a.createBuffer();this.uvBuffer=a.createBuffer();this.colorBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.vertexArray=new Float32Array([0.0,0.0,1.0,0.0,0.0,1.0,1.0,1.0]);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW);this.uvArray=new Float32Array([0.0,0.0,1.0,0.0,0.0,1.0,1.0,1.0]);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);a.bufferData(a.ARRAY_BUFFER,this.uvArray,a.STATIC_DRAW);this.colorArray=new Float32Array([1.0,0xFFFFFF,1.0,0xFFFFFF,1.0,0xFFFFFF,1.0,0xFFFFFF]);a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer);a.bufferData(a.ARRAY_BUFFER,this.colorArray,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),a.STATIC_DRAW)};K.WebGLFilterManager.prototype.destroy=function(){var a=this.gl;this.filterStack=null;this.offsetX=0;this.offsetY=0;for(var i=0;i<this.texturePool.length;i++){this.texturePool[i].destroy()}this.texturePool=null;a.deleteBuffer(this.vertexBuffer);a.deleteBuffer(this.uvBuffer);a.deleteBuffer(this.colorBuffer);a.deleteBuffer(this.indexBuffer)};function _CreateEmptyTexture(a,b,c,d){var e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,d===K.scaleModes.LINEAR?a.LINEAR:a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d===K.scaleModes.LINEAR?a.LINEAR:a.NEAREST);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,b,c,0,a.RGBA,a.UNSIGNED_BYTE,null);return e}var L={36054:'Incomplete attachment',36055:'Missing attachment',36057:'Incomplete dimensions',36061:'Framebuffer unsupported'};function _CreateFramebuffer(a,b,c,d,e){var f=a.createFramebuffer();var g=a.createRenderbuffer();var h=null;var i=0;a.activeTexture(a.TEXTURE0+e);a.bindFramebuffer(a.FRAMEBUFFER,f);a.bindRenderbuffer(a.RENDERBUFFER,g);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.renderBuffer);h=_CreateEmptyTexture(a,b,c,d);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,h,0);i=a.checkFramebufferStatus(a.FRAMEBUFFER);if(i!==a.FRAMEBUFFER_COMPLETE){console.error('Incomplete GL framebuffer. ',L[i])}f.width=b;f.height=c;f.targetTexture=h;f.renderBuffer=g;return f}K.FilterTexture=function(a,b,c,d,e){e=typeof e==='number'?e:0;this.gl=a;this.frameBuffer=_CreateFramebuffer(a,b,c,d||K.scaleModes.DEFAULT,e);this.texture=this.frameBuffer.targetTexture;this.width=b;this.height=c;this.renderBuffer=this.frameBuffer.renderBuffer};K.FilterTexture.prototype.constructor=K.FilterTexture;K.FilterTexture.prototype.clear=function(){var a=this.gl;a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT)};K.FilterTexture.prototype.resize=function(a,b){if(this.width===a&&this.height===b){return}this.width=a;this.height=b;var c=this.gl;c.bindTexture(c.TEXTURE_2D,this.texture);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null);c.bindRenderbuffer(c.RENDERBUFFER,this.renderBuffer);c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_STENCIL,a,b)};K.FilterTexture.prototype.destroy=function(){var a=this.gl;a.deleteFramebuffer(this.frameBuffer);a.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};K.CanvasBuffer=function(a,b){this.width=a;this.height=b;this.canvas=Phaser.CanvasPool.create(this,this.width,this.height);this.context=this.canvas.getContext('2d');this.canvas.width=a;this.canvas.height=b};K.CanvasBuffer.prototype.constructor=K.CanvasBuffer;K.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)};K.CanvasBuffer.prototype.resize=function(a,b){this.width=this.canvas.width=a;this.height=this.canvas.height=b};K.CanvasBuffer.prototype.destroy=function(){Phaser.CanvasPool.remove(this)};K.CanvasMaskManager=function(){};K.CanvasMaskManager.prototype.constructor=K.CanvasMaskManager;K.CanvasMaskManager.prototype.pushMask=function(a,b){var c=b.context;c.save();var d=a.alpha;var e=a.worldTransform;var f=b.resolution;c.setTransform(e.a*f,e.b*f,e.c*f,e.d*f,e.tx*f,e.ty*f);K.CanvasGraphics.renderGraphicsMask(a,c);c.clip();a.worldAlpha=d};K.CanvasMaskManager.prototype.popMask=function(a){a.context.restore()};K.CanvasTinter=function(){};K.CanvasTinter.getTintedTexture=function(a,b){var c=a.tintedTexture||Phaser.CanvasPool.create(this);K.CanvasTinter.tintMethod(a.texture,b,c);return c};K.CanvasTinter.tintWithMultiply=function(a,b,c){var d=c.getContext('2d');var e=a.crop;var w=e.width;var h=e.height;if(a.rotated){w=h;h=e.width}if(c.width!==w||c.height!==h){c.width=w;c.height=h}d.clearRect(0,0,w,h);d.fillStyle='#'+('00000'+(b|0).toString(16)).substr(-6);d.fillRect(0,0,w,h);d.globalCompositeOperation='multiply';d.drawImage(a.baseTexture.source,e.x,e.y,w,h,0,0,w,h);d.globalCompositeOperation='destination-atop';d.drawImage(a.baseTexture.source,e.x,e.y,w,h,0,0,w,h)};K.CanvasTinter.tintWithPerPixel=function(a,c,d){var e=d.getContext('2d');var f=a.crop;var w=f.width;var h=f.height;if(a.rotated){w=h;h=f.width}if(d.width!==w||d.height!==h){d.width=w;d.height=h}e.globalCompositeOperation='copy';e.drawImage(a.baseTexture.source,f.x,f.y,w,h,0,0,w,h);var j=Phaser.Color.hexToRGBArray(c);var r=j[0],g=j[1],b=j[2];var k=e.getImageData(0,0,w,h);var l=k.data;for(var i=0;i<l.length;i+=4){l[i+0]*=r;l[i+1]*=g;l[i+2]*=b;if(!K.CanvasTinter.canHandleAlpha){var m=l[i+3];l[i+0]/=255/m;l[i+1]/=255/m;l[i+2]/=255/m}}e.putImageData(k,0,0)};K.CanvasRenderer=function(a,b){this.game=a;if(!K.defaultRenderer){K.defaultRenderer=this}this.type=Phaser.CANVAS;this.resolution=a.resolution;this.clearBeforeRender=a.clearBeforeRender;this.transparent=a.transparent;this.autoResize=false;this.width=a.width*this.resolution;this.height=a.height*this.resolution;this.view=a.canvas;this.context=this.view.getContext('2d',{alpha:this.transparent});if(!this.context){throw new Error('Failed to create a Canvas 2d context.');}this.refresh=true;this.count=0;this.maskManager=new K.CanvasMaskManager();this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:b.roundPixels||false};this.mapBlendModes();this.resize(this.width,this.height)};K.CanvasRenderer.prototype.constructor=K.CanvasRenderer;K.CanvasRenderer.prototype.render=function(a){this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=0;this.renderSession.shakeX=this.game.camera._shake.x;this.renderSession.shakeY=this.game.camera._shake.y;this.context.globalCompositeOperation='source-over';if(navigator.isCocoonJS&&this.view.screencanvas){this.context.fillStyle='black';this.context.clear()}if(this.clearBeforeRender){if(this.transparent){this.context.clearRect(0,0,this.width,this.height)}else if(a._bgColor){this.context.fillStyle=a._bgColor.rgba;this.context.fillRect(0,0,this.width,this.height)}}this.renderDisplayObject(a)};K.CanvasRenderer.prototype.postRender=function(){};K.CanvasRenderer.prototype.setTexturePriority=function(){};K.CanvasRenderer.prototype.destroy=function(a){if(a===undefined){a=true}if(a&&this.view.parent){this.view.parent.removeChild(this.view)}this.view=null;this.context=null;this.maskManager=null;this.renderSession=null};K.CanvasRenderer.prototype.resize=function(a,b){this.width=a*this.resolution;this.height=b*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+'px';this.view.style.height=this.height/this.resolution+'px'}if(this.renderSession.smoothProperty){this.context[this.renderSession.smoothProperty]=(this.renderSession.scaleMode===K.scaleModes.LINEAR)}};K.CanvasRenderer.prototype.renderDisplayObject=function(a,b,c){this.renderSession.context=b||this.context;this.renderSession.resolution=this.resolution;a._renderCanvas(this.renderSession,c)};K.CanvasRenderer.prototype.mapBlendModes=function(){if(!K.blendModesCanvas){var b=[];var a=K.blendModes;var c=this.game.device.canUseMultiply;b[a.NORMAL]='source-over';b[a.ADD]='lighter';b[a.MULTIPLY]=(c)?'multiply':'source-over';b[a.SCREEN]=(c)?'screen':'source-over';b[a.OVERLAY]=(c)?'overlay':'source-over';b[a.DARKEN]=(c)?'darken':'source-over';b[a.LIGHTEN]=(c)?'lighten':'source-over';b[a.COLOR_DODGE]=(c)?'color-dodge':'source-over';b[a.COLOR_BURN]=(c)?'color-burn':'source-over';b[a.HARD_LIGHT]=(c)?'hard-light':'source-over';b[a.SOFT_LIGHT]=(c)?'soft-light':'source-over';b[a.DIFFERENCE]=(c)?'difference':'source-over';b[a.EXCLUSION]=(c)?'exclusion':'source-over';b[a.HUE]=(c)?'hue':'source-over';b[a.SATURATION]=(c)?'saturation':'source-over';b[a.COLOR]=(c)?'color':'source-over';b[a.LUMINOSITY]=(c)?'luminosity':'source-over';K.blendModesCanvas=b}};K.BaseTexture=function(a,b,c){this.resolution=c||1;this.width=100;this.height=100;this.scaleMode=b||K.scaleModes.DEFAULT;this.hasLoaded=false;this.source=a;this.premultipliedAlpha=true;this._glTextures=[];this.mipmap=false;this.textureIndex=0;this._dirty=[true,true,true,true];if(!a){return}if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height){this.hasLoaded=true;this.width=this.source.naturalWidth||this.source.width;this.height=this.source.naturalHeight||this.source.height;this.dirty()}this.skipRender=false;this._powerOf2=false};K.BaseTexture.prototype.constructor=K.BaseTexture;K.BaseTexture.prototype.forceLoaded=function(a,b){this.hasLoaded=true;this.width=a;this.height=b;this.dirty()};K.BaseTexture.prototype.destroy=function(){if(this.source){Phaser.CanvasPool.removeByCanvas(this.source)}this.source=null;this.unloadFromGPU()};K.BaseTexture.prototype.dirty=function(){for(var i=0;i<this._glTextures.length;i++){this._dirty[i]=true}};K.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var i=this._glTextures.length-1;i>=0;i--){var a=this._glTextures[i];var b=K.glContexts[i];if(b&&a){b.deleteTexture(a)}}this._glTextures.length=0;this.dirty()};K.BaseTexture.fromCanvas=function(a,b,c){if(a.width===0){a.width=1}if(a.height===0){a.height=1}c=c||1;return new K.BaseTexture(a,b,c)};K.TextureSilentFail=false;K.Texture=function(a,b,c,d){this.noFrame=false;if(!b){this.noFrame=true;b=new K.Rectangle(0,0,1,1)}if(a instanceof K.Texture){a=a.baseTexture}this.baseTexture=a;this.frame=b;this.trim=d;this.valid=false;this.isTiling=false;this.requiresUpdate=false;this.requiresReTint=false;this._uvs=null;this.width=0;this.height=0;this.crop=c||new K.Rectangle(0,0,1,1);this.rotated=false;if(a.hasLoaded){if(this.noFrame){b=new K.Rectangle(0,0,a.width,a.height)}this.setFrame(b)}};K.Texture.prototype.constructor=K.Texture;K.Texture.prototype.onBaseTextureLoaded=function(){var a=this.baseTexture;if(this.noFrame){this.frame=new K.Rectangle(0,0,a.width,a.height)}this.setFrame(this.frame)};K.Texture.prototype.destroy=function(a){if(a){this.baseTexture.destroy()}this.valid=false};K.Texture.prototype.setFrame=function(a){this.noFrame=false;this.frame=a;this.width=a.width;this.height=a.height;this.crop.x=a.x;this.crop.y=a.y;this.crop.width=a.width;this.crop.height=a.height;if(!this.trim&&(a.x+a.width>this.baseTexture.width||a.y+a.height>this.baseTexture.height)){if(!K.TextureSilentFail){throw new Error('Texture Error: frame does not fit inside the base Texture dimensions '+this);}this.valid=false;return}this.valid=a&&a.width&&a.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;if(this.trim){this.width=this.trim.width;this.height=this.trim.height;this.frame.width=this.trim.width;this.frame.height=this.trim.height}if(this.valid){this._updateUvs()}};K.Texture.prototype._updateUvs=function(){if(!this._uvs){this._uvs=new K.TextureUvs()}var a=this.crop;var b=this.baseTexture.width;var c=this.baseTexture.height;this._uvs.x0=a.x/b;this._uvs.y0=a.y/c;this._uvs.x1=(a.x+a.width)/b;this._uvs.y1=a.y/c;this._uvs.x2=(a.x+a.width)/b;this._uvs.y2=(a.y+a.height)/c;this._uvs.x3=a.x/b;this._uvs.y3=(a.y+a.height)/c};K.Texture.prototype._updateUvsInverted=function(){if(!this._uvs){this._uvs=new K.TextureUvs()}var a=this.crop;var b=this.baseTexture.width;var c=this.baseTexture.height;this._uvs.x0=a.x/b;this._uvs.y0=a.y/c;this._uvs.x1=(a.x+a.height)/b;this._uvs.y1=a.y/c;this._uvs.x2=(a.x+a.height)/b;this._uvs.y2=(a.y+a.width)/c;this._uvs.x3=a.x/b;this._uvs.y3=(a.y+a.width)/c};K.Texture.fromCanvas=function(a,b){var c=K.BaseTexture.fromCanvas(a,b);return new K.Texture(c)};K.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=0};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=K}exports.PIXI=K}else if(typeof define!=='undefined'&&define.amd){define('PIXI',(function(){return J.PIXI=K})())}else{J.PIXI=K}if(GameGlobal){GameGlobal.PIXI=K}return K}).call(this);(function(){var M=this;var N=N||{VERSION:'2.19.2',GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,WEBGL_MULTI:4,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,HORIZONTAL:0,VERTICAL:1,LANDSCAPE:0,PORTRAIT:1,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{},_UID:0};if(typeof AudioBufferSourceNode!=='undefined'){if(!AudioBufferSourceNode.prototype.start){AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn}if(!AudioBufferSourceNode.prototype.stop){AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff}}if(!Math.trunc){Math.trunc=function trunc(x){return x<0?Math.ceil(x):Math.floor(x)}}if(!Function.prototype.bind){Function.prototype.bind=(function(){var d=Array.prototype.slice;return function(b){var c=this,boundArgs=d.call(arguments,1);if(typeof c!=='function'){throw new TypeError();}function bound(){var a=boundArgs.concat(d.call(arguments));c.apply(this instanceof bound?this:b,a)}bound.prototype=(function F(a){if(a){F.prototype=a}if(!(this instanceof F)){return new F()}})(c.prototype);return bound}})()}if(!Array.isArray){Array.isArray=function(a){return Object.prototype.toString.call(a)==='[object Array]'}}if(!Array.prototype.forEach){Array.prototype.forEach=function(a){'use strict';if(this===void 0||this===null){throw new TypeError();}var t=Object(this);var b=t.length>>>0;if(typeof a!=='function'){throw new TypeError();}var c=arguments.length>=2?arguments[1]:void 0;for(var i=0;i<b;i++){if(i in t){a.call(c,t[i],i,t)}}}}if(typeof window.Uint32Array!=='function'&&typeof window.Uint32Array!=='object'){var O=function(b){var c=new Array();window[b]=function(a){if(typeof(a)==='number'){Array.call(this,a);this.length=a;for(var i=0;i<this.length;i++){this[i]=0}}else{Array.call(this,a.length);this.length=a.length;for(var i=0;i<this.length;i++){this[i]=a[i]}}};window[b].prototype=c;window[b].constructor=window[b]};O('Float32Array');O('Uint32Array');O('Uint16Array');O('Int16Array');O('ArrayBuffer')}if(!window.console){window.console={};window.console.log=window.console.assert=function(){};window.console.warn=window.console.assert=function(){}}if(!Object.assign){Object.assign=function(a,b){'use strict';if(a==null){throw new TypeError('Cannot convert undefined or null to object');}var c=Object(a);var d=Object.prototype.hasOwnProperty;for(var e=1;e<arguments.length;e++){var f=arguments[e];if(f!=null){for(var g in f){if(d.call(f,g)){c[g]=f[g]}}}}return c}}N.Utils={defaults:function(a,b){var c=Object.keys(b);for(var i=0,len=c.length;i<len;i++){var d=c[i];if(a[d]===undefined){a[d]=b[d]}}return a},reverseString:function(a){return a.split('').reverse().join('')},getProperty:function(a,b){var c=b.split('.');switch(c.length){case 1:return a[b];case 2:return a[c[0]][c[1]];case 3:return a[c[0]][c[1]][c[2]];case 4:return a[c[0]][c[1]][c[2]][c[3]];default:return this._getProperty(a,b)}},setProperties:function(a,b){for(var c in b){this.setProperty(a,c,b[c])}return a},setProperty:function(a,b,c){var d=b.split('.');switch(d.length){case 1:a[b]=c;break;case 2:a[d[0]][d[1]]=c;break;case 3:a[d[0]][d[1]][d[2]]=c;break;case 4:a[d[0]][d[1]][d[2]][d[3]]=c;break;default:this._setProperty(a,b,c)}},_getProperty:function(a,b){var c=b.split('.'),len=c.length,i=0,val=a;while(i<len){var d=c[i];if(val!=null){val=val[d];i++}else{return undefined}}return val},_setProperty:function(a,b,c){var d=b.split('.'),len=d.length,i=0,currentObj=a,P=d[0];if(len===1){a[b]=c}else{while(i<(len-1)){currentObj=currentObj[P];i++;P=d[i]}currentObj[P]=c}return a},chanceRoll:function(a){if(a===undefined){a=50}return a>0&&(Math.random()*100<=a)},randomChoice:function(a,b){return(Math.random()<0.5)?a:b},parseDimension:function(a,b){var f=0;var c=0;if(typeof a==='string'){if(a.substr(-1)==='%'){f=parseInt(a,10)/100;if(b===0){c=window.innerWidth*f}else{c=window.innerHeight*f}}else{c=parseInt(a,10)}}else{c=a}return c},pad:function(a,b,c,d){if(b===undefined){var b=0}if(c===undefined){var c=' '}if(d===undefined){var d=3}a=a.toString();var e=0;if(b+1>=a.length){switch(d){case 1:a=new Array(b+1-a.length).join(c)+a;break;case 3:var f=Math.ceil((e=b-a.length)/2);var g=e-f;a=new Array(g+1).join(c)+a+new Array(f+1).join(c);break;default:a=a+new Array(b+1-a.length).join(c);break}}return a},isPlainObject:function(a){if(typeof(a)!=='object'||a.nodeType||a===a.window){return false}try{if(a.constructor&&!({}).hasOwnProperty.call(a.constructor.prototype,'isPrototypeOf')){return false}}catch(e){return false}return true},extend:function(){var a,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==='boolean'){deep=target;target=arguments[1]||{};i=2}if(length===i){target=this;--i}for(;i<length;i++){if((a=arguments[i])!=null){for(name in a){src=target[name];copy=a[name];if(target===copy){continue}if(deep&&copy&&(N.Utils.isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&Array.isArray(src)?src:[]}else{clone=src&&N.Utils.isPlainObject(src)?src:{}}target[name]=N.Utils.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target},mixinPrototype:function(a,b,c){if(c===undefined){c=false}var d=Object.keys(b);for(var i=0;i<d.length;i++){var e=d[i];var f=b[e];if(!c&&(e in a)){continue}else if(f&&(typeof f.get==='function'||typeof f.set==='function')){if(typeof f.clone==='function'){a[e]=f.clone()}else{Object.defineProperty(a,e,f)}}else{a[e]=f}}},mixin:function(a,b){if(!a||typeof(a)!=='object'){return b}for(var c in a){var o=a[c];if(o.childNodes||o.cloneNode){continue}var d=typeof(a[c]);if(!a[c]||d!=='object'){b[c]=a[c]}else{if(typeof(b[c])===d){b[c]=N.Utils.mixin(a[c],b[c])}else{b[c]=N.Utils.mixin(a[c],new o.constructor())}}}return b}};N.Circle=function(x,y,a){x=x||0;y=y||0;a=a||0;this.x=x;this.y=y;this._diameter=a;this._radius=0;if(a>0){this._radius=a*0.5}this.type=N.CIRCLE};N.Circle.prototype={circumference:function(){return 2*(Math.PI*this._radius)},random:function(a){if(a===undefined){a=new N.Point()}var t=2*Math.PI*Math.random();var u=Math.random()+Math.random();var r=(u>1)?2-u:u;var x=r*Math.cos(t);var y=r*Math.sin(t);a.x=this.x+(x*this.radius);a.y=this.y+(y*this.radius);return a},getBounds:function(){return new N.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(x,y,a){this.x=x;this.y=y;this._diameter=a;this._radius=a*0.5;return this},copyFrom:function(a){return this.setTo(a.x,a.y,a.diameter)},copyTo:function(a){a.x=this.x;a.y=this.y;a.diameter=this._diameter;return a},distance:function(a,b){var c=N.Math.distance(this.x,this.y,a.x,a.y);return b?Math.round(c):c},clone:function(a){if(a===undefined||a===null){a=new N.Circle(this.x,this.y,this.diameter)}else{a.setTo(this.x,this.y,this.diameter)}return a},contains:function(x,y){return N.Circle.contains(this,x,y)},circumferencePoint:function(a,b,c){return N.Circle.circumferencePoint(this,a,b,c)},sample:function(a,b,c,d,e){if(!a){a=60}if(b==null){b=0}if(c==null){c=N.Math.PI2}if(!e){e=[]}var i=0;while(i<a){this.circumferencePoint(N.Math.linear(b,c,i/a),d,e[i]||(e[i]=new N.Point()));i+=1}return e},offset:function(a,b){this.x+=a;this.y+=b;return this},offsetPoint:function(a){return this.offset(a.x,a.y)},toString:function(){return'[{Phaser.Circle (x='+this.x+' y='+this.y+' diameter='+this.diameter+' radius='+this.radius+')}]'}};N.Circle.prototype.constructor=N.Circle;Object.defineProperty(N.Circle.prototype,'diameter',{get:function(){return this._diameter},set:function(a){if(a>0){this._diameter=a;this._radius=a*0.5}}});Object.defineProperty(N.Circle.prototype,'radius',{get:function(){return this._radius},set:function(a){if(a>0){this._radius=a;this._diameter=a*2}}});Object.defineProperty(N.Circle.prototype,'left',{get:function(){return this.x-this._radius},set:function(a){if(a>this.x){this._radius=0;this._diameter=0}else{this.radius=this.x-a}}});Object.defineProperty(N.Circle.prototype,'right',{get:function(){return this.x+this._radius},set:function(a){if(a<this.x){this._radius=0;this._diameter=0}else{this.radius=a-this.x}}});Object.defineProperty(N.Circle.prototype,'top',{get:function(){return this.y-this._radius},set:function(a){if(a>this.y){this._radius=0;this._diameter=0}else{this.radius=this.y-a}}});Object.defineProperty(N.Circle.prototype,'bottom',{get:function(){return this.y+this._radius},set:function(a){if(a<this.y){this._radius=0;this._diameter=0}else{this.radius=a-this.y}}});Object.defineProperty(N.Circle.prototype,'area',{get:function(){if(this._radius>0){return Math.PI*this._radius*this._radius}else{return 0}}});Object.defineProperty(N.Circle.prototype,'empty',{get:function(){return(this._diameter===0)},set:function(a){if(a===true){this.setTo(0,0,0)}}});N.Circle.contains=function(a,x,y){if(a.radius>0&&x>=a.left&&x<=a.right&&y>=a.top&&y<=a.bottom){var b=(a.x-x)*(a.x-x);var c=(a.y-y)*(a.y-y);return(b+c)<=(a.radius*a.radius)}else{return false}};N.Circle.equals=function(a,b){return(a.x===b.x&&a.y===b.y&&a.diameter===b.diameter)};N.Circle.intersects=function(a,b){return(N.Math.distance(a.x,a.y,b.x,b.y)<=(a.radius+b.radius))};N.Circle.circumferencePoint=function(a,b,c,d){if(c===undefined){c=false}if(d===undefined){d=new N.Point()}if(c===true){b=N.Math.degToRad(b)}d.x=a.x+a.radius*Math.cos(b);d.y=a.y+a.radius*Math.sin(b);return d};N.Circle.intersectsRectangle=function(c,r){var a=Math.abs(c.x-r.x-r.halfWidth);var b=r.halfWidth+c.radius;if(a>b){return false}var d=Math.abs(c.y-r.y-r.halfHeight);var e=r.halfHeight+c.radius;if(d>e){return false}if(a<=r.halfWidth||d<=r.halfHeight){return true}var f=a-r.halfWidth;var g=d-r.halfHeight;var h=f*f;var i=g*g;var j=c.radius*c.radius;return h+i<=j};N.Circle.intersectsLine=function(c,l,d){var h=c.x;var k=c.y;var m=((l.end.y-l.start.y)/(l.end.x-l.start.x));var n=l.end.y-(m*l.end.x);var a=c.radius;var b=c.radius;var e=n+m*h;var f=(h*(b*b)-m*(a*a)*(n-k)+a*b*(Math.sqrt((a*a)*(m*m)+(b*b)-(e*e)-(k*k)+(2*e*k))))/((a*a)*(m*m)+(b*b));var g=(h*(b*b)-m*(a*a)*(n-k)-a*b*(Math.sqrt((a*a)*(m*m)+(b*b)-(e*e)-(k*k)+(2*e*k))))/((a*a)*(m*m)+(b*b));var i=m*f+n;var j=m*g+n;var o=new N.Point(f,i);var p=new N.Point(g,j);var q=l.pointOnSegment(o.x,o.y,0.01);var r=l.pointOnSegment(p.x,p.y,0.01);if(q&&r){return d?[o,p]:true}else if(q){return d?[o]:true}else if(r){return d?[p]:true}else{return d?[]:false}};PIXI.Circle=N.Circle;N.Ellipse=function(x,y,a,b){x=x||0;y=y||0;a=a||0;b=b||0;this.x=x;this.y=y;this.width=a;this.height=b;this.type=N.ELLIPSE};N.Ellipse.prototype={setTo:function(x,y,a,b){this.x=x;this.y=y;this.width=a;this.height=b;return this},getBounds:function(){return new N.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(a){return this.setTo(a.x,a.y,a.width,a.height)},copyTo:function(a){a.x=this.x;a.y=this.y;a.width=this.width;a.height=this.height;return a},clone:function(a){if(a===undefined||a===null){a=new N.Ellipse(this.x,this.y,this.width,this.height)}else{a.setTo(this.x,this.y,this.width,this.height)}return a},contains:function(x,y){return N.Ellipse.contains(this,x,y)},random:function(a){if(a===undefined){a=new N.Point()}var p=Math.random()*Math.PI*2;var r=Math.sqrt(Math.random());a.x=this.centerX+0.5*r*Math.cos(p)*this.width;a.y=this.centerY+0.5*r*Math.sin(p)*this.height;return a},toString:function(){return'[{Phaser.Ellipse (x='+this.x+' y='+this.y+' width='+this.width+' height='+this.height+')}]'}};N.Ellipse.prototype.constructor=N.Ellipse;Object.defineProperty(N.Ellipse.prototype,'left',{get:function(){return this.x},set:function(a){this.x=a}});Object.defineProperty(N.Ellipse.prototype,'right',{get:function(){return this.x+this.width},set:function(a){if(a<this.x){this.width=0}else{this.width=a-this.x}}});Object.defineProperty(N.Ellipse.prototype,'top',{get:function(){return this.y},set:function(a){this.y=a}});Object.defineProperty(N.Ellipse.prototype,'bottom',{get:function(){return this.y+this.height},set:function(a){if(a<this.y){this.height=0}else{this.height=a-this.y}}});Object.defineProperty(N.Ellipse.prototype,'centerX',{get:function(){return this.x+0.5*this.width}});Object.defineProperty(N.Ellipse.prototype,'centerY',{get:function(){return this.y+0.5*this.height}});Object.defineProperty(N.Ellipse.prototype,'empty',{get:function(){return(this.width===0||this.height===0)},set:function(a){if(a===true){this.setTo(0,0,0,0)}}});N.Ellipse.contains=function(a,x,y){if(a.width<=0||a.height<=0){return false}var b=((x-a.x)/a.width)-0.5;var c=((y-a.y)/a.height)-0.5;b*=b;c*=c;return(b+c<0.25)};N.Ellipse.intersectsLine=function(e,l,c){var h=e.x;var k=e.y;var m=((l.end.y-l.start.y)/(l.end.x-l.start.x));var n=l.end.y-(m*l.end.x);var a=e.width/2;var b=e.height/2;var d=n+m*h;var f=(h*(b*b)-m*(a*a)*(n-k)+a*b*(Math.sqrt((a*a)*(m*m)+(b*b)-(d*d)-(k*k)+(2*d*k))))/((a*a)*(m*m)+(b*b));var g=(h*(b*b)-m*(a*a)*(n-k)-a*b*(Math.sqrt((a*a)*(m*m)+(b*b)-(d*d)-(k*k)+(2*d*k))))/((a*a)*(m*m)+(b*b));var i=m*f+n;var j=m*g+n;var o=new N.Point(f,i);var p=new N.Point(g,j);var q=l.pointOnSegment(o.x,o.y,0.01);var r=l.pointOnSegment(p.x,p.y,0.01);if(q&&r){return c?[o,p]:true}else if(q){return c?[o]:true}else if(r){return c?[p]:true}else{return c?[]:false}};PIXI.Ellipse=N.Ellipse;N.Line=function(a,b,c,d){a=a||0;b=b||0;c=c||0;d=d||0;this.start=new N.Point(a,b);this.end=new N.Point(c,d);this.type=N.LINE};N.Line.prototype={setTo:function(a,b,c,d){this.start.setTo(a,b);this.end.setTo(c,d);return this},fromPoints:function(a,b){this.setTo(a.x,a.y,b.x,b.y);return this},fromSprite:function(a,b,c){if(c===undefined){c=false}if(c){return this.setTo(a.centerX,a.centerY,b.centerX,b.centerY)}return this.fromPoints(a,b)},fromAngle:function(x,y,a,b){this.start.setTo(x,y);this.end.setTo(x+(Math.cos(a)*b),y+(Math.sin(a)*b));return this},rotate:function(a,b){var c=(this.start.x+this.end.x)/2;var d=(this.start.y+this.end.y)/2;this.start.rotate(c,d,a,b);this.end.rotate(c,d,a,b);return this},rotateAround:function(x,y,a,b){this.start.rotate(x,y,a,b);this.end.rotate(x,y,a,b);return this},intersects:function(a,b,c){return N.Line.intersectsPoints(this.start,this.end,a.start,a.end,b,c)},reflect:function(a){return N.Line.reflect(this,a)},midPoint:function(a){if(a===undefined){a=new N.Point()}a.x=(this.start.x+this.end.x)/2;a.y=(this.start.y+this.end.y)/2;return a},centerOn:function(x,y){var a=(this.start.x+this.end.x)/2;var b=(this.start.y+this.end.y)/2;var c=x-a;var d=y-b;this.start.add(c,d);this.end.add(c,d)},pointOnLine:function(x,y,a){return N.Math.fuzzyEqual((x-this.start.x)*(this.end.y-this.start.y),(this.end.x-this.start.x)*(y-this.start.y),a||0)},pointOnSegment:function(x,y,a){var b=Math.min(this.start.x,this.end.x);var c=Math.max(this.start.x,this.end.x);var d=Math.min(this.start.y,this.end.y);var e=Math.max(this.start.y,this.end.y);return(this.pointOnLine(x,y,a)&&(x>=b&&x<=c)&&(y>=d&&y<=e))},random:function(a){if(a===undefined){a=new N.Point()}var t=Math.random();a.x=this.start.x+t*(this.end.x-this.start.x);a.y=this.start.y+t*(this.end.y-this.start.y);return a},coordinatesOnLine:function(a,b){if(a===undefined){a=1}if(b===undefined){b=[]}var c=Math.round(this.start.x);var d=Math.round(this.start.y);var e=Math.round(this.end.x);var f=Math.round(this.end.y);var g=Math.abs(e-c);var h=Math.abs(f-d);var j=(c<e)?1:-1;var k=(d<f)?1:-1;var l=g-h;b.push([c,d]);var i=1;while(!((c===e)&&(d===f))){var m=l<<1;if(m>-h){l-=h;c+=j}if(m<g){l+=g;d+=k}if(i%a===0){b.push([c,d])}i++}return b},clone:function(a){if(a===undefined||a===null){a=new N.Line(this.start.x,this.start.y,this.end.x,this.end.y)}else{a.setTo(this.start.x,this.start.y,this.end.x,this.end.y)}return a}};Object.defineProperty(N.Line.prototype,'length',{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(N.Line.prototype,'angle',{get:function(){return N.Point.angle(this.end,this.start)}});Object.defineProperty(N.Line.prototype,'slope',{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(N.Line.prototype,'perpSlope',{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(N.Line.prototype,'x',{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(N.Line.prototype,'y',{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(N.Line.prototype,'left',{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(N.Line.prototype,'right',{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(N.Line.prototype,'top',{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(N.Line.prototype,'bottom',{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(N.Line.prototype,'width',{get:function(){return Math.abs(this.start.x-this.end.x)}});Object.defineProperty(N.Line.prototype,'height',{get:function(){return Math.abs(this.start.y-this.end.y)}});Object.defineProperty(N.Line.prototype,'normalX',{get:function(){return Math.cos(this.angle-1.5707963267948966)}});Object.defineProperty(N.Line.prototype,'normalY',{get:function(){return Math.sin(this.angle-1.5707963267948966)}});Object.defineProperty(N.Line.prototype,'normalAngle',{get:function(){return N.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}});N.Line.intersectsPoints=function(a,b,e,f,c,d){if(c===undefined){c=true}if(d===undefined){d=new N.Point()}var g=b.y-a.y;var h=f.y-e.y;var i=a.x-b.x;var j=e.x-f.x;var k=(b.x*a.y)-(a.x*b.y);var l=(f.x*e.y)-(e.x*f.y);var m=(g*j)-(h*i);if(m===0){return null}d.x=((i*l)-(j*k))/m;d.y=((h*k)-(g*l))/m;if(c){var n=((f.y-e.y)*(b.x-a.x)-(f.x-e.x)*(b.y-a.y));var o=(((f.x-e.x)*(a.y-e.y))-(f.y-e.y)*(a.x-e.x))/n;var p=(((b.x-a.x)*(a.y-e.y))-((b.y-a.y)*(a.x-e.x)))/n;if(o>=0&&o<=1&&p>=0&&p<=1){return d}else{return null}}return d};N.Line.intersects=function(a,b,c,d){return N.Line.intersectsPoints(a.start,a.end,b.start,b.end,c,d)};N.Line.intersectsRectangle=function(a,b){if(a.length===0||b.empty){return false}var c=a.start.x;var d=a.start.y;var e=a.end.x;var f=a.end.y;var g=b.x;var h=b.y;var i=b.right;var j=b.bottom;var t=0;if((c>=g&&c<=i&&d>=h&&d<=j)||(e>=g&&e<=i&&f>=h&&f<=j)){return true}if(c<g&&e>=g){t=d+(f-d)*(g-c)/(e-c);if(t>h&&t<=j){return true}}else if(c>i&&e<=i){t=d+(f-d)*(i-c)/(e-c);if(t>=h&&t<=j){return true}}if(d<h&&f>=h){t=c+(e-c)*(h-d)/(f-d);if(t>=g&&t<=i){return true}}else if(d>j&&f<=j){t=c+(e-c)*(j-d)/(f-d);if(t>=g&&t<=i){return true}}return false};N.Line.intersectionWithRectangle=function(a,b,c){var d=N.Line.intersectionWithRectangle;if(!c){c=new N.Point()}if(!d.edges){d.edges=[new N.Line(),new N.Line(),new N.Line(),new N.Line()]}if(!d.edgeIntersection){d.edgeIntersection=new N.Point()}var e=d.edges;var f=d.edgeIntersection.set(0);var g=b.x;var h=b.y;var j=b.right;var k=b.bottom;var l=Infinity;e[0].setTo(g,h,j,h);e[1].setTo(g,k,j,k);e[2].setTo(g,h,g,k);e[3].setTo(j,h,j,k);for(var m,i=0;(m=e[i]);i++){if(a.intersects(m,true,f)){var n=a.start.distance(f);if(n<l){l=n;c.copyFrom(f)}}}if(n!=null){return c}return null};N.Line.reflect=function(a,b){return 2*b.normalAngle-3.141592653589793-a.angle};N.Matrix=function(a,b,c,d,e,f){if(a===undefined||a===null){a=1}if(b===undefined||b===null){b=0}if(c===undefined||c===null){c=0}if(d===undefined||d===null){d=1}if(e===undefined||e===null){e=0}if(f===undefined||f===null){f=0}this.a=a;this.b=b;this.c=c;this.d=d;this.tx=e;this.ty=f;this.type=N.MATRIX};N.Matrix.prototype={fromArray:function(a){return this.setTo(a[0],a[1],a[3],a[4],a[2],a[5])},setTo:function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.d=d;this.tx=e;this.ty=f;return this},clone:function(a){if(a===undefined||a===null){a=new N.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)}else{a.a=this.a;a.b=this.b;a.c=this.c;a.d=this.d;a.tx=this.tx;a.ty=this.ty}return a},copyTo:function(a){a.copyFrom(this);return a},copyFrom:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.d=a.d;this.tx=a.tx;this.ty=a.ty;return this},toArray:function(a,b){if(b===undefined){b=new Float32Array(9)}if(a){b[0]=this.a;b[1]=this.b;b[2]=0;b[3]=this.c;b[4]=this.d;b[5]=0;b[6]=this.tx;b[7]=this.ty;b[8]=1}else{b[0]=this.a;b[1]=this.c;b[2]=this.tx;b[3]=this.b;b[4]=this.d;b[5]=this.ty;b[6]=0;b[7]=0;b[8]=1}return b},apply:function(a,b){if(b===undefined){b=new N.Point()}b.x=this.a*a.x+this.c*a.y+this.tx;b.y=this.b*a.x+this.d*a.y+this.ty;return b},applyInverse:function(a,b){if(b===undefined){b=new N.Point()}var c=1/(this.a*this.d+this.c*-this.b);var x=a.x;var y=a.y;b.x=this.d*c*x+ -this.c*c*y+(this.ty*this.c-this.tx*this.d)*c;b.y=this.a*c*y+ -this.b*c*x+(-this.ty*this.a+this.tx*this.b)*c;return b},translate:function(x,y){this.tx+=x;this.ty+=y;return this},scale:function(x,y){this.a*=x;this.d*=y;this.c*=x;this.b*=y;this.tx*=x;this.ty*=y;return this},rotate:function(a){var b=Math.cos(a);var c=Math.sin(a);var d=this.a;var e=this.c;var f=this.tx;this.a=d*b-this.b*c;this.b=d*c+this.b*b;this.c=e*b-this.d*c;this.d=e*c+this.d*b;this.tx=f*b-this.ty*c;this.ty=f*c+this.ty*b;return this},append:function(a){var b=this.a;var c=this.b;var d=this.c;var e=this.d;this.a=a.a*b+a.b*d;this.b=a.a*c+a.b*e;this.c=a.c*b+a.d*d;this.d=a.c*c+a.d*e;this.tx=a.tx*b+a.ty*d+this.tx;this.ty=a.tx*c+a.ty*e+this.ty;return this},identity:function(){return this.setTo(1,0,0,1,0,0)}};N.identityMatrix=new N.Matrix();N.Point=function(x,y){x=x||0;y=y||0;this.x=x;this.y=y;this.type=N.POINT};N.Point.prototype={copyFrom:function(a){return this.setTo(a.x,a.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(x,y){return N.Point.set(this,x,y)},set:function(x,y){return N.Point.set(this,x,y)},setToPolar:function(a,b,c){if(b==null){b=1}if(c){a=N.Math.degToRad(a)}return this.setTo(Math.cos(a)*b,Math.sin(a)*b)},add:function(x,y){this.x+=x;this.y+=y;return this},subtract:function(x,y){this.x-=x;this.y-=y;return this},multiply:function(x,y){this.x*=x;this.y*=y;return this},divide:function(x,y){this.x/=x;this.y/=y;return this},clampX:function(a,b){this.x=N.Math.clamp(this.x,a,b);return this},clampY:function(a,b){this.y=N.Math.clamp(this.y,a,b);return this},clamp:function(a,b){this.x=N.Math.clamp(this.x,a,b);this.y=N.Math.clamp(this.y,a,b);return this},clip:function(a){var b=a.left,top=a.top,right=a.right,bottom=a.bottom;if(this.x<b){this.x=b}else if(this.x>right){this.x=right}if(this.y<top){this.y=top}else if(this.y>bottom){this.y=bottom}return this},clone:function(a){if(a===undefined||a===null){a=new N.Point(this.x,this.y)}else{a.setTo(this.x,this.y)}return a},copyTo:function(a){a.x=this.x;a.y=this.y;return a},distance:function(a,b){return N.Point.distance(this,a,b)},equals:function(a){return a.x===this.x&&a.y===this.y},equalsXY:function(x,y){return this.x===x&&this.y===y},fuzzyEquals:function(a,b){return N.Point.fuzzyEquals(this,a,b)},fuzzyEqualsXY:function(x,y,a){return N.Point.fuzzyEqualsXY(this,x,y,a)},angle:function(a,b){return this.angleXY(a.x,a.y,b)},angleXY:function(x,y,a){var b=Math.atan2(y-this.y,x-this.x);if(a){return N.Math.radToDeg(b)}else{return b}},atan:function(a){var b=Math.atan2(this.y,this.x);if(a){return N.Math.radToDeg(b)}else{return b}},rotate:function(x,y,a,b,c){return N.Point.rotate(this,x,y,a,b,c)},getMagnitude:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y))},getMagnitudeSq:function(){return(this.x*this.x)+(this.y*this.y)},setMagnitude:function(a){return this.normalize().multiply(a,a)},normalize:function(){if(!this.isZero()){var m=this.getMagnitude();this.x/=m;this.y/=m}return this},limit:function(a){if(this.getMagnitudeSq()>a*a){this.setMagnitude(a)}return this},expand:function(a){if(this.getMagnitudeSq()<a*a){this.setMagnitude(a)}return this},isZero:function(){return(this.x===0&&this.y===0)},dot:function(a){return((this.x*a.x)+(this.y*a.y))},cross:function(a){return((this.x*a.y)-(this.y*a.x))},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(this.y*-1,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},round:function(){return this.setTo(Math.round(this.x),Math.round(this.y))},toString:function(){return'[{Point (x='+this.x+' y='+this.y+')}]'}};N.Point.prototype.constructor=N.Point;N.Point.add=function(a,b,c){if(c===undefined){c=new N.Point()}c.x=a.x+b.x;c.y=a.y+b.y;return c};N.Point.subtract=function(a,b,c){if(c===undefined){c=new N.Point()}c.x=a.x-b.x;c.y=a.y-b.y;return c};N.Point.multiply=function(a,b,c){if(c===undefined){c=new N.Point()}c.x=a.x*b.x;c.y=a.y*b.y;return c};N.Point.divide=function(a,b,c){if(c===undefined){c=new N.Point()}c.x=a.x/b.x;c.y=a.y/b.y;return c};N.Point.equals=function(a,b){return a.x===b.x&&a.y===b.y};N.Point.equalsXY=function(a,x,y){return a.x===x&&a.y===y};N.Point.fuzzyEquals=function(a,b,c){return N.Math.fuzzyEqual(a.x,b.x,c)&&N.Math.fuzzyEqual(a.y,b.y,c)};N.Point.fuzzyEqualsXY=function(a,x,y,b){return N.Math.fuzzyEqual(a.x,x,b)&&N.Math.fuzzyEqual(a.y,y,b)};N.Point.angle=function(a,b){return Math.atan2(a.y-b.y,a.x-b.x)};N.Point.negative=function(a,b){if(b===undefined){b=new N.Point()}return b.setTo(-a.x,-a.y)};N.Point.multiplyAdd=function(a,b,s,c){if(c===undefined){c=new N.Point()}return c.setTo(a.x+b.x*s,a.y+b.y*s)};N.Point.interpolate=function(a,b,f,c){if(c===undefined){c=new N.Point()}return c.setTo(a.x+(b.x-a.x)*f,a.y+(b.y-a.y)*f)};N.Point.perp=function(a,b){if(b===undefined){b=new N.Point()}return b.setTo(-a.y,a.x)};N.Point.rperp=function(a,b){if(b===undefined){b=new N.Point()}return b.setTo(a.y,-a.x)};N.Point.distance=function(a,b,c){var d=N.Math.distance(a.x,a.y,b.x,b.y);return c?Math.round(d):d};N.Point.project=function(a,b,c){if(c===undefined){c=new N.Point()}var d=a.dot(b)/b.getMagnitudeSq();if(d!==0){c.setTo(d*b.x,d*b.y)}return c};N.Point.projectUnit=function(a,b,c){if(c===undefined){c=new N.Point()}var d=a.dot(b);if(d!==0){c.setTo(d*b.x,d*b.y)}return c};N.Point.normalRightHand=function(a,b){if(b===undefined){b=new N.Point()}return b.setTo(a.y*-1,a.x)};N.Point.normalize=function(a,b){if(b===undefined){b=new N.Point()}var m=a.getMagnitude();if(m!==0){b.setTo(a.x/m,a.y/m)}return b};N.Point.rotate=function(a,x,y,b,d,e){if(d){b=N.Math.degToRad(b)}if(e===undefined){a.subtract(x,y);var s=Math.sin(b);var c=Math.cos(b);var f=c*a.x-s*a.y;var g=s*a.x+c*a.y;a.x=f+x;a.y=g+y}else{var t=b+Math.atan2(a.y-y,a.x-x);a.x=x+e*Math.cos(t);a.y=y+e*Math.sin(t)}return a};N.Point.centroid=function(a,b){if(b===undefined){b=new N.Point()}if(Object.prototype.toString.call(a)!=='[object Array]'){throw new Error('Phaser.Point. Parameter \'points\' must be an array');}var c=a.length;if(c<1){throw new Error('Phaser.Point. Parameter \'points\' array must not be empty');}if(c===1){b.copyFrom(a[0]);return b}for(var i=0;i<c;i++){N.Point.add(b,a[i],b)}b.divide(c,c);return b};N.Point.parse=function(a,b,c){b=b||'x';c=c||'y';var d=new N.Point();if(a[b]){d.x=parseFloat(a[b])}if(a[c]){d.y=parseFloat(a[c])}return d};N.Point.trunc=function(a){a.x=N.Math.trunc(a.x);a.y=N.Math.trunc(a.y);return a};N.Point.isPoint=function(a){return(a!=null)&&(typeof a.x==='number')&&(typeof a.y==='number')};N.Point.set=function(a,x,y){a.x=x||0;a.y=y||((y!==0)?a.x:0);return a};N.Point.sortClockwise=function(f,g){if(!g){g=this.centroid(f)}var h=g.x;var i=g.y;var j=function(a,b){if(a.x-h>=0&&b.x-h<0){return-1}if(a.x-h<0&&b.x-h>=0){return 1}if(a.x-h===0&&b.x-h===0){if(a.y-i>=0||b.y-i>=0){return(a.y>b.y)?1:-1}return(b.y>a.y)?1:-1}var c=(a.x-h)*-(b.y-i)-(b.x-h)*-(a.y-i);if(c<0){return-1}if(c>0){return 1}var d=(a.x-h)*(a.x-h)+(a.y-i)*(a.y-i);var e=(b.x-h)*(b.x-h)+(b.y-i)*(b.y-i);return(d>e)?-1:1};return f.sort(j)};PIXI.Point=N.Point;N.Polygon=function(){this.area=0;this._points=[];if(arguments.length>0){this.setTo.apply(this,arguments)}this.closed=true;this.flattened=false;this.type=N.POLYGON};N.Polygon.prototype={toNumberArray:function(a){if(a===undefined){a=[]}for(var i=0;i<this._points.length;i++){if(typeof this._points[i]==='number'){a.push(this._points[i]);a.push(this._points[i+1]);i++}else{a.push(this._points[i].x);a.push(this._points[i].y)}}return a},flatten:function(){this._points=this.toNumberArray();this.flattened=true;return this},clone:function(a){var b=this._points.slice();if(a===undefined||a===null){a=new N.Polygon(b)}else{a.setTo(b)}return a},contains:function(x,y){var a=false;if(this.flattened){for(var i=-2,j=this._points.length-2;(i+=2)<this._points.length;j=i){var b=this._points[i];var c=this._points[i+1];var d=this._points[j];var e=this._points[j+1];if(((c<=y&&y<e)||(e<=y&&y<c))&&(x<(d-b)*(y-c)/(e-c)+b)){a=!a}}}else{for(var i=-1,j=this._points.length-1;++i<this._points.length;j=i){var b=this._points[i].x;var c=this._points[i].y;var d=this._points[j].x;var e=this._points[j].y;if(((c<=y&&y<e)||(e<=y&&y<c))&&(x<(d-b)*(y-c)/(e-c)+b)){a=!a}}}return a},setTo:function(a){this.area=0;this._points=[];if(arguments.length>0){if(!Array.isArray(a)){a=Array.prototype.slice.call(arguments)}var b=Number.MAX_VALUE;for(var i=0,len=a.length;i<len;i++){if(typeof a[i]==='number'){var p=new PIXI.Point(a[i],a[i+1]);i++}else if(Array.isArray(a[i])){var p=new PIXI.Point(a[i][0],a[i][1])}else{var p=new PIXI.Point(a[i].x,a[i].y)}this._points.push(p);if(p.y<b){b=p.y}}this.calculateArea(b)}return this},calculateArea:function(a){var b;var c;var d;var e;for(var i=0,len=this._points.length;i<len;i++){b=this._points[i];if(i===len-1){c=this._points[0]}else{c=this._points[i+1]}d=((b.y-a)+(c.y-a))/2;e=b.x-c.x;this.area+=d*e}return this.area}};N.Polygon.prototype.constructor=N.Polygon;Object.defineProperty(N.Polygon.prototype,'points',{get:function(){return this._points}});PIXI.Polygon=N.Polygon;N.Rectangle=function(x,y,a,b){x=x||0;y=y||0;a=a||0;b=b||0;this.x=x;this.y=y;this.width=a;this.height=b;this.type=N.RECTANGLE};N.Rectangle.prototype={offset:function(a,b){this.x+=a;this.y+=b;return this},offsetPoint:function(a){return this.offset(a.x,a.y)},setTo:function(x,y,a,b){this.x=x;this.y=y;this.width=a;this.height=b;return this},scale:function(x,y){if(y===undefined){y=x}this.width*=x;this.height*=y;return this},centerOn:function(x,y){this.centerX=x;this.centerY=y;return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y)},ceilAll:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height)},copyFrom:function(a){return this.setTo(a.x,a.y,a.width,a.height)},copyFromBounds:function(a){return this.setTo(a.left,a.top,a.width,a.height)},copyTo:function(a){a.x=this.x;a.y=this.y;a.width=this.width;a.height=this.height;return a},inflate:function(a,b){return N.Rectangle.inflate(this,a,b)},size:function(a){return N.Rectangle.size(this,a)},resize:function(a,b){this.width=a;this.height=b;return this},clone:function(a){return N.Rectangle.clone(this,a)},contains:function(x,y){return N.Rectangle.contains(this,x,y)},containsRect:function(b){return N.Rectangle.containsRect(b,this)},equals:function(b){return N.Rectangle.equals(this,b)},intersection:function(b,a){return N.Rectangle.intersection(this,b,a)},intersects:function(b){return N.Rectangle.intersects(this,b)},intersectsRaw:function(a,b,c,d,e){return N.Rectangle.intersectsRaw(this,a,b,c,d,e)},union:function(b,a){return N.Rectangle.union(this,b,a)},random:function(a){if(a===undefined){a=new N.Point()}a.x=this.randomX;a.y=this.randomY;return a},getPoint:function(a,b){if(b===undefined){b=new N.Point()}switch(a){default:case N.TOP_LEFT:return b.set(this.x,this.y);case N.TOP_CENTER:return b.set(this.centerX,this.y);case N.TOP_RIGHT:return b.set(this.right,this.y);case N.LEFT_CENTER:return b.set(this.x,this.centerY);case N.CENTER:return b.set(this.centerX,this.centerY);case N.RIGHT_CENTER:return b.set(this.right,this.centerY);case N.BOTTOM_LEFT:return b.set(this.x,this.bottom);case N.BOTTOM_CENTER:return b.set(this.centerX,this.bottom);case N.BOTTOM_RIGHT:return b.set(this.right,this.bottom)}},sides:function(a,b,c,d){if(!arguments.length){a=new N.Line();b=new N.Line();c=new N.Line();d=new N.Line()}var e=this.x;var f=this.y;var g=this.right;var h=this.bottom;a.setTo(e,f,g,f);b.setTo(g,f,g,h);c.setTo(e,h,g,h);d.setTo(e,f,e,h);if(!arguments.length){return[a,b,c,d]}return null},toString:function(){return'[{Rectangle (x='+this.x+' y='+this.y+' width='+this.width+' height='+this.height+' empty='+this.empty+')}]'}};Object.defineProperty(N.Rectangle.prototype,'halfWidth',{get:function(){return Math.round(this.width/2)}});Object.defineProperty(N.Rectangle.prototype,'halfHeight',{get:function(){return Math.round(this.height/2)}});Object.defineProperty(N.Rectangle.prototype,'bottom',{get:function(){return this.y+this.height},set:function(a){if(a<=this.y){this.height=0}else{this.height=a-this.y}}});Object.defineProperty(N.Rectangle.prototype,'bottomLeft',{get:function(){return new N.Point(this.x,this.bottom)},set:function(a){this.x=a.x;this.bottom=a.y}});Object.defineProperty(N.Rectangle.prototype,'bottomRight',{get:function(){return new N.Point(this.right,this.bottom)},set:function(a){this.right=a.x;this.bottom=a.y}});Object.defineProperty(N.Rectangle.prototype,'left',{get:function(){return this.x},set:function(a){if(a>=this.right){this.width=0}else{this.width=this.right-a}this.x=a}});Object.defineProperty(N.Rectangle.prototype,'right',{get:function(){return this.x+this.width},set:function(a){if(a<=this.x){this.width=0}else{this.width=a-this.x}}});Object.defineProperty(N.Rectangle.prototype,'volume',{get:function(){return this.width*this.height}});Object.defineProperty(N.Rectangle.prototype,'perimeter',{get:function(){return(this.width*2)+(this.height*2)}});Object.defineProperty(N.Rectangle.prototype,'centerX',{get:function(){return this.x+this.halfWidth},set:function(a){this.x=a-this.halfWidth}});Object.defineProperty(N.Rectangle.prototype,'centerY',{get:function(){return this.y+this.halfHeight},set:function(a){this.y=a-this.halfHeight}});Object.defineProperty(N.Rectangle.prototype,'randomX',{get:function(){return this.x+(Math.random()*this.width)}});Object.defineProperty(N.Rectangle.prototype,'randomY',{get:function(){return this.y+(Math.random()*this.height)}});Object.defineProperty(N.Rectangle.prototype,'top',{get:function(){return this.y},set:function(a){if(a>=this.bottom){this.height=0;this.y=a}else{this.height=(this.bottom-a)}}});Object.defineProperty(N.Rectangle.prototype,'topLeft',{get:function(){return new N.Point(this.x,this.y)},set:function(a){this.x=a.x;this.y=a.y}});Object.defineProperty(N.Rectangle.prototype,'topRight',{get:function(){return new N.Point(this.x+this.width,this.y)},set:function(a){this.right=a.x;this.y=a.y}});Object.defineProperty(N.Rectangle.prototype,'empty',{get:function(){return(!this.width||!this.height)},set:function(a){if(a===true){this.setTo(0,0,0,0)}}});N.Rectangle.prototype.constructor=N.Rectangle;N.Rectangle.inflate=function(a,b,c){a.x-=b;a.width+=2*b;a.y-=c;a.height+=2*c;return a};N.Rectangle.inflatePoint=function(a,b){return N.Rectangle.inflate(a,b.x,b.y)};N.Rectangle.size=function(a,b){if(b===undefined||b===null){b=new N.Point(a.width,a.height)}else{b.setTo(a.width,a.height)}return b};N.Rectangle.clone=function(a,b){if(b===undefined||b===null){b=new N.Rectangle(a.x,a.y,a.width,a.height)}else{b.setTo(a.x,a.y,a.width,a.height)}return b};N.Rectangle.createFromBounds=function(a,b){if(b===undefined||b===null){b=new N.Rectangle(a.x,a.y,a.width,a.height)}return b.copyFromBounds(a)};N.Rectangle.contains=function(a,x,y){if(a.width<=0||a.height<=0){return false}return(x>=a.x&&x<a.right&&y>=a.y&&y<a.bottom)};N.Rectangle.containsRaw=function(a,b,c,d,x,y){return(x>=a&&x<(a+c)&&y>=b&&y<(b+d))};N.Rectangle.containsPoint=function(a,b){return N.Rectangle.contains(a,b.x,b.y)};N.Rectangle.containsRect=function(a,b){if(a.volume>b.volume){return false}return(a.x>=b.x&&a.y>=b.y&&a.right<b.right&&a.bottom<b.bottom)};N.Rectangle.equals=function(a,b){return(a.x===b.x&&a.y===b.y&&a.width===b.width&&a.height===b.height)};N.Rectangle.sameDimensions=function(a,b){return(a.width===b.width&&a.height===b.height)};N.Rectangle.intersection=function(a,b,c){if(c===undefined){c=new N.Rectangle()}if(N.Rectangle.intersects(a,b)){c.x=Math.max(a.x,b.x);c.y=Math.max(a.y,b.y);c.width=Math.min(a.right,b.right)-c.x;c.height=Math.min(a.bottom,b.bottom)-c.y}return c};N.Rectangle.intersects=function(a,b){if(a.width<=0||a.height<=0||b.width<=0||b.height<=0){return false}return!(a.right<b.x||a.bottom<b.y||a.x>b.right||a.y>b.bottom)};N.Rectangle.intersectsRaw=function(a,b,c,d,e,f){if(f===undefined){f=0}return!(b>a.right+f||c<a.left-f||d>a.bottom+f||e<a.top-f)};N.Rectangle.union=function(a,b,c){if(c===undefined){c=new N.Rectangle()}return c.setTo(Math.min(a.x,b.x),Math.min(a.y,b.y),Math.max(a.right,b.right)-Math.min(a.left,b.left),Math.max(a.bottom,b.bottom)-Math.min(a.top,b.top))};N.Rectangle.aabb=function(b,c){if(c===undefined){c=new N.Rectangle()}var d=Number.NEGATIVE_INFINITY,xMin=Number.POSITIVE_INFINITY,yMax=Number.NEGATIVE_INFINITY,yMin=Number.POSITIVE_INFINITY;b.forEach(function(a){if(a.x>d){d=a.x}if(a.x<xMin){xMin=a.x}if(a.y>yMax){yMax=a.y}if(a.y<yMin){yMin=a.y}});c.setTo(xMin,yMin,d-xMin,yMax-yMin);return c};PIXI.Rectangle=N.Rectangle;N.EmptyRectangle=new N.Rectangle(0,0,0,0);N.RoundedRectangle=function(x,y,a,b,c){if(x===undefined){x=0}if(y===undefined){y=0}if(a===undefined){a=0}if(b===undefined){b=0}if(c===undefined){c=20}this.x=x;this.y=y;this.width=a;this.height=b;this.radius=c||20;this.type=N.ROUNDEDRECTANGLE};N.RoundedRectangle.prototype={clone:function(){return new N.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(x,y){if(this.width<=0||this.height<=0){return false}var a=this.x;if(x>=a&&x<=a+this.width){var b=this.y;if(y>=b&&y<=b+this.height){return true}}return false}};N.RoundedRectangle.prototype.constructor=N.RoundedRectangle;PIXI.RoundedRectangle=N.RoundedRectangle;N.Camera=function(a,b,x,y,c,d){this.game=a;this.world=a.world;this.id=0;this.view=new N.Rectangle(x,y,c,d);this.bounds=new N.Rectangle(x,y,c,d);this.deadzone=null;this.visible=true;this.roundPx=true;this.atLimit={x:false,y:false};this.target=null;this.displayObject=null;this.scale=null;this.totalInView=0;this.lerp=new N.Point(1,1);this.onShakeComplete=new N.Signal();this.onFlashComplete=new N.Signal();this.onFadeComplete=new N.Signal();this.fx=null;this._targetPosition=new N.Point();this._edge=0;this._position=new N.Point();this._shake={intensity:0,duration:0,horizontal:false,vertical:false,shakeBounds:true,x:0,y:0};this._fxDuration=0;this._fxType=0;this._fixedView=new N.Rectangle()};N.Camera.FOLLOW_LOCKON=0;N.Camera.FOLLOW_PLATFORMER=1;N.Camera.FOLLOW_TOPDOWN=2;N.Camera.FOLLOW_TOPDOWN_TIGHT=3;N.Camera.SHAKE_BOTH=4;N.Camera.SHAKE_HORIZONTAL=5;N.Camera.SHAKE_VERTICAL=6;N.Camera.ENABLE_FX=true;N.Camera.FLASH=0;N.Camera.FADE_OUT=1;N.Camera.FADE_IN=2;N.Camera.prototype={boot:function(){this.displayObject=this.game.world;this.scale=this.game.world.scale;this.game.camera=this;if(N.Graphics&&N.Camera.ENABLE_FX){this.fx=new N.Graphics(this.game);this.game.stage.addChild(this.fx)}},preUpdate:function(){this.totalInView=0},follow:function(a,b,c,d){if(b===undefined){b=N.Camera.FOLLOW_LOCKON}if(c===undefined){c=1}if(d===undefined){d=1}this.target=a;this.lerp.set(c,d);var e;switch(b){case N.Camera.FOLLOW_PLATFORMER:var w=this.width/8;var h=this.height/3;this.deadzone=new N.Rectangle((this.width-w)/2,(this.height-h)/2-h*0.25,w,h);break;case N.Camera.FOLLOW_TOPDOWN:e=Math.max(this.width,this.height)/4;this.deadzone=new N.Rectangle((this.width-e)/2,(this.height-e)/2,e,e);break;case N.Camera.FOLLOW_TOPDOWN_TIGHT:e=Math.max(this.width,this.height)/8;this.deadzone=new N.Rectangle((this.width-e)/2,(this.height-e)/2,e,e);break;case N.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null;break}},unfollow:function(){this.target=null},focusOn:function(a){this.setPosition(Math.round(a.x-this.view.halfWidth),Math.round(a.y-this.view.halfHeight))},focusOnXY:function(x,y){this.setPosition(Math.round(x-this.view.halfWidth),Math.round(y-this.view.halfHeight))},shake:function(a,b,c,d,e){if(a===undefined){a=0.05}if(b===undefined){b=500}if(c===undefined){c=true}if(d===undefined){d=N.Camera.SHAKE_BOTH}if(e===undefined){e=true}if(!c&&this._shake.duration>0){return false}this._shake.intensity=a;this._shake.duration=b;this._shake.shakeBounds=e;this._shake.x=0;this._shake.y=0;this._shake.horizontal=(d===N.Camera.SHAKE_BOTH||d===N.Camera.SHAKE_HORIZONTAL);this._shake.vertical=(d===N.Camera.SHAKE_BOTH||d===N.Camera.SHAKE_VERTICAL);return true},flash:function(a,b,c,d){if(a===undefined){a=0xffffff}if(b===undefined){b=500}if(c===undefined){c=false}if(d===undefined){d=1}if(!this.fx||(!c&&this._fxDuration>0)){return false}this.fx.clear();this.fx.beginFill(a,d);this.fx.drawRect(0,0,this.width,this.height);this.fx.endFill();this.fx.alpha=1;this._fxDuration=b;this._fxType=0;return true},fade:function(a,b,c,d){return this.fadeEffect(a,b,c,d,N.Camera.FADE_OUT)},fadeIn:function(a,b,c,d){return this.fadeEffect(a,b,c,d,N.Camera.FADE_IN)},fadeEffect:function(a,b,c,d,e){if(a===undefined){a=0x000000}if(b===undefined){b=500}if(c===undefined){c=false}if(d===undefined){d=1}if(!this.fx||(!c&&this._fxDuration>0)){return false}this.fx.clear();this.fx.beginFill(a,d);this.fx.drawRect(0,0,this.width,this.height);this.fx.endFill();if(e<1||e>2){throw new Error('Wrong `type` argument');}this.fx.alpha=(e===N.Camera.FADE_IN)?1:0;this._fxDuration=b;this._fxType=e;return true},update:function(){if(this._fxDuration>0){this.updateFX()}if(this._shake.duration>0){this.updateShake()}if(this.bounds){this.checkBounds()}if(this.roundPx){this.view.floor();this._shake.x=Math.floor(this._shake.x);this._shake.y=Math.floor(this._shake.y)}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateFX:function(){if(this._fxType===N.Camera.FLASH){this.fx.alpha-=this.game.time.delta/this._fxDuration;if(this.fx.alpha<=0){this._fxDuration=0;this.fx.alpha=0;this.onFlashComplete.dispatch()}}else if(this._fxType===N.Camera.FADE_IN){this.fx.alpha-=this.game.time.delta/this._fxDuration;if(this.fx.alpha<=0){this._fxDuration=0;this.fx.alpha=0;this.onFadeComplete.dispatch()}}else{this.fx.alpha+=this.game.time.delta/this._fxDuration;if(this.fx.alpha>=1){this._fxDuration=0;this.fx.alpha=1;this.onFadeComplete.dispatch()}}},updateShake:function(){this._shake.duration-=this.game.time.delta;if(this._shake.duration<=0){this.onShakeComplete.dispatch();this._shake.x=0;this._shake.y=0}else{if(this._shake.horizontal){this._shake.x=this.game.rnd.frac()*this._shake.intensity*this.view.width*2-this._shake.intensity*this.view.width}if(this._shake.vertical){this._shake.y=this.game.rnd.frac()*this._shake.intensity*this.view.height*2-this._shake.intensity*this.view.height}}},updateTarget:function(){this._targetPosition.x=this.view.x+this.target.worldPosition.x;this._targetPosition.y=this.view.y+this.target.worldPosition.y;if(this.deadzone){this._edge=this._targetPosition.x-this.view.x;if(this._edge<this.deadzone.left){this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.left,this.lerp.x)}else if(this._edge>this.deadzone.right){this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.right,this.lerp.x)}this._edge=this._targetPosition.y-this.view.y;if(this._edge<this.deadzone.top){this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.top,this.lerp.y)}else if(this._edge>this.deadzone.bottom){this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.bottom,this.lerp.y)}}else{this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.view.halfWidth,this.lerp.x);this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.view.halfHeight,this.lerp.y)}if(this.bounds){this.checkBounds()}if(this.roundPx){this.view.floor()}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},setBoundsToWorld:function(){if(this.bounds){this.bounds.copyFrom(this.game.world.bounds)}},checkBounds:function(){this.atLimit.x=false;this.atLimit.y=false;var a=this.view.x+this._shake.x;var b=this.view.right+this._shake.x;var c=this.view.y+this._shake.y;var d=this.view.bottom+this._shake.y;if(a<=this.bounds.x*this.scale.x){this.atLimit.x=true;this.view.x=this.bounds.x*this.scale.x;if(!this._shake.shakeBounds){this._shake.x=0}}else if(b>=this.bounds.right*this.scale.x){this.atLimit.x=true;this.view.x=(this.bounds.right*this.scale.x)-this.width;if(!this._shake.shakeBounds){this._shake.x=0}}if(c<=this.bounds.top*this.scale.y){this.atLimit.y=true;this.view.y=this.bounds.top*this.scale.y;if(!this._shake.shakeBounds){this._shake.y=0}}else if(d>=this.bounds.bottom*this.scale.y){this.atLimit.y=true;this.view.y=(this.bounds.bottom*this.scale.y)-this.height;if(!this._shake.shakeBounds){this._shake.y=0}}},setPosition:function(x,y){this.view.x=x;this.view.y=y;if(this.bounds){this.checkBounds()}},setSize:function(a,b){this.view.width=a;this.view.height=b},reset:function(){this.target=null;this.view.x=0;this.view.y=0;this._shake.duration=0;this._shake.x=0;this._shake.y=0;this.resetFX()},resetFX:function(){if(this.fx){this.fx.clear();this.fx.alpha=0}this._fxDuration=0}};N.Camera.prototype.constructor=N.Camera;Object.defineProperty(N.Camera.prototype,'x',{get:function(){return this.view.x},set:function(a){this.view.x=a;if(this.bounds){this.checkBounds()}}});Object.defineProperty(N.Camera.prototype,'y',{get:function(){return this.view.y},set:function(a){this.view.y=a;if(this.bounds){this.checkBounds()}}});Object.defineProperty(N.Camera.prototype,'position',{get:function(){this._position.set(this.view.x,this.view.y);return this._position},set:function(a){if(typeof a.x!=='undefined'){this.view.x=a.x}if(typeof a.y!=='undefined'){this.view.y=a.y}if(this.bounds){this.checkBounds()}}});Object.defineProperty(N.Camera.prototype,'width',{get:function(){return this.view.width},set:function(a){this.view.width=a}});Object.defineProperty(N.Camera.prototype,'height',{get:function(){return this.view.height},set:function(a){this.view.height=a}});Object.defineProperty(N.Camera.prototype,'shakeIntensity',{get:function(){return this._shake.intensity},set:function(a){this._shake.intensity=a}});Object.defineProperty(N.Camera.prototype,'fixedView',{get:function(){this._fixedView.setTo(0,0,this.view.width,this.view.height);return this._fixedView}});Object.defineProperty(N.Camera.prototype,'centerX',{get:function(){return(this.x+(0.5*this.width))}});Object.defineProperty(N.Camera.prototype,'centerY',{get:function(){return(this.y+(0.5*this.height))}});N.State=function(){this.game=null;this.key='';this.add=null;this.make=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.scale=null;this.stage=null;this.state=null;this.time=null;this.tweens=null;this.world=null;this.particles=null;this.physics=null;this.rnd=null};N.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},postUpdate:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}};N.State.prototype.constructor=N.State;N.StateManager=function(a,b){this.game=a;this.states={};this._pendingState=null;if(typeof b!=='undefined'&&b!==null){this._pendingState=b}this._clearWorld=false;this._clearCache=false;this._created=false;this._args=[];this.current='';this.onStateChange=new N.Signal();this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.onShutDownCallback=null};N.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);if(this._pendingState!==null&&typeof this._pendingState!=='string'){this.add('default',this._pendingState,true)}},add:function(a,b,c){if(c===undefined){c=false}var d;if(b instanceof N.State){d=b}else if(typeof b==='object'){d=b;d.game=this.game}else if(typeof b==='function'){d=new b(this.game)}this.states[a]=d;if(c){if(this.game.isBooted){this.start(a)}else{this._pendingState=a}}return d},remove:function(a){if(this.current===a){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onPreRenderCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null}delete this.states[a]},start:function(a,b,c){if(b===undefined){b=true}if(c===undefined){c=false}if(this.checkState(a)){this._pendingState=a;this._clearWorld=b;this._clearCache=c;if(arguments.length>3){this._args=Array.prototype.splice.call(arguments,3)}}},restart:function(a,b){if(a===undefined){a=true}if(b===undefined){b=false}this._pendingState=this.current;this._clearWorld=a;this._clearCache=b;if(arguments.length>2){this._args=Array.prototype.slice.call(arguments,2)}},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){this.clearCurrentState();this.setCurrentState(this._pendingState);if(this.current!==this._pendingState){return}else{this._pendingState=null}if(this.onPreloadCallback){this.game.load.reset(true);this.onPreloadCallback.call(this.callbackContext,this.game);if(this.game.load.totalQueuedFiles()===0&&this.game.load.totalQueuedPacks()===0){this.loadComplete()}else{this.game.load.start()}}else{this.loadComplete()}}},clearCurrentState:function(){if(this.current){if(this.onShutDownCallback){this.onShutDownCallback.call(this.callbackContext,this.game)}this.game.tweens.removeAll();this.game.camera.reset();this.game.input.reset(true);this.game.physics.clear();this.game.time.removeAll();this.game.scale.reset(this._clearWorld);if(this.game.debug){this.game.debug.reset()}if(this._clearWorld){this.game.world.shutdown();if(this._clearCache){this.game.cache.destroy()}}}},checkState:function(a){var b=this.states[a];if(b){if(b.preload||b.create||b.update||b.render){return true}else{console.warn('Invalid Phaser State object given. Must contain at least one of the required functions: preload, create, update or render');return false}}else{console.warn('Phaser.StateManager - No state found with the key: '+a);return false}},link:function(a){var b=this.states[a];b.game=this.game;b.add=this.game.add;b.make=this.game.make;b.camera=this.game.camera;b.cache=this.game.cache;b.input=this.game.input;b.load=this.game.load;b.math=this.game.math;b.sound=this.game.sound;b.scale=this.game.scale;b.state=this;b.stage=this.game.stage;b.time=this.game.time;b.tweens=this.game.tweens;b.world=this.game.world;b.particles=this.game.particles;b.rnd=this.game.rnd;b.physics=this.game.physics;b.key=a},unlink:function(a){var b=this.states[a];if(b){b.game=null;b.add=null;b.make=null;b.camera=null;b.cache=null;b.input=null;b.load=null;b.math=null;b.sound=null;b.scale=null;b.state=null;b.stage=null;b.time=null;b.tweens=null;b.world=null;b.particles=null;b.rnd=null;b.physics=null}},setCurrentState:function(a){var b=this.current;var c=this.states[a];this.callbackContext=c;this.link(a);this.onInitCallback=c.init||this.dummy;this.onPreloadCallback=c.preload||null;this.onLoadRenderCallback=c.loadRender||null;this.onLoadUpdateCallback=c.loadUpdate||null;this.onCreateCallback=c.create||null;this.onUpdateCallback=c.update||null;this.onPostUpdateCallback=c.postUpdate||null;this.onPreRenderCallback=c.preRender||null;this.onRenderCallback=c.render||null;this.onResizeCallback=c.resize||null;this.onPausedCallback=c.paused||null;this.onResumedCallback=c.resumed||null;this.onPauseUpdateCallback=c.pauseUpdate||null;this.onShutDownCallback=c.shutdown||this.dummy;if(this.current!==''){this.game.physics.reset()}this.current=a;this._created=false;this.onStateChange.dispatch(this.current,b);this.onInitCallback.apply(this.callbackContext,this._args);if(a===this._pendingState){this._args=[]}this.game._kickstart=true},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){if(this._created===false&&this.onCreateCallback){this._created=true;this.onCreateCallback.call(this.callbackContext,this.game)}else{this._created=true}},loadUpdate:function(){if(this._created===false&&this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}},pause:function(){if(this._created&&this.onPausedCallback){this.onPausedCallback.call(this.callbackContext,this.game)}},resume:function(){if(this._created&&this.onResumedCallback){this.onResumedCallback.call(this.callbackContext,this.game)}},update:function(){if(this._created){if(this.onUpdateCallback){this.onUpdateCallback.call(this.callbackContext,this.game)}}else if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}},postUpdate:function(){if(this._created&&this.onPostUpdateCallback){this.onPostUpdateCallback.call(this.callbackContext,this.game)}},pauseUpdate:function(){if(this._created){if(this.onPauseUpdateCallback){this.onPauseUpdateCallback.call(this.callbackContext,this.game)}}else if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}},preRender:function(){if(this._created&&this.onPreRenderCallback){this.onPreRenderCallback.call(this.callbackContext,this.game)}},resize:function(a,b){if(this.onResizeCallback){this.onResizeCallback.call(this.callbackContext,a,b)}},render:function(){if(this._created){if(this.onRenderCallback){if(this.game.renderType===N.CANVAS){this.game.context.save();this.game.context.setTransform(1,0,0,1,0,0);this.onRenderCallback.call(this.callbackContext,this.game);this.game.context.restore()}else{this.onRenderCallback.call(this.callbackContext,this.game)}}}else if(this.onLoadRenderCallback){this.onLoadRenderCallback.call(this.callbackContext,this.game)}},destroy:function(){this._clearWorld=true;this._clearCache=true;this.clearCurrentState();this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onPostUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.game=null;this.states={};this._pendingState=null;this.current=''}};N.StateManager.prototype.constructor=N.StateManager;Object.defineProperty(N.StateManager.prototype,'created',{get:function(){return this._created}});N.Signal=function(){};N.Signal.prototype={_bindings:null,_prevParams:null,memorize:false,_shouldPropagate:true,active:true,_boundDispatch:false,validateListener:function(a,b){if(typeof a!=='function'){throw new Error('Phaser.Signal: listener is a required param of {fn}() and should be a Function.'.replace('{fn}',b));}},_registerListener:function(a,b,c,d,e){var f=this._indexOfListener(a,c);var g;if(f!==-1){g=this._bindings[f];if(g.isOnce()!==b){throw new Error('You cannot add'+(b?'':'Once')+'() then add'+(!b?'':'Once')+'() the same listener without removing the relationship first.');}}else{g=new N.SignalBinding(this,a,b,c,d,e);this._addBinding(g);}if(this.memorize&&this._prevParams){g.execute(this._prevParams);}return g;},_addBinding:function(a){if(!this._bindings){this._bindings=[];}var n=this._bindings.length;do{n--;}while(this._bindings[n]&&a._priority<=this._bindings[n]._priority);this._bindings.splice(n+1,0,a);},_indexOfListener:function(a,b){if(!this._bindings){return-1;}if(b===undefined){b=null;}var n=this._bindings.length;var c;while(n--){c=this._bindings[n];if(c._listener===a&&c.context===b){return n;}}return-1;},has:function(a,b){return this._indexOfListener(a,b)!==-1;},add:function(a,b,c){this.validateListener(a,'add');var d=[];if(arguments.length>3){for(var i=3;i<arguments.length;i++){d.push(arguments[i]);}}return this._registerListener(a,false,b,c,d);},addOnce:function(a,b,c){this.validateListener(a,'addOnce');var d=[];if(arguments.length>3){for(var i=3;i<arguments.length;i++){d.push(arguments[i]);}}return this._registerListener(a,true,b,c,d);},remove:function(a,b){this.validateListener(a,'remove');var i=this._indexOfListener(a,b);if(i!==-1){this._bindings[i]._destroy();this._bindings.splice(i,1);}return a;},removeAll:function(a){if(a===undefined){a=null;}if(!this._bindings){return;}var n=this._bindings.length;while(n--){if(a){if(this._bindings[n].context===a){this._bindings[n]._destroy();this._bindings.splice(n,1);}}else{this._bindings[n]._destroy();}}if(!a){this._bindings.length=0;}},getNumListeners:function(){return this._bindings?this._bindings.length:0;},halt:function(){this._shouldPropagate=false;},dispatch:function(){if(!this.active||(!this._bindings&&!this.memorize)){return;}var a=Array.prototype.slice.call(arguments);if(this.memorize){this._prevParams=a;}var n=this._bindings?this._bindings.length:0;if(!n){return;}var b=this._bindings.slice();this._shouldPropagate=true;do{n--;}while(b[n]&&this._shouldPropagate&&b[n].execute(a)!==false);},forget:function(){if(this._prevParams){this._prevParams=null;}},dispose:function(){this.removeAll();this._bindings=null;if(this._prevParams){this._prevParams=null;}},toString:function(){return'[Phaser.Signal active:'+this.active+' numListeners:'+this.getNumListeners()+']';}};Object.defineProperty(N.Signal.prototype,'boundDispatch',{get:function(){var a=this;return this._boundDispatch||(this._boundDispatch=function(){return a.dispatch.apply(a,arguments);});}});N.Signal.prototype.constructor=N.Signal;N.SignalBinding=function(a,b,c,d,e,f){this._listener=b;if(c){this._isOnce=true;}if(d!=null){this.context=d;}this._signal=a;if(e){this._priority=e;}if(f&&f.length){this._args=f;}};N.SignalBinding.prototype={context:null,_isOnce:false,_priority:0,_args:null,callCount:0,active:true,params:null,execute:function(a){var b,params;if(this.active&&!!this._listener){params=this.params?this.params.concat(a):a;if(this._args){params=params.concat(this._args);}b=this._listener.apply(this.context,params);this.callCount++;if(this._isOnce){this.detach();}}return b;},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null;},isBound:function(){return(!!this._signal&&!!this._listener);},isOnce:function(){return this._isOnce;},getListener:function(){return this._listener;},getSignal:function(){return this._signal;},_destroy:function(){delete this._signal;delete this._listener;delete this.context;},toString:function(){return'[Phaser.SignalBinding isOnce:'+this._isOnce+', isBound:'+this.isBound()+', active:'+this.active+']';}};N.SignalBinding.prototype.constructor=N.SignalBinding;N.Filter=function(a,b,c){this.game=a;this.type=N.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.prevPoint=new N.Point();var d=new Date();this.uniforms={resolution:{type:'2f',value:{x:256,y:256}},time:{type:'1f',value:0},mouse:{type:'2f',value:{x:0.0,y:0.0}},date:{type:'4fv',value:[d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()*60*60+d.getMinutes()*60+d.getSeconds()]},sampleRate:{type:'1f',value:44100.0},iChannel0:{type:'sampler2D',value:null,textureData:{repeat:true}},iChannel1:{type:'sampler2D',value:null,textureData:{repeat:true}},iChannel2:{type:'sampler2D',value:null,textureData:{repeat:true}},iChannel3:{type:'sampler2D',value:null,textureData:{repeat:true}}};if(b){for(var e in b){this.uniforms[e]=b[e];}}if(typeof c==='string'){c=c.split('\n');}this.fragmentSrc=c||[];};N.Filter.prototype={init:function(){},setResolution:function(a,b){this.uniforms.resolution.value.x=a;this.uniforms.resolution.value.y=b;},update:function(a){if(a){var x=a.x/this.game.width;var y=1-a.y/this.game.height;if(x!==this.prevPoint.x||y!==this.prevPoint.y){this.uniforms.mouse.value.x=x.toFixed(2);this.uniforms.mouse.value.y=y.toFixed(2);this.prevPoint.set(x,y);}}this.uniforms.time.value=this.game.time.totalElapsedSeconds();},addToWorld:function(x,y,a,b,c,d){if(c===undefined){c=0;}if(d===undefined){d=0;}if(a!==undefined&&a!==null){this.width=a;}else{a=this.width;}if(b!==undefined&&b!==null){this.height=b;}else{b=this.height;}var e=this.game.add.image(x,y,N.Cache.DEFAULT);e.width=a;e.height=b;e.anchor.set(c,d);e.filters=[this];return e;},syncUniforms:function(){for(var i=0;i<this.shaders.length;i++){this.shaders[i].dirty=true;}},destroy:function(){this.passes.length=0;this.shaders.length=0;this.fragmentSrc.length=0;this.game=null;this.uniforms=null;this.prevPoint=null;}};N.Filter.prototype.constructor=N.Filter;Object.defineProperty(N.Filter.prototype,'width',{get:function(){return this.uniforms.resolution.value.x;},set:function(a){this.uniforms.resolution.value.x=a;}});Object.defineProperty(N.Filter.prototype,'height',{get:function(){return this.uniforms.resolution.value.y;},set:function(a){this.uniforms.resolution.value.y=a;}});N.Plugin=function(a,b){if(b===undefined){b=null;}this.game=a;this.parent=b;this.active=false;this.visible=false;this.hasPreUpdate=false;this.hasUpdate=false;this.hasPostUpdate=false;this.hasRender=false;this.hasPostRender=false;};N.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=false;this.visible=false;}};N.Plugin.prototype.constructor=N.Plugin;N.PluginManager=function(a){this.game=a;this.plugins=[];this._len=0;this._i=0;};N.PluginManager.prototype={add:function(a){var b=Array.prototype.slice.call(arguments,1);var c=false;if(typeof a==='function'){a=new a(this.game,this);}else{a.game=this.game;a.parent=this;}if(typeof a.preUpdate==='function'){a.hasPreUpdate=true;c=true;}if(typeof a.update==='function'){a.hasUpdate=true;c=true;}if(typeof a.postUpdate==='function'){a.hasPostUpdate=true;c=true;}if(typeof a.render==='function'){a.hasRender=true;c=true;}if(typeof a.postRender==='function'){a.hasPostRender=true;c=true;}if(c){if(a.hasPreUpdate||a.hasUpdate||a.hasPostUpdate){a.active=true;}if(a.hasRender||a.hasPostRender){a.visible=true;}this._len=this.plugins.push(a);if(typeof a.init==='function'){a.init.apply(a,b);}return a;}else{return null;}},remove:function(a,b){if(b===undefined){b=true;}this._i=this._len;while(this._i--){if(this.plugins[this._i]===a){if(b){a.destroy();}this.plugins.splice(this._i,1);this._len--;return;}}},removeAll:function(){this._i=this._len;while(this._i--){this.plugins[this._i].destroy();}this.plugins.length=0;this._len=0;},preUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate){this.plugins[this._i].preUpdate();}}},update:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasUpdate){this.plugins[this._i].update();}}},postUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate){this.plugins[this._i].postUpdate();}}},render:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasRender){this.plugins[this._i].render();}}},postRender:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender){this.plugins[this._i].postRender();}}},destroy:function(){this.removeAll();this.game=null;}};N.PluginManager.prototype.constructor=N.PluginManager;N.Stage=function(a){this.game=a;PIXI.DisplayObjectContainer.call(this);this.name='_stage_root';this.disableVisibilityChange=false;this.exists=true;this.worldTransform=new N.Matrix();this.stage=this;this.currentRenderOrderID=0;this._hiddenVar='hidden';this._onChange=null;this._bgColor={r:0,g:0,b:0,a:0,color:0,rgba:'#000000'};if(!this.game.transparent){this._bgColor.a=1;}if(a.config){this.parseConfig(a.config);}};N.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);N.Stage.prototype.constructor=N.Stage;N.Stage.prototype.parseConfig=function(a){if(a.disableVisibilityChange){this.disableVisibilityChange=a.disableVisibilityChange;}if(a.backgroundColor){this.setBackgroundColor(a.backgroundColor);}};N.Stage.prototype.boot=function(){N.DOM.getOffset(this.game.canvas,this.offset);N.Canvas.setUserSelect(this.game.canvas,'none');N.Canvas.setTouchAction(this.game.canvas,'none');this.checkVisibility();};N.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;var i=0;while(i<this.children.length){var a=this.children[i];a.preUpdate();if(this===a.parent){i++;}}};N.Stage.prototype.update=function(){var i=this.children.length;while(i--){this.children[i].update();}};N.Stage.prototype.postUpdate=function(){this.game.camera.update();if(this.game.camera.target){this.game.camera.target.postUpdate();this.updateTransform();this.game.camera.updateTarget();}for(var i=0;i<this.children.length;i++){this.children[i].postUpdate();}this.updateTransform();};N.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var i=0;i<this.children.length;i++){this.children[i].updateTransform();}};N.Stage.prototype.checkVisibility=function(){if(document.hidden!==undefined){this._hiddenVar='visibilitychange';}else if(document.webkitHidden!==undefined){this._hiddenVar='webkitvisibilitychange';}else if(document.mozHidden!==undefined){this._hiddenVar='mozvisibilitychange';}else if(document.msHidden!==undefined){this._hiddenVar='msvisibilitychange';}else{this._hiddenVar=null;}var b=this;this._onChange=function(a){return b.visibilityChange(a);};this._onChangePause=function(){return b._onChange({type:'pause'});};this._onChangeResume=function(){return b._onChange({type:'resume'});};this._onClick=function(a){if((document.hasFocus!==undefined)&&!document.hasFocus()){b.visibilityChange(a);}};if(this._hiddenVar){document.addEventListener(this._hiddenVar,this._onChange,false);}window.onblur=this._onChange;window.onfocus=this._onChange;window.onpagehide=this._onChange;window.onpageshow=this._onChange;window.addEventListener('click',this._onClick);if(this.game.device.cocoonJSApp&&CocoonJS.App){if(CocoonJS.App.onSuspended){CocoonJS.App.onSuspended.addEventListener(this._onChangePause);}if(CocoonJS.App.onActivated){CocoonJS.App.onActivated.addEventListener(this._onChangeResume);}if(CocoonJS.App.on){CocoonJS.App.on('activated',this._onChangeResume);CocoonJS.App.on('suspended',this._onChangePause);}}};N.Stage.prototype.visibilityChange=function(a){switch(a.type){case'blur':case'pagehide':this.game.focusLoss(a);return;case'click':case'focus':case'pageshow':this.game.focusGain(a);return;}if(this.disableVisibilityChange){return;}if(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||a.type==='pause'){this.game.gamePaused(a);}else{this.game.gameResumed(a);}};N.Stage.prototype.setBackgroundColor=function(a){if(this.game.transparent){return;}N.Color.valueToColor(a,this._bgColor);N.Color.updateColor(this._bgColor);this._bgColor.r/=255;this._bgColor.g/=255;this._bgColor.b/=255;this._bgColor.a=1;};N.Stage.prototype.destroy=function(){if(this._hiddenVar){document.removeEventListener(this._hiddenVar,this._onChange,false);}window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null;window.removeEventListener('click',this._onClick);};N.Stage.prototype.add=function(a,b,c){if(a.parent===this){return a;}if(a.body&&a.parent&&a.parent.hash){a.parent.removeFromHash(a);}if(c===undefined){this.addChild(a);}else{this.addChildAt(a,c);}return a;};Object.defineProperty(N.Stage.prototype,'backgroundColor',{get:function(){return this._bgColor.color;},set:function(a){this.setBackgroundColor(a);}});Object.defineProperty(N.Stage.prototype,'smoothed',{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR;},set:function(a){if(a){PIXI.scaleModes.DEFAULT=PIXI.scaleModes.LINEAR;}else{PIXI.scaleModes.DEFAULT=PIXI.scaleModes.NEAREST;}}});N.Group=function(a,b,c,d,e,f){if(d===undefined){d=false;}if(e===undefined){e=false;}if(f===undefined){f=N.Physics.ARCADE;}this.game=a;if(b===undefined){b=a.world;}this.name=c||'group';this.z=0;PIXI.DisplayObjectContainer.call(this);if(d){this.game.stage.addChild(this);this.z=this.game.stage.children.length;}else if(b){b.addChild(this);this.z=b.children.length;}this.type=N.GROUP;this.physicsType=N.GROUP;this.alive=true;this.exists=true;this.ignoreDestroy=false;this.pendingDestroy=false;this.classType=N.Sprite;this.cursor=null;this.inputEnableChildren=false;this.updateOnlyExistingChildren=false;this.onChildInputDown=new N.Signal();this.onChildInputUp=new N.Signal();this.onChildInputOver=new N.Signal();this.onChildInputOut=new N.Signal();this.enableBody=e;this.enableBodyDebug=false;this.physicsBodyType=f;this.physicsSortDirection=null;this.onDestroy=new N.Signal();this.cursorIndex=0;this.fixedToCamera=false;this.cameraOffset=new N.Point();this.hash=[];this._sortProperty='z';};N.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);N.Group.prototype.constructor=N.Group;N.Group.RETURN_NONE=0;N.Group.RETURN_TOTAL=1;N.Group.RETURN_CHILD=2;N.Group.RETURN_ALL=3;N.Group.SORT_ASCENDING=-1;N.Group.SORT_DESCENDING=1;N.Group.prototype.add=function(a,b,c){if(b===undefined){b=false;}if(a.parent===this){return a;}if(a.body&&a.parent&&a.parent.hash){a.parent.removeFromHash(a);}if(c===undefined){a.z=this.children.length;this.addChild(a);}else{this.addChildAt(a,c);this.updateZ();}if(this.enableBody&&a.hasOwnProperty('body')&&a.body===null){this.game.physics.enable(a,this.physicsBodyType);}else if(a.body){this.addToHash(a);}if(this.inputEnableChildren&&(!a.input||a.inputEnabled)){a.inputEnabled=true;}if(!b&&a.events){a.events.onAddedToGroup$dispatch(a,this);}if(this.cursor===null){this.cursor=a;}return a;};N.Group.prototype.addAt=function(a,b,c){return this.add(a,c,b);};N.Group.prototype.addToHash=function(a){if(a.parent===this){var b=this.hash.indexOf(a);if(b===-1){this.hash.push(a);return true;}}return false;};N.Group.prototype.removeFromHash=function(a){if(a){var b=this.hash.indexOf(a);if(b!==-1){this.hash.splice(b,1);return true;}}return false;};N.Group.prototype.addMultiple=function(a,b){if(a instanceof N.Group){a.moveAll(this,b);}else if(Array.isArray(a)){for(var i=0;i<a.length;i++){this.add(a[i],b);}}return a;};N.Group.prototype.getAt=function(a){if(a<0||a>=this.children.length){return-1;}else{return this.getChildAt(a);}};N.Group.prototype.create=function(x,y,a,b,c,d){if(c===undefined){c=true;}var e=new this.classType(this.game,x,y,a,b);e.exists=c;e.visible=c;e.alive=c;return this.add(e,false,d);};N.Group.prototype.createMultiple=function(d,e,f,g,h,j){if(f===undefined){f=0;}if(g===undefined){g=false;}if(!Array.isArray(e)){e=[e];}if(!Array.isArray(f)){f=[f];}var k=this;var l=[];e.forEach(function(c){f.forEach(function(a){for(var i=0;i<d;i++){var b=k.create(0,0,c,a,g);if(h){h.call(j||b,b,i);}l.push(b);}});});return l;};N.Group.prototype.updateZ=function(){var i=this.children.length;while(i--){this.children[i].z=i;}};N.Group.prototype.align=function(a,b,c,d,e,f){if(e===undefined){e=N.TOP_LEFT;}if(f===undefined){f=0;}if(this.children.length===0||f>this.children.length||(a===-1&&b===-1)){return false;}var r=new N.Rectangle(0,0,c,d);var w=(a*c);var h=(b*d);for(var i=f;i<this.children.length;i++){var g=this.children[i];if(g.alignIn){g.alignIn(r,e);}else{continue;}if(a===-1){r.y+=d;if(r.y===h){r.x+=c;r.y=0;}}else if(b===-1){r.x+=c;if(r.x===w){r.x=0;r.y+=d;}}else{r.x+=c;if(r.x===w){r.x=0;r.y+=d;if(r.y===h){return true;}}}}return true;};N.Group.prototype.resetCursor=function(a){if(a===undefined){a=0;}if(a>this.children.length-1){a=0;}if(this.cursor){this.cursorIndex=a;this.cursor=this.children[this.cursorIndex];return this.cursor;}};N.Group.prototype.next=function(){if(this.cursor){if(this.cursorIndex>=this.children.length-1){this.cursorIndex=0;}else{this.cursorIndex++;}this.cursor=this.children[this.cursorIndex];return this.cursor;}};N.Group.prototype.previous=function(){if(this.cursor){if(this.cursorIndex===0){this.cursorIndex=this.children.length-1;}else{this.cursorIndex--;}this.cursor=this.children[this.cursorIndex];return this.cursor;}};N.Group.prototype.swap=function(a,b){this.swapChildren(a,b);this.updateZ();};N.Group.prototype.bringToTop=function(a){if(a.parent===this&&this.getIndex(a)<this.children.length){this.remove(a,false,true);this.add(a,true);}return a;};N.Group.prototype.bringChildToTop=N.Group.prototype.bringToTop;N.Group.prototype.sendToBack=function(a){if(a.parent===this&&this.getIndex(a)>0){this.remove(a,false,true);this.addAt(a,0,true);}return a;};N.Group.prototype.sendChildToBack=N.Group.prototype.sendToBack;N.Group.prototype.moveUp=function(c){if(c.parent===this&&this.getIndex(c)<this.children.length-1){var a=this.getIndex(c);var b=this.getAt(a+1);if(b){this.swap(c,b);}}return c;};N.Group.prototype.moveDown=function(c){if(c.parent===this&&this.getIndex(c)>0){var a=this.getIndex(c);var b=this.getAt(a-1);if(b){this.swap(c,b);}}return c;};N.Group.prototype.xy=function(a,x,y){if(a<0||a>this.children.length){return-1;}else{this.getChildAt(a).x=x;this.getChildAt(a).y=y;}};N.Group.prototype.reverse=function(){this.children.reverse();this.updateZ();};N.Group.prototype.getIndex=function(a){return this.children.indexOf(a);};N.Group.prototype.getByName=function(a){return this.getFirst('name',a);};N.Group.prototype.replace=function(a,b){var c=this.getIndex(a);if(c!==-1){if(b.parent){if(b.parent instanceof N.Group){b.parent.remove(b);}else{b.parent.removeChild(b);}}this.remove(a);this.addAt(b,c);return a;}};N.Group.prototype.hasProperty=function(a,b){var c=b.length;if(c===1&&b[0]in a){return true;}else if(c===2&&b[0]in a&&b[1]in a[b[0]]){return true;}else if(c===3&&b[0]in a&&b[1]in a[b[0]]&&b[2]in a[b[0]][b[1]]){return true;}else if(c===4&&b[0]in a&&b[1]in a[b[0]]&&b[2]in a[b[0]][b[1]]&&b[3]in a[b[0]][b[1]][b[2]]){return true;}return false;};N.Group.prototype.setProperty=function(a,b,c,d,e){if(e===undefined){e=false;}d=d||0;if(!this.hasProperty(a,b)&&(!e||d>0)){return false;}var f=b.length;if(f===1){if(d===0){a[b[0]]=c;}else if(d===1){a[b[0]]+=c;}else if(d===2){a[b[0]]-=c;}else if(d===3){a[b[0]]*=c;}else if(d===4){a[b[0]]/=c;}}else if(f===2){if(d===0){a[b[0]][b[1]]=c;}else if(d===1){a[b[0]][b[1]]+=c;}else if(d===2){a[b[0]][b[1]]-=c;}else if(d===3){a[b[0]][b[1]]*=c;}else if(d===4){a[b[0]][b[1]]/=c;}}else if(f===3){if(d===0){a[b[0]][b[1]][b[2]]=c;}else if(d===1){a[b[0]][b[1]][b[2]]+=c;}else if(d===2){a[b[0]][b[1]][b[2]]-=c;}else if(d===3){a[b[0]][b[1]][b[2]]*=c;}else if(d===4){a[b[0]][b[1]][b[2]]/=c;}}else if(f===4){if(d===0){a[b[0]][b[1]][b[2]][b[3]]=c;}else if(d===1){a[b[0]][b[1]][b[2]][b[3]]+=c;}else if(d===2){a[b[0]][b[1]][b[2]][b[3]]-=c;}else if(d===3){a[b[0]][b[1]][b[2]][b[3]]*=c;}else if(d===4){a[b[0]][b[1]][b[2]][b[3]]/=c;}}return true;};N.Group.prototype.checkProperty=function(a,b,c,d){if(d===undefined){d=false;}if(this!==a.parent){return false;}var e=N.Utils.getProperty(a,b);if(((e===undefined)&&d)||(e!==c)){return false;}return true;};N.Group.prototype.set=function(a,b,c,d,e,f,g){if(g===undefined){g=false;}b=b.split('.');if(d===undefined){d=false;}if(e===undefined){e=false;}if((d===false||(d&&a.alive))&&(e===false||(e&&a.visible))){return this.setProperty(a,b,c,f,g);}};N.Group.prototype.setAll=function(a,b,c,d,e,f){if(c===undefined){c=false;}if(d===undefined){d=false;}if(f===undefined){f=false;}a=a.split('.');e=e||0;var g=this.children.length;for(var i=0;i<g;i++){var h=this.children[i];if((!c||h.alive)&&(!d||h.visible)){this.setProperty(h,a,b,e,f);}}};N.Group.prototype.setAllChildren=function(a,b,c,d,e,f){if(c===undefined){c=false;}if(d===undefined){d=false;}if(f===undefined){f=false;}e=e||0;var g=this.children.length;for(var i=0;i<g;i++){var h=this.children[i];if((!c||h.alive)&&(!d||h.visible)){if(h instanceof N.Group){h.setAllChildren(a,b,c,d,e,f);}else{this.setProperty(h,a.split('.'),b,e,f);}}}};N.Group.prototype.checkAll=function(a,b,c,d,e){if(c===undefined){c=false;}if(d===undefined){d=false;}if(e===undefined){e=false;}for(var i=0;i<this.children.length;i++){var f=this.children[i];if((!c||f.alive)&&(!d||f.visible)){if(!this.checkProperty(f,a,b,e)){return false;}}}return true;};N.Group.prototype.checkAny=function(a,b,c,d){if(c===undefined){c=false;}if(d===undefined){d=false;}for(var i=0;i<this.children.length;i++){var e=this.children[i];if((!c||e.alive)&&(!d||e.visible)){if(this.checkProperty(e,a,b)){return true;}}}return false;};N.Group.prototype.addAll=function(a,b,c,d){this.setAll(a,b,c,d,1);};N.Group.prototype.subAll=function(a,b,c,d){this.setAll(a,b,c,d,2);};N.Group.prototype.multiplyAll=function(a,b,c,d){this.setAll(a,b,c,d,3);};N.Group.prototype.divideAll=function(a,b,c,d){this.setAll(a,b,c,d,4);};N.Group.prototype.kill=function(){this.alive=false;this.exists=false;this.visible=false;};N.Group.prototype.killAll=function(){this.callAllExists('kill',true);};N.Group.prototype.revive=function(){this.alive=true;this.exists=true;this.visible=true;};N.Group.prototype.reviveAll=function(){this.callAllExists('revive',false);};N.Group.prototype.resetAll=function(x,y,a,b,c){this.forEach(this.resetChild,this,c,x,y,a,b);};N.Group.prototype.callAllExists=function(a,b){var c;if(arguments.length>2){c=[];for(var i=2;i<arguments.length;i++){c.push(arguments[i]);}}for(var i=0;i<this.children.length;i++){var d=this.children[i];if(d.exists===b&&d[a]){d[a].apply(d,c);}}};N.Group.prototype.callbackFromArray=function(a,b,c){if(c===1){if(a[b[0]]){return a[b[0]];}}else if(c===2){if(a[b[0]][b[1]]){return a[b[0]][b[1]];}}else if(c===3){if(a[b[0]][b[1]][b[2]]){return a[b[0]][b[1]][b[2]];}}else if(c===4){if(a[b[0]][b[1]][b[2]][b[3]]){return a[b[0]][b[1]][b[2]][b[3]];}}else if(a[b]){return a[b];}return false;};N.Group.prototype.callAll=function(a,b){if(a===undefined){return;}a=a.split('.');var c=a.length;if(b===undefined||b===null||b===''){b=null;}else{if(typeof b==='string'){b=b.split('.');var d=b.length;}}var e;if(arguments.length>2){e=[];for(var i=2;i<arguments.length;i++){e.push(arguments[i]);}}var f=null;var g=null;for(var i=0;i<this.children.length;i++){var h=this.children[i];f=this.callbackFromArray(h,a,c);if(b&&f){g=this.callbackFromArray(h,b,d);f.apply(g,e);}else if(f){f.apply(h,e);}}};N.Group.prototype.preUpdate=function(){if(this.pendingDestroy){this.destroy();return false;}if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false;}var i=0;while(i<this.children.length){var a=this.children[i];a.preUpdate();if(this===a.parent){i++;}}return true;};N.Group.prototype.update=function(){var i=this.children.length;while(i--){var a=this.children.length;if(i>=a){i=a-1;}var b=this.children[i];if(!this.updateOnlyExistingChildren||b.exists){b.update();}}};N.Group.prototype.postUpdate=function(){if(this.fixedToCamera){this.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y;}for(var i=0;i<this.children.length;i++){this.children[i].postUpdate();}};N.Group.prototype.filter=function(a,b){var c=-1;var d=this.children.length;var e=[];while(++c<d){var f=this.children[c];if(!b||f.exists){if(a(f,c,this.children)){e.push(f);}}}return new N.ArraySet(e);};N.Group.prototype.forEach=function(a,b,c){if(c===undefined){c=false;}if(arguments.length<=3){for(var i=0;i<this.children.length;i++){var d=this.children[i];if(!c||d.exists){a.call(b,d);}}}else{var e=[null];for(var i=3;i<arguments.length;i++){e.push(arguments[i]);}for(var i=0;i<this.children.length;i++){var d=this.children[i];if(!c||d.exists){e[0]=d;a.apply(b,e);}}}};N.Group.prototype.forEachExists=function(a,b){var c;if(arguments.length>2){c=[null];for(var i=2;i<arguments.length;i++){c.push(arguments[i]);}}this.iterate('exists',true,N.Group.RETURN_TOTAL,a,b,c);};N.Group.prototype.forEachAlive=function(a,b){var c;if(arguments.length>2){c=[null];for(var i=2;i<arguments.length;i++){c.push(arguments[i]);}}this.iterate('alive',true,N.Group.RETURN_TOTAL,a,b,c);};N.Group.prototype.forEachDead=function(a,b){var c;if(arguments.length>2){c=[null];for(var i=2;i<arguments.length;i++){c.push(arguments[i]);}}this.iterate('alive',false,N.Group.RETURN_TOTAL,a,b,c);};N.Group.prototype.sort=function(a,b){if(this.children.length<2){return;}if(a===undefined){a='z';}if(b===undefined){b=N.Group.SORT_ASCENDING;}this._sortProperty=a;if(b===N.Group.SORT_ASCENDING){this.children.sort(this.ascendingSortHandler.bind(this));}else{this.children.sort(this.descendingSortHandler.bind(this));}this.updateZ();};N.Group.prototype.customSort=function(a,b){if(this.children.length<2){return;}this.children.sort(a.bind(b));this.updateZ();};N.Group.prototype.ascendingSortHandler=function(a,b){if(a[this._sortProperty]<b[this._sortProperty]){return-1;}else if(a[this._sortProperty]>b[this._sortProperty]){return 1;}else if(a.z<b.z){return-1;}else{return 1;}};N.Group.prototype.descendingSortHandler=function(a,b){if(a[this._sortProperty]<b[this._sortProperty]){return 1;}else if(a[this._sortProperty]>b[this._sortProperty]){return-1;}else{return 0;}};N.Group.prototype.iterate=function(a,b,c,d,e,f){if(this.children.length===0){if(c===N.Group.RETURN_TOTAL){return 0;}else if(c===N.Group.RETURN_ALL){return[];}}var g=0;if(c===N.Group.RETURN_ALL){var h=[];}for(var i=0;i<this.children.length;i++){if(this.children[i][a]===b){g++;if(d){if(f){f[0]=this.children[i];d.apply(e,f);}else{d.call(e,this.children[i]);}}if(c===N.Group.RETURN_CHILD){return this.children[i];}else if(c===N.Group.RETURN_ALL){h.push(this.children[i]);}}}if(c===N.Group.RETURN_TOTAL){return g;}else if(c===N.Group.RETURN_ALL){return h;}else{return null;}};N.Group.prototype.getFirst=function(a,b){return this.iterate(a,b,N.Group.RETURN_CHILD);};N.Group.prototype.getFirstExists=function(a,b,x,y,c,d){if(b===undefined){b=false;}if(typeof a!=='boolean'){a=true;}var e=this.getFirst('exists',a);return(e===null&&b)?this.create(x,y,c,d):this.resetChild(e,x,y,c,d);};N.Group.prototype.getFirstAlive=function(a,x,y,b,c){if(a===undefined){a=false;}var d=this.getFirst('alive',true);return(d===null&&a)?this.create(x,y,b,c):this.resetChild(d,x,y,b,c);};N.Group.prototype.getFirstDead=function(a,x,y,b,c){if(a===undefined){a=false;}var d=this.getFirst('alive',false);return(d===null&&a)?this.create(x,y,b,c):this.resetChild(d,x,y,b,c);};N.Group.prototype.resetChild=function(a,x,y,b,c){if(a===null){return null;}if(x===undefined){x=null;}if(y===undefined){y=null;}if(x!==null&&y!==null){a.reset(x,y);}if(b!==undefined){a.loadTexture(b,c);}return a;};N.Group.prototype.getTop=function(){if(this.children.length>0){return this.children[this.children.length-1];}};N.Group.prototype.getBottom=function(){if(this.children.length>0){return this.children[0];}};N.Group.prototype.getClosestTo=function(a,b,c){var d=Number.MAX_VALUE;var e=0;var f=null;for(var i=0;i<this.children.length;i++){var g=this.children[i];if(g.exists){e=Math.abs(N.Point.distance(a,g));if(e<d&&(!b||b.call(c,g,e))){d=e;f=g;}}}return f;};N.Group.prototype.getFurthestFrom=function(a,b,c){var d=0;var e=0;var f=null;for(var i=0;i<this.children.length;i++){var g=this.children[i];if(g.exists){e=Math.abs(N.Point.distance(a,g));if(e>d&&(!b||b.call(c,g,e))){d=e;f=g;}}}return f;};N.Group.prototype.count=function(a,b){return this.iterate(a,b,N.Group.RETURN_TOTAL);};N.Group.prototype.countLiving=function(){return this.count('alive',true);};N.Group.prototype.countDead=function(){return this.count('alive',false);};N.Group.prototype.getRandom=function(a,b){if(a===undefined){a=0;}if(b===undefined){b=this.children.length;}if(b===0){return null;}return N.ArrayUtils.getRandomItem(this.children,a,b);};N.Group.prototype.getRandomExists=function(a,b){var c=this.getAll('exists',true,a,b);return this.game.rnd.pick(c);};N.Group.prototype.getAll=function(a,b,c,d){if(c===undefined){c=0;}if(d===undefined){d=this.children.length;}var e=[];for(var i=c;i<d;i++){var f=this.children[i];if(a){if(f[a]===b){e.push(f);}}else{e.push(f);}}return e;};N.Group.prototype.remove=function(a,b,c){if(b===undefined){b=false;}if(c===undefined){c=false;}if(this.children.length===0||this.children.indexOf(a)===-1){return false;}if(!c&&a.events&&!a.destroyPhase){a.events.onRemovedFromGroup$dispatch(a,this);}var d=this.removeChild(a);this.removeFromHash(a);this.updateZ();if(this.cursor===a){this.next();}if(b&&d){d.destroy(true);}return true;};N.Group.prototype.moveAll=function(a,b){if(b===undefined){b=false;}if(this.children.length>0&&a instanceof N.Group){do{a.add(this.children[0],b);}while(this.children.length>0);this.hash=[];this.cursor=null;}return a;};N.Group.prototype.removeAll=function(a,b,c){if(a===undefined){a=false;}if(b===undefined){b=false;}if(c===undefined){c=false;}if(this.children.length===0){return;}do{if(!b&&this.children[0].events){this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this);}var d=this.removeChild(this.children[0]);this.removeFromHash(d);if(a&&d){d.destroy(true,c);}}while(this.children.length>0);this.hash=[];this.cursor=null;};N.Group.prototype.removeBetween=function(a,b,c,d){if(b===undefined){b=this.children.length-1;}if(c===undefined){c=false;}if(d===undefined){d=false;}if(this.children.length===0){return;}if(a>b||a<0||b>this.children.length){return false;}var i=b;while(i>=a){if(!d&&this.children[i].events){this.children[i].events.onRemovedFromGroup$dispatch(this.children[i],this);}var e=this.removeChild(this.children[i]);this.removeFromHash(e);if(c&&e){e.destroy(true);}if(this.cursor===this.children[i]){this.cursor=null;}i--;}this.updateZ();};N.Group.prototype.scatter=function(b,c){if(b==null){b=this.game.world.bounds;}this.forEach(function(a){a.position.set(b.randomX,b.randomY);},null,c);};N.Group.prototype.shuffle=function(){N.ArrayUtils.shuffle(this.children);this.updateZ();};N.Group.prototype.destroy=function(a,b){if(this.game===null||this.ignoreDestroy){return;}if(a===undefined){a=true;}if(b===undefined){b=false;}this.onDestroy.dispatch(this,a,b);this.removeAll(a);this.cursor=null;this.filters=null;this.pendingDestroy=false;if(!b){if(this.parent){this.parent.removeChild(this);}this.game=null;this.exists=false;}};Object.defineProperty(N.Group.prototype,'total',{get:function(){return this.iterate('exists',true,N.Group.RETURN_TOTAL);}});Object.defineProperty(N.Group.prototype,'length',{get:function(){return this.children.length;}});Object.defineProperty(N.Group.prototype,'angle',{get:function(){return N.Math.radToDeg(this.rotation);},set:function(a){this.rotation=N.Math.degToRad(a);}});Object.defineProperty(N.Group.prototype,'centerX',{get:function(){return this.getBounds(this.parent).centerX;},set:function(a){var r=this.getBounds(this.parent);var b=this.x-r.x;this.x=(a+b)-r.halfWidth;}});Object.defineProperty(N.Group.prototype,'centerY',{get:function(){return this.getBounds(this.parent).centerY;},set:function(a){var r=this.getBounds(this.parent);var b=this.y-r.y;this.y=(a+b)-r.halfHeight;}});Object.defineProperty(N.Group.prototype,'left',{get:function(){return this.getBounds(this.parent).left;},set:function(a){var r=this.getBounds(this.parent);var b=this.x-r.x;this.x=a+b;}});Object.defineProperty(N.Group.prototype,'right',{get:function(){return this.getBounds(this.parent).right;},set:function(a){var r=this.getBounds(this.parent);var b=this.x-r.x;this.x=(a+b)-r.width;}});Object.defineProperty(N.Group.prototype,'top',{get:function(){return this.getBounds(this.parent).top;},set:function(a){var r=this.getBounds(this.parent);var b=this.y-r.y;this.y=(a+b);}});Object.defineProperty(N.Group.prototype,'bottom',{get:function(){return this.getBounds(this.parent).bottom;},set:function(a){var r=this.getBounds(this.parent);var b=this.y-r.y;this.y=(a+b)-r.height;}});N.World=function(a){N.Group.call(this,a,null,'__world',false);this.bounds=new N.Rectangle(0,0,a.width,a.height);this.camera=null;this._definedSize=false;this._width=a.width;this._height=a.height;this.game.state.onStateChange.add(this.stateChange,this);};N.World.prototype=Object.create(N.Group.prototype);N.World.prototype.constructor=N.World;N.World.prototype.boot=function(){this.camera=new N.Camera(this.game,0,0,0,this.game.width,this.game.height);this.game.stage.addChild(this);this.camera.boot();};N.World.prototype.stateChange=function(){this.x=0;this.y=0;this.camera.reset();};N.World.prototype.setBounds=function(x,y,a,b){this._definedSize=true;this._width=a;this._height=b;this.bounds.setTo(x,y,a,b);this.x=x;this.y=y;if(this.camera.bounds){this.camera.bounds.setTo(x,y,Math.max(a,this.game.width),Math.max(b,this.game.height));}this.game.physics.setBoundsToWorld();};N.World.prototype.resize=function(a,b){if(this._definedSize){if(a<this._width){a=this._width;}if(b<this._height){b=this._height;}}this.bounds.width=a;this.bounds.height=b;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld();};N.World.prototype.shutdown=function(){this.destroy(true,true);};N.World.prototype.wrap=function(a,b,c,d,e){if(b===undefined){b=0;}if(c===undefined){c=false;}if(d===undefined){d=true;}if(e===undefined){e=true;}if(!c){if(d&&a.x+b<this.bounds.x){a.x=this.bounds.right+b;}else if(d&&a.x-b>this.bounds.right){a.x=this.bounds.left-b;}if(e&&a.y+b<this.bounds.top){a.y=this.bounds.bottom+b;}else if(e&&a.y-b>this.bounds.bottom){a.y=this.bounds.top-b;}}else{a.getBounds();if(d){if((a.x+a._currentBounds.width)<this.bounds.x){a.x=this.bounds.right;}else if(a.x>this.bounds.right){a.x=this.bounds.left;}}if(e){if((a.y+a._currentBounds.height)<this.bounds.top){a.y=this.bounds.bottom;}else if(a.y>this.bounds.bottom){a.y=this.bounds.top;}}}};N.World.prototype.wrapAll=function(a,b,c,d,e,f){a.forEach(this.wrap,this,b,c,d,e,f);};Object.defineProperty(N.World.prototype,'width',{get:function(){return this.bounds.width;},set:function(a){if(a<this.game.width){a=this.game.width;}this.bounds.width=a;this._width=a;this._definedSize=true;}});Object.defineProperty(N.World.prototype,'height',{get:function(){return this.bounds.height;},set:function(a){if(a<this.game.height){a=this.game.height;}this.bounds.height=a;this._height=a;this._definedSize=true;}});Object.defineProperty(N.World.prototype,'centerX',{get:function(){return this.bounds.halfWidth+this.bounds.x;}});Object.defineProperty(N.World.prototype,'centerY',{get:function(){return this.bounds.halfHeight+this.bounds.y;}});Object.defineProperty(N.World.prototype,'randomX',{get:function(){if(this.bounds.x<0){return this.game.rnd.between(this.bounds.x,(this.bounds.width-Math.abs(this.bounds.x)));}else{return this.game.rnd.between(this.bounds.x,this.bounds.width);}}});Object.defineProperty(N.World.prototype,'randomY',{get:function(){if(this.bounds.y<0){return this.game.rnd.between(this.bounds.y,(this.bounds.height-Math.abs(this.bounds.y)));}else{return this.game.rnd.between(this.bounds.y,this.bounds.height);}}});N.Game=function(a,b,c,d,e,f,g,h){this.id=N.GAMES.push(this)-1;this.config=null;this.physicsConfig=h;this.parent='';this.width=800;this.height=600;this.resolution=1;this._width=800;this._height=600;this.transparent=false;this.antialias=true;this.multiTexture=false;this.preserveDrawingBuffer=false;this.clearBeforeRender=true;this.renderer=null;this.renderType=N.AUTO;this.state=null;this.isBooted=false;this.isRunning=false;this.raf=null;this.add=null;this.make=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.scale=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.physics=null;this.plugins=null;this.rnd=null;this.device=N.Device;this.camera=null;this.canvas=null;this.context=null;this.debug=null;this.particles=null;this.create=null;this.lockRender=false;this.pendingDestroy=false;this.stepping=false;this.pendingStep=false;this.stepCount=0;this.onPause=null;this.onResume=null;this.onBlur=null;this.onFocus=null;this.onBoot=new N.Signal();this._paused=false;this._codePaused=false;this._focusGained=false;this.currentUpdateID=0;this.updatesThisFrame=1;this.rendersThisFrame=1;this._deltaTime=0;this._lastCount=0;this._spiraling=0;this._kickstart=true;this.fpsProblemNotifier=new N.Signal();this.forceSingleUpdate=true;this.forceSingleRender=false;this.dropFrames=false;this.powerPreference='default';this._nextFpsNotification=0;if(arguments.length===1&&typeof arguments[0]==='object'){this.parseConfig(arguments[0]);}else{this.config={enableDebug:true};if(typeof a!=='undefined'){this._width=a;}if(typeof b!=='undefined'){this._height=b;}if(typeof c!=='undefined'){this.renderType=c;}if(typeof d!=='undefined'){this.parent=d;}if(typeof f!=='undefined'){this.transparent=f;}if(typeof g!=='undefined'){this.antialias=g;}this.rnd=new N.RandomDataGenerator([(Date.now()*Math.random()).toString()]);this.state=new N.StateManager(this,e);}this.device.whenReady(this.boot,this);return this;};N.Game.prototype={parseConfig:function(a){this.config=a;if(a.enableDebug===undefined){this.config.enableDebug=true;}if(a.width){this._width=a.width;}if(a.height){this._height=a.height;}if(a.renderer){this.renderType=a.renderer;}if(a.parent){this.parent=a.parent;}if(a.transparent!==undefined){this.transparent=a.transparent;}if(a.antialias!==undefined){this.antialias=a.antialias;}if(a.clearBeforeRender!==undefined){this.clearBeforeRender=a.clearBeforeRender;}if(a.multiTexture!==undefined){this.multiTexture=a.multiTexture;}if(a.resolution){this.resolution=a.resolution;}if(a.preserveDrawingBuffer!==undefined){this.preserveDrawingBuffer=a.preserveDrawingBuffer;}if(a.powerPreference!==undefined){this.powerPreference=a.powerPreference;}if(a.physicsConfig){this.physicsConfig=a.physicsConfig;}var b=[(Date.now()*Math.random()).toString()];if(a.seed){b=a.seed;}this.rnd=new N.RandomDataGenerator(b);var c=null;if(a.state){c=a.state;}this.state=new N.StateManager(this,c);},boot:function(){if(this.isBooted){return;}this.onPause=new N.Signal();this.onResume=new N.Signal();this.onBlur=new N.Signal();this.onFocus=new N.Signal();this.isBooted=true;PIXI.game=this;this.math=N.Math;this.scale=new N.ScaleManager(this,this._width,this._height);this.stage=new N.Stage(this);this.setUpRenderer();this.world=new N.World(this);this.add=new N.GameObjectFactory(this);this.make=new N.GameObjectCreator(this);this.cache=new N.Cache(this);this.load=new N.Loader(this);this.time=new N.Time(this);this.tweens=new N.TweenManager(this);this.input=new N.Input(this);this.sound=new N.SoundManager(this);this.physics=new N.Physics(this,this.physicsConfig);this.particles=new N.Particles(this);this.create=new N.Create(this);this.plugins=new N.PluginManager(this);this.time.boot();this.stage.boot();this.world.boot();this.scale.boot();this.input.boot(this.config);this.sound.boot();this.state.boot();if(this.config.enableDebug){this.debug=new N.Utils.Debug(this);this.debug.boot();}else{var a=function(){};this.debug={preUpdate:a,update:a,reset:a,destroy:a,isDisabled:true};}this.showDebugHeader();this.isRunning=true;if(this.config&&this.config.forceSetTimeOut){this.raf=new N.RequestAnimationFrame(this,this.config.forceSetTimeOut);}else{this.raf=new N.RequestAnimationFrame(this,false);}this._kickstart=true;this.focusWindow();this.onBoot.dispatch(this);if(this.config.disableStart){return;}if(this.cache.isReady){this.raf.start();}else{this.cache.onReady.addOnce(function(){this.raf.start();},this);}},showDebugHeader:function(){if(window.PhaserGlobal&&window.PhaserGlobal.hideBanner){return;}var v=N.VERSION;var r='Canvas';var a='HTML Audio';var c=1;if(this.renderType===N.WEBGL){r='WebGL';c++;}else if(this.renderType===N.HEADLESS){r='Headless';}if(this.device.webAudio){a='WebAudio';c++;}if(!this.device.ie){var b=['%c %c %c Phaser CE v'+v+' | Pixi.js | '+r+' | '+a+'  %c %c '+'%c http://phaser.io %c\u2665%c\u2665%c\u2665','background: #fb8cb3','background: #d44a52','color: #ffffff; background: #871905;','background: #d44a52','background: #fb8cb3','background: #ffffff'];for(var i=0;i<3;i++){if(i<c){b.push('color: #ff2424; background: #fff');}else{b.push('color: #959595; background: #fff');}}console.log.apply(console,b);}else if(window.console){console.log('Phaser v'+v+' | Pixi.js | '+r+' | '+a+' | http://phaser.io');}},setUpRenderer:function(){this.device.canvas=true;if(!this.device.canvas){throw new Error('Phaser.Game - Cannot create Canvas 2d context, aborting.');}if(this.config.canvas){this.canvas=this.config.canvas;}else{this.canvas=N.Canvas.create(this,this.width,this.height,this.config.canvasID,true);}if(this.config.canvasStyle){this.canvas.style=this.config.canvasStyle;}else{this.canvas.style['-webkit-full-screen']='width: 100%; height: 100%';}if(this.config.crisp){N.Canvas.setImageRenderingCrisp(this.canvas);}if((this.renderType===N.WEBGL)||(this.renderType===N.WEBGL_MULTI)||(this.renderType===N.AUTO&&this.device.webGL)){if(this.multiTexture||this.renderType===N.WEBGL_MULTI){PIXI.enableMultiTexture();this.multiTexture=true;}try{this.renderer=new PIXI.WebGLRenderer(this,this.config);this.renderType=N.WEBGL;this.context=null;this.canvas.addEventListener('webglcontextlost',this.contextLost.bind(this),false);this.canvas.addEventListener('webglcontextrestored',this.contextRestored.bind(this),false);}catch(webGLRendererError){PIXI.defaultRenderer=null;this.renderer=null;this.multiTexture=false;PIXI._enableMultiTextureToggle=false;if(this.renderType===N.WEBGL){throw webGLRendererError;}}}if(!this.renderer){this.renderer=new PIXI.CanvasRenderer(this,this.config);this.context=this.renderer.context;if(this.renderType===N.AUTO){this.renderType=N.CANVAS;}}if(this.device.cocoonJS){this.canvas.screencanvas=(this.renderType===N.CANVAS)?true:false;}if(this.renderType!==N.HEADLESS){this.stage.smoothed=this.antialias;N.Canvas.addToDOM(this.canvas,this.parent,false);N.Canvas.setTouchAction(this.canvas);}},contextLost:function(a){a.preventDefault();this.renderer.contextLost=true;},contextRestored:function(){this.renderer.initContext();this.cache.clearGLTextures();this.renderer.contextLost=false;},update:function(a){if(this.pendingDestroy){this.destroy();return;}if(!this.isBooted){return;}this.time.update(a);if(this._kickstart){this.updateLogic(this.time.desiredFpsMult);this.updateRender();this._kickstart=false;return;}if(this._focusGained){this._focusGained=false;return;}var b=this.time.elapsed;if(b<=0){return;}if(b>this.time.deltaMax){if(this.dropFrames){return;}else{b=this.time.deltaMax;}}if(this.forceSingleUpdate){this.updatesThisFrame=1;this.rendersThisFrame=1;this.updateLogic(0.001*b/this.time.slowMotion);this.updateRender();}else if(this._spiraling>2){this.updatesThisFrame=0;this.rendersThisFrame=0;if(this.time.time>this._nextFpsNotification){this._nextFpsNotification=this.time.time+10000;this.fpsProblemNotifier.dispatch();}this._deltaTime=0;this._spiraling=0;}else{var c=0;var d=1000*this.time.desiredFpsMult;this._deltaTime+=b;this.updatesThisFrame=Math.floor(this._deltaTime/d);this.rendersThisFrame=this.forceSingleRender?1:Math.min(1,this.updatesThisFrame);while(this._deltaTime>=d){this._deltaTime-=d;this.currentUpdateID=c;this.updateLogic(this.time.desiredFpsMult/this.time.slowMotion);this.time.refresh();c++;}if(c>this._lastCount){this._spiraling++;}else if(c<this._lastCount){this._spiraling=0;}this._lastCount=c;if(this.rendersThisFrame>0){this.updateRender();}}},updateLogic:function(a){if(!this._paused&&!this.pendingStep){if(this.stepping){this.pendingStep=true;}this.time.preUpdate(a);this.scale.preUpdate();this.debug.preUpdate();this.camera.preUpdate();this.physics.preUpdate();this.state.preUpdate(a);this.plugins.preUpdate(a);this.stage.preUpdate();this.state.update();this.stage.update();this.tweens.update();this.sound.update();this.input.update();this.physics.update();this.plugins.update();this.stage.postUpdate();this.state.postUpdate();this.plugins.postUpdate();}else{this.scale.pauseUpdate();this.state.pauseUpdate(a);this.debug.preUpdate();this.input.pauseUpdate();}this.stage.updateTransform();},updateRender:function(){if(this.lockRender||this.renderType===N.HEADLESS){return;}this.time.preRender();this.state.preRender();this.renderer.render(this.stage);this.plugins.render();this.state.render();this.plugins.postRender();this.renderer.postRender();},enableStep:function(){this.stepping=true;this.pendingStep=false;this.stepCount=0;},disableStep:function(){this.stepping=false;this.pendingStep=false;},step:function(){this.pendingStep=false;this.stepCount++;},destroy:function(){this.raf.stop();this.debug.destroy();this.state.destroy();this.sound.destroy();this.scale.destroy();this.stage.destroy();this.input.destroy();this.physics.destroy();this.plugins.destroy();this.tweens.destroy();this.debug=null;this.state=null;this.sound=null;this.scale=null;this.stage=null;this.input=null;this.physics=null;this.plugins=null;this.tweens=null;this.cache=null;this.load=null;this.time=null;this.world=null;this.isBooted=false;this.renderer.destroy(false);N.Canvas.removeFromDOM(this.canvas);if(PIXI.game===this){PIXI.game=null;}PIXI.defaultRenderer=null;N.GAMES[this.id]=null;},gamePaused:function(a){if(!this._paused){this._paused=true;this.time.gamePaused();this.sound.gamePaused();this.onPause.dispatch(a);if(this.device.cordova&&this.device.iOS){this.lockRender=true;}}},gameResumed:function(a){if(this._paused&&!this._codePaused){this._paused=false;this.time.gameResumed();this.input.reset();this.sound.gameResumed();this.onResume.dispatch(a);if(this.device.cordova&&this.device.iOS){this.lockRender=false;}}},focusLoss:function(a){this.onBlur.dispatch(a);if(!this.stage.disableVisibilityChange){this.gamePaused(a);}},focusGain:function(a){this._focusGained=true;this.focusWindow();this.onFocus.dispatch(a);if(!this.stage.disableVisibilityChange){this.gameResumed(a);}},focusWindow:function(){if(window.focus){if(!window.PhaserGlobal||(window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)){window.focus();}}}};N.Game.prototype.constructor=N.Game;Object.defineProperty(N.Game.prototype,'paused',{get:function(){return this._paused;},set:function(a){if(a===true){if(this._paused===false){this._paused=true;if(this.sound.muteOnPause){this.sound.setMute();}this.time.gamePaused();this.onPause.dispatch(this);}this._codePaused=true;}else{if(this._paused){this._paused=false;this.input.reset();this.sound.unsetMute();this.time.gameResumed();this.onResume.dispatch(this);}this._codePaused=false;}}});N.Input=function(a){this.game=a;this.hitCanvas=null;this.hitContext=null;this.moveCallbacks=[];this.customCandidateHandler=null;this.customCandidateHandlerContext=null;this.pollRate=0;this.enabled=true;this.multiInputOverride=N.Input.MOUSE_TOUCH_COMBINE;this.position=null;this.speed=null;this.circle=null;this.scale=null;this.maxPointers=-1;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2000;this.justPressedRate=200;this.justReleasedRate=200;this.recordPointerHistory=false;this.recordRate=100;this.recordLimit=100;this.touchLockCallbacks=[];this.pointer1=null;this.pointer2=null;this.pointer3=null;this.pointer4=null;this.pointer5=null;this.pointer6=null;this.pointer7=null;this.pointer8=null;this.pointer9=null;this.pointer10=null;this.pointers=[];this.activePointer=null;this.mousePointer=null;this.mouse=null;this.keyboard=null;this.touch=null;this.mspointer=null;this.gamepad=null;this.resetLocked=false;this.onDown=null;this.onUp=null;this.onTap=null;this.onHold=null;this.minPriorityID=0;this.interactiveItems=new N.ArraySet();this._localPoint=new N.Point();this._pollCounter=0;this._oldPosition=null;this._x=0;this._y=0;};N.Input.MOUSE_OVERRIDES_TOUCH=0;N.Input.TOUCH_OVERRIDES_MOUSE=1;N.Input.MOUSE_TOUCH_COMBINE=2;N.Input.MAX_POINTERS=10;N.Input.prototype={boot:function(b){if('maxPointers'in b){this.maxPointers=b.maxPointers;}this.mousePointer=new N.Pointer(this.game,0,N.PointerMode.CURSOR);this.addPointer();this.addPointer();this.mouse=new N.Mouse(this.game);this.touch=new N.Touch(this.game);this.mspointer=new N.MSPointer(this.game);this.mouseWheel=new N.MouseWheel(this.game);this.pointerLock=new N.PointerLock(this.game);if(N.Keyboard){this.keyboard=new N.Keyboard(this.game);}if(N.Gamepad){this.gamepad=new N.Gamepad(this.game);}this.onDown=new N.Signal();this.onUp=new N.Signal();this.onTap=new N.Signal();this.onHold=new N.Signal();this.scale=new N.Point(1,1);this.speed=new N.Point();this.position=new N.Point();this._oldPosition=new N.Point();this.circle=new N.Circle(0,0,45);this.activePointer=this.mousePointer;this.hitCanvas=N.CanvasPool.create(this,1,1);this.hitContext=this.hitCanvas.getContext('2d');if(this.game.device.mspointer&&(b.mspointer!==false)){this.mspointer.start();}else if(this.game.device.touch&&(b.touch!==false)){this.touch.start();}if(!this.mspointer.active&&(b.mouse!==false)){this.mouse.start();}this.mousePointer.active=true;if(b.mouseWheel===true){this.mouseWheel.start();}if(b.pointerLock!==false){this.pointerLock.start();}if(this.keyboard&&(b.keyboard!==false)){this.keyboard.start();}var c=this;this._onClickTrampoline=function(a){c.onClickTrampoline(a);};this.game.canvas.addEventListener('click',this._onClickTrampoline,false);},destroy:function(){this.mouse.stop();this.mouseWheel.stop();this.touch.stop();this.mspointer.stop();this.pointerLock.stop();if(this.keyboard){this.keyboard.stop();}if(this.gamepad){this.gamepad.stop();}this.moveCallbacks=[];N.CanvasPool.remove(this);this.game.canvas.removeEventListener('click',this._onClickTrampoline);},setInteractiveCandidateHandler:function(a,b){this.customCandidateHandler=a;this.customCandidateHandlerContext=b;},addMoveCallback:function(a,b){this.moveCallbacks.push({callback:a,context:b});},addTouchLockCallback:function(a,b,c){if(c===undefined){c=false;}this.touchLockCallbacks.push({callback:a,context:b,onEnd:c});},removeTouchLockCallback:function(a,b){var i=this.touchLockCallbacks.length;while(i--){if(this.touchLockCallbacks[i].callback===a&&this.touchLockCallbacks[i].context===b){this.touchLockCallbacks.splice(i,1);return true;}}return false;},executeTouchLockCallbacks:function(a,b){var i=this.touchLockCallbacks.length;while(i--){var c=this.touchLockCallbacks[i];if(c.onEnd===a&&c.callback.call(c.context,this,b)){this.touchLockCallbacks.splice(i,1);}}},deleteMoveCallback:function(a,b){var i=this.moveCallbacks.length;while(i--){if(this.moveCallbacks[i].callback===a&&this.moveCallbacks[i].context===b){this.moveCallbacks.splice(i,1);return;}}},addPointer:function(){if(this.pointers.length>=N.Input.MAX_POINTERS){console.warn('Phaser.Input.addPointer: Maximum limit of '+N.Input.MAX_POINTERS+' pointers reached.');return null;}var a=this.pointers.length+1;var b=new N.Pointer(this.game,a,N.PointerMode.CONTACT);this.pointers.push(b);this['pointer'+a]=b;return b;},update:function(){if(this.keyboard){this.keyboard.update();}if(this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return;}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();if(this.gamepad&&this.gamepad.active){this.gamepad.update();}for(var i=0;i<this.pointers.length;i++){this.pointers[i].update();}this._pollCounter=0;},pauseUpdate:function(){if(this.gamepad&&this.gamepad.active){this.gamepad.update();}},reset:function(a){if(!this.game.isBooted||this.resetLocked){return;}if(a===undefined){a=false;}this.mousePointer.reset();if(this.keyboard){this.keyboard.reset(a);}for(var i=0;i<this.pointers.length;i++){this.pointers[i].reset();}if(this.game.canvas.style.cursor!=='none'){this.game.canvas.style.cursor='';}if(a){this.onDown.dispose();this.onUp.dispose();this.onTap.dispose();this.onHold.dispose();this.onDown=new N.Signal();this.onUp=new N.Signal();this.onTap=new N.Signal();this.onHold=new N.Signal();this.moveCallbacks=[];}this._pollCounter=0;},resetSpeed:function(x,y){this._oldPosition.setTo(x,y);this.speed.setTo(0,0);},startPointer:function(a){if(this.maxPointers>=0&&this.countActivePointers(this.maxPointers)>=this.maxPointers){return null;}if(!this.pointer1.active){return this.pointer1.start(a);}if(!this.pointer2.active){return this.pointer2.start(a);}for(var i=2;i<this.pointers.length;i++){var b=this.pointers[i];if(!b.active){return b.start(a);}}return null;},updatePointer:function(a){if(this.pointer1.active&&this.pointer1.identifier===a.identifier){return this.pointer1.move(a);}if(this.pointer2.active&&this.pointer2.identifier===a.identifier){return this.pointer2.move(a);}for(var i=2;i<this.pointers.length;i++){var b=this.pointers[i];if(b.active&&b.identifier===a.identifier){return b.move(a);}}return null;},stopPointer:function(a){if(this.pointer1.active&&this.pointer1.identifier===a.identifier){return this.pointer1.stop(a);}if(this.pointer2.active&&this.pointer2.identifier===a.identifier){return this.pointer2.stop(a);}for(var i=2;i<this.pointers.length;i++){var b=this.pointers[i];if(b.active&&b.identifier===a.identifier){return b.stop(a);}}return null;},countActivePointers:function(a){if(a===undefined){a=this.pointers.length;}var b=a;for(var i=0;i<this.pointers.length&&b>0;i++){var c=this.pointers[i];if(c.active){b--;}}return(a-b);},getPointer:function(a){if(a===undefined){a=false;}for(var i=0;i<this.pointers.length;i++){var b=this.pointers[i];if(b.active===a){return b;}}return null;},getPointerFromIdentifier:function(a){for(var i=0;i<this.pointers.length;i++){var b=this.pointers[i];if(b.identifier===a){return b;}}return null;},getPointerFromId:function(a){for(var i=0;i<this.pointers.length;i++){var b=this.pointers[i];if(b.pointerId===a){return b;}}return null;},getLocalPosition:function(a,b,c){if(c===undefined){c=new N.Point();}var d=a.worldTransform;var e=1/(d.a*d.d+d.c*-d.b);return c.setTo(d.d*e*b.x+ -d.c*e*b.y+(d.ty*d.c-d.tx*d.d)*e,d.a*e*b.y+ -d.b*e*b.x+(-d.ty*d.a+d.tx*d.b)*e);},hitTest:function(a,b,c){if(!a.worldVisible){return false;}this.getLocalPosition(a,b,this._localPoint);c.copyFrom(this._localPoint);if(a.hitArea&&a.hitArea.contains){return(a.hitArea.contains(this._localPoint.x,this._localPoint.y));}else if(N.Creature&&a instanceof N.Creature){var d=Math.abs(a.width);var e=Math.abs(a.height);var f=a.x-(d*a.anchorX);if(this.game.camera.x+b.x>=f&&this.game.camera.x+b.x<f+d){var g=a.y-(e*a.anchorY);if(this.game.camera.y+b.y>=g&&this.game.camera.y+b.y<g+e){return true;}}}else if(a instanceof N.TileSprite){var d=a.width;var e=a.height;var f=-d*a.anchor.x;if(this._localPoint.x>=f&&this._localPoint.x<f+d){var g=-e*a.anchor.y;if(this._localPoint.y>=g&&this._localPoint.y<g+e){return true;}}}else if(a instanceof PIXI.Sprite){var d=a.texture.frame.width/a.texture.baseTexture.resolution;var e=a.texture.frame.height/a.texture.baseTexture.resolution;var f=-d*a.anchor.x;if(this._localPoint.x>=f&&this._localPoint.x<f+d){var g=-e*a.anchor.y;if(this._localPoint.y>=g&&this._localPoint.y<g+e){return true;}}}else if(a instanceof N.Graphics){for(var i=0;i<a.graphicsData.length;i++){var h=a.graphicsData[i];if(!h.fill){continue;}if(h.shape&&h.shape.contains(this._localPoint.x,this._localPoint.y)){return true;}}}for(var i=0;i<a.children.length;i++){if(this.hitTest(a.children[i],b,c)){return true;}}return false;},onClickTrampoline:function(){this.activePointer.processClickTrampolines();},callAll:function(a,b){var c=this.interactiveItems.list;var i=c.length;while(i--){var d=c[i];if(d&&d.enabled){d[a](b);}}}};N.Input.prototype.constructor=N.Input;Object.defineProperty(N.Input.prototype,'x',{get:function(){return this._x;},set:function(a){this._x=Math.floor(a);}});Object.defineProperty(N.Input.prototype,'y',{get:function(){return this._y;},set:function(a){this._y=Math.floor(a);}});Object.defineProperty(N.Input.prototype,'pollLocked',{get:function(){return(this.pollRate>0&&this._pollCounter<this.pollRate);}});Object.defineProperty(N.Input.prototype,'totalInactivePointers',{get:function(){return this.pointers.length-this.countActivePointers();}});Object.defineProperty(N.Input.prototype,'totalActivePointers',{get:function(){return this.countActivePointers();}});Object.defineProperty(N.Input.prototype,'worldX',{get:function(){return this.game.camera.view.x+this.x;}});Object.defineProperty(N.Input.prototype,'worldY',{get:function(){return this.game.camera.view.y+this.y;}});N.Mouse=function(a){this.game=a;this.input=a.input;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseUpCallback=null;this.mouseOutCallback=null;this.mouseOverCallback=null;this.capture=false;this.active=false;this.enabled=true;this.stopOnGameOut=false;this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null;this._onMouseOut=null;this._onMouseOver=null;};N.Mouse.NO_BUTTON=-1;N.Mouse.LEFT_BUTTON=0;N.Mouse.MIDDLE_BUTTON=1;N.Mouse.RIGHT_BUTTON=2;N.Mouse.BACK_BUTTON=3;N.Mouse.FORWARD_BUTTON=4;N.Mouse.prototype={start:function(){var b=this.game.device;if(b.isAndroidStockBrowser()&&this.input.touch.active){return false;}if(this._onMouseDown!==null){return false;}var c=this;this._onMouseDown=function(a){return c.onMouseDown(a);};this._onMouseMove=function(a){return c.onMouseMove(a);};this._onMouseUp=function(a){return c.onMouseUp(a);};this._onMouseUpGlobal=function(a){return c.onMouseUpGlobal(a);};this._onMouseOutGlobal=function(a){return c.onMouseOutGlobal(a);};this._onMouseOut=function(a){return c.onMouseOut(a);};this._onMouseOver=function(a){return c.onMouseOver(a);};var d=this.game.canvas;d.addEventListener('mousedown',this._onMouseDown,true);d.addEventListener('mousemove',this._onMouseMove,true);d.addEventListener('mouseup',this._onMouseUp,true);if(!b.cocoonJS){window.addEventListener('mouseup',this._onMouseUpGlobal,true);window.addEventListener('mouseout',this._onMouseOutGlobal,true);d.addEventListener('mouseover',this._onMouseOver,true);d.addEventListener('mouseout',this._onMouseOut,true);}this.active=true;return true;},onMouseDown:function(a){this.event=a;if(this.capture){a.preventDefault();}if(this.mouseDownCallback){this.mouseDownCallback.call(this.callbackContext,a);}if(!this.input.enabled||!this.enabled){return;}a.identifier=0;this.input.mousePointer.start(a);},onMouseMove:function(a){this.event=a;if(this.capture){a.preventDefault();}if(this.mouseMoveCallback){this.mouseMoveCallback.call(this.callbackContext,a);}if(!this.input.enabled||!this.enabled){return;}a.identifier=0;this.input.mousePointer.move(a);},onMouseUp:function(a){this.event=a;if(this.capture){a.preventDefault();}if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,a);}if(!this.input.enabled||!this.enabled){return;}a.identifier=0;this.input.mousePointer.stop(a);},onMouseUpGlobal:function(a){if(!this.input.mousePointer.withinGame){if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,a);}a.identifier=0;this.input.mousePointer.stop(a);}},onMouseOutGlobal:function(a){this.event=a;if(this.capture){a.preventDefault();}this.input.mousePointer.withinGame=false;if(!this.input.enabled||!this.enabled){return;}this.input.mousePointer.stop(a);this.input.mousePointer.resetButtons();},onMouseOut:function(a){this.event=a;if(this.capture){a.preventDefault();}this.input.mousePointer.withinGame=false;if(this.mouseOutCallback){this.mouseOutCallback.call(this.callbackContext,a);}if(!this.input.enabled||!this.enabled){return;}this.input.mousePointer.updateButtons(a);if(this.stopOnGameOut){a.identifier=0;this.input.mousePointer.stop(a);this.input.callAll('_pointerOutHandler',this.input.mousePointer);}},onMouseOver:function(a){this.event=a;if(this.capture){a.preventDefault();}this.input.mousePointer.withinGame=true;if(this.mouseOverCallback){this.mouseOverCallback.call(this.callbackContext,a);}if(!this.input.enabled||!this.enabled){return;}this.input.mousePointer.updateButtons(a);},stop:function(){var a=this.game.canvas;a.removeEventListener('mousedown',this._onMouseDown,true);a.removeEventListener('mousemove',this._onMouseMove,true);a.removeEventListener('mouseup',this._onMouseUp,true);a.removeEventListener('mouseover',this._onMouseOver,true);a.removeEventListener('mouseout',this._onMouseOut,true);window.removeEventListener('mouseup',this._onMouseUpGlobal,true);window.removeEventListener('mouseout',this._onMouseOutGlobal,true);this.active=false;}};N.Mouse.prototype.constructor=N.Mouse;N.MouseWheel=function(a){this.game=a;this.input=a.input;this.element=a.canvas;this.preventDefault=true;this.active=false;this.callback=null;this.callbackContext=a;this.delta=0;this.wheelEventName=a.device.wheelEvent;this.boundOnWheelHandler=this.onWheelHandler.bind(this);this.eventProxy=null;};N.MouseWheel.UP=1;N.MouseWheel.DOWN=-1;N.MouseWheel.prototype.start=function(){if(!this.wheelEventName||this.active){return false;}this.element.addEventListener(this.wheelEventName,this.boundOnWheelHandler,true);if(this.wheelEventName==='mousewheel'){this.eventProxy=new N.WheelEventProxy(-1/40,1);}else if(this.wheelEventName==='DOMMouseScroll'){this.eventProxy=new N.WheelEventProxy(1,1);}this.active=true;return true;};N.MouseWheel.prototype.stop=function(){if(!this.active){return;}this.element.removeEventListener(this.wheelEventName,this.boundOnWheelHandler,true);this.active=false;};N.MouseWheel.prototype.onWheelHandler=function(a){if(this.eventProxy){a=this.eventProxy.bindEvent(a);}if(this.preventDefault){a.preventDefault();}this.delta=N.Math.clamp(-a.deltaY,-1,1);if(this.callback){this.callback.call(this.callbackContext,a);}};N.MSPointer=function(a){this.game=a;this.input=a.input;this.callbackContext=this.game;this.pointerDownCallback=null;this.pointerMoveCallback=null;this.pointerUpCallback=null;this.pointerOutCallback=null;this.pointerOverCallback=null;this.pointerCancelCallback=null;this.capture=false;this.event=null;this.active=false;this.enabled=true;this.stopOnGameOut=false;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null;this._onMSPointerUpGlobal=null;this._onMSPointerOut=null;this._onMSPointerOver=null;};N.MSPointer.prototype={start:function(){if(!this.game.device.mspointer){return false;}if(this._onMSPointerDown!==null){return false;}var b=this;this._onMSPointerDown=function(a){return b.onPointerDown(a);};this._onMSPointerMove=function(a){return b.onPointerMove(a);};this._onMSPointerUp=function(a){return b.onPointerUp(a);};this._onMSPointerUpGlobal=function(a){return b.onPointerUpGlobal(a);};this._onMSPointerOut=function(a){return b.onPointerOut(a);};this._onMSPointerOver=function(a){return b.onPointerOver(a);};this._onMSPointerCancel=function(a){return b.onPointerCancel(a);};var c=this.game.canvas;c.addEventListener('MSPointerDown',this._onMSPointerDown,false);c.addEventListener('MSPointerMove',this._onMSPointerMove,false);c.addEventListener('MSPointerUp',this._onMSPointerUp,false);c.addEventListener('MSPointerCancel',this._onMSPointerCancel,false);c.addEventListener('pointerdown',this._onMSPointerDown,false);c.addEventListener('pointermove',this._onMSPointerMove,false);c.addEventListener('pointerup',this._onMSPointerUp,false);c.addEventListener('pointercancel',this._onMSPointerCancel,false);c.style['-ms-content-zooming']='none';c.style['-ms-touch-action']='none';if(!this.game.device.cocoonJS){window.addEventListener('MSPointerUp',this._onMSPointerUpGlobal,true);c.addEventListener('MSPointerOver',this._onMSPointerOver,true);c.addEventListener('MSPointerOut',this._onMSPointerOut,true);window.addEventListener('pointerup',this._onMSPointerUpGlobal,true);c.addEventListener('pointerover',this._onMSPointerOver,true);c.addEventListener('pointerout',this._onMSPointerOut,true);}this.active=true;return true;},onPointerDown:function(a){this.game.input.executeTouchLockCallbacks(false,a);this.event=a;if(this.capture){a.preventDefault();}if(this.pointerDownCallback){this.pointerDownCallback.call(this.callbackContext,a);}if(!this.input.enabled||!this.enabled){return;}a.identifier=a.pointerId;if(this.isMousePointerEvent(a)){this.input.mousePointer.start(a);}else{this.input.startPointer(a);}},onPointerMove:function(a){this.event=a;if(this.capture){a.preventDefault();}if(this.pointerMoveCallback){this.pointerMoveCallback.call(this.callbackContext,a);}if(!this.input.enabled||!this.enabled){return;}a.identifier=a.pointerId;if(this.isMousePointerEvent(a)){this.input.mousePointer.move(a);}else{this.input.updatePointer(a);}},onPointerUp:function(a){this.game.input.executeTouchLockCallbacks(true,a);this.event=a;if(this.capture){a.preventDefault();}if(this.pointerUpCallback){this.pointerUpCallback.call(this.callbackContext,a);}if(!this.input.enabled||!this.enabled){return;}a.identifier=a.pointerId;if(this.isMousePointerEvent(a)){this.input.mousePointer.stop(a);}else{this.input.stopPointer(a);}},onPointerUpGlobal:function(a){a.identifier=a.pointerId;if(this.isMousePointerEvent(a)&&!this.input.mousePointer.withinGame){this.onPointerUp(a);}else{var b=this.input.getPointerFromIdentifier(a.identifier);if(b&&b.withinGame){this.onPointerUp(a);}}},onPointerOut:function(a){this.event=a;if(this.capture){a.preventDefault();}a.identifier=a.pointerId;var b=this.getPointerFromEvent(a);if(b){b.withinGame=false;}if(this.pointerOutCallback){this.pointerOutCallback.call(this.callbackContext,a);}if(!this.input.enabled||!this.enabled){return;}if(this.stopOnGameOut){a.identifier=0;if(!b){b=this.input.mousePointer;}b.stop(a);this.input.callAll('_pointerOutHandler',b);}},onPointerOver:function(a){this.event=a;if(this.capture){a.preventDefault();}a.identifier=a.pointerId;var b=this.getPointerFromEvent(a);if(b){b.withinGame=true;}if(this.pointerOverCallback){this.pointerOverCallback.call(this.callbackContext,a);}},onPointerCancel:function(a){this.event=a;if(this.pointerCancelCallback){this.pointerCancelCallback.call(this.callbackContext,a);}if(!this.game.input.enabled||!this.enabled){return;}a.identifier=a.pointerId;if(this.isMousePointerEvent(a)){this.input.mousePointer.stop(a);}else{this.input.stopPointer(a);}},stop:function(){var a=this.game.canvas;a.removeEventListener('MSPointerDown',this._onMSPointerDown,false);a.removeEventListener('MSPointerMove',this._onMSPointerMove,false);a.removeEventListener('MSPointerUp',this._onMSPointerUp,false);a.removeEventListener('pointerdown',this._onMSPointerDown,false);a.removeEventListener('pointermove',this._onMSPointerMove,false);a.removeEventListener('pointerup',this._onMSPointerUp,false);window.removeEventListener('MSPointerUp',this._onMSPointerUpGlobal,true);a.removeEventListener('MSPointerOver',this._onMSPointerOver,true);a.removeEventListener('MSPointerOut',this._onMSPointerOut,true);window.removeEventListener('pointerup',this._onMSPointerUpGlobal,true);a.removeEventListener('pointerover',this._onMSPointerOver,true);a.removeEventListener('pointerout',this._onMSPointerOut,true);this.active=false;},isMousePointerEvent:function(a){return(a.pointerType==='mouse'||a.pointerType===0x00000004);},getPointerFromEvent:function(a){return this.isMousePointerEvent(a)?this.input.mousePointer:this.input.getPointerFromIdentifier(a.identifier);}};N.MSPointer.prototype.constructor=N.MSPointer;N.DeviceButton=function(a,b){this.parent=a;this.game=a.game;this.event=null;this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.repeats=0;this.altKey=false;this.shiftKey=false;this.ctrlKey=false;this.value=0;this.buttonCode=b;this.onDown=new N.Signal();this.onUp=new N.Signal();this.onFloat=new N.Signal();};N.DeviceButton.prototype={start:function(a,b){if(this.isDown){return;}this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.repeats=0;this.event=a;this.value=b;if(a){this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.ctrlKey=a.ctrlKey;}this.onDown.dispatch(this,b);},stop:function(a,b){if(this.isUp){return;}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.event=a;this.value=b;if(a){this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.ctrlKey=a.ctrlKey;}this.onUp.dispatch(this,b);},startStop:function(a,b,c){if(a){this.start(b,c);}else{this.stop(b,c);}},padFloat:function(a){this.isDown=false;this.isUp=false;this.value=a;this.onFloat.dispatch(this,a);},justPressed:function(a){a=a||250;return(this.isDown&&(this.timeDown+a)>this.game.time.time);},justReleased:function(a){a=a||250;return(this.isUp&&(this.timeUp+a)>this.game.time.time);},reset:function(){this.isDown=false;this.isUp=true;this.timeDown=this.game.time.time;this.repeats=0;this.altKey=false;this.shiftKey=false;this.ctrlKey=false;},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.parent=null;this.game=null;}};N.DeviceButton.prototype.constructor=N.DeviceButton;Object.defineProperty(N.DeviceButton.prototype,'duration',{get:function(){if(this.isUp){return-1;}return this.game.time.time-this.timeDown;}});N.Pointer=function(a,b,c){this.game=a;this.id=b;this.type=N.POINTER;this.exists=true;this.identifier=0;this.pointerId=null;this.pointerMode=c||(N.PointerMode.CURSOR|N.PointerMode.CONTACT);this.target=null;this.button=null;this.leftButton=new N.DeviceButton(this,N.Pointer.LEFT_BUTTON);this.middleButton=new N.DeviceButton(this,N.Pointer.MIDDLE_BUTTON);this.rightButton=new N.DeviceButton(this,N.Pointer.RIGHT_BUTTON);this.backButton=new N.DeviceButton(this,N.Pointer.BACK_BUTTON);this.forwardButton=new N.DeviceButton(this,N.Pointer.FORWARD_BUTTON);this.eraserButton=new N.DeviceButton(this,N.Pointer.ERASER_BUTTON);this._holdSent=false;this._history=[];this._nextDrop=0;this._stateReset=false;this.withinGame=false;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.rawMovementX=0;this.rawMovementY=0;this.movementX=0;this.movementY=0;this.x=-1;this.y=-1;this.isMouse=(b===0);this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.interactiveCandidates=[];this.active=false;this.dirty=false;this.position=new N.Point();this.positionDown=new N.Point();this.positionUp=new N.Point();this.circle=new N.Circle(0,0,44);this._clickTrampolines=null;this._trampolineTargetObject=null;};N.Pointer.NO_BUTTON=0;N.Pointer.LEFT_BUTTON=1;N.Pointer.RIGHT_BUTTON=2;N.Pointer.MIDDLE_BUTTON=4;N.Pointer.BACK_BUTTON=8;N.Pointer.FORWARD_BUTTON=16;N.Pointer.ERASER_BUTTON=32;N.Pointer.prototype={resetButtons:function(){this.isDown=false;this.isUp=true;if(this.isMouse){this.leftButton.reset();this.middleButton.reset();this.rightButton.reset();this.backButton.reset();this.forwardButton.reset();this.eraserButton.reset();}},processButtonsDown:function(a,b){switch(a){case(N.Mouse.LEFT_BUTTON):this.leftButton.start(b);break;case(N.Mouse.RIGHT_BUTTON):this.rightButton.start(b);break;case(N.Mouse.MIDDLE_BUTTON):this.middleButton.start(b);break;case(N.Mouse.BACK_BUTTON):this.backButton.start(b);break;case(N.Mouse.FORWARD_BUTTON):this.forwardButton.start(b);break;}},processButtonsUp:function(a,b){switch(a){case(N.Mouse.LEFT_BUTTON):this.leftButton.stop(b);break;case(N.Mouse.RIGHT_BUTTON):this.rightButton.stop(b);break;case(N.Mouse.MIDDLE_BUTTON):this.middleButton.stop(b);break;case(N.Mouse.BACK_BUTTON):this.backButton.stop(b);break;case(N.Mouse.FORWARD_BUTTON):this.forwardButton.stop(b);break;}},processButtonsUpDown:function(a,b){var c=b.type.toLowerCase().substr(-4);var d=(c==='down');var e=(c==='move');if(a!==undefined){if(d&&a===1&&b.ctrlKey){a=2;}this.leftButton.startStop(N.Pointer.LEFT_BUTTON&a,b);this.rightButton.startStop(N.Pointer.RIGHT_BUTTON&a,b);this.middleButton.startStop(N.Pointer.MIDDLE_BUTTON&a,b);this.backButton.startStop(N.Pointer.BACK_BUTTON&a,b);this.forwardButton.startStop(N.Pointer.FORWARD_BUTTON&a,b);this.eraserButton.startStop(N.Pointer.ERASER_BUTTON&a,b);}else{if(b.button!==undefined){if(d&&b.ctrlKey&&b.button===0){this.rightButton.start(b);}else if(d){this.processButtonsDown(b.button,b);}else if(!e){this.processButtonsUp(b.button,b);}}else if(d){if(b.ctrlKey){this.rightButton.start(b);}else{this.leftButton.start(b);}}else{this.leftButton.stop(b);this.rightButton.stop(b);}}},updateButtons:function(a){this.button=a.button;this.processButtonsUpDown(a.buttons,a);this.isUp=true;this.isDown=false;if(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown){this.isUp=false;this.isDown=true;}},start:function(a){var b=this.game.input;if(a.pointerId){this.pointerId=a.pointerId;}this.identifier=a.identifier;this.target=a.target;if(this.isMouse){this.updateButtons(a);}else{this.isDown=true;this.isUp=false;}this.active=true;this.withinGame=true;this.dirty=false;this._history=[];this._clickTrampolines=null;this._trampolineTargetObject=null;this.msSinceLastClick=this.game.time.time-this.timeDown;this.timeDown=this.game.time.time;this._holdSent=false;this.move(a,true);this.positionDown.setTo(this.x,this.y);if(b.multiInputOverride===N.Input.MOUSE_OVERRIDES_TOUCH||b.multiInputOverride===N.Input.MOUSE_TOUCH_COMBINE||(b.multiInputOverride===N.Input.TOUCH_OVERRIDES_MOUSE&&b.totalActivePointers===0)){b.x=this.x;b.y=this.y;b.position.setTo(this.x,this.y);b.onDown.dispatch(this,a);b.resetSpeed(this.x,this.y);}this._stateReset=false;this.totalTouches++;if(this.targetObject!==null){this.targetObject._touchedHandler(this);}return this;},update:function(){var a=this.game.input;if(this.active){if(this.dirty){if(a.interactiveItems.total>0){this.processInteractiveObjects(false);}this.dirty=false;}if(this._holdSent===false&&this.duration>=a.holdRate){if(a.multiInputOverride===N.Input.MOUSE_OVERRIDES_TOUCH||a.multiInputOverride===N.Input.MOUSE_TOUCH_COMBINE||(a.multiInputOverride===N.Input.TOUCH_OVERRIDES_MOUSE&&a.totalActivePointers===0)){a.onHold.dispatch(this);}this._holdSent=true;}if(a.recordPointerHistory&&this.game.time.time>=this._nextDrop){this._nextDrop=this.game.time.time+a.recordRate;this._history.push({x:this.position.x,y:this.position.y});if(this._history.length>a.recordLimit){this._history.shift();}}}},move:function(a,b){var c=this.game.input;if(c.pollLocked){return;}if(b===undefined){b=false;}if(a.button!==undefined){this.button=a.button;}if(this.isMouse){this.updateButtons(a);}this.clientX=a.clientX;this.clientY=a.clientY;this.pageX=a.pageX;this.pageY=a.pageY;this.screenX=a.screenX;this.screenY=a.screenY;if(this.isMouse&&c.pointerLock.locked&&!b){this.rawMovementX=a.movementX||a.mozMovementX||a.webkitMovementX||0;this.rawMovementY=a.movementY||a.mozMovementY||a.webkitMovementY||0;this.movementX+=this.rawMovementX;this.movementY+=this.rawMovementY;}this.x=(this.pageX-this.game.scale.offset.x)*c.scale.x;this.y=(this.pageY-this.game.scale.offset.y)*c.scale.y;this.position.setTo(this.x,this.y);this.circle.x=this.x;this.circle.y=this.y;if(c.multiInputOverride===N.Input.MOUSE_OVERRIDES_TOUCH||c.multiInputOverride===N.Input.MOUSE_TOUCH_COMBINE||(c.multiInputOverride===N.Input.TOUCH_OVERRIDES_MOUSE&&c.totalActivePointers===0)){c.activePointer=this;c.x=this.x;c.y=this.y;c.position.setTo(c.x,c.y);c.circle.x=c.x;c.circle.y=c.y;}this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);var i=c.moveCallbacks.length;while(i--){c.moveCallbacks[i].callback.call(c.moveCallbacks[i].context,this,this.x,this.y,b,a);}if(this.targetObject!==null&&(!this.game.paused||this.targetObject.noPause)&&this.targetObject.isDragged===true){if(this.targetObject.update(this)===false){this.targetObject=null;}}else if(c.interactiveItems.total>0){this.processInteractiveObjects(b);}return this;},processInteractiveObjects:function(a){var b=0;var c=-1;var d=null;var e=this.game.input.interactiveItems.first;this.interactiveCandidates=[];while(e){e.checked=false;if(e.validForInput(c,b,false)&&(!this.game.paused||e.sprite.noPause)){e.checked=true;if((a&&e.checkPointerDown(this,true))||(!a&&e.checkPointerOver(this,true))){b=e.sprite.renderOrderID;c=e.priorityID;d=e;this.interactiveCandidates.push(e);}}e=this.game.input.interactiveItems.next;}e=this.game.input.interactiveItems.first;while(e){if(!e.checked&&e.validForInput(c,b,true)){if((a&&e.checkPointerDown(this,false))||(!a&&e.checkPointerOver(this,false))){b=e.sprite.renderOrderID;c=e.priorityID;d=e;this.interactiveCandidates.push(e);}}e=this.game.input.interactiveItems.next;}if(this.game.input.customCandidateHandler){d=this.game.input.customCandidateHandler.call(this.game.input.customCandidateHandlerContext,this,this.interactiveCandidates,d);}this.swapTarget(d,false);return(this.targetObject!==null);},swapTarget:function(a,b){if(b===undefined){b=false;}if(a===null){if(this.targetObject){this.targetObject._pointerOutHandler(this,b);this.targetObject=null;}}else if(this.targetObject===null){this.targetObject=a;a._pointerOverHandler(this,b);}else{if(this.targetObject===a){if(a.update(this)===false){this.targetObject=null;}}else{this.targetObject._pointerOutHandler(this,b);this.targetObject=a;this.targetObject._pointerOverHandler(this,b);}}},leave:function(a){this.withinGame=false;this.move(a,false);},stop:function(a){var b=this.game.input;if(this._stateReset&&this.withinGame){a.preventDefault();return;}this.timeUp=this.game.time.time;if(b.multiInputOverride===N.Input.MOUSE_OVERRIDES_TOUCH||b.multiInputOverride===N.Input.MOUSE_TOUCH_COMBINE||(b.multiInputOverride===N.Input.TOUCH_OVERRIDES_MOUSE&&b.totalActivePointers===0)){b.onUp.dispatch(this,a);if(this.duration>=0&&this.duration<=b.tapRate){var c=(this.timeUp-this.previousTapTime<b.doubleTapRate);b.onTap.dispatch(this,c,a);this.previousTapTime=this.timeUp;}}if(this.isMouse){this.updateButtons(a);}else{this.isDown=false;this.isUp=true;}if(this.id>0){this.active=false;}this.withinGame=this.game.scale.bounds.contains(a.pageX,a.pageY);this.pointerId=null;this.identifier=null;this.positionUp.setTo(this.x,this.y);if(this.isMouse===false){b.currentPointers--;}b.callAll('_releasedHandler',this);if(this._clickTrampolines){this._trampolineTargetObject=this.targetObject;}this.targetObject=null;return this;},justPressed:function(a){a=a||this.game.input.justPressedRate;return(this.isDown===true&&(this.timeDown+a)>this.game.time.time);},justReleased:function(a){a=a||this.game.input.justReleasedRate;return(this.isUp&&(this.timeUp+a)>this.game.time.time);},addClickTrampoline:function(a,b,c,d){if(!this.isDown){return;}var e=(this._clickTrampolines=this._clickTrampolines||[]);for(var i=0;i<e.length;i++){if(e[i].name===a){e.splice(i,1);break;}}e.push({name:a,targetObject:this.targetObject,callback:b,callbackContext:c,callbackArgs:d});},processClickTrampolines:function(){var a=this._clickTrampolines;if(!a){return;}for(var i=0;i<a.length;i++){var b=a[i];if(b.targetObject===this._trampolineTargetObject){b.callback.apply(b.callbackContext,b.callbackArgs);}}this._clickTrampolines=null;this._trampolineTargetObject=null;},reset:function(){if(this.isMouse===false){this.active=false;}this.pointerId=null;this.identifier=null;this.dirty=false;this.totalTouches=0;this._holdSent=false;this._history.length=0;this._stateReset=true;this.resetButtons();if(this.targetObject){this.targetObject._releasedHandler(this);}this.targetObject=null;},resetMovement:function(){this.movementX=0;this.movementY=0;}};N.Pointer.prototype.constructor=N.Pointer;Object.defineProperty(N.Pointer.prototype,'duration',{get:function(){if(this.isUp){return-1;}return this.game.time.time-this.timeDown;}});Object.defineProperty(N.Pointer.prototype,'worldX',{get:function(){return this.game.world.camera.x+this.x;}});Object.defineProperty(N.Pointer.prototype,'worldY',{get:function(){return this.game.world.camera.y+this.y;}});N.PointerMode={CURSOR:1<<0,CONTACT:1<<1};N.PointerModes={};N.PointerModes[N.PointerMode.CURSOR]='CURSOR';N.PointerModes[N.PointerMode.CONTACT]='CONTACT';N.Touch=function(a){this.game=a;this.active=false;this.enabled=true;this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=true;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null;};N.Touch.prototype={start:function(){if(!this.game.device.touch){return false;}if(this._onTouchStart!==null){return false;}var b=this;this._onTouchStart=function(a){return b.onTouchStart(a);};this._onTouchMove=function(a){return b.onTouchMove(a);};this._onTouchEnd=function(a){return b.onTouchEnd(a);};this._onTouchEnter=function(a){return b.onTouchEnter(a);};this._onTouchLeave=function(a){return b.onTouchLeave(a);};this._onTouchCancel=function(a){return b.onTouchCancel(a);};this.game.canvas.addEventListener('touchstart',this._onTouchStart,false);this.game.canvas.addEventListener('touchmove',this._onTouchMove,false);this.game.canvas.addEventListener('touchend',this._onTouchEnd,false);this.game.canvas.addEventListener('touchcancel',this._onTouchCancel,false);if(!this.game.device.cocoonJS){this.game.canvas.addEventListener('touchenter',this._onTouchEnter,false);this.game.canvas.addEventListener('touchleave',this._onTouchLeave,false);}this.active=true;return true;},consumeDocumentTouches:function(){this._documentTouchMove=function(a){a.preventDefault();};document.addEventListener('touchmove',this._documentTouchMove,false);},onTouchStart:function(a){this.game.input.executeTouchLockCallbacks(false,a);this.event=a;if(!this.game.input.enabled||!this.enabled){return;}if(this.touchStartCallback){this.touchStartCallback.call(this.callbackContext,a);}if(this.preventDefault){a.preventDefault();}for(var i=0;i<a.changedTouches.length;i++){this.game.input.startPointer(a.changedTouches[i]);}},onTouchCancel:function(a){this.event=a;if(this.touchCancelCallback){this.touchCancelCallback.call(this.callbackContext,a);}if(!this.game.input.enabled||!this.enabled){return;}if(this.preventDefault){a.preventDefault();}for(var i=0;i<a.changedTouches.length;i++){this.game.input.stopPointer(a.changedTouches[i]);}},onTouchEnter:function(a){this.event=a;if(this.touchEnterCallback){this.touchEnterCallback.call(this.callbackContext,a);}if(!this.game.input.enabled||!this.enabled){return;}if(this.preventDefault){a.preventDefault();}},onTouchLeave:function(a){this.event=a;if(this.touchLeaveCallback){this.touchLeaveCallback.call(this.callbackContext,a);}if(this.preventDefault){a.preventDefault();}},onTouchMove:function(a){this.event=a;if(this.touchMoveCallback){this.touchMoveCallback.call(this.callbackContext,a);}if(this.preventDefault){a.preventDefault();}for(var i=0;i<a.changedTouches.length;i++){this.game.input.updatePointer(a.changedTouches[i]);}},onTouchEnd:function(a){this.game.input.executeTouchLockCallbacks(true,a);this.event=a;if(this.touchEndCallback){this.touchEndCallback.call(this.callbackContext,a);}if(this.preventDefault){a.preventDefault();}for(var i=0;i<a.changedTouches.length;i++){this.game.input.stopPointer(a.changedTouches[i]);}},stop:function(){if(!this.game.device.touch){return;}this.game.canvas.removeEventListener('touchstart',this._onTouchStart);this.game.canvas.removeEventListener('touchmove',this._onTouchMove);this.game.canvas.removeEventListener('touchend',this._onTouchEnd);this.game.canvas.removeEventListener('touchenter',this._onTouchEnter);this.game.canvas.removeEventListener('touchleave',this._onTouchLeave);this.game.canvas.removeEventListener('touchcancel',this._onTouchCancel);this.active=false;}};N.Touch.prototype.constructor=N.Touch;N.InputHandler=function(a){this.sprite=a;this.game=a.game;this.enabled=false;this.checked=false;this.priorityID=0;this.useHandCursor=false;this._setHandCursor=false;this.isDragged=false;this.allowHorizontalDrag=true;this.allowVerticalDrag=true;this.bringToTop=false;this.snapOffset=null;this.snapOnDrag=false;this.snapOnRelease=false;this.snapX=0;this.snapY=0;this.snapOffsetX=0;this.snapOffsetY=0;this.pixelPerfectOver=false;this.pixelPerfectClick=false;this.pixelPerfectAlpha=255;this.draggable=false;this.boundsRect=null;this.boundsSprite=null;this.scaleLayer=false;this.dragOffset=new N.Point();this.dragFromCenter=false;this.dragStopBlocksInputUp=false;this.dragStartPoint=new N.Point();this.dragDistanceThreshold=0;this.dragTimeThreshold=0;this.downPoint=new N.Point();this.snapPoint=new N.Point();this._dragPoint=new N.Point();this._dragPhase=false;this._pendingDrag=false;this._dragTimePass=false;this._dragDistancePass=false;this._wasEnabled=false;this._tempPoint=new N.Point();this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,camX:0,camY:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false});};N.InputHandler.prototype={start:function(a,b){a=a||0;if(b===undefined){b=false;}if(this.enabled===false){this.game.input.interactiveItems.add(this);this.useHandCursor=b;this.priorityID=a;for(var i=0;i<10;i++){this._pointerData[i]={id:i,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false};}this.snapOffset=new N.Point();this.enabled=true;this._wasEnabled=true;}this.sprite.events.onAddedToGroup.add(this.addedToGroup,this);this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this);return this.sprite;},addedToGroup:function(){if(this._dragPhase){return;}if(this._wasEnabled&&!this.enabled){this.start();}},removedFromGroup:function(){if(this._dragPhase){return;}if(this.enabled){this._wasEnabled=true;this.stop();}else{this._wasEnabled=false;}},reset:function(){this.enabled=false;for(var i=0;i<10;i++){this._pointerData[i]={id:i,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false};}},stop:function(){if(this.enabled===false){return;}else{this.enabled=false;this.game.input.interactiveItems.remove(this);}},destroy:function(){if(this.sprite){if(this._setHandCursor){this.game.canvas.style.cursor='';this._setHandCursor=false;}this.enabled=false;this.game.input.interactiveItems.remove(this);this._pointerData.length=0;this.boundsRect=null;this.boundsSprite=null;this.sprite=null;}},validForInput:function(a,b,c){if(c===undefined){c=true;}if(!this.enabled||this.sprite.scale.x===0||this.sprite.scale.y===0||this.priorityID<this.game.input.minPriorityID||(this.sprite.parent&&this.sprite.parent.ignoreChildInput)){return false;}if(!c&&(this.pixelPerfectClick||this.pixelPerfectOver)){return false;}if(this.priorityID>a||(this.priorityID===a&&this.sprite.renderOrderID>b)){return true;}return false;},isPixelPerfect:function(){return(this.pixelPerfectClick||this.pixelPerfectOver);},pointerX:function(a){a=a||0;return this._pointerData[a].x;},pointerY:function(a){a=a||0;return this._pointerData[a].y;},pointerDown:function(a){a=a||0;return this._pointerData[a].isDown;},pointerUp:function(a){a=a||0;return this._pointerData[a].isUp;},pointerTimeDown:function(a){a=a||0;return this._pointerData[a].timeDown;},pointerTimeUp:function(a){a=a||0;return this._pointerData[a].timeUp;},pointerOver:function(a){if(!this.enabled){return false;}if(a===undefined){for(var i=0;i<10;i++){if(this._pointerData[i].isOver){return true;}}return false;}else{return this._pointerData[a].isOver;}},pointerOut:function(a){if(!this.enabled){return false;}if(a===undefined){for(var i=0;i<10;i++){if(this._pointerData[i].isOut){return true;}}}else{return this._pointerData[a].isOut;}},pointerTimeOver:function(a){a=a||0;return this._pointerData[a].timeOver;},pointerTimeOut:function(a){a=a||0;return this._pointerData[a].timeOut;},pointerDragged:function(a){a=a||0;return this._pointerData[a].isDragged;},checkPointerDown:function(a,b){if(!a.isDown||!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible||this.sprite.worldScale.x===0||this.sprite.worldScale.y===0){return false;}if(this.game.input.hitTest(this.sprite,a,this._tempPoint)){if(b===undefined){b=false;}if(!b&&this.pixelPerfectClick){return this.checkPixel(this._tempPoint.x,this._tempPoint.y);}else{return true;}}return false;},checkPointerOver:function(a,b){if(!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible||this.sprite.worldScale.x===0||this.sprite.worldScale.y===0){return false;}if(this.game.input.hitTest(this.sprite,a,this._tempPoint)){if(b===undefined){b=false;}if(!b&&this.pixelPerfectOver){return this.checkPixel(this._tempPoint.x,this._tempPoint.y);}else{return true;}}return false;},checkPixel:function(x,y,a){if(this.sprite.texture.baseTexture.source){if(x===null&&y===null){this.game.input.getLocalPosition(this.sprite,a,this._tempPoint);var x=this._tempPoint.x;var y=this._tempPoint.y;}if(this.sprite.anchor.x!==0){x-=-this.sprite.texture.frame.width*this.sprite.anchor.x;}if(this.sprite.anchor.y!==0){y-=-this.sprite.texture.frame.height*this.sprite.anchor.y;}x+=this.sprite.texture.frame.x;y+=this.sprite.texture.frame.y;if(this.sprite.texture.trim){x-=this.sprite.texture.trim.x;y-=this.sprite.texture.trim.y;if(x<this.sprite.texture.crop.x||x>this.sprite.texture.crop.right||y<this.sprite.texture.crop.y||y>this.sprite.texture.crop.bottom){this._dx=x;this._dy=y;return false;}}this._dx=x;this._dy=y;this.game.input.hitContext.clearRect(0,0,1,1);this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,x,y,1,1,0,0,1,1);var b=this.game.input.hitContext.getImageData(0,0,1,1);if(b.data[3]>=this.pixelPerfectAlpha){return true;}}return false;},update:function(a){if(this.sprite===null||this.sprite.parent===undefined){return;}if(!this.enabled||!this.sprite.visible||!this.sprite.parent.visible){this._pointerOutHandler(a);return false;}if(this._pendingDrag){if(!this._dragDistancePass){this._dragDistancePass=(N.Math.distance(a.x,a.y,this.downPoint.x,this.downPoint.y)>=this.dragDistanceThreshold);}if(this._dragDistancePass&&this._dragTimePass){this.startDrag(a);}return true;}else if(this.draggable&&this._draggedPointerID===a.id){return this.updateDrag(a,false);}else if(this._pointerData[a.id].isOver){if(this.checkPointerOver(a)){this._pointerData[a.id].x=a.x-this.sprite.x;this._pointerData[a.id].y=a.y-this.sprite.y;return true;}else{this._pointerOutHandler(a);return false;}}},_pointerOverHandler:function(a,b){if(this.sprite===null){return;}var c=this._pointerData[a.id];if(c.isOver===false||a.dirty){var d=(c.isOver===false);c.isOver=true;c.isOut=false;c.timeOver=this.game.time.time;c.x=a.x-this.sprite.x;c.y=a.y-this.sprite.y;if(this.useHandCursor&&c.isDragged===false){this.game.canvas.style.cursor='pointer';this._setHandCursor=true;}if(!b&&d&&this.sprite&&this.sprite.events){this.sprite.events.onInputOver$dispatch(this.sprite,a);}if(this.sprite.parent&&this.sprite.parent.onChildInputOver){this.sprite.parent.onChildInputOver.dispatch(this.sprite,a);}}},_pointerOutHandler:function(a,b){if(this.sprite===null){return;}var c=this._pointerData[a.id];c.isOver=false;c.isOut=true;c.timeOut=this.game.time.time;if(this.useHandCursor&&c.isDragged===false){this.game.canvas.style.cursor='';this._setHandCursor=false;}if(!b&&this.sprite&&this.sprite.events){this.sprite.events.onInputOut$dispatch(this.sprite,a);if(this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputOut){this.sprite.parent.onChildInputOut.dispatch(this.sprite,a);}}},_touchedHandler:function(a){if(this.sprite===null){return;}var b=this._pointerData[a.id];if(!b.isDown&&b.isOver){if(this.pixelPerfectClick&&!this.checkPixel(null,null,a)){return;}b.isDown=true;b.isUp=false;b.timeDown=this.game.time.time;this.downPoint.set(a.x,a.y);a.dirty=true;if(this.sprite&&this.sprite.events){this.sprite.events.onInputDown$dispatch(this.sprite,a);if(this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputDown){this.sprite.parent.onChildInputDown.dispatch(this.sprite,a);}if(this.sprite===null){return;}}if(this.draggable&&this.isDragged===false){if(this.dragTimeThreshold===0&&this.dragDistanceThreshold===0){this.startDrag(a);}else{this._pendingDrag=true;this._dragDistancePass=(this.dragDistanceThreshold===0);if(this.dragTimeThreshold>0){this._dragTimePass=false;this.game.time.events.add(this.dragTimeThreshold,this.dragTimeElapsed,this,a);}else{this._dragTimePass=true;}}}if(this.bringToTop){this.sprite.bringToTop();}}},dragTimeElapsed:function(a){this._dragTimePass=true;if(this._pendingDrag&&this.sprite){if(this._dragDistancePass){this.startDrag(a);}}},_releasedHandler:function(a){if(this.sprite===null){return;}var b=this._pointerData[a.id];if(b.isDown&&a.isUp){b.isDown=false;b.isUp=true;b.timeUp=this.game.time.time;b.downDuration=b.timeUp-b.timeDown;var c=this.checkPointerOver(a);if(this.sprite&&this.sprite.events){if(!this.dragStopBlocksInputUp||this.dragStopBlocksInputUp&&!(this.draggable&&this.isDragged&&this._draggedPointerID===a.id)){this.sprite.events.onInputUp$dispatch(this.sprite,a,c);}if(this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputUp){this.sprite.parent.onChildInputUp.dispatch(this.sprite,a,c);}if(c){c=this.checkPointerOver(a);}}b.isOver=c;if(!c&&this.useHandCursor){this.game.canvas.style.cursor='default';this._setHandCursor=false;}a.dirty=true;this._pendingDrag=false;if(this.draggable&&this.isDragged&&this._draggedPointerID===a.id){this.stopDrag(a);}}},updateDrag:function(a,b){var c=this.game.camera;var d=this.dragOffset;var e=this._dragPoint;var f=this._pointerData[a.id];var g=this.snapPoint;var h=this.sprite;if(b===undefined){b=false;}if(a.isUp){this.stopDrag(a);return false;}var i=this.globalToLocal(a);if(h.fixedToCamera){var j=c.scale.x*i.x+e.x+d.x;var k=c.scale.y*i.y+e.y+d.y;}else{var j=i.x+e.x+d.x;var k=i.y+e.y+d.y;}if(h.fixedToCamera){var l=h.cameraOffset;var m=l.x;var n=l.y;if(this.allowHorizontalDrag){l.x=j-c.x;}if(this.allowVerticalDrag){l.y=k-c.y;}if(this.boundsRect){this.checkBoundsRect();}if(this.boundsSprite){this.checkBoundsSprite();}if(this.snapOnDrag){l.x=Math.round((l.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);l.y=Math.round((l.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY);g.set(l.x,l.y);}var o=l.x-m;var p=l.y-n;}else{var q=c.x-f.camX;var r=c.y-f.camY;var m=h.x;var n=h.y;if(this.allowHorizontalDrag){h.x=j+q;}if(this.allowVerticalDrag){h.y=k+r;}if(this.boundsRect){this.checkBoundsRect();}if(this.boundsSprite){this.checkBoundsSprite();}if(this.snapOnDrag){h.x=Math.round((h.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);h.y=Math.round((h.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY);g.set(h.x,h.y);}var o=h.x-m;var p=h.y-n;}this.sprite.events.onDragUpdate.dispatch(h,a,j,k,g,b,o,p);return true;},justOver:function(a,b){a=a||0;b=b||500;return(this._pointerData[a].isOver&&this.overDuration(a)<b);},justOut:function(a,b){a=a||0;b=b||500;return(this._pointerData[a].isOut&&(this.game.time.time-this._pointerData[a].timeOut<b));},justPressed:function(a,b){a=a||0;b=b||500;return(this._pointerData[a].isDown&&this.downDuration(a)<b);},justReleased:function(a,b){a=a||0;b=b||500;return(this._pointerData[a].isUp&&(this.game.time.time-this._pointerData[a].timeUp<b));},overDuration:function(a){a=a||0;if(this._pointerData[a].isOver){return this.game.time.time-this._pointerData[a].timeOver;}return-1;},downDuration:function(a){a=a||0;if(this._pointerData[a].isDown){return this.game.time.time-this._pointerData[a].timeDown;}return-1;},enableDrag:function(a,b,c,d,e,f){if(a===undefined){a=false;}if(b===undefined){b=false;}if(c===undefined){c=false;}if(d===undefined){d=255;}if(e===undefined){e=null;}if(f===undefined){f=null;}this._dragPoint=new N.Point();this.draggable=true;this.bringToTop=b;this.dragOffset=new N.Point();this.dragFromCenter=a;this.pixelPerfectClick=c;this.pixelPerfectAlpha=d;if(e){this.boundsRect=e;}if(f){this.boundsSprite=f;}},disableDrag:function(){if(this._pointerData){for(var i=0;i<10;i++){this._pointerData[i].isDragged=false;}}this.draggable=false;this.isDragged=false;this._draggedPointerID=-1;this._pendingDrag=false;},startDrag:function(a){var x=this.sprite.x;var y=this.sprite.y;var b=this.globalToLocal(a);this.isDragged=true;this._draggedPointerID=a.id;this._pointerData[a.id].camX=this.game.camera.x;this._pointerData[a.id].camY=this.game.camera.y;this._pointerData[a.id].isDragged=true;if(this.sprite.fixedToCamera){if(this.dragFromCenter){var c=this.sprite.getBounds();var d=this.globalToLocal(new N.Point(c.centerX,c.centerY));this.sprite.cameraOffset.x=b.x+(this.sprite.cameraOffset.x-d.x);this.sprite.cameraOffset.y=b.y+(this.sprite.cameraOffset.y-d.y);}this._dragPoint.setTo(this.sprite.cameraOffset.x-a.x,this.sprite.cameraOffset.y-a.y);}else{if(this.dragFromCenter){var c=this.sprite.getBounds();var d=this.globalToLocal(new N.Point(c.centerX,c.centerY));this.sprite.x=b.x+(this.sprite.x-d.x);this.sprite.y=b.y+(this.sprite.y-d.y);}this._dragPoint.setTo(this.sprite.x-b.x,this.sprite.y-b.y);}this.updateDrag(a,true);if(this.bringToTop){this._dragPhase=true;this.sprite.bringToTop();}this.dragStartPoint.set(x,y);this.sprite.events.onDragStart$dispatch(this.sprite,a,x,y);this._pendingDrag=false;},globalToLocalX:function(x){if(this.scaleLayer){x-=this.game.scale.grid.boundsFluid.x;x*=this.game.scale.grid.scaleFluidInversed.x;}return x;},globalToLocalY:function(y){if(this.scaleLayer){y-=this.game.scale.grid.boundsFluid.y;y*=this.game.scale.grid.scaleFluidInversed.y;}return y;},globalToLocal:function(a){if(this.sprite.parent){return this.game.input.getLocalPosition(this.sprite.parent,{x:a.x,y:a.y});}else{return a;}},stopDrag:function(a){this.isDragged=false;this._draggedPointerID=-1;this._pointerData[a.id].isDragged=false;this._dragPhase=false;this._pendingDrag=false;if(this.snapOnRelease){if(this.sprite.fixedToCamera){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY);}else{this.sprite.x=Math.round((this.sprite.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.y=Math.round((this.sprite.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY);}}this.sprite.events.onDragStop$dispatch(this.sprite,a);if(this.checkPointerOver(a)===false){this._pointerOutHandler(a);}},setDragLock:function(a,b){if(a===undefined){a=true;}if(b===undefined){b=true;}this.allowHorizontalDrag=a;this.allowVerticalDrag=b;},enableSnap:function(a,b,c,d,e,f){if(c===undefined){c=true;}if(d===undefined){d=false;}if(e===undefined){e=0;}if(f===undefined){f=0;}this.snapX=a;this.snapY=b;this.snapOffsetX=e;this.snapOffsetY=f;this.snapOnDrag=c;this.snapOnRelease=d;},disableSnap:function(){this.snapOnDrag=false;this.snapOnRelease=false;},checkBoundsRect:function(){if(this.sprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsRect.left){this.sprite.cameraOffset.x=this.boundsRect.left;}else if((this.sprite.cameraOffset.x+this.sprite.width)>this.boundsRect.right){this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width;}if(this.sprite.cameraOffset.y<this.boundsRect.top){this.sprite.cameraOffset.y=this.boundsRect.top;}else if((this.sprite.cameraOffset.y+this.sprite.height)>this.boundsRect.bottom){this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height;}}else{if(this.sprite.left<this.boundsRect.left){this.sprite.x=this.boundsRect.x+this.sprite.offsetX;}else if(this.sprite.right>this.boundsRect.right){this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX);}if(this.sprite.top<this.boundsRect.top){this.sprite.y=this.boundsRect.top+this.sprite.offsetY;}else if(this.sprite.bottom>this.boundsRect.bottom){this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY);}}},checkBoundsSprite:function(){if(this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x){this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x;}else if((this.sprite.cameraOffset.x+this.sprite.width)>(this.boundsSprite.cameraOffset.x+this.boundsSprite.width)){this.sprite.cameraOffset.x=(this.boundsSprite.cameraOffset.x+this.boundsSprite.width)-this.sprite.width;}if(this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y){this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y;}else if((this.sprite.cameraOffset.y+this.sprite.height)>(this.boundsSprite.cameraOffset.y+this.boundsSprite.height)){this.sprite.cameraOffset.y=(this.boundsSprite.cameraOffset.y+this.boundsSprite.height)-this.sprite.height;}}else{if(this.sprite.left<this.boundsSprite.left){this.sprite.x=this.boundsSprite.left+this.sprite.offsetX;}else if(this.sprite.right>this.boundsSprite.right){this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX);}if(this.sprite.top<this.boundsSprite.top){this.sprite.y=this.boundsSprite.top+this.sprite.offsetY;}else if(this.sprite.bottom>this.boundsSprite.bottom){this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY);}}}};N.InputHandler.prototype.constructor=N.InputHandler;N.PointerLock=function(a){this.game=a;this.input=a.input;this.element=a.canvas;this.active=false;this.locked=false;this.onChange=new N.Signal();this.onError=new N.Signal();this.boundOnChangeHandler=this.onChangeHandler.bind(this);this.boundOnErrorHandler=this.onErrorHandler.bind(this);var b=a.device;this.pointerLockElement=b.pointerLockElement;this.pointerlockchange=b.pointerlockchange;this.pointerlockerror=b.pointerlockerror;};N.PointerLock.prototype.start=function(){if(!this.game.device.pointerLock||this.active){return false;}if(!this.element.requestPointerLock){this.element.requestPointerLock=this.element.mozRequestPointerLock||this.element.webkitRequestPointerLock;}if(!document.exitPointerLock){document.exitPointerLock=document.mozExitPointerLock||document.webkitExitPointerLock;}document.addEventListener(this.pointerlockchange,this.boundOnChangeHandler,true);document.addEventListener(this.pointerlockerror,this.boundOnErrorHandler,true);this.active=true;return true;};N.PointerLock.prototype.stop=function(){if(this.active){document.removeEventListener(this.pointerlockchange,this.boundOnChangeHandler,true);document.removeEventListener(this.pointerlockerror,this.boundOnErrorHandler,true);this.active=false;}};N.PointerLock.prototype.request=function(){if(!this.active||this.locked){return;}this.element.requestPointerLock();};N.PointerLock.prototype.exit=function(){document.exitPointerLock();};N.PointerLock.prototype.onChangeHandler=function(a){this.locked=(document[this.pointerLockElement]===this.element);this.onChange.dispatch(this.locked,a);};N.PointerLock.prototype.onErrorHandler=function(a){this.onError.dispatch(a);};N.Gamepad=function(a){this.game=a;this._gamepadIndexMap={};this._rawPads=[];this._active=false;this.enabled=true;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||(navigator.userAgent.indexOf('Firefox/')!==-1)||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this._ongamepadconnected=null;this._gamepaddisconnected=null;this._gamepads=[new N.SinglePad(a,this),new N.SinglePad(a,this),new N.SinglePad(a,this),new N.SinglePad(a,this)];};N.Gamepad.prototype={addCallbacks:function(a,b){if(typeof b!=='undefined'){this.onConnectCallback=(typeof b.onConnect==='function')?b.onConnect:this.onConnectCallback;this.onDisconnectCallback=(typeof b.onDisconnect==='function')?b.onDisconnect:this.onDisconnectCallback;this.onDownCallback=(typeof b.onDown==='function')?b.onDown:this.onDownCallback;this.onUpCallback=(typeof b.onUp==='function')?b.onUp:this.onUpCallback;this.onAxisCallback=(typeof b.onAxis==='function')?b.onAxis:this.onAxisCallback;this.onFloatCallback=(typeof b.onFloat==='function')?b.onFloat:this.onFloatCallback;this.callbackContext=a;}},start:function(){if(this._active){return;}this._active=true;var b=this;this._onGamepadConnected=function(a){return b.onGamepadConnected(a);};this._onGamepadDisconnected=function(a){return b.onGamepadDisconnected(a);};window.addEventListener('gamepadconnected',this._onGamepadConnected,false);window.addEventListener('gamepaddisconnected',this._onGamepadDisconnected,false);},onGamepadConnected:function(a){var b=a.gamepad;this._rawPads.push(b);this._gamepads[b.index].connect(b);},onGamepadDisconnected:function(a){var b=a.gamepad;for(var i in this._rawPads){if(this._rawPads[i].index===b.index){this._rawPads.splice(i,1);}}this._gamepads[b.index].disconnect();},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus();},_pollGamepads:function(){if(!this._active){return;}if(navigator.getGamepads){var a=navigator.getGamepads();}else if(navigator.webkitGetGamepads){var a=navigator.webkitGetGamepads();}else if(navigator.webkitGamepads){var a=navigator.webkitGamepads();}if(a){this._rawPads=[];var b=false;for(var i=0;i<a.length;i++){if(typeof a[i]!==this._prevRawGamepadTypes[i]){b=true;this._prevRawGamepadTypes[i]=typeof a[i];}if(a[i]){this._rawPads.push(a[i]);}if(i===3){break;}}for(var g=0;g<this._gamepads.length;g++){this._gamepads[g]._rawPad=this._rawPads[g];}if(b){var c={rawIndices:{},padIndices:{}};var d;for(var j=0;j<this._gamepads.length;j++){d=this._gamepads[j];if(d.connected){for(var k=0;k<this._rawPads.length;k++){if(this._rawPads[k].index===d.index){c.rawIndices[d.index]=true;c.padIndices[j]=true;}}}}for(var l=0;l<this._gamepads.length;l++){d=this._gamepads[l];if(c.padIndices[l]){continue;}if(this._rawPads.length<1){d.disconnect();}for(var m=0;m<this._rawPads.length;m++){if(c.padIndices[l]){break;}var e=this._rawPads[m];if(e){if(c.rawIndices[e.index]){d.disconnect();continue;}else{d.connect(e);c.rawIndices[e.index]=true;c.padIndices[l]=true;}}else{d.disconnect();}}}}}},setDeadZones:function(a){for(var i=0;i<this._gamepads.length;i++){this._gamepads[i].deadZone=a;}},stop:function(){this._active=false;window.removeEventListener('gamepadconnected',this._onGamepadConnected);window.removeEventListener('gamepaddisconnected',this._onGamepadDisconnected);},reset:function(){this.update();for(var i=0;i<this._gamepads.length;i++){this._gamepads[i].reset();}},justPressed:function(a,b){for(var i=0;i<this._gamepads.length;i++){if(this._gamepads[i].justPressed(a,b)===true){return true;}}return false;},justReleased:function(a,b){for(var i=0;i<this._gamepads.length;i++){if(this._gamepads[i].justReleased(a,b)===true){return true;}}return false;},isDown:function(a){for(var i=0;i<this._gamepads.length;i++){if(this._gamepads[i].isDown(a)===true){return true;}}return false;},destroy:function(){this.stop();for(var i=0;i<this._gamepads.length;i++){this._gamepads[i].destroy();}}};N.Gamepad.prototype.constructor=N.Gamepad;Object.defineProperty(N.Gamepad.prototype,'active',{get:function(){return this._active;}});Object.defineProperty(N.Gamepad.prototype,'supported',{get:function(){return this._gamepadSupportAvailable;}});Object.defineProperty(N.Gamepad.prototype,'padsConnected',{get:function(){return this._rawPads.length;}});Object.defineProperty(N.Gamepad.prototype,'pad1',{get:function(){return this._gamepads[0];}});Object.defineProperty(N.Gamepad.prototype,'pad2',{get:function(){return this._gamepads[1];}});Object.defineProperty(N.Gamepad.prototype,'pad3',{get:function(){return this._gamepads[2];}});Object.defineProperty(N.Gamepad.prototype,'pad4',{get:function(){return this._gamepads[3];}});N.Gamepad.BUTTON_0=0;N.Gamepad.BUTTON_1=1;N.Gamepad.BUTTON_2=2;N.Gamepad.BUTTON_3=3;N.Gamepad.BUTTON_4=4;N.Gamepad.BUTTON_5=5;N.Gamepad.BUTTON_6=6;N.Gamepad.BUTTON_7=7;N.Gamepad.BUTTON_8=8;N.Gamepad.BUTTON_9=9;N.Gamepad.BUTTON_10=10;N.Gamepad.BUTTON_11=11;N.Gamepad.BUTTON_12=12;N.Gamepad.BUTTON_13=13;N.Gamepad.BUTTON_14=14;N.Gamepad.BUTTON_15=15;N.Gamepad.AXIS_0=0;N.Gamepad.AXIS_1=1;N.Gamepad.AXIS_2=2;N.Gamepad.AXIS_3=3;N.Gamepad.AXIS_4=4;N.Gamepad.AXIS_5=5;N.Gamepad.AXIS_6=6;N.Gamepad.AXIS_7=7;N.Gamepad.AXIS_8=8;N.Gamepad.AXIS_9=9;N.Gamepad.XBOX360_A=0;N.Gamepad.XBOX360_B=1;N.Gamepad.XBOX360_X=2;N.Gamepad.XBOX360_Y=3;N.Gamepad.XBOX360_LEFT_BUMPER=4;N.Gamepad.XBOX360_RIGHT_BUMPER=5;N.Gamepad.XBOX360_LEFT_TRIGGER=6;N.Gamepad.XBOX360_RIGHT_TRIGGER=7;N.Gamepad.XBOX360_BACK=8;N.Gamepad.XBOX360_START=9;N.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;N.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;N.Gamepad.XBOX360_DPAD_LEFT=14;N.Gamepad.XBOX360_DPAD_RIGHT=15;N.Gamepad.XBOX360_DPAD_UP=12;N.Gamepad.XBOX360_DPAD_DOWN=13;N.Gamepad.XBOX360_STICK_LEFT_X=0;N.Gamepad.XBOX360_STICK_LEFT_Y=1;N.Gamepad.XBOX360_STICK_RIGHT_X=2;N.Gamepad.XBOX360_STICK_RIGHT_Y=3;N.Gamepad.PS3XC_X=0;N.Gamepad.PS3XC_CIRCLE=1;N.Gamepad.PS3XC_SQUARE=2;N.Gamepad.PS3XC_TRIANGLE=3;N.Gamepad.PS3XC_L1=4;N.Gamepad.PS3XC_R1=5;N.Gamepad.PS3XC_L2=6;N.Gamepad.PS3XC_R2=7;N.Gamepad.PS3XC_SELECT=8;N.Gamepad.PS3XC_START=9;N.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;N.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;N.Gamepad.PS3XC_DPAD_UP=12;N.Gamepad.PS3XC_DPAD_DOWN=13;N.Gamepad.PS3XC_DPAD_LEFT=14;N.Gamepad.PS3XC_DPAD_RIGHT=15;N.Gamepad.PS3XC_STICK_LEFT_X=0;N.Gamepad.PS3XC_STICK_LEFT_Y=1;N.Gamepad.PS3XC_STICK_RIGHT_X=2;N.Gamepad.PS3XC_STICK_RIGHT_Y=3;N.SinglePad=function(a,b){this.game=a;this.index=null;this.connected=false;this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this.deadZone=0.26;this._padParent=b;this._rawPad=null;this._prevTimestamp=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;};N.SinglePad.prototype={addCallbacks:function(a,b){if(typeof b!=='undefined'){this.onConnectCallback=(typeof b.onConnect==='function')?b.onConnect:this.onConnectCallback;this.onDisconnectCallback=(typeof b.onDisconnect==='function')?b.onDisconnect:this.onDisconnectCallback;this.onDownCallback=(typeof b.onDown==='function')?b.onDown:this.onDownCallback;this.onUpCallback=(typeof b.onUp==='function')?b.onUp:this.onUpCallback;this.onAxisCallback=(typeof b.onAxis==='function')?b.onAxis:this.onAxisCallback;this.onFloatCallback=(typeof b.onFloat==='function')?b.onFloat:this.onFloatCallback;this.callbackContext=a;}},getButton:function(a){if(this._buttons[a]){return this._buttons[a];}else{return null;}},pollStatus:function(){if(!this.connected||!this.game.input.enabled||!this.game.input.gamepad.enabled||!this._rawPad||this._rawPad.timestamp&&this._rawPad.timestamp===this._prevTimestamp){return;}for(var i=0;i<this._buttonsLen;i++){var a=isNaN(this._rawPad.buttons[i])?this._rawPad.buttons[i].value:this._rawPad.buttons[i];if(a!==this._buttons[i].value){if(a===1){this.processButtonDown(i,a);}else if(a===0){this.processButtonUp(i,a);}else{this.processButtonFloat(i,a);}}}for(var b=0;b<this._axesLen;b++){var c=this._rawPad.axes[b];if((c>0&&c>this.deadZone)||(c<0&&c<-this.deadZone)){this.processAxisChange(b,c);}else{this.processAxisChange(b,0);}}this._prevTimestamp=this._rawPad.timestamp;},connect:function(b){var c=!this.connected;this.connected=true;this.index=b.index;this._rawPad=b;this._buttons=[];this._buttonsLen=b.buttons.length;this._axes=[];this._axesLen=b.axes.length;for(var a=0;a<this._axesLen;a++){this._axes[a]=b.axes[a];}for(var d in b.buttons){d=parseInt(d,10);this._buttons[d]=new N.DeviceButton(this,d);}if(c&&this._padParent.onConnectCallback){this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index);}if(c&&this.onConnectCallback){this.onConnectCallback.call(this.callbackContext);}},disconnect:function(){var a=this.connected;var b=this.index;this.connected=false;this.index=null;this._rawPad=undefined;for(var i=0;i<this._buttonsLen;i++){this._buttons[i].destroy();}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;if(a&&this._padParent.onDisconnectCallback){this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,b);}if(a&&this.onDisconnectCallback){this.onDisconnectCallback.call(this.callbackContext);}},destroy:function(){this._rawPad=undefined;for(var i=0;i<this._buttonsLen;i++){this._buttons[i].destroy();}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;},processAxisChange:function(a,b){if(this._axes[a]===b){return;}this._axes[a]=b;if(this._padParent.onAxisCallback){this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,a,b);}if(this.onAxisCallback){this.onAxisCallback.call(this.callbackContext,this,a,b);}},processButtonDown:function(a,b){if(this._buttons[a]){this._buttons[a].start(null,b);}if(this._padParent.onDownCallback){this._padParent.onDownCallback.call(this._padParent.callbackContext,a,b,this.index);}if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,a,b);}},processButtonUp:function(a,b){if(this._padParent.onUpCallback){this._padParent.onUpCallback.call(this._padParent.callbackContext,a,b,this.index);}if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,a,b);}if(this._buttons[a]){this._buttons[a].stop(null,b);}},processButtonFloat:function(a,b){if(this._padParent.onFloatCallback){this._padParent.onFloatCallback.call(this._padParent.callbackContext,a,b,this.index);}if(this.onFloatCallback){this.onFloatCallback.call(this.callbackContext,a,b);}if(this._buttons[a]){this._buttons[a].padFloat(b);}},axis:function(a){if(this._axes[a]){return this._axes[a];}return false;},isDown:function(a){if(this._buttons[a]){return this._buttons[a].isDown;}return false;},isUp:function(a){if(this._buttons[a]){return this._buttons[a].isUp;}return false;},justReleased:function(a,b){if(this._buttons[a]){return this._buttons[a].justReleased(b);}},justPressed:function(a,b){if(this._buttons[a]){return this._buttons[a].justPressed(b);}},buttonValue:function(a){if(this._buttons[a]){return this._buttons[a].value;}return null;},reset:function(){for(var j=0;j<this._axes.length;j++){this._axes[j]=0;}}};N.SinglePad.prototype.constructor=N.SinglePad;N.Key=function(a,b){this.game=a;this._enabled=true;this.event=null;this.isDown=false;this.isUp=true;this.altKey=false;this.ctrlKey=false;this.shiftKey=false;this.timeDown=0;this.duration=0;this.timeUp=-2500;this.durationUp=-2500;this.repeats=0;this.keyCode=b;this.onDown=new N.Signal();this.onHoldCallback=null;this.onHoldContext=null;this.onUp=new N.Signal();this._justDown=false;this._justUp=false;};N.Key.prototype={update:function(){if(!this._enabled){return;}if(this.isDown){this.duration=this.game.time.time-this.timeDown;this.repeats++;if(this.onHoldCallback){this.onHoldCallback.call(this.onHoldContext,this);}}else{this.durationUp=this.game.time.time-this.timeUp;}},processKeyDown:function(a){if(!this._enabled){return;}this.event=a;if(this.isDown){return;}this.altKey=a.altKey;this.ctrlKey=a.ctrlKey;this.shiftKey=a.shiftKey;this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.duration=0;this.durationUp=this.game.time.time-this.timeUp;this.repeats=0;this._justDown=true;this.onDown.dispatch(this);},processKeyUp:function(a){if(!this._enabled){return;}this.event=a;if(this.isUp){return;}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=this.game.time.time-this.timeDown;this.durationUp=0;this._justUp=true;this.onUp.dispatch(this);},reset:function(a){if(a===undefined){a=true;}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=0;this.durationUp=-2500;this._enabled=true;this._justDown=false;this._justUp=false;if(a){this.onDown.removeAll();this.onUp.removeAll();this.onHoldCallback=null;this.onHoldContext=null;}},downDuration:function(a){if(a===undefined){a=50;}return(this.isDown&&this.duration<a);},upDuration:function(a){if(a===undefined){a=50;}return(!this.isDown&&((this.game.time.time-this.timeUp)<a));},justPressed:function(){return(this.isDown&&this.duration===0);},justReleased:function(){return(!this.isDown&&this.durationUp===0);}};Object.defineProperty(N.Key.prototype,'justDown',{get:function(){var a=this._justDown;this._justDown=false;return a;}});Object.defineProperty(N.Key.prototype,'justUp',{get:function(){var a=this._justUp;this._justUp=false;return a;}});Object.defineProperty(N.Key.prototype,'enabled',{get:function(){return this._enabled;},set:function(a){a=!!a;if(a!==this._enabled){if(!a){this.reset(false);}this._enabled=a;}}});N.Key.prototype.constructor=N.Key;N.Keyboard=function(a){this.game=a;this.active=false;this.enabled=true;this.event=null;this.pressEvent=null;this.callbackContext=this;this.onDownCallback=null;this.onPressCallback=null;this.onUpCallback=null;this._keys=[];this._capture=[];this._onKeyDown=null;this._onKeyPress=null;this._onKeyUp=null;this._i=0;this._k=0;};N.Keyboard.prototype={addCallbacks:function(a,b,c,d){this.callbackContext=a;if(b!==undefined&&b!==null){this.onDownCallback=b;}if(c!==undefined&&c!==null){this.onUpCallback=c;}if(d!==undefined&&d!==null){this.onPressCallback=d;}},removeCallbacks:function(){this.callbackContext=this;this.onDownCallback=null;this.onUpCallback=null;this.onPressCallback=null;},addKey:function(a){if(!this._keys[a]){this._keys[a]=new N.Key(this.game,a);this.addKeyCapture(a);}return this._keys[a];},addKeys:function(a){var b={};for(var c in a){b[c]=this.addKey(a[c]);}return b;},removeKey:function(a){if(this._keys[a]){this._keys[a]=null;this.removeKeyCapture(a);}},createCursorKeys:function(){return this.addKeys({up:N.KeyCode.UP,down:N.KeyCode.DOWN,left:N.KeyCode.LEFT,right:N.KeyCode.RIGHT});},start:function(){if(this.game.device.cocoonJS){return false;}if(this.active){return false;}var b=this;this._onKeyDown=function(a){return b.processKeyDown(a);};this._onKeyUp=function(a){return b.processKeyUp(a);};this._onKeyPress=function(a){return b.processKeyPress(a);};window.addEventListener('keydown',this._onKeyDown,false);window.addEventListener('keyup',this._onKeyUp,false);window.addEventListener('keypress',this._onKeyPress,false);this.active=true;return true;},stop:function(){window.removeEventListener('keydown',this._onKeyDown);window.removeEventListener('keyup',this._onKeyUp);window.removeEventListener('keypress',this._onKeyPress);this._onKeyDown=null;this._onKeyUp=null;this._onKeyPress=null;this.active=false;},destroy:function(){this.stop();this.clearCaptures();this._keys.length=0;this._i=0;},addKeyCapture:function(a){if(typeof a==='object'){for(var b in a){this._capture[a[b]]=true;}}else{this._capture[a]=true;}},removeKeyCapture:function(a){delete this._capture[a];},clearCaptures:function(){this._capture={};},update:function(){this._i=this._keys.length;while(this._i--){if(this._keys[this._i]){this._keys[this._i].update();}}},processKeyDown:function(a){this.event=a;if(!this.game.input.enabled||!this.enabled){return;}var b=a.keyCode;if(this._capture[b]){a.preventDefault();}if(!this._keys[b]){this._keys[b]=new N.Key(this.game,b);}this._keys[b].processKeyDown(a);this._k=b;if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,a);}},processKeyPress:function(a){this.pressEvent=a;if(!this.game.input.enabled||!this.enabled){return;}if(this.onPressCallback){this.onPressCallback.call(this.callbackContext,String.fromCharCode(a.charCode),a);}},processKeyUp:function(a){this.event=a;if(!this.game.input.enabled||!this.enabled){return;}var b=a.keyCode;if(this._capture[b]){a.preventDefault();}if(!this._keys[b]){this._keys[b]=new N.Key(this.game,b);}this._keys[b].processKeyUp(a);if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,a);}},reset:function(a){if(a===undefined){a=true;}this.event=null;var i=this._keys.length;while(i--){if(this._keys[i]){this._keys[i].reset(a);}}},downDuration:function(a,b){if(this._keys[a]){return this._keys[a].downDuration(b);}else{return null;}},upDuration:function(a,b){if(this._keys[a]){return this._keys[a].upDuration(b);}else{return null;}},justPressed:function(a){if(this._keys[a]){return this._keys[a].justPressed();}else{return null;}},justReleased:function(a){if(this._keys[a]){return this._keys[a].justReleased();}else{return null;}},isDown:function(a){if(this._keys[a]){return this._keys[a].isDown;}else{return null;}}};Object.defineProperty(N.Keyboard.prototype,'lastChar',{get:function(){if(this.event&&this.event.charCode===32){return'';}else if(this.pressEvent){return String.fromCharCode(this.pressEvent.charCode);}else{return null;}}});Object.defineProperty(N.Keyboard.prototype,'lastKey',{get:function(){return this._keys[this._k];}});N.Keyboard.prototype.constructor=N.Keyboard;N.KeyCode={A:'A'.charCodeAt(0),B:'B'.charCodeAt(0),C:'C'.charCodeAt(0),D:'D'.charCodeAt(0),E:'E'.charCodeAt(0),F:'F'.charCodeAt(0),G:'G'.charCodeAt(0),H:'H'.charCodeAt(0),I:'I'.charCodeAt(0),J:'J'.charCodeAt(0),K:'K'.charCodeAt(0),L:'L'.charCodeAt(0),M:'M'.charCodeAt(0),N:'N'.charCodeAt(0),O:'O'.charCodeAt(0),P:'P'.charCodeAt(0),Q:'Q'.charCodeAt(0),R:'R'.charCodeAt(0),S:'S'.charCodeAt(0),T:'T'.charCodeAt(0),U:'U'.charCodeAt(0),V:'V'.charCodeAt(0),W:'W'.charCodeAt(0),X:'X'.charCodeAt(0),Y:'Y'.charCodeAt(0),Z:'Z'.charCodeAt(0),ZERO:'0'.charCodeAt(0),ONE:'1'.charCodeAt(0),TWO:'2'.charCodeAt(0),THREE:'3'.charCodeAt(0),FOUR:'4'.charCodeAt(0),FIVE:'5'.charCodeAt(0),SIX:'6'.charCodeAt(0),SEVEN:'7'.charCodeAt(0),EIGHT:'8'.charCodeAt(0),NINE:'9'.charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144};for(var P in N.KeyCode){if(N.KeyCode.hasOwnProperty(P)&&!P.match(/[a-z]/)){N.Keyboard[P]=N.KeyCode[P];}}N.Component=function(){};N.Component.Angle=function(){};N.Component.Angle.prototype={angle:{get:function(){return N.Math.wrapAngle(N.Math.radToDeg(this.rotation));},set:function(a){this.rotation=N.Math.degToRad(N.Math.wrapAngle(a));}}};N.Component.Animation=function(){};N.Component.Animation.prototype={play:function(a,b,c,d){if(this.animations){return this.animations.play(a,b,c,d);}}};N.Component.AutoCull=function(){};N.Component.AutoCull.prototype={autoCull:false,inCamera:{get:function(){if(!this.autoCull&&!this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y;}return this.game.world.camera.view.intersects(this._bounds);}}};N.Component.Bounds=function(){};N.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width;}},offsetY:{get:function(){return this.anchor.y*this.height;}},centerX:{get:function(){return(this.x-this.offsetX)+(this.width*0.5);},set:function(a){this.x=(a+this.offsetX)-(this.width*0.5);}},centerY:{get:function(){return(this.y-this.offsetY)+(this.height*0.5);},set:function(a){this.y=(a+this.offsetY)-(this.height*0.5);}},left:{get:function(){return this.x-this.offsetX;},set:function(a){this.x=a+this.offsetX;}},right:{get:function(){return(this.x+this.width)-this.offsetX;},set:function(a){this.x=a-(this.width)+this.offsetX;}},top:{get:function(){return this.y-this.offsetY;},set:function(a){this.y=a+this.offsetY;}},bottom:{get:function(){return(this.y+this.height)-this.offsetY;},set:function(a){this.y=a-(this.height)+this.offsetY;}},alignIn:function(a,b,c,d){if(c===undefined){c=0;}if(d===undefined){d=0;}switch(b){default:case N.TOP_LEFT:this.left=a.left-c;this.top=a.top-d;break;case N.TOP_CENTER:this.centerX=a.centerX+c;this.top=a.top-d;break;case N.TOP_RIGHT:this.right=a.right+c;this.top=a.top-d;break;case N.LEFT_CENTER:this.left=a.left-c;this.centerY=a.centerY+d;break;case N.CENTER:this.centerX=a.centerX+c;this.centerY=a.centerY+d;break;case N.RIGHT_CENTER:this.right=a.right+c;this.centerY=a.centerY+d;break;case N.BOTTOM_LEFT:this.left=a.left-c;this.bottom=a.bottom+d;break;case N.BOTTOM_CENTER:this.centerX=a.centerX+c;this.bottom=a.bottom+d;break;case N.BOTTOM_RIGHT:this.right=a.right+c;this.bottom=a.bottom+d;break;}return this;},alignTo:function(a,b,c,d){if(c===undefined){c=0;}if(d===undefined){d=0;}switch(b){default:case N.TOP_LEFT:this.left=a.left-c;this.bottom=a.top-d;break;case N.TOP_CENTER:this.centerX=a.centerX+c;this.bottom=a.top-d;break;case N.TOP_RIGHT:this.right=a.right+c;this.bottom=a.top-d;break;case N.LEFT_TOP:this.right=a.left-c;this.top=a.top-d;break;case N.LEFT_CENTER:this.right=a.left-c;this.centerY=a.centerY+d;break;case N.LEFT_BOTTOM:this.right=a.left-c;this.bottom=a.bottom+d;break;case N.RIGHT_TOP:this.left=a.right+c;this.top=a.top-d;break;case N.RIGHT_CENTER:this.left=a.right+c;this.centerY=a.centerY+d;break;case N.RIGHT_BOTTOM:this.left=a.right+c;this.bottom=a.bottom+d;break;case N.BOTTOM_LEFT:this.left=a.left-c;this.top=a.bottom+d;break;case N.BOTTOM_CENTER:this.centerX=a.centerX+c;this.top=a.bottom+d;break;case N.BOTTOM_RIGHT:this.right=a.right+c;this.top=a.bottom+d;break;}return this;}};N.Group.prototype.alignIn=N.Component.Bounds.prototype.alignIn;N.Group.prototype.alignTo=N.Component.Bounds.prototype.alignTo;N.Component.BringToTop=function(){};N.Component.BringToTop.prototype.bringToTop=function(){if(this.parent&&this.parent.bringChildToTop){this.parent.bringChildToTop(this);}return this;};N.Component.BringToTop.prototype.sendToBack=function(){if(this.parent&&this.parent.sendChildToBack){this.parent.sendChildToBack(this);}return this;};N.Component.BringToTop.prototype.moveUp=function(){if(this.parent){this.parent.moveUp(this);}return this;};N.Component.BringToTop.prototype.moveDown=function(){if(this.parent){this.parent.moveDown(this);}return this;};N.Component.Core=function(){};N.Component.Core.install=function(a){N.Utils.mixinPrototype(this,N.Component.Core.prototype);this.components={};for(var i=0;i<a.length;i++){var b=a[i];var c=false;if(b==='Destroy'){c=true;}N.Utils.mixinPrototype(this,N.Component[b].prototype,c);this.components[b]=true;}};N.Component.Core.init=function(a,x,y,b,c){this.game=a;this.key=b;this.data={};this.position.set(x,y);this.world=new N.Point(x,y);this.previousPosition=new N.Point(x,y);this.events=new N.Events(this);this._bounds=new N.Rectangle();if(this.components.PhysicsBody){this.body=this.body;}if(this.components.Animation){this.animations=new N.AnimationManager(this);}if(this.components.LoadTexture&&b!==null){this.loadTexture(b,c);}if(this.components.FixedToCamera){this.cameraOffset=new N.Point(x,y);}};N.Component.Core.preUpdate=function(){if(this.pendingDestroy){this.destroy();return false;}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false;}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this.renderOrderID=this.game.stage.currentRenderOrderID++;}if(this.animations){this.animations.update();}if(this.body){this.body.preUpdate();}this.preUpdateChildren();return true;};N.Component.Core.prototype={game:null,name:'',data:{},components:{},z:0,events:undefined,animations:undefined,key:'',world:null,debug:false,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:true,pendingDestroy:false,_bounds:null,_exists:true,exists:{get:function(){return this._exists;},set:function(a){if(a){this._exists=true;if(this.body&&this.body.type===N.Physics.P2JS){this.body.addToWorld();}this.visible=true;}else{this._exists=false;if(this.body&&this.body.type===N.Physics.P2JS){this.body.removeFromWorld();}this.visible=false;}}},preUpdateChildren:function(){var i=0;while(i<this.children.length){var a=this.children[i];a.preUpdate();if(this===a.parent){i++;}}},update:function(){},postUpdate:function(){if(this.customRender){this.key.render();}if(this.components.PhysicsBody){N.Component.PhysicsBody.postUpdate.call(this);}if(this.components.FixedToCamera){N.Component.FixedToCamera.postUpdate.call(this);}for(var i=0;i<this.children.length;i++){this.children[i].postUpdate();}}};N.Component.Crop=function(){};N.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(a,b){if(b===undefined){b=false;}if(a){if(b&&this.cropRect!==null){this.cropRect.setTo(a.x,a.y,a.width,a.height);}else if(b&&this.cropRect===null){this.cropRect=new N.Rectangle(a.x,a.y,a.width,a.height);}else{this.cropRect=a;}this.updateCrop();}else{this._crop=null;this.cropRect=null;this.resetFrame();}},updateCrop:function(){if(!this.cropRect){return;}var a=this.texture.crop.x;var b=this.texture.crop.y;var c=this.texture.crop.width;var d=this.texture.crop.height;this._crop=N.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var e=Math.max(this._frame.x,this._crop.x);var f=Math.max(this._frame.y,this._crop.y);var g=Math.min(this._frame.right,this._crop.right)-e;var h=Math.min(this._frame.bottom,this._crop.bottom)-f;this.texture.crop.x=e;this.texture.crop.y=f;this.texture.crop.width=g;this.texture.crop.height=h;this.texture.frame.width=Math.min(g,this.cropRect.width);this.texture.frame.height=Math.min(h,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.texture._updateUvs();if(this.tint!==0xffffff&&(a!==e||b!==f||c!==g||d!==h)){this.texture.requiresReTint=true;}}};N.Component.Delta=function(){};N.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x;}},deltaY:{get:function(){return this.world.y-this.previousPosition.y;}},deltaZ:{get:function(){return this.rotation-this.previousRotation;}}};N.Component.Destroy=function(){};N.Component.Destroy.prototype={destroyPhase:false,destroy:function(a,b){if(this.game===null||this.destroyPhase){return;}if(a===undefined){a=true;}if(b===undefined){b=false;}this.destroyPhase=true;if(this.events){this.events.onDestroy$dispatch(this);}if(this.parent){if(this.parent instanceof N.Group){this.parent.remove(this);}else{this.parent.removeChild(this);}}if(this.input){this.input.destroy();}if(this.animations){this.animations.destroy();}if(this.body){this.body.destroy();}if(this.events){this.events.destroy();}this.game.tweens.removeFrom(this);var i=this.children.length;if(a){while(i--){this.children[i].destroy(a);}}else{while(i--){this.removeChild(this.children[i]);}}if(this._crop){this._crop=null;this.cropRect=null;}if(this._frame){this._frame=null;}if(N.Video&&this.key instanceof N.Video){this.key.onChangeSource.remove(this.resizeFrame,this);}if(N.BitmapText&&this._glyphs){this._glyphs=[];}this.alive=false;this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this.data={};this.renderable=false;if(this.transformCallback){this.transformCallback=null;this.transformCallbackContext=null;}this.hitArea=null;this.parent=null;this.stage=null;this.worldTransform=null;this.filterArea=null;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite();this._destroyTintedTexture();if(b){this.texture.destroy(true);}this.destroyPhase=false;this.pendingDestroy=false;}};N.Events=function(a){this.parent=a;};N.Events.prototype={destroy:function(){this._parent=null;if(this._onDestroy){this._onDestroy.dispose();}if(this._onAddedToGroup){this._onAddedToGroup.dispose();}if(this._onRemovedFromGroup){this._onRemovedFromGroup.dispose();}if(this._onKilled){this._onKilled.dispose();}if(this._onRevived){this._onRevived.dispose();}if(this._onEnterBounds){this._onEnterBounds.dispose();}if(this._onOutOfBounds){this._onOutOfBounds.dispose();}if(this._onInputOver){this._onInputOver.dispose();}if(this._onInputOut){this._onInputOut.dispose();}if(this._onInputDown){this._onInputDown.dispose();}if(this._onInputUp){this._onInputUp.dispose();}if(this._onDragStart){this._onDragStart.dispose();}if(this._onDragUpdate){this._onDragUpdate.dispose();}if(this._onDragStop){this._onDragStop.dispose();}if(this._onAnimationStart){this._onAnimationStart.dispose();}if(this._onAnimationComplete){this._onAnimationComplete.dispose();}if(this._onAnimationLoop){this._onAnimationLoop.dispose();}},onAddedToGroup:null,onRemovedFromGroup:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null};N.Events.prototype.constructor=N.Events;for(var Q in N.Events.prototype){if(!N.Events.prototype.hasOwnProperty(Q)||Q.indexOf('on')!==0||N.Events.prototype[Q]!==null){continue;}(function(a,b){'use strict';Object.defineProperty(N.Events.prototype,a,{get:function(){return this[b]||(this[b]=new N.Signal());}});N.Events.prototype[a+'$dispatch']=function(){return this[b]?this[b].dispatch.apply(this[b],arguments):null;};})(Q,'_'+Q);}N.Component.FixedToCamera=function(){};N.Component.FixedToCamera.postUpdate=function(){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y;}};N.Component.FixedToCamera.prototype={_fixedToCamera:false,fixedToCamera:{get:function(){return this._fixedToCamera;},set:function(a){if(a){this._fixedToCamera=true;this.cameraOffset.set(this.x,this.y);}else{this._fixedToCamera=false;}}},cameraOffset:new N.Point()};N.Component.Health=function(){};N.Component.Health.prototype={health:1,maxHealth:100,damage:function(a){if(this.alive){this.health-=a;if(this.health<=0){this.kill();}}return this;},setHealth:function(a){this.health=a;if(this.health>this.maxHealth){this.health=this.maxHealth;}return this;},heal:function(a){if(this.alive){this.health+=a;if(this.health>this.maxHealth){this.health=this.maxHealth;}}return this;}};N.Component.InCamera=function(){};N.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds);}}};N.Component.InputEnabled=function(){};N.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return(this.input&&this.input.enabled);},set:function(a){if(a){if(this.input===null){this.input=new N.InputHandler(this);this.input.start();}else if(this.input&&!this.input.enabled){this.input.start();}}else if(this.input&&this.input.enabled){this.input.stop();}}}};N.Component.InWorld=function(){};N.Component.InWorld.preUpdate=function(){if(this.pendingDestroy){this.destroy();return false;}if(this.autoCull||this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y;if(this.autoCull){if(this.game.world.camera.view.intersects(this._bounds)){this.renderable=true;this.game.world.camera.totalInView++;}else{this.renderable=false;if(this.outOfCameraBoundsKill){this.kill();return false;}}}if(this.checkWorldBounds){if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=false;this.events.onEnterBounds$dispatch(this);}else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=true;this.events.onOutOfBounds$dispatch(this);if(this.outOfBoundsKill){this.kill();return false;}}}}return true;};N.Component.InWorld.prototype={checkWorldBounds:false,outOfBoundsKill:false,outOfCameraBoundsKill:false,_outOfBoundsFired:false,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds());}}};N.Component.LifeSpan=function(){};N.Component.LifeSpan.preUpdate=function(){if(this.pendingDestroy){this.destroy();return false;}if(this.lifespan>0){this.lifespan-=this.game.time.delta;if(this.lifespan<=0){this.kill();return false;}}return true;};N.Component.LifeSpan.prototype={alive:true,lifespan:0,revive:function(a){if(a===undefined){a=100;}this.alive=true;this.exists=true;this.visible=true;if(typeof this.setHealth==='function'){this.setHealth(a);}if(this.events){this.events.onRevived$dispatch(this);}return this;},kill:function(){this.alive=false;this.exists=false;this.visible=false;if(this.events){this.events.onKilled$dispatch(this);}return this;}};N.Component.LoadTexture=function(){};N.Component.LoadTexture.prototype={customRender:false,_frame:null,loadTexture:function(a,b,c){if(a===N.PENDING_ATLAS){a=b;b=0;}else{b=b||0;}if((c||c===undefined)&&this.animations){this.animations.stop();}this.key=a;this.customRender=false;var d=this.game.cache;var e=true;var f=this.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR;if(N.RenderTexture&&a instanceof N.RenderTexture){this.key=a.key;this.setTexture(a);}else if(N.BitmapData&&a instanceof N.BitmapData){this.customRender=true;this.setTexture(a.texture);if(d.hasFrameData(a.key,N.Cache.BITMAPDATA)){e=!this.animations.loadFrameData(d.getFrameData(a.key,N.Cache.BITMAPDATA),b);}else{e=!this.animations.loadFrameData(a.frameData,0);}}else if(N.Video&&a instanceof N.Video){this.customRender=true;var g=a.texture.valid;this.setTexture(a.texture);this.setFrame(a.texture.frame.clone());a.onChangeSource.add(this.resizeFrame,this);this.texture.valid=g;}else if(N.Tilemap&&a instanceof N.TilemapLayer){this.setTexture(PIXI.Texture.fromCanvas(a.canvas));}else if(a instanceof PIXI.Texture){f=a.baseTexture.scaleMode===PIXI.scaleModes.LINEAR;this.setTexture(a);}else{var h=d.getImage(a,true);this.key=h.key;this.setTexture(new PIXI.Texture(h.base));if(a==='__default'){this.texture.baseTexture.skipRender=true;}else{this.texture.baseTexture.skipRender=false;}e=!this.animations.loadFrameData(h.frameData,b);}if(e){this._frame=N.Rectangle.clone(this.texture.frame);}if(!f){this.texture.baseTexture.scaleMode=1;}},setFrame:function(a){this._frame=a;this.texture.frame.x=a.x;this.texture.frame.y=a.y;this.texture.frame.width=a.width;this.texture.frame.height=a.height;this.texture.crop.x=a.x;this.texture.crop.y=a.y;this.texture.crop.width=a.width;this.texture.crop.height=a.height;if(a.trimmed){if(this.texture.trim){this.texture.trim.x=a.spriteSourceSizeX;this.texture.trim.y=a.spriteSourceSizeY;this.texture.trim.width=a.sourceSizeW;this.texture.trim.height=a.sourceSizeH;}else{this.texture.trim={x:a.spriteSourceSizeX,y:a.spriteSourceSizeY,width:a.sourceSizeW,height:a.sourceSizeH};}this.texture.width=a.sourceSizeW;this.texture.height=a.sourceSizeH;this.texture.frame.width=a.sourceSizeW;this.texture.frame.height=a.sourceSizeH;}else if(!a.trimmed&&this.texture.trim){this.texture.trim=null;}if(a.rotated){this.texture.rotated=true;}if(this.cropRect){this.updateCrop();}this.texture.requiresReTint=true;this.texture._updateUvs();if(this.tilingTexture){this.refreshTexture=true;}},resizeFrame:function(a,b,c){this.texture.frame.resize(b,c);this.texture.setFrame(this.texture.frame);},resetFrame:function(){if(this._frame){this.setFrame(this._frame);}},frame:{get:function(){return this.animations.frame;},set:function(a){this.animations.frame=a;}},frameName:{get:function(){return this.animations.frameName;},set:function(a){this.animations.frameName=a;}}};N.Component.Overlap=function(){};N.Component.Overlap.prototype={overlap:function(a){return N.Rectangle.intersects(this.getBounds(),a.getBounds());}};N.Component.PhysicsBody=function(){};N.Component.PhysicsBody.preUpdate=function(){if(this.pendingDestroy){this.destroy();return false;}if(this.fresh&&this.exists){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(this.body){this.body.preUpdate();}this.fresh=false;this.preUpdateChildren();return false;}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this._exists||!this.parent.exists){this.renderOrderID=-1;return false;}return true;};N.Component.PhysicsBody.postUpdate=function(){if(this.exists&&this.body){this.body.postUpdate();}};N.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x;},set:function(a){this.position.x=a;if(this.body&&!this.body.dirty){this.body._reset=true;}}},y:{get:function(){return this.position.y;},set:function(a){this.position.y=a;if(this.body&&!this.body.dirty){this.body._reset=true;}}}};N.Component.Reset=function(){};N.Component.Reset.prototype.reset=function(x,y,a){if(a===undefined){a=1;}this.world.set(x,y);this.position.set(x,y);this.fresh=true;this.exists=true;this.visible=true;this.renderable=true;if(this.components.InWorld){this._outOfBoundsFired=false;}if(this.components.LifeSpan){this.alive=true;this.health=a;}if(this.components.PhysicsBody){if(this.body){this.body.reset(x,y,false,false);}}return this;};N.Component.ScaleMinMax=function(){};N.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(a){if(this.scaleMin){if(a.a<this.scaleMin.x){a.a=this.scaleMin.x;}if(a.d<this.scaleMin.y){a.d=this.scaleMin.y;}}if(this.scaleMax){if(a.a>this.scaleMax.x){a.a=this.scaleMax.x;}if(a.d>this.scaleMax.y){a.d=this.scaleMax.y;}}},setScaleMinMax:function(a,b,c,d){if(b===undefined){b=c=d=a;}else if(c===undefined){c=d=b;b=a;}if(a===null){this.scaleMin=null;}else if(this.scaleMin){this.scaleMin.set(a,b);}else{this.scaleMin=new N.Point(a,b);}if(c===null){this.scaleMax=null;}else if(this.scaleMax){this.scaleMax.set(c,d);}else{this.scaleMax=new N.Point(c,d);}if(this.scaleMin===null){this.transformCallback=null;}else{this.transformCallback=this.checkTransform;this.transformCallbackContext=this;}}};N.Component.Smoothed=function(){};N.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode;},set:function(a){if(a){if(this.texture){if(this.texture.baseTexture.scaleMode!==0){this.texture.baseTexture.scaleMode=0;this.texture.baseTexture.dirty();}}}else if(this.texture){if(this.texture.baseTexture.scaleMode!==1){this.texture.baseTexture.scaleMode=1;this.texture.baseTexture.dirty();}}}}};N.GameObjectFactory=function(a){this.game=a;this.world=this.game.world;};N.GameObjectFactory.prototype={existing:function(a){return this.world.add(a);},weapon:function(a,b,c,d,e){var f=this.game.plugins.add(N.Weapon);if(e){f.bulletClass=e;}f.createBullets(a,b,c,d);return f;},image:function(x,y,a,b,c){if(c===undefined){c=this.world;}return c.add(new N.Image(this.game,x,y,a,b));},sprite:function(x,y,a,b,c){if(c===undefined){c=this.world;}return c.add(new N.Sprite(this.game,x,y,a,b));},creature:function(x,y,a,b,c,d,e){if(c===undefined){c=this.world;}var f=new N.Creature(this.game,x,y,a,b,d,e);c.add(f);return f;},tween:function(a){return this.game.tweens.create(a);},group:function(a,b,c,d,e){return new N.Group(this.game,a,b,c,d,e);},physicsGroup:function(a,b,c,d){return new N.Group(this.game,b,c,d,true,a);},spriteBatch:function(a,b,c){if(a===undefined){a=null;}if(b===undefined){b='group';}if(c===undefined){c=false;}return new N.SpriteBatch(this.game,a,b,c);},audio:function(a,b,c,d){return this.game.sound.add(a,b,c,d);},sound:function(a,b,c,d){return this.game.sound.add(a,b,c,d);},audioSprite:function(a){return this.game.sound.addSprite(a);},tileSprite:function(x,y,a,b,c,d,e){if(e===undefined){e=this.world;}return e.add(new N.TileSprite(this.game,x,y,a,b,c,d));},rope:function(x,y,a,b,c,d){if(d===undefined){d=this.world;}return d.add(new N.Rope(this.game,x,y,a,b,c));},text:function(x,y,a,b,c){if(c===undefined){c=this.world;}return c.add(new N.Text(this.game,x,y,a,b));},button:function(x,y,a,b,c,d,e,f,g,h){if(h===undefined){h=this.world;}return h.add(new N.Button(this.game,x,y,a,b,c,d,e,f,g));},graphics:function(x,y,a){if(a===undefined){a=this.world;}return a.add(new N.Graphics(this.game,x,y));},emitter:function(x,y,a){return this.game.particles.add(new N.Particles.Arcade.Emitter(this.game,x,y,a));},retroFont:function(a,b,c,d,e,f,g,h,i){return new N.RetroFont(this.game,a,b,c,d,e,f,g,h,i);},bitmapText:function(x,y,a,b,c,d){if(d===undefined){d=this.world;}return d.add(new N.BitmapText(this.game,x,y,a,b,c));},tilemap:function(a,b,c,d,e){return new N.Tilemap(this.game,a,b,c,d,e);},renderTexture:function(a,b,c,d){if(c===undefined||c===''){c=this.game.rnd.uuid();}if(d===undefined){d=false;}var e=new N.RenderTexture(this.game,a,b,c);if(d){this.game.cache.addRenderTexture(c,e);}return e;},video:function(a,b){return new N.Video(this.game,a,b);},bitmapData:function(a,b,c,d){if(d===undefined){d=false;}if(c===undefined||c===''){c=this.game.rnd.uuid();}var e=new N.BitmapData(this.game,c,a,b);if(d){this.game.cache.addBitmapData(c,e);}return e;},filter:function(a){var b=Array.prototype.slice.call(arguments,1);var a=new N.Filter[a](this.game);a.init.apply(a,b);return a;},plugin:function(){return this.game.plugins.add.apply(this.game.plugins,arguments);}};N.GameObjectFactory.prototype.constructor=N.GameObjectFactory;N.GameObjectCreator=function(a){this.game=a;this.world=this.game.world;};N.GameObjectCreator.prototype={image:function(x,y,a,b){return new N.Image(this.game,x,y,a,b);},sprite:function(x,y,a,b){return new N.Sprite(this.game,x,y,a,b);},tween:function(a){return new N.Tween(a,this.game,this.game.tweens);},group:function(a,b,c,d,e){return new N.Group(this.game,a||null,b,c,d,e);},spriteBatch:function(a,b,c){if(b===undefined){b='group';}if(c===undefined){c=false;}return new N.SpriteBatch(this.game,a,b,c);},audio:function(a,b,c,d){return this.game.sound.add(a,b,c,d);},audioSprite:function(a){return this.game.sound.addSprite(a);},sound:function(a,b,c,d){return this.game.sound.add(a,b,c,d);},tileSprite:function(x,y,a,b,c,d){return new N.TileSprite(this.game,x,y,a,b,c,d);},rope:function(x,y,a,b,c){return new N.Rope(this.game,x,y,a,b,c);},text:function(x,y,a,b){return new N.Text(this.game,x,y,a,b);},button:function(x,y,a,b,c,d,e,f,g){return new N.Button(this.game,x,y,a,b,c,d,e,f,g);},graphics:function(x,y){return new N.Graphics(this.game,x,y);},emitter:function(x,y,a){return new N.Particles.Arcade.Emitter(this.game,x,y,a);},retroFont:function(a,b,c,d,e,f,g,h,i){return new N.RetroFont(this.game,a,b,c,d,e,f,g,h,i);},bitmapText:function(x,y,a,b,c,d){return new N.BitmapText(this.game,x,y,a,b,c,d);},tilemap:function(a,b,c,d,e){return new N.Tilemap(this.game,a,b,c,d,e);},renderTexture:function(a,b,c,d){if(c===undefined||c===''){c=this.game.rnd.uuid();}if(d===undefined){d=false;}var e=new N.RenderTexture(this.game,a,b,c);if(d){this.game.cache.addRenderTexture(c,e);}return e;},bitmapData:function(a,b,c,d){if(d===undefined){d=false;}if(c===undefined||c===''){c=this.game.rnd.uuid();}var e=new N.BitmapData(this.game,c,a,b);if(d){this.game.cache.addBitmapData(c,e);}return e;},filter:function(a){var b=Array.prototype.slice.call(arguments,1);var a=new N.Filter[a](this.game);a.init.apply(a,b);return a;}};N.GameObjectCreator.prototype.constructor=N.GameObjectCreator;N.Sprite=function(a,x,y,b,c){x=x||0;y=y||0;b=b||null;c=c||null;this.type=N.SPRITE;this.physicsType=N.SPRITE;PIXI.Sprite.call(this,N.Cache.DEFAULT);N.Component.Core.init.call(this,a,x,y,b,c);};N.Sprite.prototype=Object.create(PIXI.Sprite.prototype);N.Sprite.prototype.constructor=N.Sprite;N.Component.Core.install.call(N.Sprite.prototype,['Angle','Animation','AutoCull','Bounds','BringToTop','Crop','Delta','Destroy','FixedToCamera','Health','InCamera','InputEnabled','InWorld','LifeSpan','LoadTexture','Overlap','PhysicsBody','Reset','ScaleMinMax','Smoothed']);N.Sprite.prototype.preUpdatePhysics=N.Component.PhysicsBody.preUpdate;N.Sprite.prototype.preUpdateLifeSpan=N.Component.LifeSpan.preUpdate;N.Sprite.prototype.preUpdateInWorld=N.Component.InWorld.preUpdate;N.Sprite.prototype.preUpdateCore=N.Component.Core.preUpdate;N.Sprite.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false;}return this.preUpdateCore();};N.Image=function(a,x,y,b,c){x=x||0;y=y||0;b=b||null;c=c||null;this.type=N.IMAGE;PIXI.Sprite.call(this,N.Cache.DEFAULT);N.Component.Core.init.call(this,a,x,y,b,c);};N.Image.prototype=Object.create(PIXI.Sprite.prototype);N.Image.prototype.constructor=N.Image;N.Component.Core.install.call(N.Image.prototype,['Angle','Animation','AutoCull','Bounds','BringToTop','Crop','Destroy','FixedToCamera','InputEnabled','LifeSpan','LoadTexture','Overlap','Reset','ScaleMinMax','Smoothed']);N.Image.prototype.preUpdateLifeSpan=N.Component.LifeSpan.preUpdate;N.Image.prototype.preUpdateInWorld=N.Component.InWorld.preUpdate;N.Image.prototype.preUpdateCore=N.Component.Core.preUpdate;N.Image.prototype.preUpdate=function(){if(!this.preUpdateInWorld()||!this.preUpdateLifeSpan()){return false;}return this.preUpdateCore();};N.Button=function(a,x,y,b,c,d,e,f,g,h){x=x||0;y=y||0;b=b||null;c=c||null;d=d||this;N.Image.call(this,a,x,y,b,f);this.type=N.BUTTON;this.physicsType=N.SPRITE;this._onOverFrame=null;this._onOutFrame=null;this._onDownFrame=null;this._onUpFrame=null;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker='';this.onOutSoundMarker='';this.onDownSoundMarker='';this.onUpSoundMarker='';this.onInputOver=new N.Signal();this.onInputOut=new N.Signal();this.onInputDown=new N.Signal();this.onInputUp=new N.Signal();this.onOverMouseOnly=true;this.justReleasedPreventsOver=N.PointerMode.CONTACT;this.freezeFrames=false;this.forceOut=false;this.inputEnabled=true;this.input.start(0,true);this.input.useHandCursor=true;this.setFrames(e,f,g,h);if(c!==null){this.onInputUp.add(c,d);}this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this);};N.Button.prototype=Object.create(N.Image.prototype);N.Button.prototype.constructor=N.Button;var R='Over';var S='Out';var T='Down';var U='Up';N.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null);};N.Button.prototype.setStateFrame=function(a,b,c){var d='_on'+a+'Frame';if(b!==null){this[d]=b;if(c){this.changeStateFrame(a);}}else{this[d]=null;}};N.Button.prototype.changeStateFrame=function(a){if(this.freezeFrames){return false;}var b='_on'+a+'Frame';var c=this[b];if(typeof c==='string'){this.frameName=c;return true;}else if(typeof c==='number'){this.frame=c;return true;}else{return false;}};N.Button.prototype.setFrames=function(a,b,c,d){this.setStateFrame(R,a,this.input.pointerOver());this.setStateFrame(S,b,!this.input.pointerOver());this.setStateFrame(T,c,this.input.pointerDown());this.setStateFrame(U,d,this.input.pointerUp());};N.Button.prototype.setStateSound=function(a,b,c){var d='on'+a+'Sound';var e='on'+a+'SoundMarker';if(b instanceof N.Sound||b instanceof N.AudioSprite){this[d]=b;this[e]=typeof c==='string'?c:'';}else{this[d]=null;this[e]='';}};N.Button.prototype.playStateSound=function(a){var b='on'+a+'Sound';var c=this[b];if(c){var d='on'+a+'SoundMarker';var e=this[d];c.play(e);return true;}else{return false;}};N.Button.prototype.setSounds=function(a,b,c,d,e,f,g,h){this.setStateSound(R,a,b);this.setStateSound(S,e,f);this.setStateSound(T,c,d);this.setStateSound(U,g,h);};N.Button.prototype.setOverSound=function(a,b){this.setStateSound(R,a,b);};N.Button.prototype.setOutSound=function(a,b){this.setStateSound(S,a,b);};N.Button.prototype.setDownSound=function(a,b){this.setStateSound(T,a,b);};N.Button.prototype.setUpSound=function(a,b){this.setStateSound(U,a,b);};N.Button.prototype.onInputOverHandler=function(a,b){if(b.justReleased()&&(this.justReleasedPreventsOver&b.pointerMode)===b.pointerMode){return;}this.changeStateFrame(R);if(this.onOverMouseOnly&&!b.isMouse){return;}this.playStateSound(R);if(this.onInputOver){this.onInputOver.dispatch(this,b);}};N.Button.prototype.onInputOutHandler=function(a,b){this.changeStateFrame(S);this.playStateSound(S);if(this.onInputOut){this.onInputOut.dispatch(this,b);}};N.Button.prototype.onInputDownHandler=function(a,b){this.changeStateFrame(T);this.playStateSound(T);if(this.onInputDown){this.onInputDown.dispatch(this,b);}};N.Button.prototype.onInputUpHandler=function(a,b,c){this.playStateSound(U);if(this.onInputUp){this.onInputUp.dispatch(this,b,c);}if(this.freezeFrames){return;}if(this.forceOut===true||(this.forceOut&b.pointerMode)===b.pointerMode){this.changeStateFrame(S);}else{var d=this.changeStateFrame(U);if(!d){if(c){this.changeStateFrame(R);}else{this.changeStateFrame(S);}}}};N.SpriteBatch=function(a,b,c,d){if(b===undefined||b===null){b=a.world;}N.Group.call(this,a,b,c,d);this.type=N.SPRITEBATCH;this.fastSpriteBatch=null;this.ready=false;};N.SpriteBatch.prototype=Object.create(N.Group.prototype);N.SpriteBatch.prototype.constructor=N.SpriteBatch;N.SpriteBatch.prototype._renderWebGL=function(a){if(!this.visible||this.alpha<=0||!this.children.length){return;}if(!this.ready){this.fastSpriteBatch=new PIXI.WebGLFastSpriteBatch(a.gl);this.ready=true;}if(this.fastSpriteBatch.gl!==a.gl){this.fastSpriteBatch.setContext(a.gl);}a.spriteBatch.stop();a.shaderManager.setShader(a.shaderManager.fastShader);this.fastSpriteBatch.begin(this,a);this.fastSpriteBatch.render(this);a.spriteBatch.start();};N.SpriteBatch.prototype._renderCanvas=function(a){if(!this.visible||this.alpha<=0||!this.children.length){return;}var b=a.context;b.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();var c=this.worldTransform;var d=true;for(var i=0;i<this.children.length;i++){var e=this.children[i];if(!e.visible){continue;}var f=e.texture;var g=f.frame;b.globalAlpha=this.worldAlpha*e.alpha;if(e.rotation%(Math.PI*2)===0){if(d){b.setTransform(c.a,c.b,c.c,c.d,c.tx,c.ty);d=false;}b.drawImage(f.baseTexture.source,g.x,g.y,g.width,g.height,((e.anchor.x)*(-g.width*e.scale.x)+e.position.x+0.5+a.shakeX)|0,((e.anchor.y)*(-g.height*e.scale.y)+e.position.y+0.5+a.shakeY)|0,g.width*e.scale.x,g.height*e.scale.y);}else{if(!d){d=true;}e.displayObjectUpdateTransform();var h=e.worldTransform;var j=(h.tx*a.resolution)+a.shakeX;var k=(h.ty*a.resolution)+a.shakeY;if(a.roundPixels){b.setTransform(h.a,h.b,h.c,h.d,j|0,k|0);}else{b.setTransform(h.a,h.b,h.c,h.d,j,k);}b.drawImage(f.baseTexture.source,g.x,g.y,g.width,g.height,((e.anchor.x)*(-g.width)+0.5)|0,((e.anchor.y)*(-g.height)+0.5)|0,g.width,g.height);}}};N.BitmapData=function(a,b,c,d,e){if(c===undefined||c===0){c=256;}if(d===undefined||d===0){d=256;}if(e===undefined){e=false;}this.game=a;this.key=b;this.width=c;this.height=d;this.canvas=N.Canvas.create(this,c,d,null,e);this.context=this.canvas.getContext('2d',{alpha:true});this.ctx=this.context;this.smoothProperty=(a.renderType===N.CANVAS)?a.renderer.renderSession.smoothProperty:N.Canvas.getSmoothingPrefix(this.context);this.imageData=this.context.getImageData(0,0,c,d);this.data=null;if(this.imageData){this.data=this.imageData.data;}this.pixels=null;if(this.data){if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer);}else if(window.ArrayBuffer){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer);}else{this.pixels=this.imageData.data;}}this.baseTexture=new PIXI.BaseTexture(this.canvas,null,this.game.resolution);this.texture=new PIXI.Texture(this.baseTexture);this.frameData=new N.FrameData();this.textureFrame=this.frameData.addFrame(new N.Frame(0,0,0,c,d,'bitmapData'));this.texture.frame=this.textureFrame;this.type=N.BITMAPDATA;this.disableTextureUpload=false;this.dirty=false;this.cls=this.clear;this._image=null;this._pos=new N.Point();this._size=new N.Point();this._scale=new N.Point();this._rotate=0;this._alpha={prev:1,current:1};this._anchor=new N.Point();this._tempR=0;this._tempG=0;this._tempB=0;this._circle=new N.Circle();this._swapCanvas=undefined;};N.BitmapData.prototype={move:function(x,y,a){if(x!==0){this.moveH(x,a);}if(y!==0){this.moveV(y,a);}return this;},moveH:function(a,b){if(b===undefined){b=true;}if(this._swapCanvas===undefined){this._swapCanvas=N.CanvasPool.create(this,this.width,this.height);}var c=this._swapCanvas;var d=c.getContext('2d');var h=this.height;var e=this.canvas;d.clearRect(0,0,this.width,this.height);if(a<0){a=Math.abs(a);var w=this.width-a;if(b){d.drawImage(e,0,0,a,h,w,0,a,h);}d.drawImage(e,a,0,w,h,0,0,w,h);}else{var w=this.width-a;if(b){d.drawImage(e,w,0,a,h,0,0,a,h);}d.drawImage(e,0,0,w,h,a,0,w,h);}this.clear();return this.copy(this._swapCanvas);},moveV:function(a,b){if(b===undefined){b=true;}if(this._swapCanvas===undefined){this._swapCanvas=N.CanvasPool.create(this,this.width,this.height);}var c=this._swapCanvas;var d=c.getContext('2d');var w=this.width;var e=this.canvas;d.clearRect(0,0,this.width,this.height);if(a<0){a=Math.abs(a);var h=this.height-a;if(b){d.drawImage(e,0,0,w,a,0,h,w,a);}d.drawImage(e,0,a,w,h,0,0,w,h);}else{var h=this.height-a;if(b){d.drawImage(e,0,h,w,a,0,0,w,a);}d.drawImage(e,0,0,w,h,0,a,w,h);}this.clear();return this.copy(this._swapCanvas);},add:function(a){if(Array.isArray(a)){for(var i=0;i<a.length;i++){if(a[i].loadTexture){a[i].loadTexture(this);}}}else{a.loadTexture(this);}return this;},load:function(a){if(typeof a==='string'){a=this.game.cache.getImage(a);}if(a){this.resize(a.width,a.height);this.cls();}else{return;}this.draw(a);this.update();return this;},clear:function(x,y,a,b){if(x===undefined){x=0;}if(y===undefined){y=0;}if(a===undefined){a=this.width;}if(b===undefined){b=this.height;}this.context.clearRect(x,y,a,b);this.dirty=true;return this;},fill:function(r,g,b,a){if(a===undefined){a=1;}this.context.fillStyle='rgba('+r+','+g+','+b+','+a+')';this.context.fillRect(0,0,this.width,this.height);this.dirty=true;return this;},getBase64:function(a,b){return this.canvas.toDataURL(a,b);},getImage:function(a,b,c,d){var e=new Image();if(c){e.onload=c;}if(d){e.onerror=d;}e.src=this.getBase64(a,b);return e;},generateTexture:function(c,d,e){var f=this.game.cache;var g=new Image();if(d){g.onload=function(){var a=f.addImage(c,'',g);var b=new PIXI.Texture(a.base);d.call(e||null,b);g.onload=null;};}g.src=this.getBase64();if(!d){var h=f.addImage(c,'',g);return new PIXI.Texture(h.base);}return null;},resize:function(a,b){if(a!==this.width||b!==this.height){this.width=a;this.height=b;this.canvas.width=a;this.canvas.height=b;if(this._swapCanvas!==undefined){this._swapCanvas.width=a;this._swapCanvas.height=b;}this.baseTexture.width=a;this.baseTexture.height=b;this.textureFrame.width=a;this.textureFrame.height=b;this.texture.width=a;this.texture.height=b;this.texture.crop.width=a;this.texture.crop.height=b;this.update();this.dirty=true;}return this;},update:function(x,y,a,b){if(x===undefined){x=0;}if(y===undefined){y=0;}if(a===undefined){a=Math.max(1,this.width);}if(b===undefined){b=Math.max(1,this.height);}this.imageData=this.context.getImageData(x,y,a,b);this.data=this.imageData.data;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer);}else if(window.ArrayBuffer){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer);}else{this.pixels=this.imageData.data;}return this;},processPixelRGB:function(a,b,x,y,c,d){if(x===undefined){x=0;}if(y===undefined){y=0;}if(c===undefined){c=this.width;}if(d===undefined){d=this.height;}var w=x+c;var h=y+d;var e=N.Color.createColor();var f={r:0,g:0,b:0,a:0};var g=false;for(var i=y;i<h;i++){for(var j=x;j<w;j++){N.Color.unpackPixel(this.getPixel32(j,i),e);f=a.call(b,e,j,i);if(f!==false&&f!==null&&f!==undefined){this.setPixel32(j,i,f.r,f.g,f.b,f.a,false);g=true;}}}if(g){this.context.putImageData(this.imageData,0,0);this.dirty=true;}return this;},processPixel:function(a,b,x,y,c,d){if(x===undefined){x=0;}if(y===undefined){y=0;}if(c===undefined){c=this.width;}if(d===undefined){d=this.height;}var w=x+c;var h=y+d;var e=0;var f=0;var g=false;for(var i=y;i<h;i++){for(var j=x;j<w;j++){e=this.getPixel32(j,i);f=a.call(b,e,j,i);if(f!==e){this.pixels[i*this.width+j]=f;g=true;}}}if(g){this.context.putImageData(this.imageData,0,0);this.dirty=true;}return this;},replaceRGB:function(a,b,c,d,e,f,g,i,j){var k=0;var l=0;var w=this.width;var h=this.height;var m=N.Color.packPixel(a,b,c,d);if(j!==undefined&&j instanceof N.Rectangle){k=j.x;l=j.y;w=j.width;h=j.height;}for(var y=0;y<h;y++){for(var x=0;x<w;x++){if(this.getPixel32(k+x,l+y)===m){this.setPixel32(k+x,l+y,e,f,g,i,false);}}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this;},setHSL:function(h,s,l,a){var b=h||h===0;var c=s||s===0;var d=l||l===0;if(!b&&!c&&!d){return;}if(a===undefined){a=new N.Rectangle(0,0,this.width,this.height);}var e=N.Color.createColor();for(var y=a.y;y<a.bottom;y++){for(var x=a.x;x<a.right;x++){N.Color.unpackPixel(this.getPixel32(x,y),e,true);if(b){e.h=h;}if(c){e.s=s;}if(d){e.l=l;}N.Color.HSLtoRGB(e.h,e.s,e.l,e);this.setPixel32(x,y,e.r,e.g,e.b,e.a,false);}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this;},shiftHSL:function(h,s,l,a){if(h===undefined||h===null){h=false;}if(s===undefined||s===null){s=false;}if(l===undefined||l===null){l=false;}if(!h&&!s&&!l){return;}if(a===undefined){a=new N.Rectangle(0,0,this.width,this.height);}var b=N.Color.createColor();for(var y=a.y;y<a.bottom;y++){for(var x=a.x;x<a.right;x++){N.Color.unpackPixel(this.getPixel32(x,y),b,true);if(h){b.h=this.game.math.wrap(b.h+h,0,1);}if(s){b.s=this.game.math.clamp(b.s+s,0,1);}if(l){b.l=this.game.math.clamp(b.l+l,0,1);}N.Color.HSLtoRGB(b.h,b.s,b.l,b);this.setPixel32(x,y,b.r,b.g,b.b,b.a,false);}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this;},setPixel32:function(x,y,a,b,c,d,e){if(e===undefined){e=true;}if(x>=0&&x<=this.width&&y>=0&&y<=this.height){if(N.Device.LITTLE_ENDIAN){this.pixels[y*this.width+x]=(d<<24)|(c<<16)|(b<<8)|a;}else{this.pixels[y*this.width+x]=(a<<24)|(b<<16)|(c<<8)|d;}if(e){this.context.putImageData(this.imageData,0,0);this.dirty=true;}}return this;},setPixel:function(x,y,a,b,c,d){return this.setPixel32(x,y,a,b,c,255,d);},getPixel:function(x,y,a){if(!a){a=N.Color.createColor();}var b=~~(x+(y*this.width));b*=4;a.r=this.data[b];a.g=this.data[++b];a.b=this.data[++b];a.a=this.data[++b];return a;},getPixel32:function(x,y){if(x>=0&&x<=this.width&&y>=0&&y<=this.height){return this.pixels[y*this.width+x];}},getPixelRGB:function(x,y,a,b,c){return N.Color.unpackPixel(this.getPixel32(x,y),a,b,c);},getPixels:function(a){return this.context.getImageData(a.x,a.y,a.width,a.height);},getFirstPixel:function(a){if(a===undefined){a=0;}var b=N.Color.createColor();var x=0;var y=0;var v=1;var c=false;if(a===1){v=-1;y=this.height;}else if(a===3){v=-1;x=this.width;}do{N.Color.unpackPixel(this.getPixel32(x,y),b);if(a===0||a===1){x++;if(x===this.width){x=0;y+=v;if(y>=this.height||y<=0){c=true;}}}else if(a===2||a===3){y++;if(y===this.height){y=0;x+=v;if(x>=this.width||x<=0){c=true;}}}}while(b.a===0&&!c);b.x=x;b.y=y;return b;},getBounds:function(a){if(a===undefined){a=new N.Rectangle();}a.x=this.getFirstPixel(2).x;if(a.x===this.width){return a.setTo(0,0,0,0);}a.y=this.getFirstPixel(0).y;a.width=(this.getFirstPixel(3).x-a.x)+1;a.height=(this.getFirstPixel(1).y-a.y)+1;return a;},addToWorld:function(x,y,a,b,c,d){c=c||1;d=d||1;var e=this.game.add.image(x,y,this);e.anchor.set(a,b);e.scale.set(c,d);return e;},copy:function(a,x,y,b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(a===undefined||a===null){a=this;}if(a instanceof N.RenderTexture){a=a.getCanvas();}this._image=a;if(a instanceof N.Sprite||a instanceof N.Image||a instanceof N.Text||a instanceof PIXI.Sprite){this._pos.set(a.texture.crop.x,a.texture.crop.y);this._size.set(a.texture.crop.width,a.texture.crop.height);this._scale.set(a.scale.x,a.scale.y);this._anchor.set(a.anchor.x,a.anchor.y);this._rotate=a.rotation;this._alpha.current=a.alpha;if(a.texture instanceof N.RenderTexture){this._image=a.texture.getCanvas();}else{this._image=a.texture.baseTexture.source;}if(d===undefined||d===null){d=a.x;}if(e===undefined||e===null){e=a.y;}if(a.texture.trim){d+=a.texture.trim.x-a.anchor.x*a.texture.trim.width;e+=a.texture.trim.y-a.anchor.y*a.texture.trim.height;}if(a.tint!==0xFFFFFF){if(a.cachedTint!==a.tint){a.cachedTint=a.tint;a.tintedTexture=PIXI.CanvasTinter.getTintedTexture(a,a.tint);}this._image=a.tintedTexture;this._pos.set(0);}}else{this._pos.set(0);this._scale.set(1);this._anchor.set(0);this._rotate=0;this._alpha.current=1;if(a instanceof N.BitmapData){this._image=a.canvas;}else if(typeof a==='string'){a=this.game.cache.getImage(a);if(a===null){return this;}else{this._image=a;}}this._size.set(this._image.width,this._image.height);}if(x===undefined||x===null){x=0;}if(y===undefined||y===null){y=0;}if(b){this._size.x=b;}if(c){this._size.y=c;}if(d===undefined||d===null){d=x;}if(e===undefined||e===null){e=y;}if(f===undefined||f===null){f=this._size.x;}if(g===undefined||g===null){g=this._size.y;}if(typeof h==='number'){this._rotate=h;}if(typeof i==='number'){this._anchor.x=i;}if(typeof j==='number'){this._anchor.y=j;}if(typeof k==='number'){this._scale.x=k;}if(typeof l==='number'){this._scale.y=l;}if(typeof m==='number'){this._alpha.current=m;}if(n===undefined){n=null;}if(o===undefined){o=false;}if(this._alpha.current<=0||this._scale.x===0||this._scale.y===0||this._size.x===0||this._size.y===0){return this;}var p=this.context;this._alpha.prev=p.globalAlpha;p.save();p.globalAlpha=this._alpha.current;if(n){this.op=n;}if(o){d|=0;e|=0;}p.translate(d,e);p.scale(this._scale.x,this._scale.y);p.rotate(this._rotate);p.drawImage(this._image,this._pos.x+x,this._pos.y+y,this._size.x,this._size.y,-f*this._anchor.x,-g*this._anchor.y,f,g);p.restore();p.globalAlpha=this._alpha.prev;this.dirty=true;return this;},copyTransform:function(a,b,c){if(b===undefined){b=null;}if(c===undefined){c=false;}if(!a.hasOwnProperty('worldTransform')||!a.worldVisible||a.worldAlpha===0){return this;}var d=a.worldTransform;this._pos.set(a.texture.crop.x,a.texture.crop.y);this._size.set(a.texture.crop.width,a.texture.crop.height);if(d.a===0||d.d===0||this._size.x===0||this._size.y===0){return this;}if(a.texture instanceof N.RenderTexture){this._image=a.texture.getCanvas();}else{this._image=a.texture.baseTexture.source;}var e=d.tx;var f=d.ty;if(a.texture.trim){e+=a.texture.trim.x-a.anchor.x*a.texture.trim.width;f+=a.texture.trim.y-a.anchor.y*a.texture.trim.height;}if(a.tint!==0xFFFFFF){if(a.cachedTint!==a.tint){a.cachedTint=a.tint;a.tintedTexture=PIXI.CanvasTinter.getTintedTexture(a,a.tint);}this._image=a.tintedTexture;this._pos.set(0);}if(c){e|=0;f|=0;}var g=this.context;this._alpha.prev=g.globalAlpha;g.save();g.globalAlpha=this._alpha.current;if(b){this.op=b;}g[this.smoothProperty]=(a.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR);g.setTransform(d.a,d.b,d.c,d.d,e,f);g.drawImage(this._image,this._pos.x,this._pos.y,this._size.x,this._size.y,-this._size.x*a.anchor.x,-this._size.y*a.anchor.y,this._size.x,this._size.y);g.restore();g.globalAlpha=this._alpha.prev;this.dirty=true;return this;},copyRect:function(a,b,x,y,c,d,e){return this.copy(a,b.x,b.y,b.width,b.height,x,y,b.width,b.height,0,0,0,1,1,c,d,e);},draw:function(a,x,y,b,c,d,e){return this.copy(a,null,null,null,null,x,y,b,c,null,null,null,null,null,null,d,e);},drawGroup:function(a,b,c){if(a.total>0){a.forEachExists(this.drawGroupProxy,this,b,c);}return this;},drawGroupProxy:function(a,b,c){if(a.hasOwnProperty('texture')){this.copyTransform(a,b,c);}if(a.type===N.GROUP&&a.exists){this.drawGroup(a,b,c);}else if(a.hasOwnProperty('children')&&a.children.length>0){for(var i=0;i<a.children.length;i++){if(a.children[i].exists){this.copyTransform(a.children[i],b,c);}}}},drawFull:function(a,b,c){if(a.worldVisible===false||a.worldAlpha===0||(a.hasOwnProperty('exists')&&a.exists===false)){return this;}if(a.type!==N.GROUP&&a.type!==N.EMITTER&&a.type!==N.BITMAPTEXT){if(a.type===N.GRAPHICS){var d=a.getBounds();this.ctx.save();this.ctx.translate(d.x,d.y);PIXI.CanvasGraphics.renderGraphics(a,this.ctx);this.ctx.restore();}else{this.copy(a,null,null,null,null,a.worldPosition.x,a.worldPosition.y,null,null,a.worldRotation,null,null,a.worldScale.x,a.worldScale.y,a.worldAlpha,b,c);}}if(a.children){for(var i=0;i<a.children.length;i++){this.drawFull(a.children[i],b,c);}}return this;},shadow:function(a,b,x,y){var c=this.context;if(a===undefined||a===null){c.shadowColor='rgba(0,0,0,0)';}else{c.shadowColor=a;c.shadowBlur=(b===0)?0:b||5;c.shadowOffsetX=(x===0)?0:x||10;c.shadowOffsetY=(y===0)?0:y||10;}return this;},alphaMask:function(a,b,c,d){if(d===undefined||d===null){this.draw(b).blendSourceAtop();}else{this.draw(b,d.x,d.y,d.width,d.height).blendSourceAtop();}if(c===undefined||c===null){this.draw(a).blendReset();}else{this.draw(a,c.x,c.y,c.width,c.height).blendReset();}return this;},extract:function(d,r,g,b,a,e,f,h,i){if(a===undefined){a=255;}if(e===undefined){e=false;}if(f===undefined){f=r;}if(h===undefined){h=g;}if(i===undefined){i=b;}if(e){d.resize(this.width,this.height);}this.processPixelRGB(function(c,x,y){if(c.r===r&&c.g===g&&c.b===b){d.setPixel32(x,y,f,h,i,a,false);}return false;},this);d.context.putImageData(d.imageData,0,0);d.dirty=true;return d;},rect:function(x,y,a,b,c){if(typeof c!=='undefined'){this.context.fillStyle=c;}this.context.fillRect(x,y,a,b);return this;},text:function(a,x,y,b,c,d){if(x===undefined){x=0;}if(y===undefined){y=0;}if(b===undefined){b='14px Courier';}if(c===undefined){c='rgb(255,255,255)';}if(d===undefined){d=true;}var e=this.context;var f=e.font;e.font=b;if(d){e.fillStyle='rgb(0,0,0)';e.fillText(a,x+1,y+1);}e.fillStyle=c;e.fillText(a,x,y);e.font=f;return this;},circle:function(x,y,a,b){var c=this.context;if(b!==undefined){c.fillStyle=b;}c.beginPath();c.arc(x,y,a,0,Math.PI*2,false);c.closePath();c.fill();return this;},line:function(a,b,c,d,e,f){if(e===undefined){e='#fff';}if(f===undefined){f=1;}var g=this.context;g.beginPath();g.moveTo(a,b);g.lineTo(c,d);g.lineWidth=f;g.strokeStyle=e;g.stroke();g.closePath();return this;},polygon:function(a,b,c,d){if(d===undefined){d='#fff';}if(c===undefined){c=0;}var e=this.context;if(b){e.fillStyle=b;}if(c){e.lineWidth=c;e.strokeStyle=d;}e.beginPath();e.moveTo(a[0].x,a[0].y);for(var i=1,len=a.length;i<len;i++){var f=a[i];e.lineTo(f.x,f.y);}e.closePath();if(b){e.fill();}if(c){e.stroke();}return this;},textureLine:function(a,b,c){if(c===undefined){c='repeat-x';}if(typeof b==='string'){b=this.game.cache.getImage(b);if(!b){return;}}var d=a.length;if(c==='no-repeat'&&d>b.width){d=b.width;}var e=this.context;e.fillStyle=e.createPattern(b,c);this._circle=new N.Circle(a.start.x,a.start.y,b.height);this._circle.circumferencePoint(a.angle-1.5707963267948966,false,this._pos);e.save();e.translate(this._pos.x,this._pos.y);e.rotate(a.angle);e.fillRect(0,0,d,b.height);e.restore();this.dirty=true;return this;},render:function(){if(!this.disableTextureUpload&&this.dirty){this.baseTexture.dirty();this.dirty=false;}return this;},destroy:function(){this.frameData.destroy();this.texture.destroy(true);N.CanvasPool.remove(this);},blendReset:function(){this.op='source-over';return this;},blendSourceOver:function(){this.op='source-over';return this;},blendSourceIn:function(){this.op='source-in';return this;},blendSourceOut:function(){this.op='source-out';return this;},blendSourceAtop:function(){this.op='source-atop';return this;},blendDestinationOver:function(){this.op='destination-over';return this;},blendDestinationIn:function(){this.op='destination-in';return this;},blendDestinationOut:function(){this.op='destination-out';return this;},blendDestinationAtop:function(){this.op='destination-atop';return this;},blendXor:function(){this.op='xor';return this;},blendAdd:function(){this.op='lighter';return this;},blendMultiply:function(){this.op='multiply';return this;},blendScreen:function(){this.op='screen';return this;},blendOverlay:function(){this.op='overlay';return this;},blendDarken:function(){this.op='darken';return this;},blendLighten:function(){this.op='lighten';return this;},blendColorDodge:function(){this.op='color-dodge';return this;},blendColorBurn:function(){this.op='color-burn';return this;},blendHardLight:function(){this.op='hard-light';return this;},blendSoftLight:function(){this.op='soft-light';return this;},blendDifference:function(){this.op='difference';return this;},blendExclusion:function(){this.op='exclusion';return this;},blendHue:function(){this.op='hue';return this;},blendSaturation:function(){this.op='saturation';return this;},blendColor:function(){this.op='color';return this;},blendLuminosity:function(){this.op='luminosity';return this;},copyBitmapData:function(a,x,y){a.update();for(var i=0,destRowStart;i<a.height;i++){destRowStart=(y+i)*this.width+x;for(var j=0;j<a.width;j++){this.pixels[destRowStart+j]=a.pixels[i*a.width+j];}}return this;}};Object.defineProperty(N.BitmapData.prototype,'smoothed',{get:function(){return N.Canvas.getSmoothingEnabled(this.context);},set:function(a){N.Canvas.setSmoothingEnabled(this.context,a);}});Object.defineProperty(N.BitmapData.prototype,'op',{get:function(){return this.context.globalCompositeOperation;},set:function(a){this.context.globalCompositeOperation=a;}});N.BitmapData.getTransform=function(a,b,c,d,e,f){if(typeof a!=='number'){a=0;}if(typeof b!=='number'){b=0;}if(typeof c!=='number'){c=1;}if(typeof d!=='number'){d=1;}if(typeof e!=='number'){e=0;}if(typeof f!=='number'){f=0;}return{sx:c,sy:d,scaleX:c,scaleY:d,skewX:e,skewY:f,translateX:a,translateY:b,tx:a,ty:b};};N.BitmapData.prototype.constructor=N.BitmapData;N.EarCut={};N.EarCut.Triangulate=function(a,b,c){c=c||2;var d=b&&b.length,outerLen=d?b[0]*c:a.length,outerNode=N.EarCut.linkedList(a,0,outerLen,c,true),triangles=[];if(!outerNode){return triangles;}var e,minY,maxX,maxY,x,y,size;if(d){outerNode=N.EarCut.eliminateHoles(a,b,outerNode,c);}if(a.length>80*c){e=maxX=a[0];minY=maxY=a[1];for(var i=c;i<outerLen;i+=c){x=a[i];y=a[i+1];if(x<e){e=x;}if(y<minY){minY=y;}if(x>maxX){maxX=x;}if(y>maxY){maxY=y;}}size=Math.max(maxX-e,maxY-minY);}N.EarCut.earcutLinked(outerNode,triangles,c,e,minY,size);return triangles;};N.EarCut.linkedList=function(a,b,c,d,e){var f=0,i,j,last;for(i=b,j=c-d;i<c;i+=d){f+=(a[j]-a[i])*(a[i+1]+a[j+1]);j=i;}if(e===(f>0)){for(i=b;i<c;i+=d){last=N.EarCut.insertNode(i,a[i],a[i+1],last);}}else{for(i=c-d;i>=b;i-=d){last=N.EarCut.insertNode(i,a[i],a[i+1],last);}}return last;};N.EarCut.filterPoints=function(a,b){if(!a){return a;}if(!b){b=a;}var p=a,again;do{again=false;if(!p.steiner&&(N.EarCut.equals(p,p.next)||N.EarCut.area(p.prev,p,p.next)===0)){N.EarCut.removeNode(p);p=b=p.prev;if(p===p.next){return null;}again=true;}else{p=p.next;}}while(again||p!==b);return b;};N.EarCut.earcutLinked=function(a,b,c,d,e,f,g){if(!a){return;}if(!g&&f){N.EarCut.indexCurve(a,d,e,f);}var h=a,prev,next;while(a.prev!==a.next){prev=a.prev;next=a.next;if(f?N.EarCut.isEarHashed(a,d,e,f):N.EarCut.isEar(a)){b.push(prev.i/c);b.push(a.i/c);b.push(next.i/c);N.EarCut.removeNode(a);a=next.next;h=next.next;continue;}a=next;if(a===h){if(!g){N.EarCut.earcutLinked(N.EarCut.filterPoints(a),b,c,d,e,f,1);}else if(g===1){a=N.EarCut.cureLocalIntersections(a,b,c);N.EarCut.earcutLinked(a,b,c,d,e,f,2);}else if(g===2){N.EarCut.splitEarcut(a,b,c,d,e,f);}break;}}};N.EarCut.isEar=function(d){var a=d.prev,b=d,c=d.next;if(N.EarCut.area(a,b,c)>=0){return false;}var p=d.next.next;while(p!==d.prev){if(N.EarCut.pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&N.EarCut.area(p.prev,p,p.next)>=0){return false;}p=p.next;}return true;};N.EarCut.isEarHashed=function(d,e,f,g){var a=d.prev,b=d,c=d.next;if(N.EarCut.area(a,b,c)>=0){return false;}var h=a.x<b.x?(a.x<c.x?a.x:c.x):(b.x<c.x?b.x:c.x),minTY=a.y<b.y?(a.y<c.y?a.y:c.y):(b.y<c.y?b.y:c.y),maxTX=a.x>b.x?(a.x>c.x?a.x:c.x):(b.x>c.x?b.x:c.x),maxTY=a.y>b.y?(a.y>c.y?a.y:c.y):(b.y>c.y?b.y:c.y);var i=N.EarCut.zOrder(h,minTY,e,f,g),maxZ=N.EarCut.zOrder(maxTX,maxTY,e,f,g);var p=d.nextZ;while(p&&p.z<=maxZ){if(p!==d.prev&&p!==d.next&&N.EarCut.pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&N.EarCut.area(p.prev,p,p.next)>=0){return false;}p=p.nextZ;}p=d.prevZ;while(p&&p.z>=i){if(p!==d.prev&&p!==d.next&&N.EarCut.pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&N.EarCut.area(p.prev,p,p.next)>=0){return false;}p=p.prevZ;}return true;};N.EarCut.cureLocalIntersections=function(c,d,e){var p=c;do{var a=p.prev,b=p.next.next;if(N.EarCut.intersects(a,p,p.next,b)&&N.EarCut.locallyInside(a,b)&&N.EarCut.locallyInside(b,a)){d.push(a.i/e);d.push(p.i/e);d.push(b.i/e);N.EarCut.removeNode(p);N.EarCut.removeNode(p.next);p=c=b;}p=p.next;}while(p!==c);return p;};N.EarCut.splitEarcut=function(d,e,f,g,h,i){var a=d;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&N.EarCut.isValidDiagonal(a,b)){var c=N.EarCut.splitPolygon(a,b);a=N.EarCut.filterPoints(a,a.next);c=N.EarCut.filterPoints(c,c.next);N.EarCut.earcutLinked(a,e,f,g,h,i);N.EarCut.earcutLinked(c,e,f,g,h,i);return;}b=b.next;}a=a.next;}while(a!==d);};N.EarCut.eliminateHoles=function(a,b,c,d){var e=[],i,len,start,end,list;for(i=0,len=b.length;i<len;i++){start=b[i]*d;end=i<len-1?b[i+1]*d:a.length;list=N.EarCut.linkedList(a,start,end,d,false);if(list===list.next){list.steiner=true;}e.push(N.EarCut.getLeftmost(list));}e.sort(N.EarCut.compareX);for(i=0;i<e.length;i++){N.EarCut.eliminateHole(e[i],c);c=N.EarCut.filterPoints(c,c.next);}return c;};N.EarCut.compareX=function(a,b){return a.x-b.x;};N.EarCut.eliminateHole=function(a,c){c=N.EarCut.findHoleBridge(a,c);if(c){var b=N.EarCut.splitPolygon(c,a);N.EarCut.filterPoints(b,b.next);}};N.EarCut.findHoleBridge=function(a,b){var p=b,hx=a.x,hy=a.y,qx=-Infinity,m;do{if(hy<=p.y&&hy>=p.next.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;m=p.x<p.next.x?p:p.next;}}p=p.next;}while(p!==b);if(!m){return null;}if(a.x===m.x){return m.prev;}var c=m,tanMin=Infinity,tan;p=m.next;while(p!==c){if(hx>=p.x&&p.x>=m.x&&N.EarCut.pointInTriangle(hy<m.y?hx:qx,hy,m.x,m.y,hy<m.y?qx:hx,hy,p.x,p.y)){tan=Math.abs(hy-p.y)/(hx-p.x);if((tan<tanMin||(tan===tanMin&&p.x>m.x))&&N.EarCut.locallyInside(p,a)){m=p;tanMin=tan;}}p=p.next;}return m;};N.EarCut.indexCurve=function(a,b,c,d){var p=a;do{if(p.z===null){p.z=N.EarCut.zOrder(p.x,p.y,b,c,d);}p.prevZ=p.prev;p.nextZ=p.next;p=p.next;}while(p!==a);p.prevZ.nextZ=null;p.prevZ=null;N.EarCut.sortLinked(p);};N.EarCut.sortLinked=function(a){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=a;a=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q){break;}}qSize=inSize;while(pSize>0||(qSize>0&&q)){if(pSize===0){e=q;q=q.nextZ;qSize--;}else if(qSize===0||!q){e=p;p=p.nextZ;pSize--;}else if(p.z<=q.z){e=p;p=p.nextZ;pSize--;}else{e=q;q=q.nextZ;qSize--;}if(tail){tail.nextZ=e;}else{a=e;}e.prevZ=tail;tail=e;}p=q;}tail.nextZ=null;inSize*=2;}while(numMerges>1);return a;};N.EarCut.zOrder=function(x,y,a,b,c){x=32767*(x-a)/c;y=32767*(y-b)/c;x=(x|(x<<8))&0x00FF00FF;x=(x|(x<<4))&0x0F0F0F0F;x=(x|(x<<2))&0x33333333;x=(x|(x<<1))&0x55555555;y=(y|(y<<8))&0x00FF00FF;y=(y|(y<<4))&0x0F0F0F0F;y=(y|(y<<2))&0x33333333;y=(y|(y<<1))&0x55555555;return x|(y<<1);};N.EarCut.getLeftmost=function(a){var p=a,leftmost=a;do{if(p.x<leftmost.x){leftmost=p;}p=p.next;}while(p!==a);return leftmost;};N.EarCut.pointInTriangle=function(a,b,c,d,e,f,g,h){return(e-g)*(b-h)-(a-g)*(f-h)>=0&&(a-g)*(d-h)-(c-g)*(b-h)>=0&&(c-g)*(f-h)-(e-g)*(d-h)>=0;};N.EarCut.isValidDiagonal=function(a,b){return N.EarCut.equals(a,b)||a.next.i!==b.i&&a.prev.i!==b.i&&!N.EarCut.intersectsPolygon(a,b)&&N.EarCut.locallyInside(a,b)&&N.EarCut.locallyInside(b,a)&&N.EarCut.middleInside(a,b);};N.EarCut.area=function(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y);};N.EarCut.equals=function(a,b){return a.x===b.x&&a.y===b.y;};N.EarCut.intersects=function(a,b,c,d){return N.EarCut.area(a,b,c)>0!==N.EarCut.area(a,b,d)>0&&N.EarCut.area(c,d,a)>0!==N.EarCut.area(c,d,b)>0;};N.EarCut.intersectsPolygon=function(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&N.EarCut.intersects(p,p.next,a,b)){return true;}p=p.next;}while(p!==a);return false;};N.EarCut.locallyInside=function(a,b){return N.EarCut.area(a.prev,a,a.next)<0?N.EarCut.area(a,b,a.next)>=0&&N.EarCut.area(a,a.prev,b)>=0:N.EarCut.area(a,b,a.prev)<0||N.EarCut.area(a,a.next,b)<0;};N.EarCut.middleInside=function(a,b){var p=a,inside=false,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{if(((p.y>py)!==(p.next.y>py))&&(px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x)){inside=!inside;}p=p.next;}while(p!==a);return inside;};N.EarCut.splitPolygon=function(a,b){var c=new N.EarCut.Node(a.i,a.x,a.y),b2=new N.EarCut.Node(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;c.next=an;an.prev=c;b2.next=c;c.prev=b2;bp.next=b2;b2.prev=bp;return b2;};N.EarCut.insertNode=function(i,x,y,a){var p=new N.EarCut.Node(i,x,y);if(!a){p.prev=p;p.next=p;}else{p.next=a.next;p.prev=a;a.next.prev=p;a.next=p;}return p;};N.EarCut.removeNode=function(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ){p.prevZ.nextZ=p.nextZ;}if(p.nextZ){p.nextZ.prevZ=p.prevZ;}};N.EarCut.Node=function(i,x,y){this.i=i;this.x=x;this.y=y;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false;};PIXI.WebGLGraphics=function(){};PIXI.WebGLGraphics.stencilBufferLimit=6;PIXI.WebGLGraphics.renderGraphics=function(a,b){var c=b.gl;var d=b.projection,offset=b.offset,shader=b.shaderManager.primitiveShader,webGLData;if(a.dirty){PIXI.WebGLGraphics.updateGraphics(a,c);}var e=a._webGL[c.id];if(!e){return;}for(var i=0;i<e.data.length;i++){if(e.data[i].mode===1){webGLData=e.data[i];b.stencilManager.pushStencil(a,webGLData,b);c.drawElements(c.TRIANGLE_FAN,4,c.UNSIGNED_SHORT,(webGLData.indices.length-4)*2);b.stencilManager.popStencil(a,webGLData,b);}else{webGLData=e.data[i];b.shaderManager.setShader(shader);shader=b.shaderManager.primitiveShader;c.uniformMatrix3fv(shader.translationMatrix,false,a.worldTransform.toArray(true));c.uniform1f(shader.flipY,1);c.uniform2f(shader.projectionVector,d.x,-d.y);c.uniform2f(shader.offsetVector,-offset.x,-offset.y);c.uniform3fv(shader.tintColor,N.Color.hexToRGBArray(a.tint));c.uniform1f(shader.alpha,a.worldAlpha);c.bindBuffer(c.ARRAY_BUFFER,webGLData.buffer);c.vertexAttribPointer(shader.aVertexPosition,2,c.FLOAT,false,4*6,0);c.vertexAttribPointer(shader.colorAttribute,4,c.FLOAT,false,4*6,2*4);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,webGLData.indexBuffer);c.drawElements(c.TRIANGLE_STRIP,webGLData.indices.length,c.UNSIGNED_SHORT,0);}}};PIXI.WebGLGraphics.updateGraphics=function(a,b){var c=a._webGL[b.id];if(!c){c=a._webGL[b.id]={lastIndex:0,data:[],gl:b};}a.dirty=false;var i;if(a.clearDirty){a.clearDirty=false;for(i=0;i<c.data.length;i++){var d=c.data[i];d.reset();PIXI.WebGLGraphics.graphicsDataPool.push(d);}c.data=[];c.lastIndex=0;}var e;for(i=c.lastIndex;i<a.graphicsData.length;i++){var f=a.graphicsData[i];if(f.type===N.POLYGON){f.points=f.shape.points.slice();if(f.shape.closed){if(f.points[0]!==f.points[f.points.length-2]||f.points[1]!==f.points[f.points.length-1]){f.points.push(f.points[0],f.points[1]);}}if(f.fill){if(f.points.length>=PIXI.WebGLGraphics.stencilBufferLimit){if(f.points.length<PIXI.WebGLGraphics.stencilBufferLimit*2){e=PIXI.WebGLGraphics.switchMode(c,0);var g=PIXI.WebGLGraphics.buildPoly(f,e);if(!g){e=PIXI.WebGLGraphics.switchMode(c,1);PIXI.WebGLGraphics.buildComplexPoly(f,e);}}else{e=PIXI.WebGLGraphics.switchMode(c,1);PIXI.WebGLGraphics.buildComplexPoly(f,e);}}}if(f.lineWidth>0){e=PIXI.WebGLGraphics.switchMode(c,0);PIXI.WebGLGraphics.buildLine(f,e);}}else{e=PIXI.WebGLGraphics.switchMode(c,0);if(f.type===N.RECTANGLE){PIXI.WebGLGraphics.buildRectangle(f,e);}else if(f.type===N.CIRCLE||f.type===N.ELLIPSE){PIXI.WebGLGraphics.buildCircle(f,e);}else if(f.type===N.ROUNDEDRECTANGLE){PIXI.WebGLGraphics.buildRoundedRectangle(f,e);}}c.lastIndex++;}for(i=0;i<c.data.length;i++){e=c.data[i];if(e.dirty){e.upload();}}};PIXI.WebGLGraphics.switchMode=function(a,b){var c;if(!a.data.length){c=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(a.gl);c.mode=b;a.data.push(c);}else{c=a.data[a.data.length-1];if(c.mode!==b||b===1){c=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(a.gl);c.mode=b;a.data.push(c);}}c.dirty=true;return c;};PIXI.WebGLGraphics.buildRectangle=function(a,c){var d=a.shape;var x=d.x;var y=d.y;var e=d.width;var f=d.height;if(a.fill){var h=N.Color.hexToRGBArray(a.fillColor);var i=a.fillAlpha;var r=h[0]*i;var g=h[1]*i;var b=h[2]*i;var j=c.points;var k=c.indices;var l=j.length/6;j.push(x,y);j.push(r,g,b,i);j.push(x+e,y);j.push(r,g,b,i);j.push(x,y+f);j.push(r,g,b,i);j.push(x+e,y+f);j.push(r,g,b,i);k.push(l,l,l+1,l+2,l+3,l+3);}if(a.lineWidth){var m=a.points;a.points=[x,y,x+e,y,x+e,y+f,x,y+f,x,y];PIXI.WebGLGraphics.buildLine(a,c);a.points=m;}};PIXI.WebGLGraphics.buildRoundedRectangle=function(a,c){var d=a.shape;var x=d.x;var y=d.y;var e=d.width;var f=d.height;var h=d.radius;var j=[];j.push(x,y+h);j=j.concat(PIXI.WebGLGraphics.quadraticBezierCurve(x,y+f-h,x,y+f,x+h,y+f));j=j.concat(PIXI.WebGLGraphics.quadraticBezierCurve(x+e-h,y+f,x+e,y+f,x+e,y+f-h));j=j.concat(PIXI.WebGLGraphics.quadraticBezierCurve(x+e,y+h,x+e,y,x+e-h,y));j=j.concat(PIXI.WebGLGraphics.quadraticBezierCurve(x+h,y,x,y,x,y+h));if(a.fill){var k=N.Color.hexToRGBArray(a.fillColor);var l=a.fillAlpha;var r=k[0]*l;var g=k[1]*l;var b=k[2]*l;var m=c.points;var n=c.indices;var o=m.length/6;var p=N.EarCut.Triangulate(j,null,2);var i=0;for(i=0;i<p.length;i+=3){n.push(p[i]+o);n.push(p[i]+o);n.push(p[i+1]+o);n.push(p[i+2]+o);n.push(p[i+2]+o);}for(i=0;i<j.length;i++){m.push(j[i],j[++i],r,g,b,l);}}if(a.lineWidth){var q=a.points;a.points=j;PIXI.WebGLGraphics.buildLine(a,c);a.points=q;}};PIXI.WebGLGraphics.quadraticBezierCurve=function(e,f,g,h,k,l){var m,ya,xb,yb,x,y,n=20,points=[];function getPt(a,b,c){var d=b-a;return a+(d*c);}var j=0;for(var i=0;i<=n;i++){j=i/n;m=getPt(e,g,j);ya=getPt(f,h,j);xb=getPt(g,k,j);yb=getPt(h,l,j);x=getPt(m,xb,j);y=getPt(ya,yb,j);points.push(x,y);}return points;};PIXI.WebGLGraphics.buildCircle=function(a,c){var d=a.shape;var x=d.x;var y=d.y;var e;var f;if(a.type===N.CIRCLE){e=d.radius;f=d.radius;}else{e=d.width;f=d.height;}var h=40;var j=(Math.PI*2)/h;var i=0;if(a.fill){var k=N.Color.hexToRGBArray(a.fillColor);var l=a.fillAlpha;var r=k[0]*l;var g=k[1]*l;var b=k[2]*l;var m=c.points;var n=c.indices;var o=m.length/6;n.push(o);for(i=0;i<h+1;i++){m.push(x,y,r,g,b,l);m.push(x+Math.sin(j*i)*e,y+Math.cos(j*i)*f,r,g,b,l);n.push(o++,o++);}n.push(o-1);}if(a.lineWidth){var p=a.points;a.points=[];for(i=0;i<h+1;i++){a.points.push(x+Math.sin(j*i)*e,y+Math.cos(j*i)*f);}PIXI.WebGLGraphics.buildLine(a,c);a.points=p;}};PIXI.WebGLGraphics.buildLine=function(a,c){var i=0;var d=a.points;if(d.length===0){return;}if(a.lineWidth%2){for(i=0;i<d.length;i++){d[i]+=0.5;}}var e=new PIXI.Point(d[0],d[1]);var f=new PIXI.Point(d[d.length-2],d[d.length-1]);if(e.x===f.x&&e.y===f.y){d=d.slice();d.pop();d.pop();f=new PIXI.Point(d[d.length-2],d[d.length-1]);var h=f.x+(e.x-f.x)*0.5;var j=f.y+(e.y-f.y)*0.5;d.unshift(h,j);d.push(h,j);}var k=c.points;var l=c.indices;var m=d.length/2;var n=d.length;var o=k.length/6;var p=a.lineWidth/2;var q=N.Color.hexToRGBArray(a.lineColor);var s=a.lineAlpha;var r=q[0]*s;var g=q[1]*s;var b=q[2]*s;var t,py,p1x,p1y,p2x,p2y,p3x,p3y;var u,perpy,perp2x,perp2y,perp3x,perp3y;var v,b1,c1,a2,b2,c2;var w,pdist,dist;p1x=d[0];p1y=d[1];p2x=d[2];p2y=d[3];u=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(u*u+perpy*perpy);u/=dist;perpy/=dist;u*=p;perpy*=p;k.push(p1x-u,p1y-perpy,r,g,b,s);k.push(p1x+u,p1y+perpy,r,g,b,s);for(i=1;i<m-1;i++){p1x=d[(i-1)*2];p1y=d[(i-1)*2+1];p2x=d[(i)*2];p2y=d[(i)*2+1];p3x=d[(i+1)*2];p3y=d[(i+1)*2+1];u=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(u*u+perpy*perpy);u/=dist;perpy/=dist;u*=p;perpy*=p;perp2x=-(p2y-p3y);perp2y=p2x-p3x;dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y);perp2x/=dist;perp2y/=dist;perp2x*=p;perp2y*=p;v=(-perpy+p1y)-(-perpy+p2y);b1=(-u+p2x)-(-u+p1x);c1=(-u+p1x)*(-perpy+p2y)-(-u+p2x)*(-perpy+p1y);a2=(-perp2y+p3y)-(-perp2y+p2y);b2=(-perp2x+p2x)-(-perp2x+p3x);c2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y);w=v*b2-a2*b1;if(Math.abs(w)<0.1){w+=10.1;k.push(p2x-u,p2y-perpy,r,g,b,s);k.push(p2x+u,p2y+perpy,r,g,b,s);continue;}t=(b1*c2-b2*c1)/w;py=(a2*c1-v*c2)/w;pdist=(t-p2x)*(t-p2x)+(py-p2y)+(py-p2y);if(pdist>140*140){perp3x=u-perp2x;perp3y=perpy-perp2y;dist=Math.sqrt(perp3x*perp3x+perp3y*perp3y);perp3x/=dist;perp3y/=dist;perp3x*=p;perp3y*=p;k.push(p2x-perp3x,p2y-perp3y);k.push(r,g,b,s);k.push(p2x+perp3x,p2y+perp3y);k.push(r,g,b,s);k.push(p2x-perp3x,p2y-perp3y);k.push(r,g,b,s);n++;}else{k.push(t,py);k.push(r,g,b,s);k.push(p2x-(t-p2x),p2y-(py-p2y));k.push(r,g,b,s);}}p1x=d[(m-2)*2];p1y=d[(m-2)*2+1];p2x=d[(m-1)*2];p2y=d[(m-1)*2+1];u=-(p1y-p2y);perpy=p1x-p2x;dist=Math.sqrt(u*u+perpy*perpy);u/=dist;perpy/=dist;u*=p;perpy*=p;k.push(p2x-u,p2y-perpy);k.push(r,g,b,s);k.push(p2x+u,p2y+perpy);k.push(r,g,b,s);l.push(o);for(i=0;i<n;i++){l.push(o++);}l.push(o-1);};PIXI.WebGLGraphics.buildComplexPoly=function(a,b){var c=a.points.slice();if(c.length<6){return;}var d=b.indices;b.points=c;b.alpha=a.fillAlpha;b.color=N.Color.hexToRGBArray(a.fillColor);var e=Infinity;var f=-Infinity;var g=Infinity;var h=-Infinity;var x,y;for(var i=0;i<c.length;i+=2){x=c[i];y=c[i+1];e=x<e?x:e;f=x>f?x:f;g=y<g?y:g;h=y>h?y:h;}c.push(e,g,f,g,f,h,e,h);var j=c.length/2;for(i=0;i<j;i++){d.push(i);}};PIXI.WebGLGraphics.buildPoly=function(a,c){var d=a.points;if(d.length<6){return;}var e=c.points;var f=c.indices;var h=d.length/2;var j=N.Color.hexToRGBArray(a.fillColor);var k=a.fillAlpha;var r=j[0]*k;var g=j[1]*k;var b=j[2]*k;var l=N.EarCut.Triangulate(d,null,2);if(!l){return false;}var m=e.length/6;var i=0;for(i=0;i<l.length;i+=3){f.push(l[i]+m);f.push(l[i]+m);f.push(l[i+1]+m);f.push(l[i+2]+m);f.push(l[i+2]+m);}for(i=0;i<h;i++){e.push(d[i*2],d[i*2+1],r,g,b,k);}return true;};PIXI.WebGLGraphics.graphicsDataPool=[];PIXI.WebGLGraphicsData=function(a){this.gl=a;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.mode=1;this.alpha=1;this.dirty=true;};PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[];};PIXI.WebGLGraphicsData.prototype.upload=function(){var a=this.gl;this.glPoints=new Float32Array(this.points);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.bufferData(a.ARRAY_BUFFER,this.glPoints,a.STATIC_DRAW);this.glIndicies=new Uint16Array(this.indices);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.glIndicies,a.STATIC_DRAW);this.dirty=false;};PIXI.CanvasGraphics=function(){};PIXI.CanvasGraphics.renderGraphics=function(a,b){var c=a.worldAlpha;if(a.dirty){this.updateGraphicsTint(a);a.dirty=false;}for(var i=0;i<a.graphicsData.length;i++){var d=a.graphicsData[i];var e=d.shape;var f=d._fillTint;var g=d._lineTint;b.lineWidth=d.lineWidth;if(d.type===N.POLYGON){b.beginPath();var k=e.points;b.moveTo(k[0],k[1]);for(var j=1;j<k.length/2;j++){b.lineTo(k[j*2],k[j*2+1]);}if(e.closed){b.lineTo(k[0],k[1]);}if(k[0]===k[k.length-2]&&k[1]===k[k.length-1]){b.closePath();}if(d.fill){b.globalAlpha=d.fillAlpha*c;b.fillStyle='#'+('00000'+(f|0).toString(16)).substr(-6);b.fill();}if(d.lineWidth){b.globalAlpha=d.lineAlpha*c;b.strokeStyle='#'+('00000'+(g|0).toString(16)).substr(-6);b.stroke();}}else if(d.type===N.RECTANGLE){if(d.fillColor||d.fillColor===0){b.globalAlpha=d.fillAlpha*c;b.fillStyle='#'+('00000'+(f|0).toString(16)).substr(-6);b.fillRect(e.x,e.y,e.width,e.height);}if(d.lineWidth){b.globalAlpha=d.lineAlpha*c;b.strokeStyle='#'+('00000'+(g|0).toString(16)).substr(-6);b.strokeRect(e.x,e.y,e.width,e.height);}}else if(d.type===N.CIRCLE){b.beginPath();b.arc(e.x,e.y,e.radius,0,2*Math.PI);b.closePath();if(d.fill){b.globalAlpha=d.fillAlpha*c;b.fillStyle='#'+('00000'+(f|0).toString(16)).substr(-6);b.fill();}if(d.lineWidth){b.globalAlpha=d.lineAlpha*c;b.strokeStyle='#'+('00000'+(g|0).toString(16)).substr(-6);b.stroke();}}else if(d.type===N.ELLIPSE){var w=e.width*2;var h=e.height*2;var x=e.x-w/2;var y=e.y-h/2;b.beginPath();var l=0.5522848,ox=(w/2)*l,oy=(h/2)*l,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;b.moveTo(x,ym);b.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);b.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);b.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);b.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);b.closePath();if(d.fill){b.globalAlpha=d.fillAlpha*c;b.fillStyle='#'+('00000'+(f|0).toString(16)).substr(-6);b.fill();}if(d.lineWidth){b.globalAlpha=d.lineAlpha*c;b.strokeStyle='#'+('00000'+(g|0).toString(16)).substr(-6);b.stroke();}}else if(d.type===N.ROUNDEDRECTANGLE){var m=e.x;var n=e.y;var o=e.width;var p=e.height;var q=e.radius;var r=Math.min(o,p)/2|0;q=q>r?r:q;b.beginPath();b.moveTo(m,n+q);b.lineTo(m,n+p-q);b.quadraticCurveTo(m,n+p,m+q,n+p);b.lineTo(m+o-q,n+p);b.quadraticCurveTo(m+o,n+p,m+o,n+p-q);b.lineTo(m+o,n+q);b.quadraticCurveTo(m+o,n,m+o-q,n);b.lineTo(m+q,n);b.quadraticCurveTo(m,n,m,n+q);b.closePath();if(d.fillColor||d.fillColor===0){b.globalAlpha=d.fillAlpha*c;b.fillStyle='#'+('00000'+(f|0).toString(16)).substr(-6);b.fill();}if(d.lineWidth){b.globalAlpha=d.lineAlpha*c;b.strokeStyle='#'+('00000'+(g|0).toString(16)).substr(-6);b.stroke();}}}};PIXI.CanvasGraphics.renderGraphicsMask=function(a,b){var c=a.graphicsData.length;if(c===0){return;}b.beginPath();for(var i=0;i<c;i++){var d=a.graphicsData[i];var e=d.shape;if(d.type===N.POLYGON){var f=e.points;b.moveTo(f[0],f[1]);for(var j=1;j<f.length/2;j++){b.lineTo(f[j*2],f[j*2+1]);}if(f[0]===f[f.length-2]&&f[1]===f[f.length-1]){b.closePath();}}else if(d.type===N.RECTANGLE){b.rect(e.x,e.y,e.width,e.height);b.closePath();}else if(d.type===N.CIRCLE){b.arc(e.x,e.y,e.radius,0,2*Math.PI);b.closePath();}else if(d.type===N.ELLIPSE){var w=e.width*2;var h=e.height*2;var x=e.x-w/2;var y=e.y-h/2;var g=0.5522848,ox=(w/2)*g,oy=(h/2)*g,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;b.moveTo(x,ym);b.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y);b.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym);b.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);b.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym);b.closePath();}else if(d.type===N.ROUNDEDRECTANGLE){var k=e.x;var l=e.y;var m=e.width;var n=e.height;var o=e.radius;var p=Math.min(m,n)/2|0;o=o>p?p:o;b.moveTo(k,l+o);b.lineTo(k,l+n-o);b.quadraticCurveTo(k,l+n,k+o,l+n);b.lineTo(k+m-o,l+n);b.quadraticCurveTo(k+m,l+n,k+m,l+n-o);b.lineTo(k+m,l+o);b.quadraticCurveTo(k+m,l,k+m-o,l);b.lineTo(k+o,l);b.quadraticCurveTo(k,l,k,l+o);b.closePath();}}};PIXI.CanvasGraphics.updateGraphicsTint=function(a){if(a.tint===0xFFFFFF){return;}var b=(a.tint>>16&0xFF)/255;var c=(a.tint>>8&0xFF)/255;var d=(a.tint&0xFF)/255;for(var i=0;i<a.graphicsData.length;i++){var e=a.graphicsData[i];var f=e.fillColor|0;var g=e.lineColor|0;e._fillTint=(((f>>16&0xFF)/255*b*255<<16)+((f>>8&0xFF)/255*c*255<<8)+(f&0xFF)/255*d*255);e._lineTint=(((g>>16&0xFF)/255*b*255<<16)+((g>>8&0xFF)/255*c*255<<8)+(g&0xFF)/255*d*255);}};N.GraphicsData=function(a,b,c,d,e,f,g){this.lineWidth=a;this.lineColor=b;this.lineAlpha=c;this._lineTint=b;this.fillColor=d;this.fillAlpha=e;this._fillTint=d;this.fill=f;this.shape=g;this.type=g.type;};N.GraphicsData.prototype.constructor=N.GraphicsData;N.GraphicsData.prototype.clone=function(){return new N.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape);};N.Graphics=function(a,x,y){if(x===undefined){x=0;}if(y===undefined){y=0;}this.type=N.GRAPHICS;this.physicsType=N.SPRITE;this.anchor=new N.Point();PIXI.DisplayObjectContainer.call(this);this.renderable=true;this.fillAlpha=1;this.lineWidth=0;this.lineColor=0;this.graphicsData=[];this.tint=0xFFFFFF;this.blendMode=PIXI.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=false;this.boundsPadding=0;this._localBounds=new N.Rectangle(0,0,1,1);this.dirty=true;this._boundsDirty=false;this.webGLDirty=false;this.cachedSpriteDirty=false;N.Component.Core.init.call(this,a,x,y,'',null);};N.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);N.Graphics.prototype.constructor=N.Graphics;N.Component.Core.install.call(N.Graphics.prototype,['Angle','AutoCull','Bounds','Destroy','FixedToCamera','InputEnabled','InWorld','LifeSpan','PhysicsBody','Reset']);N.Graphics.prototype.preUpdatePhysics=N.Component.PhysicsBody.preUpdate;N.Graphics.prototype.preUpdateLifeSpan=N.Component.LifeSpan.preUpdate;N.Graphics.prototype.preUpdateInWorld=N.Component.InWorld.preUpdate;N.Graphics.prototype.preUpdateCore=N.Component.Core.preUpdate;N.Graphics.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false;}return this.preUpdateCore();};N.Graphics.prototype.postUpdate=function(){N.Component.PhysicsBody.postUpdate.call(this);N.Component.FixedToCamera.postUpdate.call(this);if(this._boundsDirty){this.updateLocalBounds();this._boundsDirty=false;}for(var i=0;i<this.children.length;i++){this.children[i].postUpdate();}};N.Graphics.prototype.destroy=function(a){this.clear();N.Component.Destroy.prototype.destroy.call(this,a);};N.Graphics.prototype.drawTriangle=function(a,b){if(b===undefined){b=false;}var c=new N.Polygon(a);if(b){var d=new N.Point(this.game.camera.x-a[0].x,this.game.camera.y-a[0].y);var e=new N.Point(a[1].x-a[0].x,a[1].y-a[0].y);var f=new N.Point(a[1].x-a[2].x,a[1].y-a[2].y);var g=f.cross(e);if(d.dot(g)>0){this.drawPolygon(c);}}else{this.drawPolygon(c);}};N.Graphics.prototype.drawTriangles=function(a,b,c){if(c===undefined){c=false;}var d=new N.Point();var e=new N.Point();var f=new N.Point();var g=[];var i;if(!b){if(a[0]instanceof N.Point){for(i=0;i<a.length/3;i++){this.drawTriangle([a[i*3],a[i*3+1],a[i*3+2]],c);}}else{for(i=0;i<a.length/6;i++){d.x=a[i*6+0];d.y=a[i*6+1];e.x=a[i*6+2];e.y=a[i*6+3];f.x=a[i*6+4];f.y=a[i*6+5];this.drawTriangle([d,e,f],c);}}}else if(a[0]instanceof N.Point){for(i=0;i<b.length/3;i++){g.push(a[b[i*3]]);g.push(a[b[i*3+1]]);g.push(a[b[i*3+2]]);if(g.length===3){this.drawTriangle(g,c);g=[];}}}else{for(i=0;i<b.length;i++){d.x=a[b[i]*2];d.y=a[b[i]*2+1];g.push(d.copyTo({}));if(g.length===3){this.drawTriangle(g,c);g=[];}}}};N.Graphics.prototype.lineStyle=function(a,b,c){this.lineWidth=a||0;this.lineColor=b||0;this.lineAlpha=(c===undefined)?1:c;if(this.currentPath){if(this.currentPath.shape.points.length){this.drawShape(new N.Polygon(this.currentPath.shape.points.slice(-2)));}else{this.currentPath.lineWidth=this.lineWidth;this.currentPath.lineColor=this.lineColor;this.currentPath.lineAlpha=this.lineAlpha;}}return this;};N.Graphics.prototype.moveTo=function(x,y){this.drawShape(new N.Polygon([x,y]));return this;};N.Graphics.prototype.lineTo=function(x,y){if(!this.currentPath){this.moveTo(0,0);}this.currentPath.shape.points.push(x,y);this.dirty=true;this._boundsDirty=true;return this;};N.Graphics.prototype.quadraticCurveTo=function(a,b,c,d){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0];}}else{this.moveTo(0,0);}var e,ya,n=20,points=this.currentPath.shape.points;if(points.length===0){this.moveTo(0,0);}var f=points[points.length-2];var g=points[points.length-1];var j=0;for(var i=1;i<=n;++i){j=i/n;e=f+((a-f)*j);ya=g+((b-g)*j);points.push(e+(((a+((c-a)*j))-e)*j),ya+(((b+((d-b)*j))-ya)*j));}this.dirty=true;this._boundsDirty=true;return this;};N.Graphics.prototype.bezierCurveTo=function(a,b,c,d,e,f){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0];}}else{this.moveTo(0,0);}var n=20,dt,dt2,dt3,t2,t3,points=this.currentPath.shape.points;var g=points[points.length-2];var h=points[points.length-1];var j=0;for(var i=1;i<=n;++i){j=i/n;dt=(1-j);dt2=dt*dt;dt3=dt2*dt;t2=j*j;t3=t2*j;points.push(dt3*g+3*dt2*j*a+3*dt*t2*c+t3*e,dt3*h+3*dt2*j*b+3*dt*t2*d+t3*f);}this.dirty=true;this._boundsDirty=true;return this;};N.Graphics.prototype.arcTo=function(a,b,c,d,e){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points.push(a,b);}}else{this.moveTo(a,b);}var f=this.currentPath.shape.points,fromX=f[f.length-2],fromY=f[f.length-1],a1=fromY-b,b1=fromX-a,a2=d-b,b2=c-a,mm=Math.abs(a1*b2-b1*a2);if(mm<1.0e-8||e===0){if(f[f.length-2]!==a||f[f.length-1]!==b){f.push(a,b);}}else{var g=a1*a1+b1*b1,cc=a2*a2+b2*b2,tt=a1*a2+b1*b2,k1=e*Math.sqrt(g)/mm,k2=e*Math.sqrt(cc)/mm,j1=k1*tt/g,j2=k2*tt/cc,cx=k1*b2+k2*b1,cy=k1*a2+k2*a1,px=b1*(k2+j1),py=a1*(k2+j1),qx=b2*(k1+j2),qy=a2*(k1+j2),startAngle=Math.atan2(py-cy,px-cx),endAngle=Math.atan2(qy-cy,qx-cx);this.arc(cx+a,cy+b,e,startAngle,endAngle,b1*a2>b2*a1);}this.dirty=true;this._boundsDirty=true;return this;};N.Graphics.prototype.arc=function(a,b,d,e,f,g,h){if(e===f){return this;}if(g===undefined){g=false;}if(h===undefined){h=40;}if(!g&&f<=e){f+=Math.PI*2;}else if(g&&e<=f){e+=Math.PI*2;}var j=g?(e-f)*-1:(f-e);var k=Math.ceil(Math.abs(j)/(Math.PI*2))*h;if(j===0){return this;}var l=a+Math.cos(e)*d;var m=b+Math.sin(e)*d;if(g&&this.filling){this.moveTo(a,b);}else{this.moveTo(l,m);}var n=this.currentPath.shape.points;var o=j/(k*2);var p=o*2;var q=Math.cos(o);var r=Math.sin(o);var t=k-1;var u=(t%1)/t;for(var i=0;i<=t;i++){var v=i+u*i;var w=((o)+e+(p*v));var c=Math.cos(w);var s=-Math.sin(w);n.push(((q*c)+(r*s))*d+a,((q*-s)+(r*c))*d+b);}this.dirty=true;this._boundsDirty=true;return this;};N.Graphics.prototype.beginFill=function(a,b){this.filling=true;this.fillColor=a||0;this.fillAlpha=(b===undefined)?1:b;if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.currentPath.fill=this.filling;this.currentPath.fillColor=this.fillColor;this.currentPath.fillAlpha=this.fillAlpha;}}return this;};N.Graphics.prototype.endFill=function(){this.filling=false;this.fillColor=null;this.fillAlpha=1;return this;};N.Graphics.prototype.drawRect=function(x,y,a,b){this.drawShape(new N.Rectangle(x,y,a,b));return this;};N.Graphics.prototype.drawRoundedRect=function(x,y,a,b,c){this.drawShape(new N.RoundedRectangle(x,y,a,b,c));return this;};N.Graphics.prototype.drawCircle=function(x,y,a){this.drawShape(new N.Circle(x,y,a));return this;};N.Graphics.prototype.drawEllipse=function(a,b,c,d){this.drawShape({x:a,y:b,width:c,height:d,type:N.ELLIPSE});return this;};N.Graphics.prototype.drawPolygon=function(a){if(a instanceof N.Polygon){a=a.points;}var b=a;if(!Array.isArray(b)){b=new Array(arguments.length);for(var i=0;i<b.length;++i){b[i]=arguments[i];}}this.drawShape(new N.Polygon(b));return this;};N.Graphics.prototype.clear=function(){this.lineWidth=0;this.filling=false;this.dirty=true;this._boundsDirty=true;this.clearDirty=true;this.graphicsData=[];this.updateLocalBounds();return this;};N.Graphics.prototype.generateTexture=function(a,b,c){if(a===undefined){a=1;}if(b===undefined){b=PIXI.scaleModes.DEFAULT;}if(c===undefined){c=0;}var d=this.getBounds();d.width+=c;d.height+=c;var e=new PIXI.CanvasBuffer(d.width*a,d.height*a);var f=PIXI.Texture.fromCanvas(e.canvas,b);f.baseTexture.resolution=a;e.context.scale(a,a);e.context.translate(-d.x,-d.y);PIXI.CanvasGraphics.renderGraphics(this,e.context);return f;};N.Graphics.prototype._renderWebGL=function(a){if(this.visible===false||this.alpha===0||this.isMask===true){return;}if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false;}this._cachedSprite.worldAlpha=this.worldAlpha;PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,a);return;}else{a.spriteBatch.stop();a.blendModeManager.setBlendMode(this.blendMode);if(this._mask){a.maskManager.pushMask(this._mask,a);}if(this._filters){a.filterManager.pushFilter(this._filterBlock);}if(this.blendMode!==a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=this.blendMode;var b=PIXI.blendModesWebGL[a.spriteBatch.currentBlendMode];a.spriteBatch.gl.blendFunc(b[0],b[1]);}if(this.webGLDirty){this.dirty=true;this.webGLDirty=false;}PIXI.WebGLGraphics.renderGraphics(this,a);if(this.children.length){a.spriteBatch.start();for(var i=0;i<this.children.length;i++){this.children[i]._renderWebGL(a);}a.spriteBatch.stop();}if(this._filters){a.filterManager.popFilter();}if(this._mask){a.maskManager.popMask(this.mask,a);}a.drawCount++;a.spriteBatch.start();}};N.Graphics.prototype._renderCanvas=function(a){if(this.visible===false||this.alpha===0||this.isMask===true){return;}if(this._prevTint!==this.tint){this.dirty=true;this._prevTint=this.tint;}if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false;}this._cachedSprite.alpha=this.alpha;PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,a);return;}else{var b=a.context;var c=this.worldTransform;if(this.blendMode!==a.currentBlendMode){a.currentBlendMode=this.blendMode;b.globalCompositeOperation=PIXI.blendModesCanvas[a.currentBlendMode];}if(this._mask){a.maskManager.pushMask(this._mask,a);}var d=a.resolution;var e=(c.tx*a.resolution)+a.shakeX;var f=(c.ty*a.resolution)+a.shakeY;b.setTransform(c.a*d,c.b*d,c.c*d,c.d*d,e,f);PIXI.CanvasGraphics.renderGraphics(this,b);for(var i=0;i<this.children.length;i++){this.children[i]._renderCanvas(a);}if(this._mask){a.maskManager.popMask(a);}}};N.Graphics.prototype.getBounds=function(e){if(this._currentBounds){return this._currentBounds;}if(this.isMask){return N.EmptyRectangle;}if(this.dirty){this.updateLocalBounds();this.webGLDirty=true;this.cachedSpriteDirty=true;this.dirty=false;}var f=this._localBounds;var g=f.x;var h=f.width+f.x;var i=f.y;var j=f.height+f.y;var k=e||this.worldTransform;var a=k.a;var b=k.b;var c=k.c;var d=k.d;var l=k.tx;var m=k.ty;var n=a*h+c*j+l;var o=d*j+b*h+m;var p=a*g+c*j+l;var q=d*j+b*g+m;var r=a*g+c*i+l;var s=d*i+b*g+m;var t=a*h+c*i+l;var u=d*i+b*h+m;var v=n;var w=o;var x=n;var y=o;x=p<x?p:x;x=r<x?r:x;x=t<x?t:x;y=q<y?q:y;y=s<y?s:y;y=u<y?u:y;v=p>v?p:v;v=r>v?r:v;v=t>v?t:v;w=q>w?q:w;w=s>w?s:w;w=u>w?u:w;this._bounds.x=x;this._bounds.width=v-x;this._bounds.y=y;this._bounds.height=w-y;this._currentBounds=this._bounds;return this._currentBounds;};N.Graphics.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=N.identityMatrix;for(var i=0;i<this.children.length;i++){this.children[i].updateTransform();}var b=this.getBounds();this.worldTransform=a;for(i=0;i<this.children.length;i++){this.children[i].updateTransform();}return b;};N.Graphics.prototype.containsPoint=function(a,b){if(b===undefined){b=new N.Point();}this.worldTransform.applyInverse(a,b);var c=this.graphicsData;for(var i=0;i<c.length;i++){var d=c[i];if(!d.fill){continue;}if(d.shape){if(d.shape.contains(b.x,b.y)){return true;}}}return false;};N.Graphics.prototype.getVisualBounds=function(a){if(this._boundsDirty){this.updateLocalBounds();this._boundsDirty=false;}return this._localBounds.clone(a);};N.Graphics.prototype.updateLocalBounds=function(){var a=Infinity;var b=-Infinity;var c=Infinity;var d=-Infinity;if(this.graphicsData.length){var e,points,x,y,w,h;for(var i=0;i<this.graphicsData.length;i++){var f=this.graphicsData[i];var g=f.type;var k=f.lineWidth;e=f.shape;if(g===N.RECTANGLE||g===N.ROUNDEDRECTANGLE){x=e.x-k/2;y=e.y-k/2;w=e.width+k;h=e.height+k;a=x<a?x:a;b=x+w>b?x+w:b;c=y<c?y:c;d=y+h>d?y+h:d;}else if(g===N.CIRCLE){x=e.x;y=e.y;w=e.radius+k/2;h=e.radius+k/2;a=x-w<a?x-w:a;b=x+w>b?x+w:b;c=y-h<c?y-h:c;d=y+h>d?y+h:d;}else if(g===N.ELLIPSE){x=e.x;y=e.y;w=e.width+k/2;h=e.height+k/2;a=x-w<a?x-w:a;b=x+w>b?x+w:b;c=y-h<c?y-h:c;d=y+h>d?y+h:d;}else{points=e.points;for(var j=0;j<points.length;j++){if(points[j]instanceof N.Point){x=points[j].x;y=points[j].y;}else{x=points[j];y=points[j+1];if(j<points.length-1){j++;}}a=x-k<a?x-k:a;b=x+k>b?x+k:b;c=y-k<c?y-k:c;d=y+k>d?y+k:d;}}}}else{a=0;b=0;c=0;d=0;}var l=this.boundsPadding;this._localBounds.x=a-l;this._localBounds.width=(b-a)+l*2;this._localBounds.y=c-l;this._localBounds.height=(d-c)+l*2;};N.Graphics.prototype._generateCachedSprite=function(){var a=this.getLocalBounds();if(!this._cachedSprite){var b=new PIXI.CanvasBuffer(a.width,a.height);var c=PIXI.Texture.fromCanvas(b.canvas);this._cachedSprite=new PIXI.Sprite(c);this._cachedSprite.buffer=b;this._cachedSprite.worldTransform=this.worldTransform;}else{this._cachedSprite.buffer.resize(a.width,a.height);}this._cachedSprite.anchor.x=-(a.x/a.width);this._cachedSprite.anchor.y=-(a.y/a.height);this._cachedSprite.buffer.context.translate(-a.x,-a.y);this.worldAlpha=1;PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha;};N.Graphics.prototype.updateCachedSpriteTexture=function(){var a=this._cachedSprite;var b=a.texture;var c=a.buffer.canvas;b.baseTexture.width=c.width;b.baseTexture.height=c.height;b.crop.width=b.frame.width=c.width;b.crop.height=b.frame.height=c.height;a._width=c.width;a._height=c.height;b.baseTexture.dirty();};N.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(true);this._cachedSprite=null;};N.Graphics.prototype.drawShape=function(a){if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.graphicsData.pop();}}this.currentPath=null;if(a instanceof N.Polygon){a=a.clone();a.flatten();}var b=new N.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,a);this.graphicsData.push(b);if(b.type===N.POLYGON){b.shape.closed=this.filling;this.currentPath=b;}this.dirty=true;this._boundsDirty=true;return b;};Object.defineProperty(N.Graphics.prototype,'cacheAsBitmap',{get:function(){return this._cacheAsBitmap;},set:function(a){this._cacheAsBitmap=a;if(this._cacheAsBitmap){this._generateCachedSprite();}else{this.destroyCachedSprite();}this.dirty=true;this.webGLDirty=true;}});N.RenderTexture=function(a,b,c,d,e,f,g,h){if(b===undefined){b=100;}if(c===undefined){c=100;}if(d===undefined){d='';}if(e===undefined){e=N.scaleModes.DEFAULT;}if(f===undefined){f=1;}if(g===undefined){g=PIXI.defaultRenderer;}if(h===undefined){h=0;}this.game=a;this.key=d;this.type=N.RENDERTEXTURE;this._tempMatrix=new N.Matrix();this.width=b;this.height=c;this.resolution=f;this.frame=new N.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.crop=this.frame.clone();this.baseTexture=new PIXI.BaseTexture();this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution;this.baseTexture._glTextures=[];this.baseTexture.resolution=this.resolution;this.baseTexture.scaleMode=e;this.baseTexture.hasLoaded=true;PIXI.Texture.call(this,this.baseTexture,this.frame.clone());this.renderer=g;if(this.renderer.type===N.WEBGL){var i=this.renderer.gl;this.baseTexture.textureIndex=h;this.baseTexture._dirty[i.id]=false;this.textureBuffer=new PIXI.FilterTexture(i,this.width,this.height,this.baseTexture.scaleMode,h);this.baseTexture._glTextures[i.id]=this.textureBuffer.texture;this.projection=new N.Point(this.width*0.5,-this.height*0.5);}else{this.textureBuffer=new PIXI.CanvasBuffer(this.width*this.resolution,this.height*this.resolution);this.baseTexture.source=this.textureBuffer.canvas;}this.valid=true;this.tempMatrix=new N.Matrix();this._updateUvs();};N.RenderTexture.prototype=Object.create(PIXI.Texture.prototype);N.RenderTexture.prototype.constructor=N.RenderTexture;N.RenderTexture.prototype.renderXY=function(a,x,y,b){a.updateTransform();this._tempMatrix.copyFrom(a.worldTransform);this._tempMatrix.tx=x;this._tempMatrix.ty=y;if(this.renderer.type===N.WEBGL){this._renderWebGL(a,this._tempMatrix,b);}else{this._renderCanvas(a,this._tempMatrix,b);}};N.RenderTexture.prototype.renderRawXY=function(a,x,y,b){this._tempMatrix.identity().translate(x,y);if(this.renderer.type===N.WEBGL){this._renderWebGL(a,this._tempMatrix,b);}else{this._renderCanvas(a,this._tempMatrix,b);}};N.RenderTexture.prototype.render=function(a,b,c){if(b===undefined||b===null){this._tempMatrix.copyFrom(a.worldTransform);}else{this._tempMatrix.copyFrom(b);}if(this.renderer.type===N.WEBGL){this._renderWebGL(a,this._tempMatrix,c);}else{this._renderCanvas(a,this._tempMatrix,c);}};N.RenderTexture.prototype.resize=function(a,b,c){if(a===this.width&&b===this.height){return;}this.valid=(a>0&&b>0);this.width=a;this.height=b;this.frame.width=this.crop.width=a*this.resolution;this.frame.height=this.crop.height=b*this.resolution;if(c){this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution;}if(this.renderer.type===N.WEBGL){this.projection.x=this.width/2;this.projection.y=-this.height/2;}if(!this.valid){return;}this.textureBuffer.resize(this.width,this.height);};N.RenderTexture.prototype.clear=function(){if(!this.valid){return;}if(this.renderer.type===N.WEBGL){this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer);}this.textureBuffer.clear();};N.RenderTexture.prototype._renderWebGL=function(a,b,c){if(!this.valid||a.alpha===0){return;}var d=a.worldTransform;d.identity();d.translate(0,this.projection.y*2);if(b){d.append(b);}d.scale(1,-1);for(var i=0;i<a.children.length;i++){a.children[i].updateTransform();}var e=this.renderer.gl;e.viewport(0,0,this.width*this.resolution,this.height*this.resolution);e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer);if(c){this.textureBuffer.clear();}this.renderer.spriteBatch.dirty=true;this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer,b);this.renderer.spriteBatch.dirty=true;e.bindFramebuffer(e.FRAMEBUFFER,null);};N.RenderTexture.prototype._renderCanvas=function(a,b,c){if(!this.valid||a.alpha===0){return;}var d=a.worldTransform;d.identity();if(b){d.append(b);}for(var i=0;i<a.children.length;i++){a.children[i].updateTransform();}if(c){this.textureBuffer.clear();}var e=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(a,this.textureBuffer.context,b);this.renderer.resolution=e;};N.RenderTexture.prototype.getImage=function(a,b,c,d){var e=new Image();e.src=this.getBase64(a,b);if(c){e.onload=c;}if(d){e.onerror=d;}return e;};N.RenderTexture.prototype.getBase64=function(a,b){return this.getCanvas().toDataURL(a,b);};N.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===N.WEBGL){var a=this.renderer.gl;var b=this.textureBuffer.width;var c=this.textureBuffer.height;var d=new Uint8Array(4*b*c);a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer);a.readPixels(0,0,b,c,a.RGBA,a.UNSIGNED_BYTE,d);a.bindFramebuffer(a.FRAMEBUFFER,null);var e=new PIXI.CanvasBuffer(b,c);var f=e.context.getImageData(0,0,b,c);f.data.set(d);e.context.putImageData(f,0,0);return e.canvas;}else{return this.textureBuffer.canvas;}};N.Text=function(a,x,y,b,c){x=x||0;y=y||0;if(b===undefined||b===null){b='';}else{b=b.toString();}this.canvas=N.CanvasPool.create(this);N.Sprite.call(this,a,x,y,PIXI.Texture.fromCanvas(this.canvas));this.type=N.TEXT;this.physicsType=N.SPRITE;this.padding=new N.Point();this.textBounds=null;this.context=this.canvas.getContext('2d');this.colors=[];this.strokeColors=[];this.fontStyles=[];this.fontWeights=[];this.autoRound=false;this.useAdvancedWrap=false;this.splitRegExp=/(?:\r\n|\r|\n)/;this.characterLimitSize=-1;this.characterLimitSuffix='';this._testString='|MQfjq_';this._res=a.renderer.resolution;this._text=b;this._fontComponents=null;this._lineSpacing=0;this._charCount=0;this._width=0;this._height=0;this.style={};this.setStyle(c||{});if(b!==''){this.updateText();}};N.Text.prototype=Object.create(N.Sprite.prototype);N.Text.prototype.constructor=N.Text;N.Text.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false;}return this.preUpdateCore();};N.Text.prototype.update=function(){};N.Text.prototype.destroy=function(a){this.texture.destroy(true);N.Component.Destroy.prototype.destroy.call(this,a);};N.Text.prototype.setShadow=function(x,y,a,b,c,d){if(x===undefined){x=0;}if(y===undefined){y=0;}if(a===undefined){a='rgba(0, 0, 0, 1)';}if(b===undefined){b=0;}if(c===undefined){c=true;}if(d===undefined){d=true;}this.style.shadowOffsetX=x;this.style.shadowOffsetY=y;this.style.shadowColor=a;this.style.shadowBlur=b;this.style.shadowStroke=c;this.style.shadowFill=d;this.dirty=true;return this;};N.Text.prototype.setStyle=function(a,b){if(b===undefined){b=false;}var c=Object.assign({},a);c.font=a.font||'bold 20pt Arial';c.backgroundColor=a.backgroundColor||null;c.fill=a.fill||'black';c.align=(a.align||'left').toLowerCase();c.boundsAlignH=(a.boundsAlignH||'left').toLowerCase();c.boundsAlignV=(a.boundsAlignV||'top').toLowerCase();c.stroke=a.stroke||'black';c.strokeThickness=Number(a.strokeThickness)||0;c.wordWrap=a.wordWrap||false;c.wordWrapWidth=a.wordWrapWidth||100;c.maxLines=a.maxLines||0;c.shadowOffsetX=a.shadowOffsetX||0;c.shadowOffsetY=a.shadowOffsetY||0;c.shadowColor=a.shadowColor||'rgba(0,0,0,0)';c.shadowBlur=a.shadowBlur||0;c.tabs=a.tabs||0;c.fontProperties=a.fontProperties||null;var d=this.fontToComponents(c.font);if(c.fontStyle){d.fontStyle=c.fontStyle;}if(c.fontVariant){d.fontVariant=c.fontVariant;}if(c.fontWeight){d.fontWeight=c.fontWeight;}if(c.fontSize){if(typeof c.fontSize==='number'){c.fontSize=c.fontSize+'px';}d.fontSize=c.fontSize;}this._fontComponents=d;c.font=this.componentsToFont(this._fontComponents);this.style=c;this.dirty=true;if(c.testString){this.testString=c.testString;}if(b){this.updateText();}return this;};N.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var a=this.text;if(this.characterLimitSize>-1&&this.characterLimitSize<a.length){a=this.text.substring(0,this.characterLimitSize)+this.characterLimitSuffix;}if(this.style.wordWrap){a=this.runWordWrap(this.text);}var b=a.split(this.splitRegExp);var d=this.style.tabs;var e=[];var f=0;var g=this.style.fontProperties||this.determineFontProperties(this.style.font);var h=b.length;if(this.style.maxLines>0&&this.style.maxLines<b.length){h=this.style.maxLines;}this._charCount=0;for(var i=0;i<h;i++){if(d===0){var j=this.style.strokeThickness+this.padding.x;if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){j+=this.measureLine(b[i]);}else{j+=this.context.measureText(b[i]).width;}if(this.style.wordWrap){j-=this.context.measureText(' ').width;}}else{var k=b[i].split(/(?:\t)/);var j=this.padding.x+this.style.strokeThickness;if(Array.isArray(d)){var l=0;for(var c=0;c<k.length;c++){var m=0;if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){m=this.measureLine(k[c]);}else{m=Math.ceil(this.context.measureText(k[c]).width);}if(c>0){l+=d[c-1];}j=l+m;}}else{for(var c=0;c<k.length;c++){if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){j+=this.measureLine(k[c]);}else{j+=Math.ceil(this.context.measureText(k[c]).width);}var n=this.game.math.snapToCeil(j,d)-j;j+=n;}}}e[i]=Math.ceil(j);f=Math.max(f,e[i]);}this.canvas.width=f*this._res;var o=g.fontSize+this.style.strokeThickness+this.padding.y;var p=o*h;var q=this._lineSpacing;if(q<0&&Math.abs(q)>o){q=-o;}if(q!==0){p+=(q>0)?q*b.length:q*(b.length-1);}this.canvas.height=p*this._res;this.context.scale(this._res,this._res);if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);}if(this.style.backgroundColor){this.context.fillStyle=this.style.backgroundColor;this.context.fillRect(0,0,this.canvas.width,this.canvas.height);}this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.textBaseline='alphabetic';this.context.lineWidth=this.style.strokeThickness;this.context.lineCap='round';this.context.lineJoin='round';var r;var s;this._charCount=0;for(i=0;i<h;i++){r=this.style.strokeThickness/2;s=(this.style.strokeThickness/2+i*o)+g.ascent;if(i>0){s+=(q*i);}if(this.style.align==='right'){r+=f-e[i];}else if(this.style.align==='center'){r+=(f-e[i])/2;}if(this.autoRound){r=Math.round(r);s=Math.round(s);}if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){this.updateLine(b[i],r,s);}else{if(this.style.stroke&&this.style.strokeThickness){this.updateShadow(this.style.shadowStroke);if(d===0){this.context.strokeText(b[i],r,s);}else{this.renderTabLine(b[i],r,s,false);}}if(this.style.fill){this.updateShadow(this.style.shadowFill);if(d===0){this.context.fillText(b[i],r,s);}else{this.renderTabLine(b[i],r,s,true);}}}}this.updateTexture();this.dirty=false;};N.Text.prototype.renderTabLine=function(a,x,y,b){var d=a.split(/(?:\t)/);var e=this.style.tabs;var f=0;if(Array.isArray(e)){var g=0;for(var c=0;c<d.length;c++){if(c>0){g+=e[c-1];}f=x+g;if(b){this.context.fillText(d[c],f,y);}else{this.context.strokeText(d[c],f,y);}}}else{for(var c=0;c<d.length;c++){var h=Math.ceil(this.context.measureText(d[c]).width);f=this.game.math.snapToCeil(x,e);if(b){this.context.fillText(d[c],f,y);}else{this.context.strokeText(d[c],f,y);}x=f+h;}}};N.Text.prototype.updateShadow=function(a){if(a){this.context.shadowOffsetX=this.style.shadowOffsetX;this.context.shadowOffsetY=this.style.shadowOffsetY;this.context.shadowColor=this.style.shadowColor;this.context.shadowBlur=this.style.shadowBlur;}else{this.context.shadowOffsetX=0;this.context.shadowOffsetY=0;this.context.shadowColor=0;this.context.shadowBlur=0;}};N.Text.prototype.measureLine=function(a){var b=0;for(var i=0;i<a.length;i++){var c=a[i];if(this.fontWeights.length>0||this.fontStyles.length>0){var d=this.fontToComponents(this.context.font);if(this.fontStyles[this._charCount]){d.fontStyle=this.fontStyles[this._charCount];}if(this.fontWeights[this._charCount]){d.fontWeight=this.fontWeights[this._charCount];}this.context.font=this.componentsToFont(d);}if(this.style.stroke&&this.style.strokeThickness){if(this.strokeColors[this._charCount]){this.context.strokeStyle=this.strokeColors[this._charCount];}this.updateShadow(this.style.shadowStroke);}if(this.style.fill){if(this.colors[this._charCount]){this.context.fillStyle=this.colors[this._charCount];}this.updateShadow(this.style.shadowFill);}b+=this.context.measureText(c).width;this._charCount++;}return Math.ceil(b);};N.Text.prototype.updateLine=function(a,x,y){for(var i=0;i<a.length;i++){var b=a[i];if(this.fontWeights.length>0||this.fontStyles.length>0){var c=this.fontToComponents(this.context.font);if(this.fontStyles[this._charCount]){c.fontStyle=this.fontStyles[this._charCount];}if(this.fontWeights[this._charCount]){c.fontWeight=this.fontWeights[this._charCount];}this.context.font=this.componentsToFont(c);}if(this.style.stroke&&this.style.strokeThickness){if(this.strokeColors[this._charCount]){this.context.strokeStyle=this.strokeColors[this._charCount];}this.updateShadow(this.style.shadowStroke);this.context.strokeText(b,x,y);}if(this.style.fill){if(this.colors[this._charCount]){this.context.fillStyle=this.colors[this._charCount];}this.updateShadow(this.style.shadowFill);this.context.fillText(b,x,y);}x+=this.context.measureText(b).width;this._charCount++;}};N.Text.prototype.clearColors=function(){this.colors=[];this.strokeColors=[];this.dirty=true;return this;};N.Text.prototype.clearFontValues=function(){this.fontStyles=[];this.fontWeights=[];this.dirty=true;return this;};N.Text.prototype.addColor=function(a,b){this.colors[b]=a;this.dirty=true;return this;};N.Text.prototype.addStrokeColor=function(a,b){this.strokeColors[b]=a;this.dirty=true;return this;};N.Text.prototype.addFontStyle=function(a,b){this.fontStyles[b]=a;this.dirty=true;return this;};N.Text.prototype.addFontWeight=function(a,b){this.fontWeights[b]=a;this.dirty=true;return this;};N.Text.prototype.precalculateWordWrap=function(a){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var b=this.runWordWrap(a);return b.split(/(?:\r\n|\r|\n)/);};N.Text.prototype.runWordWrap=function(a){if(this.useAdvancedWrap){return this.advancedWordWrap(a);}else{return this.basicWordWrap(a);}};N.Text.prototype.advancedWordWrap=function(a){var b=this.context;var c=this.style.wordWrapWidth;var d='';var e=a.replace(/ +/gi,' ').split(/\r?\n/gi);var f=e.length;for(var i=0;i<f;i++){var g=e[i];var h='';g=g.replace(/^ *|\s*$/gi,'');var k=b.measureText(g).width;if(k<c){d+=g+'\n';continue;}var l=c;var m=g.split(' ');for(var j=0;j<m.length;j++){var n=m[j];var o=n+' ';var p=b.measureText(o).width;if(p>l){if(j===0){var q=o;while(q.length){q=q.slice(0,-1);p=b.measureText(q).width;if(p<=l){break;}}if(!q.length){throw new Error('This text\'s wordWrapWidth setting is less than a single character!')}var r=n.substr(q.length);m[j]=r;h+=q}var s=(m[j].length)?j:j+1;var t=m.slice(s).join(' ').replace(/[ \n]*$/gi,'');e[i+1]=t+' '+(e[i+1]||'');f=e.length;break}else{h+=o;l-=p}}d+=h.replace(/[ \n]*$/gi,'')+'\n'}d=d.replace(/[\s|\n]*$/gi,'');return d};N.Text.prototype.basicWordWrap=function(a){var b='';var c=a.split('\n');for(var i=0;i<c.length;i++){var d=this.style.wordWrapWidth;var e=c[i].split(' ');for(var j=0;j<e.length;j++){var f=this.context.measureText(e[j]).width;var g=f+this.context.measureText(' ').width;if(g>d){if(j>0){b+='\n'}b+=e[j]+' ';d=this.style.wordWrapWidth-f}else{d-=g;b+=e[j]+' '}}if(i<c.length-1){b+='\n'}}return b};N.Text.prototype.updateFont=function(a){var b=this.componentsToFont(a);if(this.style.font!==b){this.style.font=b;this.dirty=true;if(this.parent){this.updateTransform()}}};N.Text.prototype.fontToComponents=function(a){var m=a.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(m){var b=m[5].trim();if(!(/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/).exec(b)&&!(/['",]/).exec(b)){b='\''+b+'\''}return{font:a,fontStyle:m[1]||'normal',fontVariant:m[2]||'normal',fontWeight:m[3]||'normal',fontSize:m[4]||'medium',fontFamily:b}}else{console.warn('Phaser.Text - unparsable CSS font: '+a);return{font:a}}};N.Text.prototype.componentsToFont=function(a){var b=[];var v;v=a.fontStyle;if(v&&v!=='normal'){b.push(v)}v=a.fontVariant;if(v&&v!=='normal'){b.push(v)}v=a.fontWeight;if(v&&v!=='normal'){b.push(v)}v=a.fontSize;if(v&&v!=='medium'){b.push(v)}v=a.fontFamily;if(v){b.push(v)}if(!b.length){b.push(a.font)}return b.join(' ')};N.Text.prototype.setText=function(a,b){if(b===undefined){b=false}a=a.toString()||'';if(a===this._text){return this}this.text=a;if(b){this.updateText()}else{this.dirty=true}return this};N.Text.prototype.parseList=function(a){if(!Array.isArray(a)){return this}else{var s='';for(var i=0;i<a.length;i++){if(Array.isArray(a[i])){s+=a[i].join('\t');if(i<a.length-1){s+='\n'}}else{s+=a[i];if(i<a.length-1){s+='\t'}}}}this.text=s;this.dirty=true;return this};N.Text.prototype.setTextBounds=function(x,y,a,b){if(x===undefined){this.textBounds=null}else{if(!this.textBounds){this.textBounds=new N.Rectangle(x,y,a,b)}else{this.textBounds.setTo(x,y,a,b)}if(this.style.wordWrapWidth>a){this.style.wordWrapWidth=a}}this.updateTexture();return this};N.Text.prototype.updateTexture=function(){var a=this.texture.baseTexture;var b=this.texture.crop;var c=this.texture.frame;var w=this.canvas.width;var h=this.canvas.height;a.width=w;a.height=h;b.width=w;b.height=h;c.width=w;c.height=h;this.texture.width=w;this.texture.height=h;this._width=w;this._height=h;if(this.textBounds){var x=this.textBounds.x;var y=this.textBounds.y;if(this.style.boundsAlignH==='right'){x+=this.textBounds.width-this.canvas.width/this.resolution}else if(this.style.boundsAlignH==='center'){x+=this.textBounds.halfWidth-(this.canvas.width/this.resolution/2)}if(this.style.boundsAlignV==='bottom'){y+=this.textBounds.height-this.canvas.height/this.resolution}else if(this.style.boundsAlignV==='middle'){y+=this.textBounds.halfHeight-(this.canvas.height/this.resolution/2)}this.pivot.x=-x;this.pivot.y=-y}this.renderable=(w!==0&&h!==0);this.texture.requiresReTint=true;this.texture.baseTexture.dirty()};N.Text.prototype._renderWebGL=function(a){if(this.dirty){this.updateText();this.dirty=false}PIXI.Sprite.prototype._renderWebGL.call(this,a)};N.Text.prototype._renderCanvas=function(a){if(this.dirty){this.updateText();this.dirty=false}PIXI.Sprite.prototype._renderCanvas.call(this,a)};N.Text.prototype.determineFontProperties=function(a){var b=N.Text.fontPropertiesCache[a];if(b){return b}var c=N.Text.fontPropertiesContext;c.font=a;var d=c.measureText(this.testString);if(d.actualBoundingBoxAscent){var e=Math.ceil(d.actualBoundingBoxAscent);var f=Math.ceil(d.actualBoundingBoxDescent);b={ascent:e,descent:f,fontSize:e+f}}else{var g=c.measureText('MX').width;var e=Math.ceil(0.75*g);var f=Math.ceil(0.25*g);b={ascent:e,descent:f,fontSize:e+f}}N.Text.fontPropertiesCache[a]=b;return b};N.Text.prototype.getBounds=function(a){if(this.dirty){this.updateText();this.dirty=false}return PIXI.Sprite.prototype.getBounds.call(this,a)};N.Text.prototype.setCharacterLimit=function(a,b){this.characterLimitSuffix=(b===undefined)?'':b;this.characterLimitSize=a;this.updateText()};Object.defineProperty(N.Text.prototype,'text',{get:function(){return this._text},set:function(a){if(a!==this._text){this._text=a.toString()||'';this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(N.Text.prototype,'cssFont',{get:function(){return this.componentsToFont(this._fontComponents)},set:function(a){a=a||'bold 20pt Arial';this._fontComponents=this.fontToComponents(a);this.updateFont(this._fontComponents)}});Object.defineProperty(N.Text.prototype,'font',{get:function(){return this._fontComponents.fontFamily},set:function(a){a=a||'Arial';a=a.trim();if(!(/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/).exec(a)&&!(/['",]/).exec(a)){a='\''+a+'\''}this._fontComponents.fontFamily=a;this.updateFont(this._fontComponents)}});Object.defineProperty(N.Text.prototype,'fontSize',{get:function(){var a=this._fontComponents.fontSize;if(a&&(/(?:^0$|px$)/).exec(a)){return parseInt(a,10)}else{return a}},set:function(a){a=a||'0';if(typeof a==='number'){a=a+'px'}this._fontComponents.fontSize=a;this.updateFont(this._fontComponents)}});Object.defineProperty(N.Text.prototype,'fontWeight',{get:function(){return this._fontComponents.fontWeight||'normal'},set:function(a){a=a||'normal';this._fontComponents.fontWeight=a;this.updateFont(this._fontComponents)}});Object.defineProperty(N.Text.prototype,'fontStyle',{get:function(){return this._fontComponents.fontStyle||'normal'},set:function(a){a=a||'normal';this._fontComponents.fontStyle=a;this.updateFont(this._fontComponents)}});Object.defineProperty(N.Text.prototype,'fontVariant',{get:function(){return this._fontComponents.fontVariant||'normal'},set:function(a){a=a||'normal';this._fontComponents.fontVariant=a;this.updateFont(this._fontComponents)}});Object.defineProperty(N.Text.prototype,'fill',{get:function(){return this.style.fill},set:function(a){if(a!==this.style.fill){this.style.fill=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'align',{get:function(){return this.style.align},set:function(a){a=a.toLowerCase();if(a!==this.style.align){this.style.align=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'resolution',{get:function(){return this._res},set:function(a){if(a!==this._res){this._res=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'tabs',{get:function(){return this.style.tabs},set:function(a){if(a!==this.style.tabs){this.style.tabs=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'boundsAlignH',{get:function(){return this.style.boundsAlignH},set:function(a){a=a.toLowerCase();if(a!==this.style.boundsAlignH){this.style.boundsAlignH=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'boundsAlignV',{get:function(){return this.style.boundsAlignV},set:function(a){a=a.toLowerCase();if(a!==this.style.boundsAlignV){this.style.boundsAlignV=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'stroke',{get:function(){return this.style.stroke},set:function(a){if(a!==this.style.stroke){this.style.stroke=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'strokeThickness',{get:function(){return this.style.strokeThickness},set:function(a){if(a!==this.style.strokeThickness){this.style.strokeThickness=Number(a);this.dirty=true}}});Object.defineProperty(N.Text.prototype,'wordWrap',{get:function(){return this.style.wordWrap},set:function(a){if(a!==this.style.wordWrap){this.style.wordWrap=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'wordWrapWidth',{get:function(){return this.style.wordWrapWidth},set:function(a){if(a!==this.style.wordWrapWidth){this.style.wordWrapWidth=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'lineSpacing',{get:function(){return this._lineSpacing},set:function(a){if(a!==this._lineSpacing){this._lineSpacing=parseFloat(a);this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(N.Text.prototype,'shadowOffsetX',{get:function(){return this.style.shadowOffsetX},set:function(a){if(a!==this.style.shadowOffsetX){this.style.shadowOffsetX=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'shadowOffsetY',{get:function(){return this.style.shadowOffsetY},set:function(a){if(a!==this.style.shadowOffsetY){this.style.shadowOffsetY=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'shadowColor',{get:function(){return this.style.shadowColor},set:function(a){if(a!==this.style.shadowColor){this.style.shadowColor=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'shadowBlur',{get:function(){return this.style.shadowBlur},set:function(a){if(a!==this.style.shadowBlur){this.style.shadowBlur=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'shadowStroke',{get:function(){return this.style.shadowStroke},set:function(a){if(a!==this.style.shadowStroke){this.style.shadowStroke=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'shadowFill',{get:function(){return this.style.shadowFill},set:function(a){if(a!==this.style.shadowFill){this.style.shadowFill=a;this.dirty=true}}});Object.defineProperty(N.Text.prototype,'width',{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.x*(this.texture.frame.width/this.resolution)},set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}});Object.defineProperty(N.Text.prototype,'height',{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.y*(this.texture.frame.height/this.resolution)},set:function(a){this.scale.y=a/this.texture.frame.height;this._height=a}});Object.defineProperty(N.Text.prototype,'testString',{get:function(){return this._testString},set:function(a){this._testString=a;this.updateText()}});N.Text.fontPropertiesCache={};N.Text.fontPropertiesCanvas=document.createElement('canvas');N.Text.fontPropertiesContext=N.Text.fontPropertiesCanvas.getContext('2d');N.BitmapText=function(a,x,y,b,c,d,e){x=x||0;y=y||0;b=b||'';c=c||'';d=d||32;e=e||'left';PIXI.DisplayObjectContainer.call(this);this.type=N.BITMAPTEXT;this.physicsType=N.SPRITE;this.textWidth=0;this.textHeight=0;this.anchor=new N.Point();this._prevAnchor=new N.Point();this._glyphs=[];this._maxWidth=0;this._text=c.toString()||'';this._data=a.cache.getBitmapFont(b);this._font=b;this._fontSize=d;this._align=e;this._letterSpacing=0;this._tint=0xFFFFFF;this.updateText();this.dirty=false;N.Component.Core.init.call(this,a,x,y,'',null)};N.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);N.BitmapText.prototype.constructor=N.BitmapText;N.Component.Core.install.call(N.BitmapText.prototype,['Angle','AutoCull','Bounds','Destroy','FixedToCamera','InputEnabled','InWorld','LifeSpan','PhysicsBody','Reset']);N.BitmapText.prototype.preUpdatePhysics=N.Component.PhysicsBody.preUpdate;N.BitmapText.prototype.preUpdateLifeSpan=N.Component.LifeSpan.preUpdate;N.BitmapText.prototype.preUpdateInWorld=N.Component.InWorld.preUpdate;N.BitmapText.prototype.preUpdateCore=N.Component.Core.preUpdate;N.BitmapText.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};N.BitmapText.prototype.postUpdate=function(){N.Component.PhysicsBody.postUpdate.call(this);N.Component.FixedToCamera.postUpdate.call(this);if(this.body&&this.body.type===N.Physics.ARCADE){if((this.textWidth!==this.body.sourceWidth)||(this.textHeight!==this.body.sourceHeight)){this.body.setSize(this.textWidth,this.textHeight)}}};N.BitmapText.prototype.setText=function(a){this.text=a};N.BitmapText.prototype.scanLine=function(a,b,d){var x=0;var w=0;var e=-1;var f=0;var g=null;var h=(this._maxWidth>0)?this._maxWidth:null;var j=[];for(var i=0;i<d.length;i++){var k=(i===d.length-1)?true:false;if((/(?:\r\n|\r|\n)/).test(d.charAt(i))){return{width:w,text:d.substr(0,i),end:k,chars:j}}else{var l=d.charCodeAt(i);var m=a.chars[l];var c=0;if(m===undefined){l=32;m=a.chars[l]}var n=(g&&m.kerning[g])?m.kerning[g]:0;if((/(\s)/).test(d.charAt(i))){e=i;f=w}c=(n+m.texture.width+m.xOffset)*b;if(h&&((w+c)>=h)&&e>-1){return{width:f||w,text:d.substr(0,i-(i-e)),end:false,chars:j}}else{w+=(m.xAdvance+n+this.letterSpacing)*b;j.push(x+(m.xOffset+n+this.letterSpacing)*b);x+=(m.xAdvance+n+this.letterSpacing)*b;g=l}}}return{width:w,text:d,end:k,chars:j}};N.BitmapText.prototype.cleanText=function(a,b){if(b===undefined){b=''}var d=this._data.font;if(!d){return''}var e=/\r\n|\n\r|\n|\r/g;var f=a.replace(e,'\n').split('\n');for(var i=0;i<f.length;i++){var g='';var h=f[i];for(var c=0;c<h.length;c++){if(d.chars[h.charCodeAt(c)]){g=g.concat(h[c])}else{g=g.concat(b)}}f[i]=g}return f.join('\n')};N.BitmapText.prototype.updateText=function(){var a=this._data.font;if(!a){return}var b=this.text;var d=this._fontSize/a.size;var e=[];var y=0;this.textWidth=0;do{var f=this.scanLine(a,d,b);f.y=y;e.push(f);if(f.width>this.textWidth){this.textWidth=f.width}y+=(a.lineHeight*d);b=b.substr(f.text.length+1)}while(f.end===false);this.textHeight=y;var t=0;var h=0;var j=this.textWidth*this.anchor.x;var k=this.textHeight*this.anchor.y;for(var i=0;i<e.length;i++){var f=e[i];if(this._align==='right'){h=this.textWidth-f.width}else if(this._align==='center'){h=(this.textWidth-f.width)/2}for(var c=0;c<f.text.length;c++){var l=f.text.charCodeAt(c);var m=a.chars[l];if(m===undefined){l=32;m=a.chars[l]}var g=this._glyphs[t];if(g){g.texture=m.texture}else{g=new PIXI.Sprite(m.texture);g.name=f.text[c];this._glyphs.push(g)}g.position.x=(f.chars[c]+h)-j;g.position.y=(f.y+(m.yOffset*d))-k;g.scale.set(d);g.tint=this.tint;g.texture.requiresReTint=true;g.cachedTint=0xFFFFFF;if(!g.parent){this.addChild(g)}t++}}for(i=t;i<this._glyphs.length;i++){this.removeChild(this._glyphs[i])}};N.BitmapText.prototype.purgeGlyphs=function(){var a=this._glyphs.length;var b=[];for(var i=0;i<this._glyphs.length;i++){if(this._glyphs[i].parent!==this){this._glyphs[i].destroy()}else{b.push(this._glyphs[i])}}this._glyphs=[];this._glyphs=b;this.updateText();return a-b.length};N.BitmapText.prototype.updateTransform=function(){if(this.dirty||!this.anchor.equals(this._prevAnchor)){this.updateText();this.dirty=false;this._prevAnchor.copyFrom(this.anchor)}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)};Object.defineProperty(N.BitmapText.prototype,'letterSpacing',{get:function(){return this._letterSpacing},set:function(a){if(typeof(a)==='number'){this._letterSpacing=a;this.updateText()}}});Object.defineProperty(N.BitmapText.prototype,'align',{get:function(){return this._align},set:function(a){if(a!==this._align&&(a==='left'||a==='center'||a==='right')){this._align=a;this.updateText()}}});Object.defineProperty(N.BitmapText.prototype,'tint',{get:function(){return this._tint},set:function(a){if(a!==this._tint){this._tint=a;this.updateText()}}});Object.defineProperty(N.BitmapText.prototype,'font',{get:function(){return this._font},set:function(a){if(a!==this._font){this._font=a.trim();this._data=this.game.cache.getBitmapFont(this._font);this.updateText()}}});Object.defineProperty(N.BitmapText.prototype,'fontSize',{get:function(){return this._fontSize},set:function(a){a=parseInt(a,10);if(a!==this._fontSize&&a>0){this._fontSize=a;this.updateText()}}});Object.defineProperty(N.BitmapText.prototype,'text',{get:function(){return this._text},set:function(a){if(a!==this._text){this._text=a.toString()||'';this.updateText()}}});Object.defineProperty(N.BitmapText.prototype,'maxWidth',{get:function(){return this._maxWidth},set:function(a){if(a!==this._maxWidth){this._maxWidth=a;this.updateText()}}});Object.defineProperty(N.BitmapText.prototype,'smoothed',{get:function(){return!this._data.base.scaleMode},set:function(a){if(a){this._data.base.scaleMode=0}else{this._data.base.scaleMode=1}this._data.base.dirty()}});N.RetroFont=function(a,b,d,e,f,g,h,i,j,k){if(!a.cache.checkImageKey(b)){return false}if(g===undefined||g===null){g=a.cache.getImage(b).width/d}this.characterWidth=d;this.characterHeight=e;this.characterSpacingX=h||0;this.characterSpacingY=i||0;this.characterPerRow=g;this.offsetX=j||0;this.offsetY=k||0;this.align='left';this.multiLine=false;this.autoUpperCase=true;this.customSpacingX=0;this.customSpacingY=0;this.fixedWidth=0;this.fontSet=a.cache.getImage(b);this._text='';this.grabData=[];this.frameData=new N.FrameData();var l=this.offsetX;var m=this.offsetY;var r=0;for(var c=0;c<f.length;c++){var n=this.frameData.addFrame(new N.Frame(c,l,m,this.characterWidth,this.characterHeight));this.grabData[f.charCodeAt(c)]=n.index;r++;if(r===this.characterPerRow){r=0;l=this.offsetX;m+=this.characterHeight+this.characterSpacingY}else{l+=this.characterWidth+this.characterSpacingX}}a.cache.updateFrameData(b,this.frameData);this.stamp=new N.Image(a,0,0,b,0);N.RenderTexture.call(this,a,100,100,'',N.scaleModes.NEAREST);this.type=N.RETROFONT};N.RetroFont.prototype=Object.create(N.RenderTexture.prototype);N.RetroFont.prototype.constructor=N.RetroFont;N.RetroFont.ALIGN_LEFT='left';N.RetroFont.ALIGN_RIGHT='right';N.RetroFont.ALIGN_CENTER='center';N.RetroFont.TEXT_SET1=' !"#$%&\'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~';N.RetroFont.TEXT_SET2=' !"#$%&\'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ';N.RetroFont.TEXT_SET3='ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ';N.RetroFont.TEXT_SET4='ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789';N.RetroFont.TEXT_SET5='ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() \'!?-*:0123456789';N.RetroFont.TEXT_SET6='ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789"(),-.\' ';N.RetroFont.TEXT_SET7='AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW")28FLRX-\'39';N.RetroFont.TEXT_SET8='0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ';N.RetroFont.TEXT_SET9='ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,\'"?!';N.RetroFont.TEXT_SET10='ABCDEFGHIJKLMNOPQRSTUVWXYZ';N.RetroFont.TEXT_SET11='ABCDEFGHIJKLMNOPQRSTUVWXYZ.,"-+!?()\':;0123456789';N.RetroFont.prototype.setFixedWidth=function(a,b){if(b===undefined){b='left'}this.fixedWidth=a;this.align=b};N.RetroFont.prototype.setText=function(a,b,c,d,e,f){this.multiLine=b||false;this.customSpacingX=c||0;this.customSpacingY=d||0;this.align=e||'left';if(f){this.autoUpperCase=false}else{this.autoUpperCase=true}if(a.length>0){this.text=a}};N.RetroFont.prototype.buildRetroFontText=function(){var a=0;var b=0;this.clear();if(this.multiLine){var c=this._text.split('\n');if(this.fixedWidth>0){this.resize(this.fixedWidth,(c.length*(this.characterHeight+this.customSpacingY))-this.customSpacingY,true)}else{this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),(c.length*(this.characterHeight+this.customSpacingY))-this.customSpacingY,true)}for(var i=0;i<c.length;i++){a=0;if(this.align===N.RetroFont.ALIGN_RIGHT){a=this.width-(c[i].length*(this.characterWidth+this.customSpacingX))}else if(this.align===N.RetroFont.ALIGN_CENTER){a=(this.width/2)-((c[i].length*(this.characterWidth+this.customSpacingX))/2);a+=this.customSpacingX/2}if(a<0){a=0}this.pasteLine(c[i],a,b,this.customSpacingX);b+=this.characterHeight+this.customSpacingY}}else{if(this.fixedWidth>0){this.resize(this.fixedWidth,this.characterHeight,true)}else{this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,true)}a=0;if(this.align===N.RetroFont.ALIGN_RIGHT){a=this.width-(this._text.length*(this.characterWidth+this.customSpacingX))}else if(this.align===N.RetroFont.ALIGN_CENTER){a=(this.width/2)-((this._text.length*(this.characterWidth+this.customSpacingX))/2);a+=this.customSpacingX/2}if(a<0){a=0}this.pasteLine(this._text,a,0,this.customSpacingX)}this.requiresReTint=true};N.RetroFont.prototype.pasteLine=function(a,x,y,b){for(var c=0;c<a.length;c++){if(a.charAt(c)===' '){x+=this.characterWidth+b}else{if(this.grabData[a.charCodeAt(c)]>=0){this.stamp.frame=this.grabData[a.charCodeAt(c)];this.renderXY(this.stamp,x,y,false);x+=this.characterWidth+b;if(x>this.width){break}}}}};N.RetroFont.prototype.getLongestLine=function(){var a=0;if(this._text.length>0){var b=this._text.split('\n');for(var i=0;i<b.length;i++){if(b[i].length>a){a=b[i].length}}}return a};N.RetroFont.prototype.removeUnsupportedCharacters=function(a){var b='';for(var c=0;c<this._text.length;c++){var d=this._text[c];var e=d.charCodeAt(0);if(this.grabData[e]>=0||(!a&&d==='\n')){b=b.concat(d)}}return b};N.RetroFont.prototype.updateOffset=function(x,y){if(this.offsetX===x&&this.offsetY===y){return}var a=x-this.offsetX;var b=y-this.offsetY;var c=this.game.cache.getFrameData(this.stamp.key).getFrames();var i=c.length;while(i--){c[i].x+=a;c[i].y+=b}this.buildRetroFontText()};Object.defineProperty(N.RetroFont.prototype,'text',{get:function(){return this._text},set:function(a){var b;if(this.autoUpperCase){b=a.toUpperCase()}else{b=a}if(b!==this._text){this._text=b;this.removeUnsupportedCharacters(this.multiLine);this.buildRetroFontText()}}});Object.defineProperty(N.RetroFont.prototype,'smoothed',{get:function(){return this.stamp.smoothed},set:function(a){this.stamp.smoothed=a;this.buildRetroFontText()}});N.Rope=function(a,x,y,b,c,d){this.points=d||[];this._hasUpdateAnimation=false;this._updateAnimationCallback=null;x=x||0;y=y||0;b=b||null;c=c||null;this.type=N.ROPE;PIXI.DisplayObjectContainer.call(this);this.texture=N.Cache.DEFAULT;this.uvs=new Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new Float32Array([0,0,100,0,100,100,0,100]);this.colors=new Float32Array([1,1,1,1]);this.indices=new Uint16Array([0,1,2,3]);if(d){this.vertices=new Float32Array(d.length*4);this.uvs=new Float32Array(d.length*4);this.colors=new Float32Array(d.length*2);this.indices=new Uint16Array(d.length*2)}this.dirty=true;this.canvasPadding=0;this.drawMode=N.Rope.TRIANGLE_STRIP;N.Component.Core.init.call(this,a,x,y,b,c);this.refresh()};N.Rope.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);N.Rope.prototype.constructor=N.Rope;N.Component.Core.install.call(N.Rope.prototype,['Angle','Animation','AutoCull','Bounds','BringToTop','Crop','Delta','Destroy','FixedToCamera','InWorld','LifeSpan','LoadTexture','Overlap','PhysicsBody','Reset','ScaleMinMax','Smoothed']);N.Rope.prototype.preUpdatePhysics=N.Component.PhysicsBody.preUpdate;N.Rope.prototype.preUpdateLifeSpan=N.Component.LifeSpan.preUpdate;N.Rope.prototype.preUpdateInWorld=N.Component.InWorld.preUpdate;N.Rope.prototype.preUpdateCore=N.Component.Core.preUpdate;N.Rope.TRIANGLE_STRIP=0;N.Rope.TRIANGLES=1;N.Rope.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};N.Rope.prototype.update=function(){if(this._hasUpdateAnimation){this.updateAnimation.call(this)}};N.Rope.prototype.reset=function(x,y){N.Component.Reset.prototype.reset.call(this,x,y);return this};N.Rope.prototype.refresh=function(){var a=this.points;if(a.length<1){return}var b=this.uvs;var c=this.indices;var d=this.colors;this.count-=0.2;var e=a.length;var f=0;var g=0;for(var i=0;i<e;i++){f=i*4;g=i/(e-1);b[f]=g;b[f+1]=0;b[f+2]=g;b[f+3]=1;f=i*2;d[f]=1;d[f+1]=1;f=i*2;c[f]=f;c[f+1]=f+1}};N.Rope.prototype.updateTransform=function(){var a=this.points;if(a.length<1){return}var b=a[0];var c;var d={x:0,y:0};this.count-=0.2;var e=this.vertices;var f=a.length;var g;var h;var j;var k;var l=this.texture.height/2;for(var i=0;i<f;i++){g=a[i];h=i*4;if(i<f-1){c=a[i+1]}else{c=g}d.y=-(c.x-b.x);d.x=c.y-b.y;j=Math.sqrt((d.x*d.x)+(d.y*d.y));k=l;d.x/=j;d.y/=j;d.x*=k;d.y*=k;e[h]=g.x+d.x;e[h+1]=g.y+d.y;e[h+2]=g.x-d.x;e[h+3]=g.y-d.y;b=g}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)};N.Rope.prototype.setTexture=function(a){this.texture=a};N.Rope.prototype._renderWebGL=function(a){if(!this.visible||this.alpha<=0){return}a.spriteBatch.stop();if(!this._vertexBuffer){this._initWebGL(a)}a.shaderManager.setShader(a.shaderManager.stripShader);this._renderStrip(a);a.spriteBatch.start()};N.Rope.prototype._initWebGL=function(a){var b=a.gl;this._vertexBuffer=b.createBuffer();this._indexBuffer=b.createBuffer();this._uvBuffer=b.createBuffer();this._colorBuffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer);b.bufferData(b.ARRAY_BUFFER,this.vertices,b.DYNAMIC_DRAW);b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer);b.bufferData(b.ARRAY_BUFFER,this.uvs,b.STATIC_DRAW);b.bindBuffer(b.ARRAY_BUFFER,this._colorBuffer);b.bufferData(b.ARRAY_BUFFER,this.colors,b.STATIC_DRAW);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.indices,b.STATIC_DRAW)};N.Rope.prototype._renderStrip=function(a){var b=a.gl;var c=a.projection;var d=a.offset;var e=a.shaderManager.stripShader;var f=(this.drawMode===N.Rope.TRIANGLE_STRIP)?b.TRIANGLE_STRIP:b.TRIANGLES;a.blendModeManager.setBlendMode(this.blendMode);b.uniformMatrix3fv(e.translationMatrix,false,this.worldTransform.toArray(true));b.uniform2f(e.projectionVector,c.x,-c.y);b.uniform2f(e.offsetVector,-d.x,-d.y);b.uniform1f(e.alpha,this.worldAlpha);if(!this.dirty){b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer);b.bufferSubData(b.ARRAY_BUFFER,0,this.vertices);b.vertexAttribPointer(e.aVertexPosition,2,b.FLOAT,false,0,0);b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer);b.vertexAttribPointer(e.aTextureCoord,2,b.FLOAT,false,0,0);b.activeTexture(b.TEXTURE0);if(this.texture.baseTexture._dirty[b.id]){a.renderer.updateTexture(this.texture.baseTexture)}else{b.bindTexture(b.TEXTURE_2D,this.texture.baseTexture._glTextures[b.id])}b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer)}else{this.dirty=false;b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer);b.bufferData(b.ARRAY_BUFFER,this.vertices,b.STATIC_DRAW);b.vertexAttribPointer(e.aVertexPosition,2,b.FLOAT,false,0,0);b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer);b.bufferData(b.ARRAY_BUFFER,this.uvs,b.STATIC_DRAW);b.vertexAttribPointer(e.aTextureCoord,2,b.FLOAT,false,0,0);b.activeTexture(b.TEXTURE0);if(this.texture.baseTexture._dirty[b.id]){a.renderer.updateTexture(this.texture.baseTexture)}else{b.bindTexture(b.TEXTURE_2D,this.texture.baseTexture._glTextures[b.id])}b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.indices,b.STATIC_DRAW)}b.drawElements(f,this.indices.length,b.UNSIGNED_SHORT,0)};N.Rope.prototype._renderCanvas=function(a){var b=a.context;var c=this.worldTransform;var d=(c.tx*a.resolution)+a.shakeX;var e=(c.ty*a.resolution)+a.shakeY;if(a.roundPixels){b.setTransform(c.a,c.b,c.c,c.d,d|0,e|0)}else{b.setTransform(c.a,c.b,c.c,c.d,d,e)}if(this.drawMode===N.Rope.TRIANGLE_STRIP){this._renderCanvasTriangleStrip(b)}else{this._renderCanvasTriangles(b)}};N.Rope.prototype._renderCanvasTriangleStrip=function(a){var b=this.vertices;var c=this.uvs;var d=b.length/2;this.count++;for(var i=0;i<d-2;i++){var e=i*2;this._renderCanvasDrawTriangle(a,b,c,e,(e+2),(e+4))}};N.Rope.prototype._renderCanvasTriangles=function(a){var b=this.vertices;var c=this.uvs;var d=this.indices;var e=d.length;this.count++;for(var i=0;i<e;i+=3){var f=d[i]*2;var g=d[i+1]*2;var h=d[i+2]*2;this._renderCanvasDrawTriangle(a,b,c,f,g,h)}};N.Rope.prototype._renderCanvasDrawTriangle=function(a,b,c,d,e,f){var g=this.texture.baseTexture.source;var h=this.texture.width;var i=this.texture.height;var j=b[d];var k=b[e];var l=b[f];var m=b[d+1];var n=b[e+1];var o=b[f+1];var p=c[d]*h;var q=c[e]*h;var r=c[f]*h;var s=c[d+1]*i;var t=c[e+1]*i;var u=c[f+1]*i;if(this.canvasPadding>0){var v=this.canvasPadding/this.worldTransform.a;var w=this.canvasPadding/this.worldTransform.d;var x=(j+k+l)/3;var y=(m+n+o)/3;var z=j-x;var A=m-y;var B=Math.sqrt((z*z)+(A*A));j=x+(z/B)*(B+v);m=y+(A/B)*(B+w);z=k-x;A=n-y;B=Math.sqrt((z*z)+(A*A));k=x+(z/B)*(B+v);n=y+(A/B)*(B+w);z=l-x;A=o-y;B=Math.sqrt((z*z)+(A*A));l=x+(z/B)*(B+v);o=y+(A/B)*(B+w)}a.save();a.beginPath();a.moveTo(j,m);a.lineTo(k,n);a.lineTo(l,o);a.closePath();a.clip();var C=(p*t)+(s*r)+(q*u)-(t*r)-(s*q)-(p*u);var D=(j*t)+(s*l)+(k*u)-(t*l)-(s*k)-(j*u);var E=(p*k)+(j*r)+(q*l)-(k*r)-(j*q)-(p*l);var F=(p*t*l)+(s*k*r)+(j*q*u)-(j*t*r)-(s*q*l)-(p*k*u);var G=(m*t)+(s*o)+(n*u)-(t*o)-(s*n)-(m*u);var H=(p*n)+(m*r)+(q*o)-(n*r)-(m*q)-(p*o);var I=(p*t*o)+(s*n*r)+(m*q*u)-(m*t*r)-(s*q*o)-(p*n*u);a.transform(D/C,G/C,E/C,H/C,F/C,I/C);a.drawImage(g,0,0);a.restore()};N.Rope.prototype.renderStripFlat=function(a){var b=this.context;var c=a.vertices;var d=c.length/2;this.count++;b.beginPath();for(var i=1;i<d-2;i++){var e=i*2;var f=c[e];var g=c[e+2];var h=c[e+4];var j=c[e+1];var k=c[e+3];var l=c[e+5];b.moveTo(f,j);b.lineTo(g,k);b.lineTo(h,l)}b.fillStyle='#FF0000';b.fill();b.closePath()};N.Rope.prototype.getBounds=function(e){var f=e||this.worldTransform;var a=f.a;var b=f.b;var c=f.c;var d=f.d;var g=f.tx;var h=f.ty;var j=-Infinity;var k=-Infinity;var l=Infinity;var m=Infinity;var n=this.vertices;for(var i=0;i<n.length;i+=2){var o=n[i];var p=n[i+1];var x=(a*o)+(c*p)+g;var y=(d*p)+(b*o)+h;l=x<l?x:l;m=y<m?y:m;j=x>j?x:j;k=y>k?y:k}if(l===-Infinity||k===Infinity){return N.EmptyRectangle}var q=this._bounds;q.x=l;q.width=j-l;q.y=m;q.height=k-m;this._currentBounds=q;return q};Object.defineProperty(N.Rope.prototype,'updateAnimation',{get:function(){return this._updateAnimation},set:function(a){if(a&&typeof a==='function'){this._hasUpdateAnimation=true;this._updateAnimation=a}else{this._hasUpdateAnimation=false;this._updateAnimation=null}}});Object.defineProperty(N.Rope.prototype,'segments',{get:function(){var a=[];var b,x1,y1,x2,y2,width,height,rect;for(var i=0;i<this.points.length;i++){b=i*4;x1=this.vertices[b]*this.scale.x;y1=this.vertices[b+1]*this.scale.y;x2=this.vertices[b+4]*this.scale.x;y2=this.vertices[b+3]*this.scale.y;width=N.Math.difference(x1,x2);height=N.Math.difference(y1,y2);x1+=this.world.x;y1+=this.world.y;rect=new N.Rectangle(x1,y1,width,height);a.push(rect)}return a}});N.TileSprite=function(a,x,y,b,c,d,e){x=x||0;y=y||0;b=b||256;c=c||256;d=d||null;e=e||null;PIXI.Sprite.call(this,new PIXI.Texture(N.Cache.DEFAULT.baseTexture),b,c);this.type=N.TILESPRITE;this.physicsType=N.SPRITE;this._scroll=new N.Point();this.tileScale=new N.Point(1,1);this.tileScaleOffset=new N.Point(1,1);this.tilePosition=new N.Point();this.textureDebug=false;this.canvasBuffer=null;this.tilingTexture=null;this.tilePattern=null;this.refreshTexture=true;this.frameWidth=0;this.frameHeight=0;this._width=b;this._height=c;N.Component.Core.init.call(this,a,x,y,d,e)};N.TileSprite.prototype=Object.create(PIXI.Sprite.prototype);N.TileSprite.prototype.constructor=N.TileSprite;N.Component.Core.install.call(N.TileSprite.prototype,['Angle','Animation','AutoCull','Bounds','BringToTop','Destroy','FixedToCamera','Health','InCamera','InputEnabled','InWorld','LifeSpan','LoadTexture','Overlap','PhysicsBody','Reset','Smoothed']);N.TileSprite.prototype.preUpdatePhysics=N.Component.PhysicsBody.preUpdate;N.TileSprite.prototype.preUpdateLifeSpan=N.Component.LifeSpan.preUpdate;N.TileSprite.prototype.preUpdateInWorld=N.Component.InWorld.preUpdate;N.TileSprite.prototype.preUpdateCore=N.Component.Core.preUpdate;N.TileSprite.prototype.preUpdate=function(){if(this._scroll.x!==0){this.tilePosition.x+=this._scroll.x*0.001*this.game.time.delta}if(this._scroll.y!==0){this.tilePosition.y+=this._scroll.y*0.001*this.game.time.delta}if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};N.TileSprite.prototype.autoScroll=function(x,y){this._scroll.set(x,y);return this};N.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0);return this};N.TileSprite.prototype.destroy=function(a){N.Component.Destroy.prototype.destroy.call(this,a);PIXI.Sprite.prototype.destroy.call(this);if(this.canvasBuffer){this.canvasBuffer.destroy();this.canvasBuffer=null}this.tileScale=null;this.tileScaleOffset=null;this.tilePosition=null;if(this.tilingTexture){this.tilingTexture.destroy(true);this.tilingTexture=null}};N.TileSprite.prototype.reset=function(x,y){N.Component.Reset.prototype.reset.call(this,x,y);this.tilePosition.x=0;this.tilePosition.y=0;return this};N.TileSprite.prototype.setTexture=function(a){if(this.texture!==a){this.texture=a;this.refreshTexture=true;this.cachedTint=0xFFFFFF}return this};N.TileSprite.prototype._renderWebGL=function(a){if(!this.visible||!this.renderable||this.alpha===0){return}if(this._mask){a.spriteBatch.stop();a.maskManager.pushMask(this.mask,a);a.spriteBatch.start()}if(this._filters){a.spriteBatch.flush();a.filterManager.pushFilter(this._filterBlock)}if(this.refreshTexture){this.generateTilingTexture(true,a);if(this.tilingTexture){if(this.tilingTexture.needsUpdate){this.tilingTexture.baseTexture.textureIndex=this.texture.baseTexture.textureIndex;a.renderer.updateTexture(this.tilingTexture.baseTexture);this.tilingTexture.needsUpdate=false}}else{return}}a.spriteBatch.renderTilingSprite(this);for(var i=0;i<this.children.length;i++){this.children[i]._renderWebGL(a)}var b=false;if(this._filters){b=true;a.spriteBatch.stop();a.filterManager.popFilter()}if(this._mask){if(!b){a.spriteBatch.stop()}a.maskManager.popMask(this._mask,a)}if(b){a.spriteBatch.start()}};N.TileSprite.prototype._renderCanvas=function(a){if(!this.visible||!this.renderable||this.alpha===0){return}var b=a.context;if(this._mask){a.maskManager.pushMask(this._mask,a)}b.globalAlpha=this.worldAlpha;var c=this.worldTransform;var d=a.resolution;var e=(c.tx*d)+a.shakeX;var f=(c.ty*d)+a.shakeY;b.setTransform(c.a*d,c.b*d,c.c*d,c.d*d,e,f);if(this.tint!==0xFFFFFF&&(this.texture.requiresReTint||this.cachedTint!==this.tint)){this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint);this.cachedTint=this.tint;this.texture.requiresReTint=false;this.refreshTexture=true}if(this.refreshTexture){this.generateTilingTexture(false,a);if(this.tilingTexture){this.tilePattern=b.createPattern(this.tilingTexture.baseTexture.source,'repeat')}else{return}}var g=a.currentBlendMode;if(this.blendMode!==a.currentBlendMode){a.currentBlendMode=this.blendMode;b.globalCompositeOperation=PIXI.blendModesCanvas[a.currentBlendMode]}var h=this.tilePosition;var j=this.tileScale;h.x%=this.tilingTexture.baseTexture.width;h.y%=this.tilingTexture.baseTexture.height;b.scale(j.x,j.y);b.translate(h.x+(this.anchor.x*-this._width),h.y+(this.anchor.y*-this._height));b.fillStyle=this.tilePattern;e=-h.x;f=-h.y;var k=this._width/j.x;var l=this._height/j.y;if(a.roundPixels){e|=0;f|=0;k|=0;l|=0}b.fillRect(e,f,k,l);b.scale(1/j.x,1/j.y);b.translate(-h.x+(this.anchor.x*this._width),-h.y+(this.anchor.y*this._height));if(this._mask){a.maskManager.popMask(a)}for(var i=0;i<this.children.length;i++){this.children[i]._renderCanvas(a)}if(g!==this.blendMode){a.currentBlendMode=g;b.globalCompositeOperation=PIXI.blendModesCanvas[g]}};N.TileSprite.prototype.onTextureUpdate=function(){};N.TileSprite.prototype.generateTilingTexture=function(a){if(!this.texture.baseTexture.hasLoaded){return}var b=this.texture;var c=b.frame;var d=this._frame.sourceSizeW||this._frame.width;var e=this._frame.sourceSizeH||this._frame.height;var f=0;var g=0;if(this._frame.trimmed){f=this._frame.spriteSourceSizeX;g=this._frame.spriteSourceSizeY}if(a){d=N.Math.getNextPowerOfTwo(d);e=N.Math.getNextPowerOfTwo(e)}if(this.canvasBuffer){this.canvasBuffer.resize(d,e);this.tilingTexture.baseTexture.width=d;this.tilingTexture.baseTexture.height=e;this.tilingTexture.needsUpdate=true}else{this.canvasBuffer=new PIXI.CanvasBuffer(d,e);this.tilingTexture=PIXI.Texture.fromCanvas(this.canvasBuffer.canvas);this.tilingTexture.isTiling=true;this.tilingTexture.needsUpdate=true}if(this.textureDebug){this.canvasBuffer.context.strokeStyle='#00ff00';this.canvasBuffer.context.strokeRect(0,0,d,e)}var w=b.crop.width;var h=b.crop.height;if(w!==d||h!==e){w=d;h=e}var i=this.tintedTexture?this.tintedTexture:b.baseTexture.source;this.canvasBuffer.context.drawImage(i,b.crop.x,b.crop.y,b.crop.width,b.crop.height,f,g,w,h);this.tileScaleOffset.x=c.width/d;this.tileScaleOffset.y=c.height/e;this.refreshTexture=false;this.tilingTexture.baseTexture._powerOf2=true};N.TileSprite.prototype.getBounds=function(){var e=this._width;var f=this._height;var g=e*(1-this.anchor.x);var h=e*-this.anchor.x;var i=f*(1-this.anchor.y);var j=f*-this.anchor.y;var k=this.worldTransform;var a=k.a;var b=k.b;var c=k.c;var d=k.d;var l=k.tx;var m=k.ty;var n=(a*h)+(c*j)+l;var o=(d*j)+(b*h)+m;var p=(a*g)+(c*j)+l;var q=(d*j)+(b*g)+m;var r=(a*g)+(c*i)+l;var s=(d*i)+(b*g)+m;var t=a*h+c*i+l;var u=d*i+b*h+m;var v=-Infinity;var w=-Infinity;var x=Infinity;var y=Infinity;x=n<x?n:x;x=p<x?p:x;x=r<x?r:x;x=t<x?t:x;y=o<y?o:y;y=q<y?q:y;y=s<y?s:y;y=u<y?u:y;v=n>v?n:v;v=p>v?p:v;v=r>v?r:v;v=t>v?t:v;w=o>w?o:w;w=q>w?q:w;w=s>w?s:w;w=u>w?u:w;var z=this._bounds;z.x=x;z.width=v-x;z.y=y;z.height=w-y;this._currentBounds=z;return z};Object.defineProperty(N.TileSprite.prototype,'width',{get:function(){return this._width},set:function(a){this._width=a}});Object.defineProperty(N.TileSprite.prototype,'height',{get:function(){return this._height},set:function(a){this._height=a}});N.CanvasPool={create:function(a,b,c){var d=N.CanvasPool.getFirst();var e;if(d===-1){var f={parent:a,canvas:document.createElement('canvas')};N.CanvasPool.pool.push(f);e=f.canvas}else{N.CanvasPool.pool[d].parent=a;e=N.CanvasPool.pool[d].canvas}if(b!==undefined){e.width=b;e.height=c}return e},getFirst:function(){var a=N.CanvasPool.pool;for(var i=0;i<a.length;i++){if(!a[i].parent){return i}}return-1},remove:function(a){var b=N.CanvasPool.pool;for(var i=0;i<b.length;i++){if(b[i].parent===a){b[i].parent=null;b[i].canvas.width=1;b[i].canvas.height=1}}},removeByCanvas:function(a){var b=N.CanvasPool.pool;for(var i=0;i<b.length;i++){if(b[i].canvas===a){b[i].parent=null;b[i].canvas.width=1;b[i].canvas.height=1}}},getTotal:function(){var a=N.CanvasPool.pool;var c=0;for(var i=0;i<a.length;i++){if(a[i].parent){c++}}return c},getFree:function(){var a=N.CanvasPool.pool;var c=0;for(var i=0;i<a.length;i++){if(!a[i].parent){c++}}return c},log:function(){console.log('CanvasPool: %s used, %s free, %s total',N.CanvasPool.getTotal(),N.CanvasPool.getFree(),N.CanvasPool.pool.length)}};N.CanvasPool.pool=[];Object.defineProperty(N.CanvasPool,'length',{get:function(){return this.pool.length}});N.Device=function(){this.deviceReadyAt=0;this.initialized=false;this.desktop=false;this.iOS=false;this.iOSVersion=0;this.cocoonJS=false;this.cocoonJSApp=false;this.cordova=false;this.node=false;this.nodeWebkit=false;this.electron=false;this.ejecta=false;this.crosswalk=false;this.android=false;this.chromeOS=false;this.linux=false;this.macOS=false;this.windows=false;this.windowsPhone=false;this.canvas=false;this.canvasBitBltShift=null;this.canHandleAlpha=false;this.canUseMultiply=false;this.webGL=false;this.file=false;this.fileSystem=false;this.localStorage=false;this.worker=false;this.css3D=false;this.pointerLock=false;this.typedArray=false;this.vibration=false;this.getUserMedia=true;this.quirksMode=false;this.touch=false;this.mspointer=false;this.wheelEvent=null;this.arora=false;this.chrome=false;this.chromeVersion=0;this.epiphany=false;this.firefox=false;this.firefoxVersion=0;this.ie=false;this.ieVersion=0;this.trident=false;this.tridentVersion=0;this.edge=false;this.mobileSafari=false;this.midori=false;this.opera=false;this.safari=false;this.safariVersion=0;this.webApp=false;this.silk=false;this.audioData=false;this.webAudio=false;this.ogg=false;this.opus=false;this.mp3=false;this.wav=false;this.m4a=false;this.webm=false;this.dolby=false;this.oggVideo=false;this.h264Video=false;this.mp4Video=false;this.webmVideo=false;this.vp9Video=false;this.hlsVideo=false;this.iPhone=false;this.iPhone4=false;this.iPad=false;this.pixelRatio=0;this.littleEndian=false;this.LITTLE_ENDIAN=false;this.support32bit=false;this.fullscreen=false;this.requestFullscreen='';this.cancelFullscreen='';this.fullscreenKeyboard=false};N.Device=new N.Device();N.Device.onInitialized=new N.Signal();N.Device.whenReady=function(a,b,c){var d=this._readyCheck;if(this.deviceReadyAt||!d){a.call(b,this)}else if(d._monitor||c){d._queue=d._queue||[];d._queue.push([a,b])}else{d._monitor=d.bind(this);d._queue=d._queue||[];d._queue.push([a,b]);var e=typeof window.cordova!=='undefined';var f=navigator.isCocoonJS;if(document.readyState==='complete'||document.readyState==='interactive'){window.setTimeout(d._monitor,0)}else if(e&&!f){document.addEventListener('deviceready',d._monitor,false)}else{document.addEventListener('DOMContentLoaded',d._monitor,false);window.addEventListener('load',d._monitor,false)}}};N.Device._readyCheck=function(){var a=this._readyCheck;if(!document.body){window.setTimeout(a._monitor,20)}else if(!this.deviceReadyAt){this.deviceReadyAt=Date.now();document.removeEventListener('deviceready',a._monitor);document.removeEventListener('DOMContentLoaded',a._monitor);window.removeEventListener('load',a._monitor);this._initialize();this.initialized=true;this.onInitialized.dispatch(this);var b;while((b=a._queue.shift())){var c=b[0];var d=b[1];c.call(d,this)}this._readyCheck=null;this._initialize=null;this.onInitialized=null}};N.Device._initialize=function(){var f=this;function _checkOS(){var a=navigator.userAgent;if((/Playstation Vita/).test(a)){f.vita=true}else if((/Kindle/).test(a)||(/\bKF[A-Z][A-Z]+/).test(a)||(/Silk.*Mobile Safari/).test(a)){f.kindle=true}else if((/Android/).test(a)){f.android=true}else if((/CrOS/).test(a)){f.chromeOS=true}else if((/iP[ao]d|iPhone/i).test(a)){f.iOS=true;(navigator.appVersion).match(/OS (\d+)/);f.iOSVersion=parseInt(RegExp.$1,10)}else if((/Linux/).test(a)){f.linux=true}else if((/Mac OS/).test(a)){f.macOS=true}else if((/Windows/).test(a)){f.windows=true}if((/Windows Phone/i).test(a)||(/IEMobile/i).test(a)){f.android=false;f.iOS=false;f.macOS=false;f.windows=true;f.windowsPhone=true}var b=(/Silk/).test(a);if(f.windows||f.macOS||(f.linux&&!b)||f.chromeOS){f.desktop=true}if(f.windowsPhone||(((/Windows NT/i).test(a))&&((/Touch/i).test(a)))){f.desktop=false}}function _checkCanvasFeatures(){var a=N.CanvasPool.create(this,6,1);var b=a.getContext('2d');b.fillStyle='rgba(10, 20, 30, 0.5)';b.fillRect(0,0,1,1);var c=b.getImageData(0,0,1,1);if(c){b.putImageData(c,1,0);var d=b.getImageData(1,0,1,1);f.canHandleAlpha=(d.data[0]===c.data[0]&&d.data[1]===c.data[1]&&d.data[2]===c.data[2]&&d.data[3]===c.data[3])}b.globalCompositeOperation='multiply';f.canUseMultiply=(b.globalCompositeOperation==='multiply');N.CanvasPool.removeByCanvas(a);PIXI.CanvasTinter.tintMethod=(f.canUseMultiply)?PIXI.CanvasTinter.tintWithMultiply:PIXI.CanvasTinter.tintWithPerPixel}function _checkFeatures(){f.canvas=!!window.CanvasRenderingContext2D||f.cocoonJS;try{f.localStorage=!!localStorage.getItem}catch(error){f.localStorage=false}f.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob;f.fileSystem=!!window.requestFileSystem;f.webGL=!!window.WebGLRenderingContext;f.worker=!!window.Worker;f.pointerLockElement=(('pointerLockElement'in document)&&'pointerLockElement')||(('mozPointerLockElement'in document)&&'mozPointerLockElement')||(('webkitPointerLockElement'in document)&&'webkitPointerLockElement');f.pointerlockchange=(('onpointerlockchange'in document)&&'pointerlockchange')||(('onmozpointerlockchange'in document)&&'mozpointerlockchange')||(('onwebkitpointerlockchange'in document)&&'webkitpointerlockchange');f.pointerlockerror=(('onpointerlockerror'in document)&&'pointerlockerror')||(('onmozpointerlockerror'in document)&&'mozpointerlockerror')||(('onwebkitpointerlockerror'in document)&&'webkitpointerlockerror');f.pointerLock=!!f.pointerLockElement;f.quirksMode=(document.compatMode==='CSS1Compat')?false:true;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;f.getUserMedia=f.getUserMedia&&!!navigator.getUserMedia&&!!window.URL;if(f.firefox&&f.firefoxVersion<21){f.getUserMedia=false}if(!f.iOS&&(f.ie||f.firefox||f.chrome)){f.canvasBitBltShift=true}if(f.safari||f.mobileSafari){f.canvasBitBltShift=false}}function _checkInput(){if('ontouchstart'in document.documentElement||(window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)){f.touch=true}if(window.PointerEvent||window.MSPointerEvent||window.navigator.msPointerEnabled||window.navigator.pointerEnabled){f.mspointer=true}if(!f.cocoonJS){if('onwheel'in window||(f.ie&&'WheelEvent'in window)){f.wheelEvent='wheel'}else if('onmousewheel'in window){f.wheelEvent='mousewheel'}else if(f.firefox&&'MouseScrollEvent'in window){f.wheelEvent='DOMMouseScroll'}}}function _checkFullScreenSupport(){var a=['requestFullscreen','requestFullScreen','webkitRequestFullscreen','webkitRequestFullScreen','msRequestFullscreen','msRequestFullScreen','mozRequestFullScreen','mozRequestFullscreen'];var b=document.createElement('div');for(var i=0;i<a.length;i++){if(b[a[i]]){f.fullscreen=true;f.requestFullscreen=a[i];break}}var c=['cancelFullScreen','exitFullscreen','webkitCancelFullScreen','webkitExitFullscreen','msCancelFullScreen','msExitFullscreen','mozCancelFullScreen','mozExitFullscreen'];if(f.fullscreen){for(var i=0;i<c.length;i++){if(document[c[i]]){f.cancelFullscreen=c[i];break}}}if(window.Element&&Element.ALLOW_KEYBOARD_INPUT){f.fullscreenKeyboard=true}}function _checkBrowser(){var a=navigator.userAgent;if((/Arora/).test(a)){f.arora=true}else if((/Edge\/\d+/).test(a)){f.edge=true}else if((/Chrome\/(\d+)/).test(a)&&!f.windowsPhone){f.chrome=true;f.chromeVersion=parseInt(RegExp.$1,10)}else if((/Epiphany/).test(a)){f.epiphany=true}else if((/Firefox\D+(\d+)/).test(a)){f.firefox=true;f.firefoxVersion=parseInt(RegExp.$1,10)}else if((/AppleWebKit/).test(a)&&f.iOS){f.mobileSafari=true}else if((/MSIE (\d+\.\d+);/).test(a)){f.ie=true;f.ieVersion=parseInt(RegExp.$1,10)}else if((/Midori/).test(a)){f.midori=true}else if((/Opera/).test(a)){f.opera=true}else if((/Safari\/(\d+)/).test(a)&&!f.windowsPhone){f.safari=true;if((/Version\/(\d+)\./).test(a)){f.safariVersion=parseInt(RegExp.$1,10)}}else if((/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/).test(a)){f.ie=true;f.trident=true;f.tridentVersion=parseInt(RegExp.$1,10);f.ieVersion=parseInt(RegExp.$3,10)}if((/Silk/).test(a)){f.silk=true}if(navigator.standalone){f.webApp=true}if(typeof window.cordova!=='undefined'){f.cordova=true}if(typeof process!=='undefined'&&typeof require!=='undefined'){f.node=true}if(f.node&&typeof process.versions==='object'){f.nodeWebkit=!!process.versions['node-webkit'];f.electron=!!process.versions.electron}if(navigator.isCocoonJS){f.cocoonJS=true}if(f.cocoonJS){try{f.cocoonJSApp=(typeof CocoonJS!=='undefined')}catch(error){f.cocoonJSApp=false}}if(typeof window.ejecta!=='undefined'){f.ejecta=true}if((/Crosswalk/).test(a)){f.crosswalk=true}}function _checkVideo(){var a=document.createElement('video');try{if(a.canPlayType){if(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,'')){f.oggVideo=true}if(a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,'')){f.h264Video=true;f.mp4Video=true}if(a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,'')){f.webmVideo=true}if(a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,'')){f.vp9Video=true}if(a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,'')){f.hlsVideo=true}}}catch(e){}}function _checkAudio(){f.audioData=!!(window.Audio);f.webAudio=!!(window.AudioContext||window.webkitAudioContext);var a=document.createElement('audio');try{if(a.canPlayType){if(a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,'')){f.ogg=true}if(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,'')||a.canPlayType('audio/opus;').replace(/^no$/,'')){f.opus=true}if(a.canPlayType('audio/mpeg;').replace(/^no$/,'')){f.mp3=true}if(a.canPlayType('audio/wav').replace(/^no$/,'')){f.wav=true}if(a.canPlayType('audio/x-m4a;')||a.canPlayType('audio/aac;').replace(/^no$/,'')){f.m4a=true}if(a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,'')){f.webm=true}if(a.canPlayType('audio/mp4;codecs="ec-3"')!==''){if(f.edge){f.dolby=true}else if(f.safari&&f.safariVersion>=9){if((/Mac OS X (\d+)_(\d+)/).test(navigator.userAgent)){var b=parseInt(RegExp.$1,10);var c=parseInt(RegExp.$2,10);if((b===10&&c>=11)||b>10){f.dolby=true}}}}}}catch(e){}}function _checkIsLittleEndian(){var a=new ArrayBuffer(4);var b=new Uint8Array(a);var c=new Uint32Array(a);b[0]=0xa1;b[1]=0xb2;b[2]=0xc3;b[3]=0xd4;if(c[0]===0xd4c3b2a1){return true}if(c[0]===0xa1b2c3d4){return false}else{return null}}function _checkIsUint8ClampedImageData(){if(Uint8ClampedArray===undefined){return false}var a=N.CanvasPool.create(this,1,1);var b=a.getContext('2d');if(!b){return false}var c=b.createImageData(1,1);N.CanvasPool.remove(this);return c.data instanceof Uint8ClampedArray}function _checkDevice(){f.pixelRatio=window.devicePixelRatio||1;f.iPhone=navigator.userAgent.toLowerCase().indexOf('iphone')!==-1;f.iPhone4=(f.pixelRatio===2&&f.iPhone);f.iPad=navigator.userAgent.toLowerCase().indexOf('ipad')!==-1;if(typeof Int8Array!=='undefined'){f.typedArray=true}else{f.typedArray=false}if(typeof ArrayBuffer!=='undefined'&&typeof Uint8Array!=='undefined'&&typeof Uint32Array!=='undefined'){f.littleEndian=_checkIsLittleEndian();f.LITTLE_ENDIAN=f.littleEndian}f.support32bit=(typeof ArrayBuffer!=='undefined'&&typeof Uint8ClampedArray!=='undefined'&&typeof Int32Array!=='undefined'&&f.littleEndian!==null&&_checkIsUint8ClampedImageData());navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;if(navigator.vibrate){f.vibration=true}}function _checkCSS3D(){var a=document.createElement('p');var b;var c={webkitTransform:'-webkit-transform',OTransform:'-o-transform',msTransform:'-ms-transform',MozTransform:'-moz-transform',transform:'transform'};document.body.insertBefore(a,null);for(var t in c){if(a.style[t]!==undefined){a.style[t]='translate3d(1px,1px,1px)';b=window.getComputedStyle(a).getPropertyValue(c[t])}}document.body.removeChild(a);f.css3D=(b!==undefined&&b.length>0&&b!=='none')}_checkOS();_checkBrowser();_checkAudio();_checkVideo();_checkCSS3D();_checkDevice();_checkFeatures();_checkCanvasFeatures();_checkFullScreenSupport();_checkInput()};N.Device.canPlayAudio=function(a){if(a==='mp3'&&this.mp3){return true}else if(a==='ogg'&&(this.ogg||this.opus)){return true}else if(a==='m4a'&&this.m4a){return true}else if(a==='opus'&&this.opus){return true}else if(a==='wav'&&this.wav){return true}else if(a==='webm'&&this.webm){return true}else if(a==='mp4'&&this.dolby){return true}return false};N.Device.canPlayVideo=function(a){if(a==='webm'&&(this.webmVideo||this.vp9Video)){return true}else if(a==='mp4'&&(this.mp4Video||this.h264Video)){return true}else if((a==='ogg'||a==='ogv')&&this.oggVideo){return true}else if(a==='mpeg'&&this.hlsVideo){return true}return false};N.Device.needsTouchUnlock=function(){return!!(!this.cocoonJS&&(this.iOS||this.android)||(window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock))};N.Device.isAndroidStockBrowser=function(){var a=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return a&&a[1]<537};N.Canvas={create:function(a,b,c,d,e){b=b||256;c=c||256;var f=(e)?document.createElement('canvas'):N.CanvasPool.create(a,b,c);if(typeof d==='string'&&d!==''){f.id=d}f.width=b;f.height=c;f.style.display='block';return f},setBackgroundColor:function(a,b){b=b||'rgb(0,0,0)';a.style.backgroundColor=b;return a},setTouchAction:function(a,b){b=b||'none';a.style.msTouchAction=b;a.style['ms-touch-action']=b;a.style['touch-action']=b;return a},setUserSelect:function(a,b){b=b||'none';a.style['-webkit-touch-callout']=b;a.style['-webkit-user-select']=b;a.style['-khtml-user-select']=b;a.style['-moz-user-select']=b;a.style['-ms-user-select']=b;a.style['user-select']=b;a.style['-webkit-tap-highlight-color']='rgba(0, 0, 0, 0)';return a},addToDOM:function(a,b,c){var d;if(c===undefined){c=true}if(b){if(typeof b==='string'){d=document.getElementById(b)}else if(typeof b==='object'&&b.nodeType===1){d=b}}if(!d){d=document.body}if(c&&d.style){d.style.overflow='hidden'}d.appendChild(a);return a},removeFromDOM:function(a){if(a.parentNode){a.parentNode.removeChild(a)}},setTransform:function(a,b,c,d,e,f,g){a.setTransform(d,f,g,e,b,c);return a},setSmoothingEnabled:function(a,b){var s=N.Canvas.getSmoothingPrefix(a);if(s){a[s]=b}return a},getSmoothingPrefix:function(a){var b=['i','webkitI','msI','mozI','oI'];for(var c in b){var s=b[c]+'mageSmoothingEnabled';if(s in a){return s}}return null},getSmoothingEnabled:function(a){var s=N.Canvas.getSmoothingPrefix(a);if(s){return a[s]}},setImageRenderingCrisp:function(a){var b=['-webkit-optimize-contrast','-moz-crisp-edges','crisp-edges','pixelated'];for(var i=0;i<b.length;i++){a.style['image-rendering']=b[i]}a.style.msInterpolationMode='nearest-neighbor';return a},setImageRenderingBicubic:function(a){a.style['image-rendering']='auto';a.style.msInterpolationMode='bicubic';return a}};N.RequestAnimationFrame=function(a,b){if(b===undefined){b=false}this.game=a;this.isRunning=false;this.forceSetTimeOut=b;var c=['ms','moz','webkit','o'];for(var x=0;x<c.length&&!window.requestAnimationFrame;x++){window.requestAnimationFrame=window[c[x]+'RequestAnimationFrame'];window.cancelAnimationFrame=window[c[x]+'CancelAnimationFrame']||window[c[x]+'CancelRequestAnimationFrame']}this._isSetTimeOut=false;this._onLoop=null;this._timeOutID=null};N.RequestAnimationFrame.prototype={start:function(){this.isRunning=true;var b=this;if(!window.requestAnimationFrame||this.forceSetTimeOut){this._isSetTimeOut=true;this._onLoop=function(){return b.updateSetTimeout()};this._timeOutID=window.setTimeout(this._onLoop,0)}else{this._isSetTimeOut=false;this._onLoop=function(a){return b.updateRAF(a)};this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateRAF:function(a){if(this.isRunning){this.game.update(Math.floor(a));this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateSetTimeout:function(){if(this.isRunning){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)}},stop:function(){if(this._isSetTimeOut){clearTimeout(this._timeOutID)}else{window.cancelAnimationFrame(this._timeOutID)}this.isRunning=false},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return(this._isSetTimeOut===false)}};N.RequestAnimationFrame.prototype.constructor=N.RequestAnimationFrame;N.Math={PI2:Math.PI*2,HALF_PI:Math.PI*0.5,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,degToRad:function(a){return a*N.Math.DEG_TO_RAD},radToDeg:function(a){return a*N.Math.RAD_TO_DEG},getNextPowerOfTwo:function(a){if(a>0&&(a&(a-1))===0){return a}else{var b=1;while(b<a){b<<=1}return b}},isPowerOfTwo:function(a,b){return(a>0&&(a&(a-1))===0&&b>0&&(b&(b-1))===0)},random:function(a,b){if(a===undefined){a=0}if(b===undefined){b=1}if(a===b){return a}if(a>b){var c=a;a=b;b=c}return(Math.random()*(b-a)+a)},between:function(a,b){if(a===undefined){a=0}if(b===undefined){b=1}if(a===b){return a}if(a>b){var c=a;a=b;b=c}a=Math.ceil(a);b=Math.floor(b);return Math.floor(Math.random()*(b-a+1))+a},fuzzyEqual:function(a,b,c){if(c===undefined){c=0.0001}return Math.abs(a-b)<c},fuzzyLessThan:function(a,b,c){if(c===undefined){c=0.0001}return a<b+c},fuzzyGreaterThan:function(a,b,c){if(c===undefined){c=0.0001}return a>b-c},fuzzyCeil:function(a,b){if(b===undefined){b=0.0001}return Math.ceil(a-b)},fuzzyFloor:function(a,b){if(b===undefined){b=0.0001}return Math.floor(a+b)},average:function(){var a=0;var b=arguments.length;for(var i=0;i<b;i++){a+=(+arguments[i])}return a/b},shear:function(n){return n%1},snapTo:function(a,b,c){if(c===undefined){c=0}if(b===0){return a}a-=c;a=b*Math.round(a/b);return c+a},snapToFloor:function(a,b,c){if(c===undefined){c=0}if(b===0){return a}a-=c;a=b*Math.floor(a/b);return c+a},snapToCeil:function(a,b,c){if(c===undefined){c=0}if(b===0){return a}a-=c;a=b*Math.ceil(a/b);return c+a},roundTo:function(a,b,c){if(b===undefined){b=0}if(c===undefined){c=10}var p=Math.pow(c,-b);return Math.round(a*p)/p},floorTo:function(a,b,c){if(b===undefined){b=0}if(c===undefined){c=10}var p=Math.pow(c,-b);return Math.floor(a*p)/p},ceilTo:function(a,b,c){if(b===undefined){b=0}if(c===undefined){c=10}var p=Math.pow(c,-b);return Math.ceil(a*p)/p},trunc:function(a){if(!isFinite(a)){return a}return(a-a%1)||(a<0?-0:a===0?a:0)},rotateToAngle:function(a,b,c){if(c===undefined){c=0.05}if(a===b){return a}if(Math.abs(b-a)<=c||Math.abs(b-a)>=(N.Math.PI2-c)){a=b}else{if(Math.abs(b-a)>Math.PI){if(b<a){b+=N.Math.PI2}else{b-=N.Math.PI2}}if(b>a){a+=c}else if(b<a){a-=c}}return a},getShortestAngle:function(a,b){var c=b-a;if(c===0){return 0}var d=Math.floor((c-(-180))/360);return c-(d*360)},angleBetween:function(a,b,c,d){return Math.atan2(d-b,c-a)},angleBetweenY:function(a,b,c,d){return Math.atan2(c-a,d-b)},angleBetweenPoints:function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)},angleBetweenPointsY:function(a,b){return Math.atan2(b.x-a.x,b.y-a.y)},reverseAngle:function(a){return this.normalizeAngle(a+Math.PI,true)},normalizeAngle:function(a){a=a%(2*Math.PI);return a>=0?a:a+2*Math.PI},maxAdd:function(a,b,c){return Math.min(a+b,c)},minSub:function(a,b,c){return Math.max(a-b,c)},wrap:function(a,b,c){var d=c-b;if(d<=0){return 0}var e=(a-b)%d;if(e<0){e+=d}return e+b},wrapValue:function(a,b,c){var d;a=Math.abs(a);b=Math.abs(b);c=Math.abs(c);d=(a+b)%c;return d},isOdd:function(n){return!!(n&1)},isEven:function(n){return!(n&1)},min:function(){if(arguments.length===1&&typeof arguments[0]==='object'){var a=arguments[0]}else{var a=arguments}for(var i=1,min=0,len=a.length;i<len;i++){if(a[i]<a[min]){min=i}}return a[min]},max:function(){if(arguments.length===1&&typeof arguments[0]==='object'){var a=arguments[0]}else{var a=arguments}for(var i=1,max=0,len=a.length;i<len;i++){if(a[i]>a[max]){max=i}}return a[max]},minProperty:function(a){if(arguments.length===2&&typeof arguments[1]==='object'){var b=arguments[1]}else{var b=arguments.slice(1)}for(var i=1,min=0,len=b.length;i<len;i++){if(b[i][a]<b[min][a]){min=i}}return b[min][a]},maxProperty:function(a){if(arguments.length===2&&typeof arguments[1]==='object'){var b=arguments[1]}else{var b=arguments.slice(1)}for(var i=1,max=0,len=b.length;i<len;i++){if(b[i][a]>b[max][a]){max=i}}return b[max][a]},wrapAngle:function(a,b){return b?this.wrap(a,-Math.PI,Math.PI):this.wrap(a,-180,180)},linearInterpolation:function(v,k){var m=v.length-1;var f=m*k;var i=Math.floor(f);if(k<0){return this.linear(v[0],v[1],f)}if(k>1){return this.linear(v[m],v[m-1],m-f)}return this.linear(v[i],v[i+1>m?m:i+1],f-i)},bezierInterpolation:function(v,k){var b=0;var n=v.length-1;for(var i=0;i<=n;i++){b+=Math.pow(1-k,n-i)*Math.pow(k,i)*v[i]*this.bernstein(n,i)}return b},catmullRomInterpolation:function(v,k){var m=v.length-1;var f=m*k;var i=Math.floor(f);if(v[0]===v[m]){if(k<0){i=Math.floor(f=m*(1+k))}return this.catmullRom(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)}else{if(k<0){return v[0]-(this.catmullRom(v[0],v[0],v[1],v[1],-f)-v[0])}if(k>1){return v[m]-(this.catmullRom(v[m],v[m],v[m-1],v[m-1],f-m)-v[m])}return this.catmullRom(v[i?i-1:0],v[i],v[m<i+1?m:i+1],v[m<i+2?m:i+2],f-i)}},linear:function(a,b,t){return(b-a)*t+a},bernstein:function(n,i){return this.factorial(n)/this.factorial(i)/this.factorial(n-i)},factorial:function(a){if(a===0){return 1}var b=a;while(--a){b*=a}return b},catmullRom:function(a,b,c,d,t){var e=(c-a)*0.5,v1=(d-b)*0.5,t2=t*t,t3=t*t2;return(2*b-2*c+e+v1)*t3+(-3*b+3*c-2*e-v1)*t2+e*t+b},difference:function(a,b){return Math.abs(a-b)},roundAwayFromZero:function(a){return(a>0)?Math.ceil(a):Math.floor(a)},sinCosGenerator:function(a,b,d,e){if(b===undefined){b=1.0}if(d===undefined){d=1.0}if(e===undefined){e=1.0}var f=b;var g=d;var h=e*Math.PI/a;var i=[];var j=[];for(var c=0;c<a;c++){g-=f*h;f+=g*h;i[c]=g;j[c]=f}return{sin:j,cos:i,length:a}},hypot:function(a,b){return Math.sqrt(a*a+b*b)},distance:function(a,b,c,d){var e=a-c;var f=b-d;return Math.sqrt(e*e+f*f)},distanceSq:function(a,b,c,d){var e=a-c;var f=b-d;return e*e+f*f},distancePow:function(a,b,c,d,e){if(e===undefined){e=2}return Math.sqrt(Math.pow(c-a,e)+Math.pow(d-b,e))},clamp:function(v,a,b){if(v<a){return a}else if(b<v){return b}else{return v}},clampBottom:function(x,a){return x<a?a:x},within:function(a,b,c){return(Math.abs(a-b)<=c)},mapLinear:function(x,a,b,c,d){return c+(x-a)*(d-c)/(b-a)},smoothstep:function(x,a,b){x=Math.max(0,Math.min(1,(x-a)/(b-a)));return x*x*(3-2*x)},smootherstep:function(x,a,b){x=Math.max(0,Math.min(1,(x-a)/(b-a)));return x*x*x*(x*(x*6-15)+10)},sign:function(x){return(x<0)?-1:((x>0)?1:0)},percent:function(a,b,c){if(c===undefined){c=0}if(a>b||c>b){return 1}else if(a<c||c>a){return 0}else{return(a-c)/b}}};N.RandomDataGenerator=function(a){if(a===undefined){a=[]}this.c=1;this.s0=0;this.s1=0;this.s2=0;if(typeof a==='string'){this.state(a)}else{this.sow(a)}};N.RandomDataGenerator.prototype={rnd:function(){var t=2091639*this.s0+this.c*2.3283064365386963e-10;this.c=t|0;this.s0=this.s1;this.s1=this.s2;this.s2=t-this.c;return this.s2},sow:function(a){this.s0=this.hash(' ');this.s1=this.hash(this.s0);this.s2=this.hash(this.s1);this.c=1;if(!a){return}for(var i=0;i<a.length&&(a[i]!=null);i++){var b=a[i];this.s0-=this.hash(b);this.s0+=~~(this.s0<0);this.s1-=this.hash(b);this.s1+=~~(this.s1<0);this.s2-=this.hash(b);this.s2+=~~(this.s2<0)}},hash:function(a){var h,i,n;n=0xefc8249d;a=a.toString();for(i=0;i<a.length;i++){n+=a.charCodeAt(i);h=0.02519603282416938*n;n=h>>>0;h-=n;h*=n;n=h>>>0;h-=n;n+=h*0x100000000}return(n>>>0)*2.3283064365386963e-10},integer:function(){return this.rnd.apply(this)*0x100000000},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*0x200000|0)*1.1102230246251565e-16},real:function(){return this.integer()+this.frac()},integerInRange:function(a,b){return Math.floor(this.realInRange(0,b-a+1)+a)},between:function(a,b){return this.integerInRange(a,b)},realInRange:function(a,b){return this.frac()*(b-a)+a},normal:function(){return 1-2*this.frac()},uuid:function(){var a='';var b='';for(b=a='';a++<36;b+=~a%5|a*3&4?(a^15?8^this.frac()*(a^20?16:4):4).toString(16):'-'){}return b},pick:function(a){return a[this.integerInRange(0,a.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(a){return a[~~(Math.pow(this.frac(),2)*(a.length-1)+0.5)]},timestamp:function(a,b){return this.realInRange(a||946684800000,b||1577862000000)},angle:function(){return this.integerInRange(-180,180)},state:function(a){if(typeof a==='string'&&a.match(/^!rnd/)){a=a.split(',');this.c=parseFloat(a[1]);this.s0=parseFloat(a[2]);this.s1=parseFloat(a[3]);this.s2=parseFloat(a[4])}return['!rnd',this.c,this.s0,this.s1,this.s2].join(',')}};N.RandomDataGenerator.prototype.constructor=N.RandomDataGenerator;N.QuadTree=function(x,y,a,b,c,d,e){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(x,y,a,b,c,d,e)};N.QuadTree.prototype={reset:function(x,y,a,b,c,d,e){this.maxObjects=c||10;this.maxLevels=d||4;this.level=e||0;this.bounds={x:Math.round(x),y:Math.round(y),width:a,height:b,subWidth:Math.floor(a/2),subHeight:Math.floor(b/2),right:Math.round(x)+Math.floor(a/2),bottom:Math.round(y)+Math.floor(b/2)};this.objects.length=0;this.nodes.length=0},populate:function(a){a.forEach(this.populateHandler,this,true)},populateHandler:function(a){if(a.body&&a.exists){this.insert(a.body)}},split:function(){this.nodes[0]=new N.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[1]=new N.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[2]=new N.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[3]=new N.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1))},insert:function(a){var i=0;var b;if(this.nodes[0]!=null){b=this.getIndex(a);if(b!==-1){this.nodes[b].insert(a);return}}this.objects.push(a);if(this.objects.length>this.maxObjects&&this.level<this.maxLevels){if(this.nodes[0]==null){this.split()}while(i<this.objects.length){b=this.getIndex(this.objects[i]);if(b!==-1){this.nodes[b].insert(this.objects.splice(i,1)[0])}else{i++}}}},getIndex:function(a){var b=-1;if(a.x<this.bounds.right&&a.right<this.bounds.right){if(a.y<this.bounds.bottom&&a.bottom<this.bounds.bottom){b=1}else if(a.y>this.bounds.bottom){b=2}}else if(a.x>this.bounds.right){if(a.y<this.bounds.bottom&&a.bottom<this.bounds.bottom){b=0}else if(a.y>this.bounds.bottom){b=3}}return b},retrieve:function(a){if(a instanceof N.Rectangle){var b=this.objects;var c=this.getIndex(a)}else{if(!a.body){return this._empty}var b=this.objects;var c=this.getIndex(a.body)}if(this.nodes[0]){if(c!==-1){b=b.concat(this.nodes[c].retrieve(a))}else{b=b.concat(this.nodes[0].retrieve(a));b=b.concat(this.nodes[1].retrieve(a));b=b.concat(this.nodes[2].retrieve(a));b=b.concat(this.nodes[3].retrieve(a))}}return b},clear:function(){this.objects.length=0;var i=this.nodes.length;while(i--){this.nodes[i].clear();this.nodes.splice(i,1)}this.nodes.length=0}};N.QuadTree.prototype.constructor=N.QuadTree;N.TweenManager=function(a){this.game=a;this._tweens=[];this._add=[];this.easeMap={Power0:N.Easing.Power0,Power1:N.Easing.Power1,Power2:N.Easing.Power2,Power3:N.Easing.Power3,Power4:N.Easing.Power4,Linear:N.Easing.Linear.None,Quad:N.Easing.Quadratic.Out,Cubic:N.Easing.Cubic.Out,Quart:N.Easing.Quartic.Out,Quint:N.Easing.Quintic.Out,Sine:N.Easing.Sinusoidal.Out,Expo:N.Easing.Exponential.Out,Circ:N.Easing.Circular.Out,Elastic:N.Easing.Elastic.Out,Back:N.Easing.Back.Out,Bounce:N.Easing.Bounce.Out,'Quad.easeIn':N.Easing.Quadratic.In,'Cubic.easeIn':N.Easing.Cubic.In,'Quart.easeIn':N.Easing.Quartic.In,'Quint.easeIn':N.Easing.Quintic.In,'Sine.easeIn':N.Easing.Sinusoidal.In,'Expo.easeIn':N.Easing.Exponential.In,'Circ.easeIn':N.Easing.Circular.In,'Elastic.easeIn':N.Easing.Elastic.In,'Back.easeIn':N.Easing.Back.In,'Bounce.easeIn':N.Easing.Bounce.In,'Quad.easeOut':N.Easing.Quadratic.Out,'Cubic.easeOut':N.Easing.Cubic.Out,'Quart.easeOut':N.Easing.Quartic.Out,'Quint.easeOut':N.Easing.Quintic.Out,'Sine.easeOut':N.Easing.Sinusoidal.Out,'Expo.easeOut':N.Easing.Exponential.Out,'Circ.easeOut':N.Easing.Circular.Out,'Elastic.easeOut':N.Easing.Elastic.Out,'Back.easeOut':N.Easing.Back.Out,'Bounce.easeOut':N.Easing.Bounce.Out,'Quad.easeInOut':N.Easing.Quadratic.InOut,'Cubic.easeInOut':N.Easing.Cubic.InOut,'Quart.easeInOut':N.Easing.Quartic.InOut,'Quint.easeInOut':N.Easing.Quintic.InOut,'Sine.easeInOut':N.Easing.Sinusoidal.InOut,'Expo.easeInOut':N.Easing.Exponential.InOut,'Circ.easeInOut':N.Easing.Circular.InOut,'Elastic.easeInOut':N.Easing.Elastic.InOut,'Back.easeInOut':N.Easing.Back.InOut,'Bounce.easeInOut':N.Easing.Bounce.InOut};this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};N.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var i=0;i<this._tweens.length;i++){this._tweens[i].pendingDelete=true}this._add=[]},removeFrom:function(a,b){if(b===undefined){b=true}var i;var c;if(Array.isArray(a)){for(i=0,c=a.length;i<c;i++){this.removeFrom(a[i])}}else if(a.type===N.GROUP&&b){for(var i=0,c=a.children.length;i<c;i++){this.removeFrom(a.children[i])}}else{for(i=0,c=this._tweens.length;i<c;i++){if(a===this._tweens[i].target){this.remove(this._tweens[i])}}for(i=0,c=this._add.length;i<c;i++){if(a===this._add[i].target){this.remove(this._add[i])}}}},add:function(a){a._manager=this;this._add.push(a)},create:function(a){return new N.Tween(a,this.game,this)},remove:function(a){var i=this._tweens.indexOf(a);if(i!==-1){this._tweens[i].pendingDelete=true}else{i=this._add.indexOf(a);if(i!==-1){this._add[i].pendingDelete=true}}},update:function(){var a=this._add.length;var b=this._tweens.length;if(b===0&&a===0){return false}var i=0;while(i<b){if(this._tweens[i].update(this.game.time.deltaTotal)){i++}else{this._tweens.splice(i,1);b--}}if(a>0){this._tweens=this._tweens.concat(this._add);this._add.length=0}return true},isTweening:function(b,c){if(!c){c=false}return this._tweens.some(function(a){return(a.target===b)&&(!c||(a.isRunning&&!a.pendingDelete))})},_pauseAll:function(){for(var i=this._tweens.length-1;i>=0;i--){this._tweens[i]._pause()}},_resumeAll:function(){for(var i=this._tweens.length-1;i>=0;i--){this._tweens[i]._resume()}},pauseAll:function(){for(var i=this._tweens.length-1;i>=0;i--){this._tweens[i].pause()}},resumeAll:function(){for(var i=this._tweens.length-1;i>=0;i--){this._tweens[i].resume(true)}},destroy:function(){this.game.onPause.remove(this._pauseAll,this);this.game.onResume.remove(this._resumeAll,this);this.game=null;this._add=null;this._tweens=null}};N.TweenManager.prototype.constructor=N.TweenManager;N.Tween=function(a,b,c){this.game=b;this.target=a;this.manager=c;this.timeline=[];this.reverse=false;this.timeScale=1;this.repeatCounter=0;this.pendingDelete=false;this.onStart=new N.Signal();this.onLoop=new N.Signal();this.onRepeat=new N.Signal();this.onChildComplete=new N.Signal();this.onComplete=new N.Signal();this.isRunning=false;this.current=0;this.properties={};this.chainedTween=null;this.isPaused=false;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;this._pausedTime=0;this._codePaused=false;this._hasStarted=false};N.Tween.updateColor=function(a){N.Color.updateColor(a.target)};N.Tween.prototype={to:function(a,b,c,d,e,f,g){if(b===undefined||b<=0){b=1000}if(c===undefined||c===null){c=N.Easing.Default}if(d===undefined){d=false}if(e===undefined){e=0}if(f===undefined){f=0}if(g===undefined){g=false}if(typeof c==='string'&&this.manager.easeMap[c]){c=this.manager.easeMap[c]}if(this.isRunning){console.warn('Phaser.Tween.to cannot be called after Tween.start');return this}this.timeline.push(new N.TweenData(this).to(a,b,c,e,f,g));if(d){this.start()}return this},from:function(a,b,c,d,e,f,g){if(b===undefined){b=1000}if(c===undefined||c===null){c=N.Easing.Default}if(d===undefined){d=false}if(e===undefined){e=0}if(f===undefined){f=0}if(g===undefined){g=false}if(typeof c==='string'&&this.manager.easeMap[c]){c=this.manager.easeMap[c]}if(this.isRunning){console.warn('Phaser.Tween.from cannot be called after Tween.start');return this}this.timeline.push(new N.TweenData(this).from(a,b,c,e,f,g));if(d){this.start()}return this},start:function(a){if(a===undefined){a=0}if(this.pendingDelete){console.warn('Phaser.Tween.start cannot be called after Tween.stop');return this}if(this.game===null||this.target===null||this.timeline.length===0||this.isRunning){return this}for(var i=0;i<this.timeline.length;i++){for(var b in this.timeline[i].vEnd){this.properties[b]=this.target[b]||0;if(!Array.isArray(this.properties[b])){this.properties[b]*=1.0}}}for(var i=0;i<this.timeline.length;i++){this.timeline[i].loadValues()}this.manager.add(this);this.isRunning=true;if(a<0||a>this.timeline.length-1){a=0}this.current=a;this.timeline[this.current].start();return this},stop:function(a){if(a===undefined){a=false}this.isRunning=false;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;if(a){this.onComplete.dispatch(this.target,this);this._hasStarted=false;if(this.chainedTween){this.chainedTween.start()}}this.manager.remove(this);return this},updateTweenData:function(a,b,c){if(this.timeline.length===0){return this}if(c===undefined){c=0}if(c===-1){for(var i=0;i<this.timeline.length;i++){this.timeline[i][a]=b}}else{this.timeline[c][a]=b}return this},delay:function(a,b){return this.updateTweenData('delay',a,b)},repeat:function(a,b,c){if(b===undefined){b=0}this.updateTweenData('repeatCounter',a,c);this.updateTweenData('repeatTotal',a,c);return this.updateTweenData('repeatDelay',b,c)},repeatDelay:function(a,b){return this.updateTweenData('repeatDelay',a,b)},yoyo:function(a,b,c){if(b===undefined){b=0}this.updateTweenData('yoyo',a,c);return this.updateTweenData('yoyoDelay',b,c)},yoyoDelay:function(a,b){return this.updateTweenData('yoyoDelay',a,b)},easing:function(a,b){if(typeof a==='string'&&this.manager.easeMap[a]){a=this.manager.easeMap[a]}return this.updateTweenData('easingFunction',a,b)},interpolation:function(a,b,c){if(b===undefined){b=N.Math}this.updateTweenData('interpolationFunction',a,c);return this.updateTweenData('interpolationContext',b,c)},repeatAll:function(a){if(a===undefined){a=0}this.repeatCounter=a;return this},chain:function(){var i=arguments.length;while(i--){if(i>0){arguments[i-1].chainedTween=arguments[i]}else{this.chainedTween=arguments[i]}}return this},loop:function(a){if(a===undefined){a=true}this.repeatCounter=(a)?-1:0;return this},onUpdateCallback:function(a,b){this._onUpdateCallback=a;this._onUpdateCallbackContext=b;return this},pause:function(){this.isPaused=true;this._codePaused=true;this._pausedTime=this.game.time.deltaTotal},_pause:function(){if(!this._codePaused){this.isPaused=true;this._pausedTime=this.game.time.deltaTotal}},resume:function(){if(this.isPaused){this.isPaused=false;this._codePaused=false;for(var i=0;i<this.timeline.length;i++){if(!this.timeline[i].isRunning){this.timeline[i].startTime+=(this.game.time.deltaTotal-this._pausedTime)}}}},_resume:function(){if(this._codePaused){return}else{this.resume()}},update:function(a){if(this.pendingDelete||!this.target){return false}if(this.isPaused){return true}var b=this.timeline[this.current].update(a);if(b===N.TweenData.PENDING){return true}else if(b===N.TweenData.RUNNING){if(!this._hasStarted){this.onStart.dispatch(this.target,this);this._hasStarted=true}if(this._onUpdateCallback!==null){this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current])}return this.isRunning}else if(b===N.TweenData.LOOPED){if(this.timeline[this.current].repeatCounter===-1){this.onLoop.dispatch(this.target,this)}else{this.onRepeat.dispatch(this.target,this)}return true}else if(b===N.TweenData.COMPLETE){var c=false;if(this.reverse){this.current--;if(this.current<0){this.current=this.timeline.length-1;c=true}}else{this.current++;if(this.current===this.timeline.length){this.current=0;c=true}}if(c){if(this.repeatCounter===-1){this.timeline[this.current].start();this.onLoop.dispatch(this.target,this);return true}else if(this.repeatCounter>0){this.repeatCounter--;this.timeline[this.current].start();this.onRepeat.dispatch(this.target,this);return true}else{this.isRunning=false;this.onComplete.dispatch(this.target,this);this._hasStarted=false;if(this.chainedTween){this.chainedTween.start()}return false}}else{this.onChildComplete.dispatch(this.target,this);this.timeline[this.current].start();return true}}},generateData:function(a,b){if(this.game===null||this.target===null){return null}if(a===undefined){a=60}if(b===undefined){b=[]}for(var i=0;i<this.timeline.length;i++){for(var c in this.timeline[i].vEnd){this.properties[c]=this.target[c]||0;if(!Array.isArray(this.properties[c])){this.properties[c]*=1.0}}}for(var i=0;i<this.timeline.length;i++){this.timeline[i].loadValues()}for(var i=0;i<this.timeline.length;i++){b=b.concat(this.timeline[i].generateData(a))}return b}};Object.defineProperty(N.Tween.prototype,'totalDuration',{get:function(){var a=0;for(var i=0;i<this.timeline.length;i++){a+=this.timeline[i].duration}return a}});N.Tween.prototype.constructor=N.Tween;N.TweenData=function(a){this.parent=a;this.game=a.game;this.vStart={};this.vStartCache={};this.vEnd={};this.vEndCache={};this.duration=1000;this.percent=0;this.value=0;this.repeatCounter=0;this.repeatDelay=0;this.repeatTotal=0;this.interpolate=false;this.yoyo=false;this.yoyoDelay=0;this.inReverse=false;this.delay=0;this.dt=0;this.startTime=null;this.easingFunction=N.Easing.Default;this.interpolationFunction=N.Math.linearInterpolation;this.interpolationContext=N.Math;this.isRunning=false;this.isFrom=false};N.TweenData.PENDING=0;N.TweenData.RUNNING=1;N.TweenData.LOOPED=2;N.TweenData.COMPLETE=3;N.TweenData.prototype={to:function(a,b,c,d,e,f){this.vEnd=a;this.duration=b;this.easingFunction=c;this.delay=d;this.repeatTotal=e;this.yoyo=f;this.isFrom=false;return this},from:function(a,b,c,d,e,f){this.vEnd=a;this.duration=b;this.easingFunction=c;this.delay=d;this.repeatTotal=e;this.yoyo=f;this.isFrom=true;return this},start:function(){this.startTime=this.game.time.deltaTotal+this.delay;if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}if(this.delay>0){this.isRunning=false}else{this.isRunning=true}if(this.isFrom){for(var a in this.vStartCache){this.vStart[a]=this.vEndCache[a];this.vEnd[a]=this.vStartCache[a];this.parent.target[a]=this.vStart[a]}}this.value=0;this.repeatCounter=this.repeatTotal;return this},loadValues:function(){for(var a in this.parent.properties){this.vStart[a]=this.parent.properties[a];if(Array.isArray(this.vEnd[a])){if(this.vEnd[a].length===0){continue}if(this.percent===0){this.vEnd[a]=[this.vStart[a]].concat(this.vEnd[a])}}if(typeof this.vEnd[a]!=='undefined'){if(typeof this.vEnd[a]==='string'){this.vEnd[a]=this.vStart[a]+parseFloat(this.vEnd[a])}this.parent.properties[a]=this.vEnd[a]}else{this.vEnd[a]=this.vStart[a]}this.vStartCache[a]=this.vStart[a];this.vEndCache[a]=this.vEnd[a]}return this},update:function(a){if(!this.isRunning){if(a>=this.startTime){this.isRunning=true}else{return N.TweenData.PENDING}}else{if(a<this.startTime){return N.TweenData.RUNNING}}var b=this.game.time.delta;if(this.parent.reverse){this.dt-=b*this.parent.timeScale;this.dt=Math.max(this.dt,0)}else{this.dt+=b*this.parent.timeScale;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);for(var c in this.vEnd){var d=this.vStart[c];var e=this.vEnd[c];if(Array.isArray(e)){this.parent.target[c]=this.interpolationFunction.call(this.interpolationContext,e,this.value)}else{this.parent.target[c]=d+((e-d)*this.value)}}if((!this.parent.reverse&&this.percent===1)||(this.parent.reverse&&this.percent===0)){return this.repeat()}return N.TweenData.RUNNING},generateData:function(a){if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}var b=[];var c=false;var d=(1/a)*1000;do{if(this.parent.reverse){this.dt-=d;this.dt=Math.max(this.dt,0)}else{this.dt+=d;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);var e={};for(var f in this.vEnd){var g=this.vStart[f];var h=this.vEnd[f];if(Array.isArray(h)){e[f]=this.interpolationFunction.call(this.interpolationContext,h,this.value)}else{e[f]=g+((h-g)*this.value)}}b.push(e);if((!this.parent.reverse&&this.percent===1)||(this.parent.reverse&&this.percent===0)){c=true}}while(!c);if(this.yoyo){var i=b.slice();i.reverse();b=b.concat(i)}return b},repeat:function(){if(this.yoyo){if(this.inReverse&&this.repeatCounter===0){for(var a in this.vStartCache){this.vStart[a]=this.vStartCache[a];this.vEnd[a]=this.vEndCache[a]}this.inReverse=false;return N.TweenData.COMPLETE}this.inReverse=!this.inReverse}else if(this.repeatCounter===0){return N.TweenData.COMPLETE}if(this.inReverse){for(var a in this.vStartCache){this.vStart[a]=this.vEndCache[a];this.vEnd[a]=this.vStartCache[a]}}else{for(var a in this.vStartCache){this.vStart[a]=this.vStartCache[a];this.vEnd[a]=this.vEndCache[a]}if(this.repeatCounter>0){this.repeatCounter--}}this.startTime=this.game.time.deltaTotal;if(this.yoyo&&this.inReverse){this.startTime+=this.yoyoDelay}else if(!this.inReverse){this.startTime+=this.repeatDelay}if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}return N.TweenData.LOOPED}};N.TweenData.prototype.constructor=N.TweenData;N.Easing={Linear:{None:function(k){return k}},Quadratic:{In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){if((k*=2)<1){return 0.5*k*k}return-0.5*(--k*(k-2)-1)}},Cubic:{In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){if((k*=2)<1){return 0.5*k*k*k}return 0.5*((k-=2)*k*k+2)}},Quartic:{In:function(k){return k*k*k*k},Out:function(k){return 1-(--k*k*k*k)},InOut:function(k){if((k*=2)<1){return 0.5*k*k*k*k}return-0.5*((k-=2)*k*k*k-2)}},Quintic:{In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){if((k*=2)<1){return 0.5*k*k*k*k*k}return 0.5*((k-=2)*k*k*k*k+2)}},Sinusoidal:{In:function(k){if(k===0){return 0}if(k===1){return 1}return 1-Math.cos(k*Math.PI/2)},Out:function(k){if(k===0){return 0}if(k===1){return 1}return Math.sin(k*Math.PI/2)},InOut:function(k){if(k===0){return 0}if(k===1){return 1}return 0.5*(1-Math.cos(Math.PI*k))}},Exponential:{In:function(k){return k===0?0:Math.pow(1024,k-1)},Out:function(k){return k===1?1:1-Math.pow(2,-10*k)},InOut:function(k){if(k===0){return 0}if(k===1){return 1}if((k*=2)<1){return 0.5*Math.pow(1024,k-1)}return 0.5*(-Math.pow(2,-10*(k-1))+2)}},Circular:{In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1-(--k*k))},InOut:function(k){if((k*=2)<1){return-0.5*(Math.sqrt(1-k*k)-1)}return 0.5*(Math.sqrt(1-(k-=2)*k)+1)}},Elastic:{In:function(k){var s,a=1,p=0.4;if(k===0){return 0}if(k===1){return 1}s=p/4;return-(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))},Out:function(k){var s,a=1,p=0.4;if(k===0){return 0}if(k===1){return 1}s=p/4;return(a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1)},InOut:function(k){var s,a=1,p=0.4;if(k===0){return 0}if(k===1){return 1}s=p/4;if((k*=2)<1){return-0.5*(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))}return a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*0.5+1}},Back:{In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=1.70158*1.525;if((k*=2)<1){return 0.5*(k*k*((s+1)*k-s))}return 0.5*((k-=2)*k*((s+1)*k+s)+2)}},Bounce:{In:function(k){return 1-N.Easing.Bounce.Out(1-k)},Out:function(k){if(k<(1/2.75)){return 7.5625*k*k}else if(k<(2/2.75)){return 7.5625*(k-=(1.5/2.75))*k+0.75}else if(k<(2.5/2.75)){return 7.5625*(k-=(2.25/2.75))*k+0.9375}else{return 7.5625*(k-=(2.625/2.75))*k+0.984375}},InOut:function(k){if(k<0.5){return N.Easing.Bounce.In(k*2)*0.5}return N.Easing.Bounce.Out(k*2-1)*0.5+0.5}}};N.Easing.Default=N.Easing.Linear.None;N.Easing.Power0=N.Easing.Linear.None;N.Easing.Power1=N.Easing.Quadratic.Out;N.Easing.Power2=N.Easing.Cubic.Out;N.Easing.Power3=N.Easing.Quartic.Out;N.Easing.Power4=N.Easing.Quintic.Out;N.Time=function(a){this.game=a;this.time=0;this.now=0;this.elapsed=0;this.elapsedMS=0;this.delta=0;this.deltaTotal=0;this.deltaMax=200;this.desiredFpsMult=1.0/60;this._desiredFps=60;this.suggestedFps=this.desiredFps;this.slowMotion=1.0;this.advancedTiming=false;this.frames=0;this.updates=0;this.renders=0;this.fps=0;this.ups=0;this.rps=0;this.fpsMin=1000;this.fpsMax=0;this.msMin=1000;this.msMax=0;this.pauseDuration=0;this.timeToCall=0;this.timeExpected=0;this.events=new N.Timer(this.game,false);this._frameCount=0;this._elapsedAccumulator=0;this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this._timers=[]};N.Time.prototype={boot:function(){this._started=Date.now();this.time=Date.now();this.events.start();this.timeExpected=this.time},add:function(a){this._timers.push(a);return a},create:function(a){if(a===undefined){a=true}var b=new N.Timer(this.game,a);this._timers.push(b);return b},removeAll:function(){for(var i=0;i<this._timers.length;i++){this._timers[i].destroy()}this._timers=[];this.events.removeAll()},refresh:function(){var a=this.time;this.time=Date.now();this.elapsedMS=this.time-a},update:function(a){var b=this.time;var c=this.now;this.time=Date.now();this.elapsedMS=this.time-b;this.now=a;this.elapsed=this.now-c;if(this.game.raf._isSetTimeOut){this.timeToCall=Math.floor(Math.max(0,(1000.0/this._desiredFps)+this.timeExpected-a));this.timeExpected=a+this.timeToCall}if(this.advancedTiming){this.updateAdvancedTiming()}},updateTimers:function(){var i=0;var a=this._timers.length;if(!a){return}while(i<a){if(this._timers[i].update(this.deltaTotal)){i++}else{this._timers.splice(i,1);a--}}},updateAdvancedTiming:function(){this._frameCount++;this._elapsedAccumulator+=this.elapsed;if(this._frameCount>=this._desiredFps*2){this.suggestedFps=Math.floor(200/(this._elapsedAccumulator/this._frameCount))*5;this._frameCount=0;this._elapsedAccumulator=0}this.msMin=Math.min(this.msMin,this.elapsed);this.msMax=Math.max(this.msMax,this.elapsed);this.frames++;if(this.now>this._timeLastSecond+1000){var a=this.now-this._timeLastSecond;this.fps=Math.round((this.frames*1000)/a);this.ups=Math.round((this.updates*1000)/a);this.rps=Math.round((this.renders*1000)/a);this.fpsMin=Math.min(this.fpsMin,this.fps);this.fpsMax=Math.max(this.fpsMax,this.fps);this._timeLastSecond=this.now;this.frames=0;this.updates=0;this.renders=0}},preUpdate:function(a){a*=1000;this.delta=a;this.deltaTotal+=a;if(!this.game.paused){this.events.update(this.deltaTotal);this.updateTimers()}if(this.advancedTiming){this.updates++}},preRender:function(){if(this.advancedTiming){this.renders++}},gamePaused:function(){this._pauseStarted=Date.now()},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.time-this._pauseStarted},totalElapsedSeconds:function(){return(this.time-this._started)*0.001},elapsedSince:function(a){return this.time-a},elapsedSecondsSince:function(a){return(this.time-a)*0.001},reset:function(){this._started=this.time;this.removeAll()}};Object.defineProperty(N.Time.prototype,'desiredFps',{get:function(){return this._desiredFps},set:function(a){this._desiredFps=a;this.desiredFpsMult=1.0/a}});Object.defineProperty(N.Time.prototype,'desiredMinFps',{get:function(){return 1000/this.deltaMax},set:function(a){this.deltaMax=1000/a}});N.Time.prototype.constructor=N.Time;N.Timer=function(a,b){if(b===undefined){b=true}this.game=a;this.running=false;this.autoDestroy=b;this.expired=false;this.elapsed=0;this.events=[];this.onComplete=new N.Signal();this.nextTick=0;this.paused=false;this._codePaused=false;this._started=0;this._pauseStarted=0;this._pauseTotal=0;this._now=this.game.time?this.game.time.deltaTotal:0;this._len=0;this._marked=0;this._i=0;this._diff=0;this._newTick=0};N.Timer.MINUTE=60000;N.Timer.SECOND=1000;N.Timer.HALF=500;N.Timer.QUARTER=250;N.Timer.prototype={create:function(a,b,c,d,e,f){a=Math.round(a);var g=a+this._now;var h=new N.TimerEvent(this,a,g,c,b,d,e,f);this.events.push(h);this.order();this.expired=false;return h},add:function(a,b,c){return this.create(a,false,0,b,c,Array.prototype.slice.call(arguments,3))},repeat:function(a,b,c,d){return this.create(a,false,b,c,d,Array.prototype.slice.call(arguments,4))},loop:function(a,b,c){return this.create(a,true,0,b,c,Array.prototype.slice.call(arguments,3))},start:function(a){if(this.running){return}this._started=this.game.time.deltaTotal+(a||0);this.running=true;for(var i=0;i<this.events.length;i++){this.events[i].tick=this.events[i].delay+this._started}},stop:function(a){this.running=false;if(a===undefined){a=true}if(a){this.events.length=0}},remove:function(a){for(var i=0;i<this.events.length;i++){if(this.events[i]===a){this.events[i].pendingDelete=true;return true}}return false},order:function(){if(this.events.length>0){this.events.sort(this.sortHandler);this.nextTick=this.events[0].tick}},sortHandler:function(a,b){if(a.tick<b.tick){return-1}else if(a.tick>b.tick){return 1}return 0},clearPendingEvents:function(){this._i=this.events.length;while(this._i--){if(this.events[this._i].pendingDelete){this.events.splice(this._i,1)}}this._len=this.events.length;this._i=0},update:function(a){if(this.paused){return true}this.elapsed=a-this._now;this._now=a;this._marked=0;this.clearPendingEvents();if(this.running&&this._now>=this.nextTick&&this._len>0){while(this._i<this._len&&this.running){var b=this.events[this._i];if(this._now>=b.tick&&!b.pendingDelete){this._newTick=(this._now+b.delay)-(this._now-b.tick);if(this._newTick<0){this._newTick=this._now+b.delay}if(b.loop===true){b.tick=this._newTick;b.callback.apply(b.callbackContext,b.args)}else if(b.repeatCount>0){b.repeatCount--;b.tick=this._newTick;b.callback.apply(b.callbackContext,b.args)}else{this._marked++;b.pendingDelete=true;b.callback.apply(b.callbackContext,b.args)}this._i++}else{break}}if(this.events.length>this._marked){this.order()}else{this.expired=true;this.onComplete.dispatch(this)}}if(this.expired&&this.autoDestroy){return false}else{return true}},pause:function(){if(!this.running){return}this._codePaused=true;if(this.paused){return}this._pauseStarted=this.game.time.deltaTotal;this.paused=true},_pause:function(){if(this.paused||!this.running){return}this._pauseStarted=this.game.time.deltaTotal;this.paused=true},adjustEvents:function(a){for(var i=0;i<this.events.length;i++){if(!this.events[i].pendingDelete){var t=this.events[i].tick-a;if(t<0){t=0}this.events[i].tick=this._now+t}}var d=this.nextTick-a;if(d<0){this.nextTick=this._now}else{this.nextTick=this._now+d}},resume:function(){if(!this.paused){return}var a=this.game.time.deltaTotal;this._pauseTotal+=a-this._now;this._now=a;this.adjustEvents(this._pauseStarted);this.paused=false;this._codePaused=false},_resume:function(){if(this._codePaused){return}else{this.resume()}},removeAll:function(){this.onComplete.removeAll();this.events.length=0;this._len=0;this._i=0},destroy:function(){this.onComplete.removeAll();this.running=false;this.expired=true;this.events=[];this._len=0;this._i=0}};Object.defineProperty(N.Timer.prototype,'next',{get:function(){return this.nextTick}});Object.defineProperty(N.Timer.prototype,'duration',{get:function(){if(this.running&&this.nextTick>this._now){return this.nextTick-this._now}else{return 0}}});Object.defineProperty(N.Timer.prototype,'length',{get:function(){return this.events.length}});Object.defineProperty(N.Timer.prototype,'ms',{get:function(){if(this.running){return this._now-this._started-this._pauseTotal}else{return 0}}});Object.defineProperty(N.Timer.prototype,'seconds',{get:function(){if(this.running){return this.ms*0.001}else{return 0}}});N.Timer.prototype.constructor=N.Timer;N.TimerEvent=function(a,b,c,d,e,f,g,h){this.timer=a;this.delay=b;this.tick=c;this.repeatCount=d-1;this.loop=e;this.callback=f;this.callbackContext=g;this.args=h;this.pendingDelete=false};N.TimerEvent.prototype.constructor=N.TimerEvent;N.AnimationManager=function(a){this.sprite=a;this.game=a.game;this.currentFrame=null;this.currentAnim=null;this.updateIfVisible=true;this.isLoaded=false;this._frameData=null;this._anims={};this._outputFrames=[]};N.AnimationManager.prototype={loadFrameData:function(a,b){if(a===undefined){return false}if(this.isLoaded){for(var c in this._anims){this._anims[c].updateFrameData(a)}}this._frameData=a;if(b===undefined||b===null){this.frame=0}else if(typeof b==='string'){this.frameName=b}else{this.frame=b}this.isLoaded=true;return true},copyFrameData:function(a,b){this._frameData=a.clone();if(this.isLoaded){for(var c in this._anims){this._anims[c].updateFrameData(this._frameData)}}if(b===undefined||b===null){this.frame=0}else if(typeof b==='string'){this.frameName=b}else{this.frame=b}this.isLoaded=true;return true},add:function(a,b,c,d,e){b=b||[];c=c||60;if(d===undefined){d=false}if(e===undefined){if(b&&typeof b[0]==='number'){e=true}else{e=false}}this._outputFrames=[];this._frameData.getFrameIndexes(b,e,this._outputFrames);this._anims[a]=new N.Animation(this.game,this.sprite,a,this._frameData,this._outputFrames,c,d);this.currentAnim=this._anims[a];if(this.sprite.tilingTexture){this.sprite.refreshTexture=true}return this._anims[a]},validateFrames:function(a,b){if(b===undefined){b=true}for(var i=0;i<a.length;i++){if(b===true){if(a[i]>this._frameData.total){return false}}else if(this._frameData.checkFrameName(a[i])===false){return false}}return true},play:function(a,b,c,d){if(this._anims[a]){if(this.currentAnim===this._anims[a]){if(this.currentAnim.isPlaying===false){this.currentAnim.paused=false;return this.currentAnim.play(b,c,d)}return this.currentAnim}else{if(this.currentAnim&&this.currentAnim.isPlaying){this.currentAnim.stop()}this.currentAnim=this._anims[a];this.currentAnim.paused=false;this.currentFrame=this.currentAnim.currentFrame;return this.currentAnim.play(b,c,d)}}},stop:function(a,b){if(b===undefined){b=false}if(this.currentAnim&&(typeof a!=='string'||a===this.currentAnim.name)){this.currentAnim.stop(b)}},update:function(){if(this.updateIfVisible&&!this.sprite.visible){return false}if(this.currentAnim&&this.currentAnim.update()){this.currentFrame=this.currentAnim.currentFrame;return true}return false},next:function(a){if(this.currentAnim){this.currentAnim.next(a);this.currentFrame=this.currentAnim.currentFrame}},previous:function(a){if(this.currentAnim){this.currentAnim.previous(a);this.currentFrame=this.currentAnim.currentFrame}},getAnimation:function(a){if(typeof a==='string'){if(this._anims[a]){return this._anims[a]}}return null},refreshFrame:function(){},destroy:function(){var a=null;for(var a in this._anims){if(this._anims.hasOwnProperty(a)){this._anims[a].destroy()}}this._anims={};this._outputFrames=[];this._frameData=null;this.currentAnim=null;this.currentFrame=null;this.sprite=null;this.game=null}};N.AnimationManager.prototype.constructor=N.AnimationManager;Object.defineProperty(N.AnimationManager.prototype,'frameData',{get:function(){return this._frameData}});Object.defineProperty(N.AnimationManager.prototype,'frameTotal',{get:function(){return this._frameData.total}});Object.defineProperty(N.AnimationManager.prototype,'paused',{get:function(){return this.currentAnim.isPaused},set:function(a){this.currentAnim.paused=a}});Object.defineProperty(N.AnimationManager.prototype,'name',{get:function(){return(this.currentAnim)?this.currentAnim.name:undefined}});Object.defineProperty(N.AnimationManager.prototype,'frame',{get:function(){return(this.currentFrame)?this.currentFrame.index:undefined},set:function(a){var b;if(typeof a==='number'&&this._frameData&&(b=this._frameData.getFrame(a))){this.currentFrame=b;this.sprite.setFrame(this.currentFrame)}}});Object.defineProperty(N.AnimationManager.prototype,'frameName',{get:function(){return(this.currentFrame)?this.currentFrame.name:undefined},set:function(a){var b;if(typeof a==='string'&&this._frameData&&(b=this._frameData.getFrameByName(a))){this.currentFrame=b;this._frameIndex=this.currentFrame.index;this.sprite.setFrame(this.currentFrame)}else{console.warn('Cannot set frameName: '+a)}}});N.Animation=function(a,b,c,d,e,f,g){if(g===undefined){g=false}this.game=a;this._parent=b;this._frameData=d;this.name=c;this._frames=[];this._frames=this._frames.concat(e);this.delay=1000/f;this.loop=g;this.loopCount=0;this.killOnComplete=false;this.isFinished=false;this.isPlaying=false;this.isPaused=false;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new N.Signal();this.onUpdate=null;this.onComplete=new N.Signal();this.onLoop=new N.Signal();this.isReversed=false;this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};N.Animation.prototype={play:function(a,b,c){if(typeof a==='number'){this.delay=1000/a}if(typeof b==='boolean'){this.loop=b}if(typeof c!=='undefined'){this.killOnComplete=c}this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.deltaTotal;this._timeNextFrame=this.game.time.deltaTotal+this.delay;this._frameIndex=this.isReversed?this._frames.length-1:0;this.updateCurrentFrame(false,true);this._parent.events.onAnimationStart$dispatch(this._parent,this);this.onStart.dispatch(this._parent,this);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;return this},restart:function(){this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.deltaTotal;this._timeNextFrame=this.game.time.deltaTotal+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,this)},reverse:function(){this.reversed=!this.reversed;return this},reverseOnce:function(){this.onComplete.addOnce(this.reverse,this);return this.reverse()},setFrame:function(a,b){var c;if(b===undefined){b=false}if(typeof a==='string'){for(var i=0;i<this._frames.length;i++){if(this._frameData.getFrame(this._frames[i]).name===a){c=i}}}else if(typeof a==='number'){if(b){c=a}else{for(var i=0;i<this._frames.length;i++){if(this._frames[i]===a){c=i}}}}if(c){var d=this.isReversed?-1:1;this._frameIndex=c-d;this._timeNextFrame=this.game.time.deltaTotal;this.update()}},stop:function(a,b){if(a===undefined){a=false}if(b===undefined){b=false}this.isPlaying=false;this.isFinished=true;this.paused=false;if(a){this.currentFrame=this._frameData.getFrame(this._frames[0]);this._parent.setFrame(this.currentFrame)}if(b){this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this)}},onPause:function(){if(this.isPlaying){this._frameDiff=this._timeNextFrame-this.game.time.deltaTotal}},onResume:function(){if(this.isPlaying){this._timeNextFrame=this.game.time.deltaTotal+this._frameDiff}},update:function(){if(this.isPaused){return false}var a=this.game.time.deltaTotal;var b=a-this._timeNextFrame;if(this.isPlaying&&b>=0){this._frameSkip=1;this._frameDiff=b;this._timeLastFrame=a;if(this._frameDiff>this.delay){this._frameSkip=Math.floor(this._frameDiff/this.delay);this._frameDiff-=(this._frameSkip*this.delay)}this._timeNextFrame=a+(this.delay-this._frameDiff);if(this.isReversed){this._frameIndex-=this._frameSkip}else{this._frameIndex+=this._frameSkip}if(!this.isReversed&&this._frameIndex>=this._frames.length||this.isReversed&&this._frameIndex<=-1){if(this.loop){this._frameIndex=Math.abs(this._frameIndex)%this._frames.length;if(this.isReversed){this._frameIndex=this._frames.length-1-this._frameIndex}this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setFrame(this.currentFrame)}this.loopCount++;this._parent.events.onAnimationLoop$dispatch(this._parent,this);this.onLoop.dispatch(this._parent,this);if(this.onUpdate){this.onUpdate.dispatch(this,this.currentFrame);return!!this._frameData}else{return true}}else{this.complete();return false}}else{return this.updateCurrentFrame(true)}}return false},updateCurrentFrame:function(a,b){if(b===undefined){b=false}if(!this._frameData){return false}var c=this.currentFrame.index;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame&&(b||(c!==this.currentFrame.index))){this._parent.setFrame(this.currentFrame)}if(this.onUpdate&&a){this.onUpdate.dispatch(this,this.currentFrame);return!!this._frameData}else{return true}},next:function(a){if(a===undefined){a=1}var b=this._frameIndex+a;if(b>=this._frames.length){if(this.loop){b%=this._frames.length}else{b=this._frames.length-1}}if(b!==this._frameIndex){this._frameIndex=b;this.updateCurrentFrame(true)}},previous:function(a){if(a===undefined){a=1}var b=this._frameIndex-a;if(b<0){if(this.loop){b=this._frames.length+b}else{b++}}if(b!==this._frameIndex){this._frameIndex=b;this.updateCurrentFrame(true)}},updateFrameData:function(a){this._frameData=a;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){if(!this._frameData){return}this.game.onPause.remove(this.onPause,this);this.game.onResume.remove(this.onResume,this);this.game=null;this._parent=null;this._frames=null;this._frameData=null;this.currentFrame=null;this.isPlaying=false;this.onStart.dispose();this.onLoop.dispose();this.onComplete.dispose();if(this.onUpdate){this.onUpdate.dispose()}},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.updateCurrentFrame(false);this.isPlaying=false;this.isFinished=true;this.paused=false;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);if(this.killOnComplete){this._parent.kill()}}};N.Animation.prototype.constructor=N.Animation;Object.defineProperty(N.Animation.prototype,'paused',{get:function(){return this.isPaused},set:function(a){this.isPaused=a;if(a){this._pauseStartTime=this.game.time.deltaTotal}else{if(this.isPlaying){this._timeNextFrame=this.game.time.deltaTotal+this.delay}}}});Object.defineProperty(N.Animation.prototype,'reversed',{get:function(){return this.isReversed},set:function(a){this.isReversed=a}});Object.defineProperty(N.Animation.prototype,'frameTotal',{get:function(){return this._frames.length}});Object.defineProperty(N.Animation.prototype,'frame',{get:function(){if(this.currentFrame!==null){return this.currentFrame.index}else{return this._frameIndex}},set:function(a){this.currentFrame=this._frameData.getFrame(this._frames[a]);if(this.currentFrame!==null){this._frameIndex=a;this._parent.setFrame(this.currentFrame);if(this.onUpdate){this.onUpdate.dispatch(this,this.currentFrame)}}}});Object.defineProperty(N.Animation.prototype,'speed',{get:function(){return 1000/this.delay},set:function(a){if(a>0){this.delay=1000/a}}});Object.defineProperty(N.Animation.prototype,'enableUpdate',{get:function(){return(this.onUpdate!==null)},set:function(a){if(a&&this.onUpdate===null){this.onUpdate=new N.Signal()}else if(!a&&this.onUpdate!==null){this.onUpdate.dispose();this.onUpdate=null}}});N.Animation.generateFrameNames=function(a,b,c,d,e){if(d===undefined){d=''}var f=[];var g='';if(b<c){for(var i=b;i<=c;i++){if(typeof e==='number'){g=N.Utils.pad(i.toString(),e,'0',1)}else{g=i.toString()}g=a+g+d;f.push(g)}}else{for(var i=b;i>=c;i--){if(typeof e==='number'){g=N.Utils.pad(i.toString(),e,'0',1)}else{g=i.toString()}g=a+g+d;f.push(g)}}return f};N.Frame=function(a,x,y,b,c,d){this.index=a;this.x=x;this.y=y;this.width=b;this.height=c;if(this.width===0||this.height===0){console.warn('Phaser.Frame: Frame "'+d+'" has a width or height of zero')}this.name=d;this.centerX=Math.floor(b/2);this.centerY=Math.floor(c/2);this.distance=N.Math.distance(0,0,b,c);this.rotated=false;this.trimmed=false;this.sourceSizeW=b;this.sourceSizeH=c;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0;this.right=this.x+this.width;this.bottom=this.y+this.height};N.Frame.prototype={resize:function(a,b){this.width=a;this.height=b;this.centerX=Math.floor(a/2);this.centerY=Math.floor(b/2);this.distance=N.Math.distance(0,0,a,b);this.sourceSizeW=a;this.sourceSizeH=b;this.right=this.x+a;this.bottom=this.y+b},setTrim:function(a,b,c,d,e,f,g){this.trimmed=a;if(a){this.sourceSizeW=b;this.sourceSizeH=c;this.centerX=Math.floor(b/2);this.centerY=Math.floor(c/2);this.spriteSourceSizeX=d;this.spriteSourceSizeY=e;this.spriteSourceSizeW=f;this.spriteSourceSizeH=g}},clone:function(){var a=new N.Frame(this.index,this.x,this.y,this.width,this.height,this.name);for(var b in this){if(this.hasOwnProperty(b)){a[b]=this[b]}}return a},getRect:function(a){if(a===undefined){a=new N.Rectangle(this.x,this.y,this.width,this.height)}else{a.setTo(this.x,this.y,this.width,this.height)}return a}};N.Frame.prototype.constructor=N.Frame;N.FrameData=function(){this._frames=[];this._frameNames=[]};N.FrameData.prototype={addFrame:function(a){a.index=this._frames.length;this._frames.push(a);if(a.name!==''){this._frameNames[a.name]=a.index}return a},getFrame:function(a){if(a>=this._frames.length){a=0}return this._frames[a]},getFrameByName:function(a){if(typeof this._frameNames[a]==='number'){return this._frames[this._frameNames[a]]}return null},checkFrameName:function(a){if(this._frameNames[a]==null){return false}return true},clone:function(){var a=new N.FrameData();for(var i=0;i<this._frames.length;i++){a._frames.push(this._frames[i].clone())}for(var p in this._frameNames){if(this._frameNames.hasOwnProperty(p)){a._frameNames[p]=this._frameNames[p]}}return a},getFrameRange:function(a,b,c){if(c===undefined){c=[]}for(var i=a;i<=b;i++){c.push(this._frames[i])}return c},getFrames:function(a,b,c){if(b===undefined){b=true}if(c===undefined){c=[]}if(a===undefined||a.length===0){for(var i=0;i<this._frames.length;i++){c.push(this._frames[i])}}else{for(var i=0;i<a.length;i++){if(b){c.push(this.getFrame(a[i]))}else{c.push(this.getFrameByName(a[i]))}}}return c},getFrameIndexes:function(a,b,c){if(b===undefined){b=true}if(c===undefined){c=[]}if(a===undefined||a.length===0){for(var i=0;i<this._frames.length;i++){c.push(this._frames[i].index)}}else{for(var i=0;i<a.length;i++){if(b&&this._frames[a[i]]){c.push(this._frames[a[i]].index)}else if(this.getFrameByName(a[i])){c.push(this.getFrameByName(a[i]).index)}}}return c},destroy:function(){this._frames=null;this._frameNames=null}};N.FrameData.prototype.constructor=N.FrameData;Object.defineProperty(N.FrameData.prototype,'total',{get:function(){return this._frames.length}});N.AnimationParser={spriteSheet:function(a,b,c,d,e,f,g,h){if(e===undefined){e=-1}if(f===undefined){f=0}if(g===undefined){g=0}if(h===undefined){h=0}var j=b;if(typeof b==='string'){j=a.cache.getImage(b)}else{b=j.name}if(j===null){return null}if(c<=0||d<=0){console.error('Spritesheet "%s": frameWidth (%s) and frameHeight (%s) values must be positive',b,c,d);return null}var k=j.width;var l=j.height;if(k===0||l===0){console.error('Spritesheet "%s": Texture width (%s) or height (%s) is zero',b,k,l);return null}if(k<c||l<d){console.error('Spritesheet "%s": Texture width (%s) or height (%s) is less than the given frameWidth (%s) or frameHeight (%s)',b,k,l,c,d);return null}var m=Math.floor((k-f)/(c+g));var n=Math.floor((l-f)/(d+g));var o=m*n;var p=o;var q=o-1;var r=0;var s=q;if(h>o||h<-o){console.error('Spritesheet "%s": skipFrames=%s is larger than the frame total %s',b,h,o);return null}if(e>-1){o=e;s=o-1}if(m<1){console.warn('Spritesheet "%s": Texture has width %d, but it should be at least %d (frameWidth=%s, margin=%s, spacing=%s)',b,k,c+f+g,c,f,g)}if(n<1){console.warn('Spritesheet "%s": Texture has height %d, but it should be at least %d (frameHeight=%s, margin=%s, spacing=%s)',b,l,d+f+g,d,f,g)}if(p===0){console.error('Spritesheet "%s": zero frames were produced',b);return null}if(h>0){r=h;o=Math.min(o,p-h);s=r+o-1}else if(h<0){s=q+h;o=Math.min(o,p+h);r=s-o+1}if(r<0){console.error('Spritesheet "%s": There is no frame at index %s',b,r);return null}if(s>q){console.warn('Spritesheet "%s": There is no frame at index %s. Last frame found is index %s',b,s,q);return null}var t=new N.FrameData();var x=f;var y=f;var u=0;for(var i=0;i<p;i++){if(i>s){break}if(i>=r){t.addFrame(new N.Frame(u++,x,y,c,d,''))}x+=c+g;if(x+c>k){x=f;y+=d+g}}return t},JSONData:function(a,b){if(!b.frames){console.warn('Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing \'frames\' array');console.log(b);return}var c=new N.FrameData();var d=b.frames;var e;for(var i=0;i<d.length;i++){e=c.addFrame(new N.Frame(i,d[i].frame.x,d[i].frame.y,d[i].frame.w,d[i].frame.h,d[i].filename));if(d[i].trimmed){e.setTrim(d[i].trimmed,d[i].sourceSize.w,d[i].sourceSize.h,d[i].spriteSourceSize.x,d[i].spriteSourceSize.y,d[i].spriteSourceSize.w,d[i].spriteSourceSize.h)}if(d[i].rotated){e.rotated=true}}return c},JSONDataPyxel:function(b,c){var d=['layers','tilewidth','tileheight','tileswide','tileshigh'];d.forEach(function(a){if(!c[a]){console.warn('Phaser.AnimationParser.JSONDataPyxel: Invalid Pyxel Tilemap JSON given, missing "'+a+'" key.');console.log(c);return}});if(c.layers.length!==1){console.warn('Phaser.AnimationParser.JSONDataPyxel: Too many layers, this parser only supports flat Tilemaps.');console.log(c);return}var e=new N.FrameData();var f=c.tileheight;var g=c.tilewidth;var h=c.layers[0].tiles;var j;for(var i=0;i<h.length;i++){j=e.addFrame(new N.Frame(i,h[i].x,h[i].y,g,f,'frame_'+i));j.setTrim(false)}return e},JSONDataHash:function(a,b){if(!b.frames){console.warn('Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing \'frames\' object');console.log(b);return}var c=new N.FrameData();var d=b.frames;var e;var i=0;for(var f in d){e=c.addFrame(new N.Frame(i,d[f].frame.x,d[f].frame.y,d[f].frame.w,d[f].frame.h,f));if(d[f].trimmed){e.setTrim(d[f].trimmed,d[f].sourceSize.w,d[f].sourceSize.h,d[f].spriteSourceSize.x,d[f].spriteSourceSize.y,d[f].spriteSourceSize.w,d[f].spriteSourceSize.h)}if(d[f].rotated){e.rotated=true}i++}return c},XMLData:function(a,b){if(!b.getElementsByTagName('TextureAtlas')){console.warn('Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag');return}var c=new N.FrameData();var d=b.getElementsByTagName('SubTexture');var e;var f;var g;var x;var y;var h;var j;var k;var l;var m;var n;for(var i=0;i<d.length;i++){g=d[i].attributes;f=g.name.value;x=parseInt(g.x.value,10);y=parseInt(g.y.value,10);h=parseInt(g.width.value,10);j=parseInt(g.height.value,10);k=null;l=null;if(g.frameX){k=Math.abs(parseInt(g.frameX.value,10));l=Math.abs(parseInt(g.frameY.value,10));m=parseInt(g.frameWidth.value,10);n=parseInt(g.frameHeight.value,10)}e=c.addFrame(new N.Frame(i,x,y,h,j,f));if(k!==null||l!==null){e.setTrim(true,h,j,k,l,m,n)}}return c}};N.Cache=function(a){this.game=a;this.autoResolveURL=false;this._cache={canvas:{},image:{},texture:{},sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{},compressedTexture:{},data:{}};this._urlMap={};this._urlResolver=new Image();this._urlTemp=null;this.onSoundUnlock=new N.Signal();this._cacheMap=[];this._cacheMap[N.Cache.CANVAS]=this._cache.canvas;this._cacheMap[N.Cache.IMAGE]=this._cache.image;this._cacheMap[N.Cache.TEXTURE]=this._cache.texture;this._cacheMap[N.Cache.SOUND]=this._cache.sound;this._cacheMap[N.Cache.TEXT]=this._cache.text;this._cacheMap[N.Cache.PHYSICS]=this._cache.physics;this._cacheMap[N.Cache.TILEMAP]=this._cache.tilemap;this._cacheMap[N.Cache.BINARY]=this._cache.binary;this._cacheMap[N.Cache.BITMAPDATA]=this._cache.bitmapData;this._cacheMap[N.Cache.BITMAPFONT]=this._cache.bitmapFont;this._cacheMap[N.Cache.JSON]=this._cache.json;this._cacheMap[N.Cache.XML]=this._cache.xml;this._cacheMap[N.Cache.VIDEO]=this._cache.video;this._cacheMap[N.Cache.SHADER]=this._cache.shader;this._cacheMap[N.Cache.RENDER_TEXTURE]=this._cache.renderTexture;this._cacheMap[N.Cache.DATA]=this._cache.data;this._pendingCount=0;this.onReady=new N.Signal();this._addImages()};N.Cache.CANVAS=1;N.Cache.IMAGE=2;N.Cache.TEXTURE=3;N.Cache.SOUND=4;N.Cache.TEXT=5;N.Cache.PHYSICS=6;N.Cache.TILEMAP=7;N.Cache.BINARY=8;N.Cache.BITMAPDATA=9;N.Cache.BITMAPFONT=10;N.Cache.JSON=11;N.Cache.XML=12;N.Cache.VIDEO=13;N.Cache.SHADER=14;N.Cache.RENDER_TEXTURE=15;N.Cache.DATA=16;N.Cache.DEFAULT=null;N.Cache.DEFAULT_KEY='__default';N.Cache.DEFAULT_SRC='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==';N.Cache.MISSING=null;N.Cache.MISSING_KEY='__missing';N.Cache.MISSING_SRC='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==';N.Cache.READY_TIMEOUT=1000;N.Cache.prototype={addCompressedTextureMetaData:function(a,b,c,d){if(this.checkImageKey(a)){this.removeImage(a)}var e=(c in N.LoaderParser)?N.LoaderParser[c](d):d;var f={key:a,url:b,data:e,base:new PIXI.BaseTexture(e,null,this.game.resolution),frame:new N.Frame(0,0,0,e.width,e.height,a),frameData:new N.FrameData(),fileFormat:c};f.frameData.addFrame(new N.Frame(0,0,0,e.width,e.height,b));this._cache.image[a]=f;this._resolveURL(b,f);return f},addCanvas:function(a,b,c){if(c===undefined){c=b.getContext('2d')}this._cache.canvas[a]={canvas:b,context:c}},addImage:function(a,b,c){if(this.checkImageKey(a)){this.removeImage(a)}if(c.complete===false){console.warn('Phaser.Cache.addImage: Image "%s" is not complete',a)}var d={key:a,url:b,data:c,base:new PIXI.BaseTexture(c,null,this.game.resolution),frame:new N.Frame(0,0,0,c.width,c.height,a),frameData:new N.FrameData()};d.frameData.addFrame(new N.Frame(0,0,0,c.width,c.height,b));this._cache.image[a]=d;this._resolveURL(b,d);if(a==='__default'){N.Cache.DEFAULT=new PIXI.Texture(d.base)}else if(a==='__missing'){N.Cache.MISSING=new PIXI.Texture(d.base)}return d},addImageAsync:function(a,b,c){var d=this;var e=new Image();e.onload=function(){c.call(this,d.addImage(a,null,e));d._removePending();e.onload=null};this._addPending();e.src=b},addDefaultImage:function(){this.addImageAsync(N.Cache.DEFAULT_KEY,N.Cache.DEFAULT_SRC,function(a){a.base.skipRender=true;N.Cache.DEFAULT=new PIXI.Texture(a.base)})},addMissingImage:function(){this.addImageAsync(N.Cache.MISSING_KEY,N.Cache.MISSING_SRC,function(a){N.Cache.MISSING=new PIXI.Texture(a.base)})},addSound:function(a,b,c,d,e){if(d===undefined){d=true;e=false}if(e===undefined){d=false;e=true}var f=false;if(e){f=true}this._cache.sound[a]={url:b,data:c,isDecoding:false,decoded:f,webAudio:d,audioTag:e,locked:this.game.sound.touchLocked};this._resolveURL(b,this._cache.sound[a])},addText:function(a,b,c){this._cache.text[a]={url:b,data:c};this._resolveURL(b,this._cache.text[a])},addPhysicsData:function(a,b,c,d){this._cache.physics[a]={url:b,data:c,format:d};this._resolveURL(b,this._cache.physics[a])},addTilemap:function(a,b,c,d){this._cache.tilemap[a]={url:b,data:c,format:d};this._resolveURL(b,this._cache.tilemap[a])},addBinary:function(a,b){this._cache.binary[a]=b},addBitmapData:function(a,b,c){b.key=a;if(c===undefined){c=new N.FrameData();c.addFrame(b.textureFrame)}this._cache.bitmapData[a]={data:b,frameData:c};return b},addBitmapFont:function(a,b,c,d,e,f,g){var h={url:b,data:c,font:null,base:new PIXI.BaseTexture(c,null,this.game.resolution)};if(f===undefined){f=0}if(g===undefined){g=0}if(e==='json'){h.font=N.LoaderParser.jsonBitmapFont(d,h.base,f,g,false,this.game.resolution)}else{h.font=N.LoaderParser.xmlBitmapFont(d,h.base,f,g,false,this.game.resolution)}this._cache.bitmapFont[a]=h;this._resolveURL(b,h)},addBitmapFontFromAtlas:function(a,b,c,d,e,f,g){var h=this.getFrameByName(b,c);if(!h){return}var i={font:null,base:this.getBaseTexture(b),frame:h};if(f===undefined){f=0}if(g===undefined){g=0}var j;if(e==='json'){j=this.getJSON(d);i.font=N.LoaderParser.jsonBitmapFont(j,i.base,f,g,h,this.game.resolution)}else{j=this.getXML(d);i.font=N.LoaderParser.xmlBitmapFont(j,i.base,f,g,h,this.game.resolution)}this._cache.bitmapFont[a]=i},addJSON:function(a,b,c){this._cache.json[a]={url:b,data:c};this._resolveURL(b,this._cache.json[a])},addXML:function(a,b,c){this._cache.xml[a]={url:b,data:c};this._resolveURL(b,this._cache.xml[a])},addVideo:function(a,b,c,d){this._cache.video[a]={url:b,data:c,isBlob:d,locked:true};this._resolveURL(b,this._cache.video[a])},addShader:function(a,b,c){this._cache.shader[a]={url:b,data:c};this._resolveURL(b,this._cache.shader[a])},addRenderTexture:function(a,b){this._cache.renderTexture[a]={texture:b,frame:new N.Frame(0,0,0,b.width,b.height,'','')}},addSpriteSheet:function(a,b,c,d,e,f,g,h,i){if(f===undefined){f=-1}if(g===undefined){g=0}if(h===undefined){h=0}var j={key:a,url:b,data:c,frameWidth:d,frameHeight:e,margin:g,spacing:h,base:new PIXI.BaseTexture(c,null,this.game.resolution),frameData:N.AnimationParser.spriteSheet(this.game,c,d,e,f,g,h,i)};this._cache.image[a]=j;this._resolveURL(b,j)},addTextureAtlas:function(a,b,c,d,e){var f={key:a,url:b,data:c,base:new PIXI.BaseTexture(c,null,this.game.resolution)};if(e===N.Loader.TEXTURE_ATLAS_XML_STARLING){f.frameData=N.AnimationParser.XMLData(this.game,d,a)}else if(e===N.Loader.TEXTURE_ATLAS_JSON_PYXEL){f.frameData=N.AnimationParser.JSONDataPyxel(this.game,d,a)}else{if(Array.isArray(d.frames)){f.frameData=N.AnimationParser.JSONData(this.game,d,a)}else{f.frameData=N.AnimationParser.JSONDataHash(this.game,d,a)}}this._cache.image[a]=f;this._resolveURL(b,f)},addData:function(a,b){this._cache.data[a]=b},reloadSound:function(a){var b=this;var c=this.getSound(a);if(c){c.data.src=c.url;c.data.addEventListener('canplaythrough',function(){return b.reloadSoundComplete(a)},false);c.data.load()}},reloadSoundComplete:function(a){var b=this.getSound(a);if(b){b.locked=false;this.onSoundUnlock.dispatch(a)}},updateSound:function(a,b,c){var d=this.getSound(a);if(d){d[b]=c}},decodedSound:function(a,b){var c=this.getSound(a);c.data=b;c.decoded=true;c.isDecoding=false},isSoundDecoded:function(a){var b=this.getItem(a,N.Cache.SOUND,'isSoundDecoded');if(b){return b.decoded}},isSoundReady:function(a){var b=this.getItem(a,N.Cache.SOUND,'isSoundDecoded');if(b){return(b.decoded&&!this.game.sound.touchLocked)}},checkKey:function(a,b){if(this._cacheMap[a][b]){return true}return false},checkURL:function(a){if(this._urlMap[this._resolveURL(a)]){return true}return false},checkCanvasKey:function(a){return this.checkKey(N.Cache.CANVAS,a)},checkDataKey:function(a){return this.checkKey(N.Cache.DATA,a)},checkImageKey:function(a){return this.checkKey(N.Cache.IMAGE,a)},checkTextureKey:function(a){return this.checkKey(N.Cache.TEXTURE,a)},checkSoundKey:function(a){return this.checkKey(N.Cache.SOUND,a)},checkTextKey:function(a){return this.checkKey(N.Cache.TEXT,a)},checkPhysicsKey:function(a){return this.checkKey(N.Cache.PHYSICS,a)},checkTilemapKey:function(a){return this.checkKey(N.Cache.TILEMAP,a)},checkBinaryKey:function(a){return this.checkKey(N.Cache.BINARY,a)},checkBitmapDataKey:function(a){return this.checkKey(N.Cache.BITMAPDATA,a)},checkBitmapFontKey:function(a){return this.checkKey(N.Cache.BITMAPFONT,a)},checkJSONKey:function(a){return this.checkKey(N.Cache.JSON,a)},checkXMLKey:function(a){return this.checkKey(N.Cache.XML,a)},checkVideoKey:function(a){return this.checkKey(N.Cache.VIDEO,a)},checkShaderKey:function(a){return this.checkKey(N.Cache.SHADER,a)},checkRenderTextureKey:function(a){return this.checkKey(N.Cache.RENDER_TEXTURE,a)},getItem:function(a,b,c,d){if(!this.checkKey(b,a)){if(c){console.warn('Phaser.Cache.'+c+': Key "'+a+'" not found in Cache.')}}else if(d===undefined){return this._cacheMap[b][a]}else{return this._cacheMap[b][a][d]}return null},getCanvas:function(a){return this.getItem(a,N.Cache.CANVAS,'getCanvas','canvas')},getImage:function(a,b){if(a===undefined||a===null){a='__default'}if(b===undefined){b=false}var c=this.getItem(a,N.Cache.IMAGE,'getImage');if(c===null){c=this.getItem('__missing',N.Cache.IMAGE,'getImage')}if(b){return c}else{return c.data}},getTextureFrame:function(a){return this.getItem(a,N.Cache.TEXTURE,'getTextureFrame','frame')},getSound:function(a){return this.getItem(a,N.Cache.SOUND,'getSound')},getSoundData:function(a){return this.getItem(a,N.Cache.SOUND,'getSoundData','data')},getText:function(a){return this.getItem(a,N.Cache.TEXT,'getText','data')},getPhysicsData:function(a,b,c){var d=this.getItem(a,N.Cache.PHYSICS,'getPhysicsData','data');if(d===null||b===undefined||b===null){return d}else if(d[b]){var e=d[b];if(e&&c){for(var f in e){f=e[f];if(f.fixtureKey===c){return f}}console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+c+' in '+a+'"')}else{return e}}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+a+' / '+b+'"')}return null},getTilemapData:function(a){return this.getItem(a,N.Cache.TILEMAP,'getTilemapData')},getBinary:function(a){return this.getItem(a,N.Cache.BINARY,'getBinary')},getBitmapData:function(a){return this.getItem(a,N.Cache.BITMAPDATA,'getBitmapData','data')},getBitmapFont:function(a){return this.getItem(a,N.Cache.BITMAPFONT,'getBitmapFont')},getJSON:function(a,b){var c=this.getItem(a,N.Cache.JSON,'getJSON','data');if(c){if(b){return N.Utils.extend(true,Array.isArray(c)?[]:{},c)}else{return c}}else{return null}},getXML:function(a){return this.getItem(a,N.Cache.XML,'getXML','data')},getVideo:function(a){return this.getItem(a,N.Cache.VIDEO,'getVideo')},getShader:function(a){return this.getItem(a,N.Cache.SHADER,'getShader','data')},getRenderTexture:function(a){return this.getItem(a,N.Cache.RENDER_TEXTURE,'getRenderTexture')},getData:function(a){return this.getItem(a,N.Cache.DATA,'getData')},getBaseTexture:function(a,b){if(b===undefined){b=N.Cache.IMAGE}return this.getItem(a,b,'getBaseTexture','base')},getFrame:function(a,b){if(b===undefined){b=N.Cache.IMAGE}return this.getItem(a,b,'getFrame','frame')},getFrameCount:function(a,b){var c=this.getFrameData(a,b);if(c){return c.total}else{return 0}},getFrameData:function(a,b){if(b===undefined){b=N.Cache.IMAGE}return this.getItem(a,b,'getFrameData','frameData')},hasFrameData:function(a,b){if(b===undefined){b=N.Cache.IMAGE}return(this.getItem(a,b,'','frameData')!==null)},updateFrameData:function(a,b,c){if(c===undefined){c=N.Cache.IMAGE}if(this._cacheMap[c][a]){this._cacheMap[c][a].frameData=b}},getFrameByIndex:function(a,b,c){var d=this.getFrameData(a,c);if(d){return d.getFrame(b)}else{return null}},getFrameByName:function(a,b,c){var d=this.getFrameData(a,c);if(d){return d.getFrameByName(b)}else{return null}},getURL:function(a){var a=this._resolveURL(a);if(a){return this._urlMap[a]}else{console.warn('Phaser.Cache.getUrl: Invalid url: "'+a+'" or Cache.autoResolveURL was false');return null}},getKeys:function(a){if(a===undefined){a=N.Cache.IMAGE}var b=[];if(this._cacheMap[a]){for(var c in this._cacheMap[a]){if(c!=='__default'&&c!=='__missing'){b.push(c)}}}return b},removeCanvas:function(a){delete this._cache.canvas[a]},removeImage:function(a,b){if(b===undefined){b=true}var c=this.getImage(a,true);if(b&&c.base){c.base.destroy()}delete this._cache.image[a]},removeSound:function(a){delete this._cache.sound[a]},removeText:function(a){delete this._cache.text[a]},removePhysics:function(a){delete this._cache.physics[a]},removeTilemap:function(a){delete this._cache.tilemap[a]},removeBinary:function(a){delete this._cache.binary[a]},removeBitmapData:function(a){delete this._cache.bitmapData[a]},removeBitmapFont:function(a){delete this._cache.bitmapFont[a]},removeJSON:function(a){delete this._cache.json[a]},removeXML:function(a){delete this._cache.xml[a]},removeVideo:function(a){delete this._cache.video[a]},removeShader:function(a){delete this._cache.shader[a]},removeRenderTexture:function(a){delete this._cache.renderTexture[a]},removeSpriteSheet:function(a){delete this._cache.spriteSheet[a]},removeTextureAtlas:function(a){delete this._cache.image[a]},removeData:function(a){delete this._cache.data[a]},clearGLTextures:function(){for(var a in this._cache.image){this._cache.image[a].base._glTextures=[]}},_resolveURL:function(a,b){if(!this.autoResolveURL){return null}this._urlResolver.src=this.game.load.baseURL+a;this._urlTemp=this._urlResolver.src;this._urlResolver.src='';if(b){this._urlMap[this._urlTemp]=b}return this._urlTemp},destroy:function(){for(var i=0;i<this._cacheMap.length;i++){var a=this._cacheMap[i];for(var b in a){if(b!=='__default'&&b!=='__missing'){this.destroyItem(a[b]);delete a[b]}}}this._urlMap=null;this._urlResolver=null;this._urlTemp=null},destroyItem:function(a){if(a.destroy){a.destroy()}else{if(a.base&&a.base.destroy){a.base.destroy()}if(a.data&&a.data.destroy){a.data.destroy()}if(a.frameData&&a.frameData.destroy){a.frameData.destroy()}if(a.texture&&a.texture.destroy){a.texture.destroy(true)}}},_addImages:function(){this._pendingCount=0;this.addDefaultImage();this.addMissingImage();var a=this;var b=N.Cache.READY_TIMEOUT;if(N.Cache.READY_TIMEOUT>0){setTimeout(function(){if(!a.isReady){console.warn('Phaser.Cache: Still waiting for images after %s ms.',b);a._ready()}},N.Cache.READY_TIMEOUT)}else{this._ready()}},_addPending:function(){this._pendingCount+=1},_removePending:function(){this._pendingCount-=1;this._checkReady()},_checkReady:function(){if(this.isReady){this._ready()}},_ready:function(){this._pendingCount=0;this.onReady.dispatch(this)}};N.Cache.prototype.constructor=N.Cache;Object.defineProperty(N.Cache.prototype,'isReady',{get:function(){return this._pendingCount<=0}});N.Loader=function(a){this.game=a;this.cache=a.cache;this.resetLocked=false;this.isLoading=false;this.hasLoaded=false;this.preloadSprite=null;this.crossOrigin=false;this.baseURL='';this.path='';this.headers={requestedWith:false,json:'application/json',xml:'application/xml'};this.onLoadStart=new N.Signal();this.onBeforeLoadComplete=new N.Signal();this.onLoadComplete=new N.Signal();this.onPackComplete=new N.Signal();this.onFileStart=new N.Signal();this.onFileComplete=new N.Signal();this.onFileError=new N.Signal();this.enableParallel=true;this.maxParallelDownloads=4;this._withSyncPointDepth=0;this._fileList=[];this._flightQueue=[];this._processingHead=0;this._fileLoadStarted=false;this._totalPackCount=0;this._totalFileCount=0;this._loadedPackCount=0;this._loadedFileCount=0};N.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;N.Loader.TEXTURE_ATLAS_JSON_HASH=1;N.Loader.TEXTURE_ATLAS_XML_STARLING=2;N.Loader.PHYSICS_LIME_CORONA_JSON=3;N.Loader.PHYSICS_PHASER_JSON=4;N.Loader.TEXTURE_ATLAS_JSON_PYXEL=5;N.Loader.mediaTypes={avif:'image/avif',bmp:'image/bmp',cur:'image/x-icon',gif:'image/gif',ico:'image/x-icon',jpg:'image/jpeg',jpeg:'image/jpeg',png:'image/png',svg:'image/svg+xml',tif:'image/tiff',tiff:'image/tiff',webp:'image/webp'};N.Loader.getMediaType=function(a){var b=a.match(/\.(\w+)$/);if(!b){return null}return N.Loader.mediaTypes[b[1]]||null};N.Loader._getSource=function(a){if(typeof a==='string'){return{url:a,type:N.Loader.getMediaType(a)}}return a};N.Loader.prototype={setPreloadSprite:function(a,b){b=b||0;this.preloadSprite={sprite:a,direction:b,width:a.width,height:a.height,rect:null};if(b===0){this.preloadSprite.rect=new N.Rectangle(0,0,1,a.height)}else{this.preloadSprite.rect=new N.Rectangle(0,0,a.width,1)}a.crop(this.preloadSprite.rect);a.visible=true},resize:function(){if(this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height){this.preloadSprite.rect.height=this.preloadSprite.sprite.height}},checkKeyExists:function(a,b){return this.getAssetIndex(a,b)>-1},getAssetIndex:function(a,b){var c=-1;for(var i=0;i<this._fileList.length;i++){var d=this._fileList[i];if(d.type===a&&d.key===b){c=i;if(!d.loaded&&!d.loading){break}}}return c},getAsset:function(a,b){var c=this.getAssetIndex(a,b);if(c>-1){return{index:c,file:this._fileList[c]}}return false},reset:function(a,b){if(b===undefined){b=false}if(this.resetLocked){return}if(a){this.preloadSprite=null}this.isLoading=false;this._processingHead=0;this._fileList.length=0;this._flightQueue.length=0;this._fileLoadStarted=false;this._totalFileCount=0;this._totalPackCount=0;this._loadedPackCount=0;this._loadedFileCount=0;if(b){this.onLoadStart.removeAll();this.onLoadComplete.removeAll();this.onPackComplete.removeAll();this.onFileStart.removeAll();this.onFileComplete.removeAll();this.onFileError.removeAll()}},addToFileList:function(a,b,c,d,e,f){if(e===undefined){e=false}if(b===undefined||b===''){console.warn('Phaser.Loader: Invalid or no key given of type '+a);return this}if(c===undefined||c===null){if(f){c=b+f}else{console.warn('Phaser.Loader: No URL given for file type: '+a+' key: '+b);return this}}var g={type:a,key:b,path:this.path,url:c,syncPoint:this._withSyncPointDepth>0,data:null,loading:false,loaded:false,error:false};if(d){for(var h in d){g[h]=d[h]}}var i=this.getAssetIndex(a,b);if(e&&i>-1){var j=this._fileList[i];if(!j.loading&&!j.loaded){this._fileList[i]=g}else{this._fileList.push(g);this._totalFileCount++}}else if(i===-1){this._fileList.push(g);this._totalFileCount++}return this},replaceInFileList:function(a,b,c,d){return this.addToFileList(a,b,c,d,true)},pack:function(a,b,c,d){if(b===undefined){b=null}if(c===undefined){c=null}if(d===undefined){d=null}if(!b&&!c){console.warn('Phaser.Loader.pack - Both url and data are null. One must be set.');return this}var e={type:'packfile',key:a,url:b,path:this.path,syncPoint:true,data:null,loading:false,loaded:false,error:false,callbackContext:d};if(c){if(typeof c==='string'){c=JSON.parse(c)}e.data=c||{};e.loaded=true}for(var i=0;i<this._fileList.length+1;i++){var f=this._fileList[i];if(!f||(!f.loaded&&!f.loading&&f.type!=='packfile')){this._fileList.splice(i,0,e);this._totalPackCount++;break}}return this},image:function(a,b,c){if(Array.isArray(b)){return this.imageset(a,b,c)}if(typeof b==='object'){return this.texture(a,b,c)}else{return this.addToFileList('image',a,b,undefined,c,'.png')}},imageset:function(a,b,c){var d=b[b.length-1];var e=(typeof d==='string')?d:d.url;return this.addToFileList('imageset',a,e,{sources:b},c)},imageFromBitmapData:function(a,b,c){return this.image(a,b.canvas.toDataURL('image/png'),c)},imageFromGrid:function(a,b,c,d,e,f){return this.imageFromBitmapData(a,this.game.create.grid(a,b,c,d,e,f,false))},imageFromTexture:function(a,b,c,d,e){return this.imageFromBitmapData(a,this.game.create.texture(a,b,c,d,e,false))},texture:function(a,b,c){if(this.game.renderType===N.WEBGL){var d=this.game.renderer.extensions.compression;var e;for(e in b){if(e.toUpperCase()in d){return this.addToFileList('texture',a,b[e],undefined,c,'.pvr')}}}if(b.truecolor){this.addToFileList('image',a,b.truecolor,undefined,c,'.png')}return this},images:function(a,b){if(Array.isArray(b)){for(var i=0;i<a.length;i++){this.image(a[i],b[i])}}else{for(var i=0;i<a.length;i++){this.image(a[i])}}return this},text:function(a,b,c){return this.addToFileList('text',a,b,undefined,c,'.txt')},json:function(a,b,c){return this.addToFileList('json',a,b,undefined,c,'.json')},shader:function(a,b,c){return this.addToFileList('shader',a,b,undefined,c,'.frag')},xml:function(a,b,c){return this.addToFileList('xml',a,b,undefined,c,'.xml')},script:function(a,b,c,d){if(c===undefined){c=false}if(c!==false&&d===undefined){d=this}return this.addToFileList('script',a,b,{syncPoint:true,callback:c,callbackContext:d},false,'.js')},binary:function(a,b,c,d){if(c===undefined){c=false}if(c!==false&&d===undefined){d=c}return this.addToFileList('binary',a,b,{callback:c,callbackContext:d},false,'.bin')},spritesheet:function(a,b,c,d,e,f,g,h){if(e===undefined){e=-1}if(f===undefined){f=0}if(g===undefined){g=0}if(h===undefined){h=0}return this.addToFileList('spritesheet',a,b,{frameWidth:c,frameHeight:d,frameMax:e,margin:f,spacing:g,skipFrames:h},false,'.png')},audio:function(a,b,c){if(this.game.sound.noAudio){return this}if(c===undefined){c=true}if(typeof b==='string'){b=[b]}return this.addToFileList('audio',a,b,{buffer:null,autoDecode:c})},audioSprite:function(a,b,c,d,e){if(this.game.sound.noAudio){return this}if(c===undefined){c=null}if(d===undefined){d=null}if(e===undefined){e=true}this.audio(a,b,e);if(c){this.json(a+'-audioatlas',c)}else if(d){if(typeof d==='string'){d=JSON.parse(d)}this.cache.addJSON(a+'-audioatlas','',d)}else{console.warn('Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object')}return this},audiosprite:function(a,b,c,d,e){return this.audioSprite(a,b,c,d,e)},video:function(a,b,c,d){if(c===undefined){if(this.game.device.firefox){c='loadeddata'}else{c='canplaythrough'}}if(d===undefined){d=false}if(typeof b==='string'){b=[b]}return this.addToFileList('video',a,b,{buffer:null,asBlob:d,loadEvent:c})},tilemap:function(a,b,c,d){if(b===undefined){b=null}if(c===undefined){c=null}if(d===undefined){d=N.Tilemap.CSV}if(!b&&!c){if(d===N.Tilemap.CSV){b=a+'.csv'}else{b=a+'.json'}}if(c){switch(d){case N.Tilemap.CSV:break;case N.Tilemap.TILED_JSON:if(typeof c==='string'){c=JSON.parse(c)}break}this.cache.addTilemap(a,null,c,d)}else{this.addToFileList('tilemap',a,b,{format:d})}return this},tilemapCSV:function(a,b,c){return this.tilemap(a,b,c,N.Tilemap.CSV)},tilemapTiledJSON:function(a,b,c){return this.tilemap(a,b,c,N.Tilemap.TILED_JSON)},physics:function(a,b,c,d){if(b===undefined){b=null}if(c===undefined){c=null}if(d===undefined){d=N.Physics.LIME_CORONA_JSON}if(!b&&!c){b=a+'.json'}if(c){if(typeof c==='string'){c=JSON.parse(c)}this.cache.addPhysicsData(a,null,c,d)}else{this.addToFileList('physics',a,b,{format:d})}return this},bitmapFont:function(a,b,c,d,f,g){if(b===undefined||b===null){b=a+'.png'}if(c===undefined){c=null}if(d===undefined){d=null}if(c===null&&d===null){c=a+'.xml'}if(f===undefined){f=0}if(g===undefined){g=0}if(c){this.addToFileList('bitmapfont',a,b,{atlasURL:c,xSpacing:f,ySpacing:g})}else{if(typeof d==='string'){var h,xml;try{h=JSON.parse(d)}catch(e){xml=this.parseXml(d)}if(!xml&&!h){throw new Error('Phaser.Loader. Invalid Bitmap Font atlas given');}this.addToFileList('bitmapfont',a,b,{atlasURL:null,atlasData:h||xml,atlasType:(h?'json':'xml'),xSpacing:f,ySpacing:g})}}return this},atlasJSONArray:function(a,b,c,d){return this.atlas(a,b,c,d,N.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(a,b,c,d){return this.atlas(a,b,c,d,N.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(a,b,c,d){if(c===undefined){c=null}if(d===undefined){d=null}if(!c&&!d){c=a+'.xml'}return this.atlas(a,b,c,d,N.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(a,b,c,d,e){if(b===undefined||b===null){b=a+'.png'}if(c===undefined){c=null}if(d===undefined){d=null}if(e===undefined){e=N.Loader.TEXTURE_ATLAS_JSON_ARRAY}if(!c&&!d){if(e===N.Loader.TEXTURE_ATLAS_XML_STARLING){c=a+'.xml'}else{c=a+'.json'}}if(c){this.addToFileList('textureatlas',a,b,{atlasURL:c,format:e})}else{switch(e){case N.Loader.TEXTURE_ATLAS_JSON_ARRAY:if(typeof d==='string'){d=JSON.parse(d)}break;case N.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof d==='string'){var f=this.parseXml(d);if(!f){throw new Error('Phaser.Loader. Invalid Texture Atlas XML given');}d=f}break}this.addToFileList('textureatlas',a,b,{atlasURL:null,atlasData:d,format:e})}return this},withSyncPoint:function(a,b){this._withSyncPointDepth++;try{a.call(b||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(a,b){var c=this.getAsset(a,b);if(c){c.file.syncPoint=true}return this},removeFile:function(a,b){var c=this.getAsset(a,b);if(c){if(!c.loaded&&!c.loading){this._fileList.splice(c.index,1)}}},removeAll:function(){this._fileList.length=0;this._flightQueue.length=0},start:function(){if(this.isLoading){return}this.hasLoaded=false;this.isLoading=true;this.updateProgress();this.processLoadQueue()},processLoadQueue:function(){if(!this.game.isBooted){return}if(!this.isLoading){console.warn('Phaser.Loader - active loading canceled / reset');this.finishedLoading(true);return}for(var i=0;i<this._flightQueue.length;i++){var a=this._flightQueue[i];if(a.loaded||a.error){this._flightQueue.splice(i,1);i--;a.loading=false;a.requestUrl=null;a.requestObject=null;if(a.error){this.onFileError.dispatch(a.key,a)}if(a.type!=='packfile'){this._loadedFileCount++;this.onFileComplete.dispatch(this.progress,a.key,!a.error,this._loadedFileCount,this._totalFileCount)}else if(a.type==='packfile'&&a.error){this._loadedPackCount++;this.onPackComplete.dispatch(a.key,!a.error,this._loadedPackCount,this._totalPackCount)}}}var b=false;var c=this.enableParallel?Math.max(1,this.maxParallelDownloads):1;for(var i=this._processingHead;i<this._fileList.length;i++){var a=this._fileList[i];if(a.type==='packfile'&&!a.error&&a.loaded&&i===this._processingHead){this.processPack(a);this._loadedPackCount++;this.onPackComplete.dispatch(a.key,!a.error,this._loadedPackCount,this._totalPackCount)}if(a.loaded||a.error){if(i===this._processingHead){this._processingHead=i+1}}else if(!a.loading&&this._flightQueue.length<c){if(a.type==='packfile'&&!a.data){this._flightQueue.push(a);a.loading=true;this.loadFile(a)}else if(!b){if(!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this._flightQueue.push(a);a.loading=true;this.onFileStart.dispatch(this.progress,a.key,a.url);this.loadFile(a)}}if(!a.loaded&&a.syncPoint){b=true}if(this._flightQueue.length>=c||(b&&this._loadedPackCount===this._totalPackCount)){break}}this.updateProgress();if(this._processingHead>=this._fileList.length){this.finishedLoading()}else if(!this._flightQueue.length){console.warn('Phaser.Loader - aborting: processing queue empty, loading may have stalled');var d=this;setTimeout(function(){d.finishedLoading(true)},2000)}},finishedLoading:function(a){if(this.hasLoaded||!this.game.state){return}this.hasLoaded=true;this.isLoading=false;if(!a&&!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this.game.state.loadUpdate();this.onBeforeLoadComplete.dispatch();this.reset();this.onLoadComplete.dispatch();this.game.state.loadComplete()},asyncComplete:function(a,b){if(b===undefined){b=''}a.loaded=true;a.error=!!b;if(b){a.errorMessage=b;console.warn('Phaser.Loader - '+a.type+'['+a.key+']'+': '+b)}this.processLoadQueue()},processPack:function(a){var b=a.data[a.key];if(!b){console.warn('Phaser.Loader - '+a.key+': pack has data, but not for pack key');return}for(var i=0;i<b.length;i++){var c=b[i];switch(c.type){case'image':this.image(c.key,c.url,c.overwrite);break;case'text':this.text(c.key,c.url,c.overwrite);break;case'json':this.json(c.key,c.url,c.overwrite);break;case'xml':this.xml(c.key,c.url,c.overwrite);break;case'script':this.script(c.key,c.url,c.callback,a.callbackContext||this);break;case'binary':this.binary(c.key,c.url,c.callback,a.callbackContext||this);break;case'spritesheet':this.spritesheet(c.key,c.url,c.frameWidth,c.frameHeight,c.frameMax,c.margin,c.spacing,c.skipFrames);break;case'video':this.video(c.key,c.urls);break;case'audio':this.audio(c.key,c.urls,c.autoDecode);break;case'audiosprite':this.audiosprite(c.key,c.urls,c.jsonURL,c.jsonData,c.autoDecode);break;case'tilemap':this.tilemap(c.key,c.url,c.data,N.Tilemap[c.format]);break;case'physics':this.physics(c.key,c.url,c.data,N.Loader[c.format]);break;case'bitmapFont':this.bitmapFont(c.key,c.textureURL,c.atlasURL,c.atlasData,c.xSpacing,c.ySpacing);break;case'atlasJSONArray':this.atlasJSONArray(c.key,c.textureURL,c.atlasURL,c.atlasData);break;case'atlasJSONHash':this.atlasJSONHash(c.key,c.textureURL,c.atlasURL,c.atlasData);break;case'atlasXML':this.atlasXML(c.key,c.textureURL,c.atlasURL,c.atlasData);break;case'atlas':this.atlas(c.key,c.textureURL,c.atlasURL,c.atlasData,N.Loader[c.format]);break;case'shader':this.shader(c.key,c.url,c.overwrite);break}}},transformUrl:function(a,b){if(!a){return false}if(a.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)){return a}else{return this.baseURL+b.path+a}},loadFile:function(a){switch(a.type){case'packfile':this.xhrLoad(a,this.transformUrl(a.url,a),'text',this.fileComplete);break;case'image':case'spritesheet':case'textureatlas':case'bitmapfont':this.loadImageTag(a);break;case'imageset':this.loadPictureTag(a);break;case'audio':a.url=this.getAudioURL(a.url);if(a.url){if(this.game.sound.usingWebAudio){this.xhrLoad(a,this.transformUrl(a.url,a),'arraybuffer',this.fileComplete)}else if(this.game.sound.usingAudioTag){this.loadAudioTag(a)}}else{this.fileError(a,null,'No supported audio URL specified or device does not have audio playback support')}break;case'video':a.url=this.getVideoURL(a.url);if(a.url){if(a.asBlob){this.xhrLoad(a,this.transformUrl(a.url,a),'blob',this.fileComplete)}else{this.loadVideoTag(a)}}else{this.fileError(a,null,'No supported video URL specified or device does not have video playback support')}break;case'json':this.xhrLoad(a,this.transformUrl(a.url,a),'text',this.jsonLoadComplete);break;case'xml':this.xhrLoad(a,this.transformUrl(a.url,a),'text',this.xmlLoadComplete);break;case'tilemap':if(a.format===N.Tilemap.TILED_JSON){this.xhrLoad(a,this.transformUrl(a.url,a),'text',this.jsonLoadComplete)}else if(a.format===N.Tilemap.CSV){this.xhrLoad(a,this.transformUrl(a.url,a),'text',this.csvLoadComplete)}else{this.asyncComplete(a,'invalid Tilemap format: '+a.format)}break;case'text':case'script':case'shader':case'physics':this.xhrLoad(a,this.transformUrl(a.url,a),'text',this.fileComplete);break;case'texture':if(a.key.split('_').pop()==='truecolor'){this.loadImageTag(a)}else{this.xhrLoad(a,this.transformUrl(a.url,a),'arraybuffer',this.fileComplete)}break;case'binary':this.xhrLoad(a,this.transformUrl(a.url,a),'arraybuffer',this.fileComplete);break}},loadImageTag:function(a){var b=this;a.data=new Image();a.data.name=a.key;if(this.crossOrigin){a.data.crossOrigin=this.crossOrigin}a.data.onload=function(){if(a.data.onload){a.data.onload=null;a.data.onerror=null;b.fileComplete(a)}};a.data.onerror=function(){if(a.data.onload){a.data.onload=null;a.data.onerror=null;b.fileError(a)}};a.data.src=this.transformUrl(a.url,a);if(a.data.complete&&a.data.width&&a.data.height){a.data.onload=null;a.data.onerror=null;this.fileComplete(a)}},loadPictureTag:function(a){var b=this;var c=document.createElement('picture');var d=a.sources;var e=N.Loader._getSource(d.pop());for(var i=0,len=d.length;i<len;i++){var f=N.Loader._getSource(d[i]);if(!f.type||!f.url){console.warn('Skipping an invalid source for image "%s" (url: "%s", type: "%s")',a.key,f.url,f.type)}var g=document.createElement('source');g.setAttribute('type',f.type);g.setAttribute('srcset',this.transformUrl(f.url,a));c.appendChild(g)}a.data=document.createElement('img');a.data.name=a.key;if(this.crossOrigin){a.data.crossOrigin=this.crossOrigin}a.data.onload=function(){if(a.data.onload){a.data.onload=null;a.data.onerror=null;a.url=a.data.currentSrc;b.fileComplete(a)}};a.data.onerror=function(){if(a.data.onload){a.data.onload=null;a.data.onerror=null;a.url=a.data.currentSrc;b.fileError(a)}};c.appendChild(a.data);a.data.src=this.transformUrl(e.url,a);if(a.data.complete&&a.data.width&&a.data.height){a.data.onload=null;a.data.onerror=null;this.fileComplete(a)}},loadVideoTag:function(a){var b=this;a.data=document.createElement('video');a.data.name=a.key;a.data.crossOrigin=this.crossOrigin;a.data.controls=false;a.data.autoplay=false;a.data.playsInline=true;var c=function(){a.data.removeEventListener(a.loadEvent,c,false);a.data.onerror=null;a.data.canplay=true;N.GAMES[b.game.id].load.fileComplete(a)};a.data.onerror=function(){a.data.removeEventListener(a.loadEvent,c,false);a.data.onerror=null;a.data.canplay=false;b.fileError(a)};a.data.addEventListener(a.loadEvent,c,false);a.data.src=this.transformUrl(a.url,a);a.data.load()},loadAudioTag:function(a){var b=this;if(this.game.sound.touchLocked){a.data=new Audio();a.data.name=a.key;a.data.preload='auto';a.data.src=this.transformUrl(a.url,a);this.fileComplete(a)}else{a.data=new Audio();a.data.name=a.key;var c=function(){a.data.removeEventListener('canplaythrough',c,false);a.data.onerror=null;b.fileComplete(a)};a.data.onerror=function(){a.data.removeEventListener('canplaythrough',c,false);a.data.onerror=null;b.fileError(a)};a.data.preload='auto';a.data.src=this.transformUrl(a.url,a);a.data.addEventListener('canplaythrough',c,false);a.data.load()}},xhrLoad:function(a,b,c,d,f){var g=new XMLHttpRequest();g.open('GET',b,true);g.responseType=c;if(this.headers.requestedWith!==false){g.setRequestHeader('X-Requested-With',this.headers.requestedWith)}if(this.headers[a.type]){g.setRequestHeader('Accept',this.headers[a.type])}f=f||this.fileError;var h=this;g.onload=function(){try{if(g.readyState===4&&g.status>=400&&g.status<=599){return f.call(h,a,g)}else{return d.call(h,a,g)}}catch(e){if(!h.hasLoaded){h.asyncComplete(a,e.message||'Exception')}else{console.error(e)}}};g.onerror=function(){try{return f.call(h,a,g)}catch(e){if(!h.hasLoaded){h.asyncComplete(a,e.message||'Exception')}else{console.error(e)}}};a.requestObject=g;a.requestUrl=b;g.send()},getVideoURL:function(a){for(var i=0;i<a.length;i++){var b=a[i];var c;if(b.uri){c=b.type;b=b.uri;if(this.game.device.canPlayVideo(c)){return b}}else{if(b.indexOf('blob:')===0||b.indexOf('data:')===0){return b}if(b.indexOf('?')>=0){b=b.substr(0,b.indexOf('?'))}var d=b.substr((Math.max(0,b.lastIndexOf('.'))||Infinity)+1);c=d.toLowerCase();if(this.game.device.canPlayVideo(c)){return a[i]}}}return null},getAudioURL:function(a){if(this.game.sound.noAudio){return null}for(var i=0;i<a.length;i++){var b=a[i];var c;if(b.uri){c=b.type;b=b.uri;if(this.game.device.canPlayAudio(c)){return b}}else{if(b.indexOf('blob:')===0||b.indexOf('data:')===0){return b}if(b.indexOf('?')>=0){b=b.substr(0,b.indexOf('?'))}var d=b.substr((Math.max(0,b.lastIndexOf('.'))||Infinity)+1);c=d.toLowerCase();if(this.game.device.canPlayAudio(c)){return a[i]}}}return null},fileError:function(a,b,c){var d=a.requestUrl||this.transformUrl(a.url,a);var e='error loading asset from URL '+d;if(!c&&b){c=b.status}if(c){e=e+' ('+c+')'}this.asyncComplete(a,e)},fileComplete:function(d,f){if(!this.game.isBooted){return}var g=true;switch(d.type){case'packfile':var h=JSON.parse(f.responseText);d.data=h||{};break;case'texture':var i=(/\.([^.]+)$/).exec(d.url.split('?',1)[0])[1].toLowerCase();if(d.data!==null){this.cache.addCompressedTextureMetaData(d.key,d.url,i,d.data)}else{this.cache.addCompressedTextureMetaData(d.key,d.url,i,f.response)}break;case'image':case'imageset':this.cache.addImage(d.key,d.url,d.data);break;case'spritesheet':this.cache.addSpriteSheet(d.key,d.url,d.data,d.frameWidth,d.frameHeight,d.frameMax,d.margin,d.spacing,d.skipFrames);break;case'textureatlas':if(d.atlasURL==null){this.cache.addTextureAtlas(d.key,d.url,d.data,d.atlasData,d.format)}else{g=false;if(d.format===N.Loader.TEXTURE_ATLAS_JSON_ARRAY||d.format===N.Loader.TEXTURE_ATLAS_JSON_HASH||d.format===N.Loader.TEXTURE_ATLAS_JSON_PYXEL){this.xhrLoad(d,this.transformUrl(d.atlasURL,d),'text',this.jsonLoadComplete)}else if(d.format===N.Loader.TEXTURE_ATLAS_XML_STARLING){this.xhrLoad(d,this.transformUrl(d.atlasURL,d),'text',this.xmlLoadComplete)}else{throw new Error('Phaser.Loader. Invalid Texture Atlas format: '+d.format);}}break;case'bitmapfont':if(!d.atlasURL){this.cache.addBitmapFont(d.key,d.url,d.data,d.atlasData,d.atlasType,d.xSpacing,d.ySpacing)}else{g=false;this.xhrLoad(d,this.transformUrl(d.atlasURL,d),'text',function(a,b){var c;try{c=JSON.parse(b.responseText)}catch(e){}if(c){a.atlasType='json';this.jsonLoadComplete(a,b)}else{a.atlasType='xml';this.xmlLoadComplete(a,b)}})}break;case'video':if(d.asBlob){try{d.data=f.response}catch(e){throw new Error('Phaser.Loader. Unable to parse video file as Blob: '+d.key);}}this.cache.addVideo(d.key,d.url,d.data,d.asBlob);break;case'audio':if(this.game.sound.usingWebAudio){d.data=f.response;this.cache.addSound(d.key,d.url,d.data,true,false);if(d.autoDecode){this.game.sound.decode(d.key)}}else{this.cache.addSound(d.key,d.url,d.data,false,true)}break;case'text':d.data=f.responseText;this.cache.addText(d.key,d.url,d.data);break;case'shader':d.data=f.responseText;this.cache.addShader(d.key,d.url,d.data);break;case'physics':var h=JSON.parse(f.responseText);this.cache.addPhysicsData(d.key,d.url,h,d.format);break;case'script':d.data=document.createElement('script');d.data.language='javascript';d.data.type='text/javascript';d.data.defer=false;d.data.text=f.responseText;document.head.appendChild(d.data);if(d.callback){d.data=d.callback.call(d.callbackContext,d.key,f.responseText)}break;case'binary':if(d.callback){d.data=d.callback.call(d.callbackContext,d.key,f.response)}else{d.data=f.response}this.cache.addBinary(d.key,d.data);break}if(g){this.asyncComplete(d)}},jsonLoadComplete:function(a,b){var c=JSON.parse(b.responseText);if(a.type==='tilemap'){this.cache.addTilemap(a.key,a.url,c,a.format)}else if(a.type==='bitmapfont'){this.cache.addBitmapFont(a.key,a.url,a.data,c,a.atlasType,a.xSpacing,a.ySpacing)}else if(a.type==='json'){this.cache.addJSON(a.key,a.url,c)}else{this.cache.addTextureAtlas(a.key,a.url,a.data,c,a.format)}this.asyncComplete(a)},csvLoadComplete:function(a,b){var c=b.responseText;this.cache.addTilemap(a.key,a.url,c,a.format);this.asyncComplete(a)},xmlLoadComplete:function(a,b){var c=b.responseText;var d=this.parseXml(c);if(!d){var e=b.responseType||b.contentType;console.warn('Phaser.Loader - '+a.key+': invalid XML ('+e+')');this.asyncComplete(a,'invalid XML');return}if(a.type==='bitmapfont'){this.cache.addBitmapFont(a.key,a.url,a.data,d,a.atlasType,a.xSpacing,a.ySpacing)}else if(a.type==='textureatlas'){this.cache.addTextureAtlas(a.key,a.url,a.data,d,a.format)}else if(a.type==='xml'){this.cache.addXML(a.key,a.url,d)}this.asyncComplete(a)},parseXml:function(a){var b;try{if(window.DOMParser){var c=new DOMParser();b=c.parseFromString(a,'text/xml')}else{b=new ActiveXObject('Microsoft.XMLDOM');b.async='false';b.loadXML(a)}}catch(e){b=null}if(!b||!b.documentElement||b.getElementsByTagName('parsererror').length){return null}else{return b}},updateProgress:function(){if(this.preloadSprite){if(this.preloadSprite.direction===0){this.preloadSprite.rect.width=Math.floor((this.preloadSprite.width/100)*this.progress)}else{this.preloadSprite.rect.height=Math.floor((this.preloadSprite.height/100)*this.progress)}if(this.preloadSprite.sprite){this.preloadSprite.sprite.updateCrop()}else{this.preloadSprite=null}}},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}};Object.defineProperty(N.Loader.prototype,'progressFloat',{get:function(){var a=(this._loadedFileCount/this._totalFileCount)*100;return N.Math.clamp(a||0,0,100)}});Object.defineProperty(N.Loader.prototype,'progress',{get:function(){return Math.round(this.progressFloat)}});N.Loader.prototype.constructor=N.Loader;N.LoaderParser={bitmapFont:function(a,b,c,d,e,f){return this.xmlBitmapFont(a,b,c,d,e,f)},xmlBitmapFont:function(a,b,c,d,e,f){if(f==null){f=1}var g={};var h=a.getElementsByTagName('info')[0];var j=a.getElementsByTagName('common')[0];g.font=h.getAttribute('face');g.size=parseInt(h.getAttribute('size'),10);g.lineHeight=parseInt(j.getAttribute('lineHeight'),10)+d;g.chars={};var k=a.getElementsByTagName('char');var x=(e)?e.x:0;var y=(e)?e.y:0;for(var i=0;i<k.length;i++){var l=parseInt(k[i].getAttribute('id'),10);var m=g.chars[l]={x:parseInt(k[i].getAttribute('x'),10),y:parseInt(k[i].getAttribute('y'),10),width:parseInt(k[i].getAttribute('width'),10),height:parseInt(k[i].getAttribute('height'),10),xOffset:parseInt(k[i].getAttribute('xoffset'),10)/f,yOffset:parseInt(k[i].getAttribute('yoffset'),10)/f,xAdvance:(parseInt(k[i].getAttribute('xadvance'),10)+c)/f,kerning:{}};if(e&&e.trimmed){if(m.x+m.width>e.spriteSourceSizeX+e.spriteSourceSizeW){m.width-=m.x+m.width-e.spriteSourceSizeX-e.spriteSourceSizeW}if(m.y+m.height>e.spriteSourceSizeY+e.spriteSourceSizeH){m.height-=m.y+m.height-e.spriteSourceSizeY-e.spriteSourceSizeH}if(m.x<e.spriteSourceSizeX){var n=e.spriteSourceSizeX-m.x;m.x=0;m.width-=n;m.xOffset+=n}if(m.y<e.spriteSourceSizeY){var n=e.spriteSourceSizeY-m.y;m.y=0;m.height-=n;m.yOffset+=n}}m.x+=x;m.y+=y}var o=a.getElementsByTagName('kerning');for(i=0;i<o.length;i++){var p=parseInt(o[i].getAttribute('first'),10);var q=parseInt(o[i].getAttribute('second'),10);var r=parseInt(o[i].getAttribute('amount'),10)/f;if(g.chars[q]){g.chars[q].kerning[p]=r}}return this.finalizeBitmapFont(b,g)},jsonBitmapFont:function(e,f,g,h,i,j){if(j==null){j=1}var k={font:e.font.info._face,size:parseInt(e.font.info._size,10),lineHeight:parseInt(e.font.common._lineHeight,10)+h,chars:{}};var x=(i)?i.x:0;var y=(i)?i.y:0;e.font.chars.char.forEach(function parseChar(a){var b=parseInt(a._id,10);var c=k.chars[b]={x:parseInt(a._x,10),y:parseInt(a._y,10),width:parseInt(a._width,10),height:parseInt(a._height,10),xOffset:parseInt(a._xoffset,10)/j,yOffset:parseInt(a._yoffset,10)/j,xAdvance:(parseInt(a._xadvance,10)+g)/j,kerning:{}};if(i&&i.trimmed){if(c.x+c.width>i.spriteSourceSizeX+i.spriteSourceSizeW){c.width-=c.x+c.width-i.spriteSourceSizeX-i.spriteSourceSizeW}if(c.y+c.height>i.spriteSourceSizeY+i.spriteSourceSizeH){c.height-=c.y+c.height-i.spriteSourceSizeY-i.spriteSourceSizeH}if(c.x<i.spriteSourceSizeX){var d=i.spriteSourceSizeX-c.x;c.x=0;c.width-=d;c.xOffset+=d}if(c.y<i.spriteSourceSizeY){var d=i.spriteSourceSizeY-c.y;c.y=0;c.height-=d;c.yOffset+=d}}c.x+=x;c.y+=y});if(e.font.kernings&&e.font.kernings.kerning){e.font.kernings.kerning.forEach(function parseKerning(a){if(k.chars[a._second]){k.chars[a._second].kerning[a._first]=parseInt(a._amount,10)/j}})}return this.finalizeBitmapFont(f,k)},finalizeBitmapFont:function(c,d){Object.keys(d.chars).forEach(function addTexture(a){var b=d.chars[a];b.texture=new PIXI.Texture(c,new N.Rectangle(b.x,b.y,b.width,b.height))});return d},pvr:function(a){var b=new Uint32Array(a.slice(0,52)),byteArray=new Uint8Array(a),pvrHeader=null,pixelFormat=(b[3]<<32|b[2]),compressionAlgorithm,glExtensionFormat=0;if(b[0]===0x03525650&&[0,1,2,3,6,7,9,11].indexOf(pixelFormat)>=0){if(pixelFormat>=0&&pixelFormat<=3){compressionAlgorithm='PVRTC'}else if(pixelFormat>=7&&pixelFormat<=11){compressionAlgorithm='S3TC'}else if(pixelFormat===6){compressionAlgorithm='ETC1'}switch(pixelFormat){case 0:glExtensionFormat=0x8C01;break;case 1:glExtensionFormat=0x8C03;break;case 2:glExtensionFormat=0x8C00;break;case 3:glExtensionFormat=0x8C02;break;case 6:glExtensionFormat=0x8D64;break;case 7:glExtensionFormat=0x83F1;break;case 9:glExtensionFormat=0x83F2;break;case 11:glExtensionFormat=0x83F3;break;default:glExtensionFormat=-1}pvrHeader={complete:true,fileFormat:'PVR',compressionAlgorithm:compressionAlgorithm,flags:b[1],pixelFormat:pixelFormat,colorSpace:b[4],channelType:b[5],height:b[6],width:b[7],depth:b[8],numberOfSurfaces:b[9],numberOfFaces:b[10],numberOfMipmaps:b[11],metaDataSize:b[12],textureData:byteArray.subarray(52+b[12],byteArray.byteLength),glExtensionFormat:glExtensionFormat}}return pvrHeader},dds:function(a){var b=new Uint8Array(a),uintArray=new Uint32Array(a),ddsHeader=null;if(b[0]===0x44&&b[1]===0x44&&b[2]===0x53&&b[3]===0x20){ddsHeader={complete:true,fileFormat:'DDS',compressionAlgorithm:'S3TC',size:uintArray[1],flags:uintArray[2],height:uintArray[3],width:uintArray[4],pitch:uintArray[5],depth:uintArray[6],mipmapCount:uintArray[7],formatSize:uintArray[19],formatFlag:uintArray[19],formatFourCC:[String.fromCharCode(b[84]),String.fromCharCode(b[85]),String.fromCharCode(b[86]),String.fromCharCode(b[87])].join(''),formatBitCount:uintArray[21],formatRBitMask:uintArray[22],formatGBitMask:uintArray[23],formatBBitMask:uintArray[24],formatABitMask:uintArray[25],caps1:uintArray[26],caps2:uintArray[27],caps3:uintArray[28],caps4:uintArray[29],reserved2:uintArray[30],DXGIFormat:null,resourceDimension:null,miscFlag:null,arraySize:null,textureData:b.subarray(uintArray[1]+4,b.byteLength)};if(ddsHeader.formatFourCC==='DX10'){ddsHeader.DXGIFormat=uintArray[31];ddsHeader.resourceDimension=uintArray[32];ddsHeader.miscFlag=uintArray[33];ddsHeader.arraySize=uintArray[34];ddsHeader.miscFlag=uintArray[35]}else if(ddsHeader.formatFourCC==='DXT5'){ddsHeader.glExtensionFormat=0x83F3}else if(ddsHeader.formatFourCC==='DXT3'){ddsHeader.glExtensionFormat=0x83F2}}return ddsHeader},ktx:function(a){var b=new Uint8Array(a),uintArray=new Uint32Array(a),ktxHeader=null,imageSizeOffset=16+(uintArray[15]/4)|0,imageSize=uintArray[imageSizeOffset],glInternalFormat=uintArray[7],compressionAlgorithm=0;if(b[0]===0xAB&&b[1]===0x4B&&b[2]===0x54&&b[3]===0x58&&b[4]===0x20&&b[5]===0x31&&b[6]===0x31&&b[7]===0xBB&&b[8]===0x0D&&b[9]===0x0A&&b[10]===0x1A&&b[11]===0x0A&&[0x8D64,0x8C00,0x8C01,0x8C02,0x8C03,0x83F0,0x83F1,0x83F2,0x83F3].indexOf(glInternalFormat)>=0){switch(glInternalFormat){case 0x8D64:compressionAlgorithm='ETC1';break;case 0x8C00:case 0x8C01:case 0x8C02:case 0x8C03:compressionAlgorithm='PVRTC';break;case 0x83F0:case 0x83F1:case 0x83F2:case 0x83F3:compressionAlgorithm='S3TC';break}ktxHeader={complete:true,fileFormat:'KTX',compressionAlgorithm:compressionAlgorithm,endianness:uintArray[3],glType:uintArray[4],glTypeSize:uintArray[5],glFormat:uintArray[6],glInternalFormat:uintArray[7],glBaseInternalFormat:uintArray[8],width:uintArray[9],height:uintArray[10],pixelDepth:uintArray[11],numberOfArrayElements:uintArray[12],numberOfFaces:uintArray[13],numberOfMipmapLevels:uintArray[14],bytesOfKeyValueData:uintArray[15],keyAndValueByteSize:uintArray[16],imageSize:imageSize,textureData:b.subarray((imageSizeOffset+1)*4,imageSize+100)}}return ktxHeader},pkm:function(a){var b=new Uint8Array(a),pkmHeader=null;if(b[0]===0x50&&b[1]===0x4B&&b[2]===0x4D&&b[3]===0x20){pkmHeader={complete:true,fileFormat:'PKM',compressionAlgorithm:'ETC1',format:((b[6]<<8|b[7]))&0xFFFF,width:((b[8]<<8|b[9]))&0xFFFF,height:((b[10]<<8|b[11]))&0xFFFF,originalWidth:((b[12]<<8|b[13]))&0xFFFF,originalHeight:((b[14]<<8|b[15]))&0xFFFF,textureData:b.subarray(16,b.length)}}return pkmHeader}};N.AudioSprite=function(a,b){this.game=a;this.key=b;this.config=this.game.cache.getJSON(b+'-audioatlas');this.autoplayKey=null;this.autoplay=false;this.sounds={};for(var k in this.config.spritemap){var c=this.config.spritemap[k];var d=this.game.add.sound(this.key);d.addMarker(k,c.start,(c.end-c.start),null,c.loop);this.sounds[k]=d}if(this.config.autoplay){this.autoplayKey=this.config.autoplay;this.play(this.autoplayKey);this.autoplay=this.sounds[this.autoplayKey]}};N.AudioSprite.prototype={play:function(a,b){if(b===undefined){b=1}return this.sounds[a].play(a,null,b)},stop:function(a){if(!a){for(var b in this.sounds){this.sounds[b].stop()}}else{this.sounds[a].stop()}},get:function(a){return this.sounds[a]}};N.AudioSprite.prototype.constructor=N.AudioSprite;N.Sound=function(a,b,c,d,e){if(c===undefined){c=1}if(d===undefined){d=false}if(e===undefined){e=a.sound.connectToMaster}this.game=a;this.name=b;this.key=b;this.loop=d;this.markers={};this.context=null;this.autoplay=false;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.durationMS=0;this.position=0;this.stopTime=0;this.paused=false;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=false;this.currentMarker='';this.fadeTween=null;this.pendingPlayback=false;this.override=false;this.allowMultiple=false;this.playOnce=false;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;this.masterGainNode=null;this.gainNode=null;this._sound=null;this._globalVolume=1;this._markedToDelete=false;this._pendingStart=false;this._removeFromSoundManager=false;this._sourceId=0;if(this.usingWebAudio){this.context=this.game.sound.context;this.masterGainNode=this.game.sound.masterGain;if(this.context.createGain===undefined){this.gainNode=this.context.createGainNode()}else{this.gainNode=this.context.createGain()}this.gainNode.gain.value=c;if(e){this.gainNode.connect(this.masterGainNode)}}else if(this.usingAudioTag){if(this.game.cache.getSound(b)&&this.game.cache.isSoundReady(b)){this._sound=this.game.cache.getSoundData(b);this.totalDuration=0;if(this._sound.duration){this.totalDuration=this._sound.duration}}else{this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)}}this.onDecoded=new N.Signal();this.onPlay=new N.Signal();this.onPause=new N.Signal();this.onResume=new N.Signal();this.onLoop=new N.Signal();this.onStop=new N.Signal();this.onMute=new N.Signal();this.onMarkerComplete=new N.Signal();this.onFadeComplete=new N.Signal();this._volume=c;this._buffer=null;this._muted=false;this._tempMarker=0;this._tempPosition=0;this._tempVolume=0;this._tempPause=0;this._muteVolume=0;this._tempLoop=0;this._paused=false;this._onDecodedEventDispatched=false};N.Sound.prototype={soundHasUnlocked:function(a){if(a===this.key){this._sound=this.game.cache.getSoundData(this.key);this.totalDuration=this._sound.duration}},addMarker:function(a,b,c,d,e){if(c===undefined||c===null){c=1}if(d===undefined||d===null){d=1}if(e===undefined){e=false}this.markers[a]={name:a,start:b,stop:b+c,volume:d,duration:c,durationMS:c*1000,loop:e}},removeMarker:function(a){delete this.markers[a]},onEndedHandler:function(){if(!this._sound){return}this._removeOnEndedHandler();this.isPlaying=false;this.currentTime=this.durationMS;this.stop();if(this.playOnce){this._markedToDelete=true;this._removeFromSoundManager=true}if(this._markedToDelete){this._disconnectSource();if(this._removeFromSoundManager){this.game.sound.remove(this)}else{this.markers={};this.context=null;this._buffer=null;this.externalNode=null;this.onDecoded.dispose();this.onPlay.dispose();this.onPause.dispose();this.onResume.dispose();this.onLoop.dispose();this.onStop.dispose();this.onMute.dispose();this.onMarkerComplete.dispose()}}},update:function(){if(!this.game.cache.checkSoundKey(this.key)){this.destroy();return}if(this.isDecoded&&!this._onDecodedEventDispatched){this.onDecoded.dispatch(this);this._onDecodedEventDispatched=true}if(this.pendingPlayback&&this.game.cache.isSoundReady(this.key)){this.pendingPlayback=false;this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)}var a=this.game.time.time;if(this.isPlaying){if(this._pendingStart){var b=this._sound.currentTime;if(b>((this.paused?this._tempPause:0)||this.position||0)){this._pendingStart=false;this.startTime=a-(1000*b);this.stopTime=this.startTime+this.durationMS}else{return}}this.currentTime=a-this.startTime;if(this.currentTime>=this.durationMS){if(this.usingWebAudio){if(this.loop){this.onLoop.dispatch(this);this.isPlaying=false;if(this.currentMarker===''){this.currentTime=0;this.startTime=a;this.isPlaying=true}else{this.onMarkerComplete.dispatch(this.currentMarker,this);this.play(this.currentMarker,0,this.volume,true,true,false)}}else{if(this.currentMarker!==''){this.stop()}}}else if(this.loop){this.onLoop.dispatch(this);if(this.currentMarker===''){this.currentTime=0;this.startTime=a}this.isPlaying=false;this.play(this.currentMarker,0,this.volume,true,true,false)}else{this.stop()}}}},loopFull:function(a){return this.play(null,0,a,true)},play:function(a,b,c,d,e,f){if(a===undefined||a===false||a===null){a=''}if(e===undefined){e=true}if(f===undefined){f=true}if(this.isPlaying&&!this.allowMultiple&&!e&&!this.override){return this}if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||e)){if(this.usingWebAudio){this._stopSourceAndDisconnect()}else if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}this.isPlaying=false}if(a===''&&Object.keys(this.markers).length>0){return this}if(a!==''){if(this.markers[a]){this.currentMarker=a;this.position=this.markers[a].start;this.volume=this.markers[a].volume;this.loop=this.markers[a].loop;this.duration=this.markers[a].duration;this.durationMS=this.markers[a].durationMS;if(typeof c!=='undefined'){this.volume=c}if(typeof d!=='undefined'){this.loop=d}this._tempMarker=a;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else{console.warn('Phaser.Sound.play: audio marker '+a+' doesn\'t exist');return this}}else{b=b||0;if(c===undefined){c=this._volume}if(d===undefined){d=this.loop}this.position=Math.max(0,b);this.volume=c;this.loop=d;this.duration=0;this.durationMS=0;this._tempMarker=a;this._tempPosition=b;this._tempVolume=c;this._tempLoop=d}if(this.usingWebAudio){if(this.game.cache.isSoundDecoded(this.key)){this._createSourceAndConnect();if(this.loop&&a===''){this._sound.loop=true}if(!this.loop&&a===''){this._addOnEndedHandler()}this.totalDuration=this._sound.buffer.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=Math.ceil(this.totalDuration*1000)}if(this.loop&&a===''){this._startSource(0,0)}else{this._startSource(0,this.position,this.duration)}this.isPlaying=true;this.paused=false;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;if(f){this.onPlay.dispatch(this)}}else{this.pendingPlayback=true;if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===false){this.game.sound.decode(this.key,this)}}}else if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked){this.game.cache.reloadSound(this.key);this.pendingPlayback=true}else if(this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)){this._sound.play();this._sound.loop=this.loop;this.totalDuration=this._sound.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1000}this._globalVolume=this.game.sound.volume;this._sound.currentTime=this.position;this._sound.muted=this._muted;if(this._muted||this.game.sound.mute){this._sound.volume=0}else{this._sound.volume=this._volume*this._globalVolume}this._pendingStart=!this.currentMarker;this.isPlaying=true;this.paused=false;this._tempPause=0;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;if(f){this.onPlay.dispatch(this)}}else{this.pendingPlayback=true}if(this.playOnce){if(this.loop){console.warn('Phaser.Sound.play: audio clip '+this.name+' cannot be deleted while looping.')}this._markedToDelete=true;this._removeFromSoundManager=true}return this},restart:function(a,b,c,d){a=a||'';b=b||0;c=c||1;if(d===undefined){d=false}this.play(a,b,c,d,true)},pause:function(){if(this.isPlaying){this.paused=true;this.pausedPosition=this.currentTime;this.pausedTime=this.game.time.time;this._tempPause=this._sound.currentTime;this.onPause.dispatch(this);this.stop()}},resume:function(){if(this.paused){if(this.usingWebAudio){var p=Math.max(0,this.position+(this.pausedPosition/1000));this._createSourceAndConnect();if(this.currentMarker===''){if(this.loop){this._sound.loop=true}else{this._addOnEndedHandler()}}var a=this.duration-(this.pausedPosition/1000);if(this.loop&&this.currentMarker===''){this._startSource(0,p)}else{this._startSource(0,p,a)}}else{this._pendingStart=!this.currentMarker;this._sound.currentTime=this._tempPause;this._tempPause=0;this._sound.play()}this.isPlaying=true;this.paused=false;this.startTime+=(this.game.time.time-this.pausedTime);this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound){if(this.usingWebAudio){this._stopSourceAndDisconnect()}else if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}this.pendingPlayback=false;this.isPlaying=false;if(!this.paused){var a=this.currentMarker;if(this.currentMarker!==''){this.onMarkerComplete.dispatch(this.currentMarker,this)}this.currentMarker='';if(this.fadeTween!==null){this.fadeTween.stop()}this.onStop.dispatch(this,a)}},fadeIn:function(a,b,c){if(b===undefined){b=false}if(c===undefined){c=this.currentMarker}if(this.paused){return}this.play(c,0,0,b);this.fadeTo(a,1)},fadeOut:function(a){this.fadeTo(a,0)},fadeTo:function(a,b){if(!this.isPlaying||this.paused||b===this.volume){return}if(a===undefined){a=1000}if(b===undefined){console.warn('Phaser.Sound.fadeTo: No Volume Specified.');return}this.fadeTween=this.game.add.tween(this).to({volume:b},a,N.Easing.Linear.None,true);this.fadeTween.onComplete.add(this.fadeComplete,this)},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume);if(this.volume===0){this.stop()}},updateGlobalVolume:function(a){if(this.usingAudioTag&&this._sound){this._globalVolume=a;this._sound.volume=this._globalVolume*this._volume}},destroy:function(a){if(a===undefined){a=true}this._markedToDelete=true;this._removeFromSoundManager=a;this.stop();if(a){this.game.sound.remove(this)}else{this.markers={};this.context=null;this._buffer=null;this.externalNode=null;this.onDecoded.dispose();this.onPlay.dispose();this.onPause.dispose();this.onResume.dispose();this.onLoop.dispose();this.onStop.dispose();this.onMute.dispose();this.onMarkerComplete.dispose()}},_createSourceAndConnect:function(){this._sound=this.context.createBufferSource();this._sound.connect(this.externalNode||this.gainNode);this._buffer=this.game.cache.getSoundData(this.key);this._sound.buffer=this._buffer;this._sourceId++},_disconnectSource:function(){this._sound.disconnect(this.externalNode||this.gainNode)},_startSource:function(a,b,c){if(c===undefined){this._sound.start(a||0,b||0)}else{this._sound.start(a||0,b||0,c)}},_stopSourceAndDisconnect:function(){this._removeOnEndedHandler();try{this._sound.stop(0)}catch(e){}this._disconnectSource();this._sound=null},_addOnEndedHandler:function(){this._sound.onended=this.onEndedHandler.bind(this)},_removeOnEndedHandler:function(){this._sound.onended=null}};N.Sound.prototype.constructor=N.Sound;Object.defineProperty(N.Sound.prototype,'isDecoding',{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(N.Sound.prototype,'isDecoded',{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(N.Sound.prototype,'mute',{get:function(){return(this._muted||this.game.sound.mute)},set:function(a){a=a||false;if(a===this._muted){return}if(a){this._muted=true;this._muteVolume=this._tempVolume;if(this.usingWebAudio){this.gainNode.gain.value=0}else if(this.usingAudioTag&&this._sound){this._sound.volume=0}}else{this._muted=false;if(this.usingWebAudio){this.gainNode.gain.value=this._muteVolume}else if(this.usingAudioTag&&this._sound){this._sound.volume=this._muteVolume}}this.onMute.dispatch(this)}});Object.defineProperty(N.Sound.prototype,'volume',{get:function(){return this._volume},set:function(a){if(this.usingAudioTag){a=this.game.math.clamp(a,0,1)}if(this._muted){this._muteVolume=a;return}this._tempVolume=a;this._volume=a;if(this.usingWebAudio){this.gainNode.gain.value=a}else if(this.usingAudioTag&&this._sound){this._sound.volume=this._globalVolume*a}}});Object.defineProperty(N.Sound.prototype,'sourceId',{get:function(){return this._sound?this._sourceId:null}});N.SoundManager=function(a){this.game=a;this.onSoundDecode=new N.Signal();this.onVolumeChange=new N.Signal();this.onMute=new N.Signal();this.onUnMute=new N.Signal();this.onTouchUnlock=new N.Signal();this.onStateChange=new N.Signal();this.context=null;this.baseLatency=null;this.usingWebAudio=false;this.usingAudioTag=false;this.noAudio=false;this.connectToMaster=true;this.touchLocked=false;this.channels=32;this.muteOnPause=true;this._codeMuted=false;this._muted=false;this._unlockSource=null;this._volume=1;this._sounds=[];this._watchList=new N.ArraySet();this._watching=false;this._watchCallback=null;this._watchContext=null;this._onClick=this._onClick.bind(this);this._onStateChange=this._onStateChange.bind(this)};N.SoundManager.prototype={boot:function(){var a=this.game.device;var b=window.PhaserGlobal;if(a.iOS&&a.webAudio===false){this.channels=1}if(b){if(b.disableAudio===true){this.noAudio=true;this.touchLocked=false;return}if(b.disableWebAudio===true){this.usingAudioTag=true;this.touchLocked=false;return}}if(b&&b.audioContext){this.context=b.audioContext}else{var c=window.AudioContext||window.webkitAudioContext;if(c){try{this.context=new c()}catch(error){this.context=null;this.usingWebAudio=false;this.touchLocked=false;console.warn(error)}}}if(this.context===null){if(window.Audio===undefined){this.noAudio=true;return}else{this.usingAudioTag=true}}else{this.usingWebAudio=true;this.baseLatency=this.context.baseLatency||(256/(this.context.sampleRate||44100));if(this.context.createGain===undefined){this.masterGain=this.context.createGainNode()}else{this.masterGain=this.context.createGain()}this.masterGain.gain.value=1;this.masterGain.connect(this.context.destination);this.context.onstatechange=this._onStateChange;if(this.context.state==='suspended'){this.game.canvas.addEventListener('click',this._onClick)}}if(!this.noAudio){if(a.needsTouchUnlock()){this.setTouchLock()}}if(this.usingWebAudio&&a.chrome&&a.chromeVersion<=65){console.log('A "GainNode.gain.value setter smoothing is deprecated" notice in Chrome is normal. <https://github.com/photonstorm/phaser-ce/issues/385>')}},setTouchLock:function(){if(this.noAudio||(window.PhaserGlobal&&window.PhaserGlobal.disableAudio===true)){return}this.game.input.addTouchLockCallback(this.unlock,this,true);this.touchLocked=true},setTouchUnlock:function(){this.touchLocked=false;this._unlockSource=null;this.onTouchUnlock.dispatch()},webAudioIsSuspended:function(){return(this.usingWebAudio&&this.context.state==='suspended')},resumeWebAudio:function(){if(this.usingWebAudio){return this.context.resume()}},resumeWebAudioIfSuspended:function(){if(this.webAudioIsSuspended()){return this.context.resume()}},unlock:function(){if(this.noAudio||!this.touchLocked||this._unlockSource!==null){return true}if(this.usingAudioTag){this.setTouchUnlock()}else if(this.usingWebAudio){var a=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=a;this._unlockSource.connect(this.context.destination);var b=this;this._unlockSource.onended=function unlockSourceOnEndedHandler(){b.setTouchUnlock();b.resumeWebAudioIfSuspended()};if(this._unlockSource.start===undefined){this._unlockSource.noteOn(0)}else{this._unlockSource.start(0)}this.resumeWebAudioIfSuspended()}return true},stopAll:function(){if(this.noAudio){return}for(var i=0;i<this._sounds.length;i++){if(this._sounds[i]){this._sounds[i].stop()}}},pauseAll:function(){if(this.noAudio){return}for(var i=0;i<this._sounds.length;i++){if(this._sounds[i]){this._sounds[i].pause()}}},resumeAll:function(){if(this.noAudio){return}for(var i=0;i<this._sounds.length;i++){if(this._sounds[i]){this._sounds[i].resume()}}},decode:function(b,c){c=c||null;var d=this.game.cache.getSoundData(b);if(d){if(this.game.cache.isSoundDecoded(b)===false){this.game.cache.updateSound(b,'isDecoding',true);var f=this;try{this.context.decodeAudioData(d,function(a){if(!f.game.isBooted){return}if(a){f.game.cache.decodedSound(b,a);f.onSoundDecode.dispatch(b,c)}})}catch(e){}}}},setDecodedCallback:function(a,b,c){if(typeof a==='string'){a=[a]}this._watchList.reset();for(var i=0;i<a.length;i++){if(a[i]instanceof N.Sound){if(!this.game.cache.isSoundDecoded(a[i].key)){this._watchList.add(a[i].key)}}else if(!this.game.cache.isSoundDecoded(a[i])){this._watchList.add(a[i])}}if(this._watchList.total===0){this._watching=false;b.call(c)}else{this._watching=true;this._watchCallback=b;this._watchContext=c}},update:function(){if(this.noAudio){return}if(!this.webAudioIsSuspended()){for(var i=0;i<this._sounds.length;i++){this._sounds[i].update()}}if(this._watching){var a=this._watchList.first;while(a){if(this.game.cache.isSoundDecoded(a)){this._watchList.remove(a)}a=this._watchList.next}if(this._watchList.total===0){this._watching=false;this._watchCallback.call(this._watchContext)}}},add:function(a,b,c,d){if(b===undefined){b=1}if(c===undefined){c=false}if(d===undefined){d=this.connectToMaster}var e=new N.Sound(this.game,a,b,c,d);this._sounds.push(e);return e},addSprite:function(a){var b=new N.AudioSprite(this.game,a);return b},remove:function(a){var i=this._sounds.length;while(i--){if(this._sounds[i]===a){this._sounds[i].destroy(false);this._sounds.splice(i,1);return true}}return false},removeAll:function(){this.stopAll();for(var i=0;i<this._sounds.length;i++){if(this._sounds[i]){this._sounds[i].destroy()}}this._sounds.length=0},removeByKey:function(a){var i=this._sounds.length;var b=0;while(i--){if(this._sounds[i].key===a){this._sounds[i].destroy(false);this._sounds.splice(i,1);b++}}return b},play:function(a,b,c){if(this.noAudio){return}var d=this.add(a,b,c);d.play();return d},setMute:function(){if(this._muted){return}this._muted=true;if(this.usingWebAudio){this._muteVolume=this.masterGain.gain.value;this.masterGain.gain.value=0}for(var i=0;i<this._sounds.length;i++){if(this._sounds[i].usingAudioTag){this._sounds[i].mute=true}}this.onMute.dispatch()},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;if(this.usingWebAudio){this.masterGain.gain.value=this._muteVolume}for(var i=0;i<this._sounds.length;i++){if(this._sounds[i].usingAudioTag){this._sounds[i].mute=false}}this.onUnMute.dispatch()},gamePaused:function(){if(this.muteOnPause){this.setMute()}},gameResumed:function(){this.resumeWebAudio();if(this.muteOnPause){this.unsetMute()}},destroy:function(){this.removeAll();this.onMute.dispose();this.onSoundDecode.dispose();this.onStateChange.dispose();this.onTouchUnlock.dispose();this.onUnMute.dispose();this.onVolumeChange.dispose();this.game.canvas.removeEventListener('click',this._onClick);if(this.context){this.context.onstatechange=null;if(window.PhaserGlobal){window.PhaserGlobal.audioContext=this.context}else if(this.context.close){this.context.close()}this.context=null}},_onStateChange:function(){this.onStateChange.dispatch(this.context.state)},_onClick:function(){this.resumeWebAudioIfSuspended();this.game.canvas.removeEventListener('click',this._onClick)}};N.SoundManager.prototype.constructor=N.SoundManager;Object.defineProperty(N.SoundManager.prototype,'mute',{get:function(){return this._muted},set:function(a){a=a||false;if(a){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(N.SoundManager.prototype,'volume',{get:function(){return this._volume},set:function(a){if(a<0){a=0}else if(a>1){a=1}if(this._volume!==a){this._volume=a;if(this.usingWebAudio){this.masterGain.gain.value=a}else{for(var i=0;i<this._sounds.length;i++){if(this._sounds[i].usingAudioTag){this._sounds[i].updateGlobalVolume(a)}}}this.onVolumeChange.dispatch(a)}}});N.ScaleManager=function(a,b,c){this.game=a;this.dom=N.DOM;this.grid=null;this.width=0;this.height=0;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this.offset=new N.Point();this.forceLandscape=false;this.forcePortrait=false;this.incorrectOrientation=false;this._pageAlignHorizontally=false;this._pageAlignVertically=false;this.onOrientationChange=new N.Signal();this.enterIncorrectOrientation=new N.Signal();this.leaveIncorrectOrientation=new N.Signal();this.hasPhaserSetFullScreen=false;this.fullScreenTarget=null;this._createdFullScreenTarget=null;this.onFullScreenInit=new N.Signal();this.onFullScreenChange=new N.Signal();this.onFullScreenError=new N.Signal();this.screenOrientation=this.dom.getScreenOrientation();this.scaleFactor=new N.Point(1,1);this.scaleFactorInversed=new N.Point(1,1);this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0};this.bounds=new N.Rectangle();this.aspectRatio=0;this.sourceAspectRatio=0;this.event=null;this.windowConstraints={right:'layout',bottom:''};this.compatibility={supportsFullScreen:false,orientationFallback:null,noMargins:false,scrollTo:null,forceMinimumDocumentHeight:false,canExpandParent:true,clickTrampoline:''};this._scaleMode=N.ScaleManager.NO_SCALE;this._fullScreenScaleMode=N.ScaleManager.NO_SCALE;this.parentIsWindow=false;this.parentNode=null;this.parentScaleFactor=new N.Point(1,1);this.trackParentInterval=2000;this.onSizeChange=new N.Signal();this.onResize=null;this.onResizeContext=null;this._pendingScaleMode=null;this._fullScreenRestore=null;this._gameSize=new N.Rectangle();this._userScaleFactor=new N.Point(1,1);this._userScaleTrim=new N.Point(0,0);this._lastUpdate=0;this._updateThrottle=0;this._updateThrottleReset=100;this._parentBounds=new N.Rectangle();this._tempBounds=new N.Rectangle();this._lastReportedCanvasSize=new N.Rectangle();this._lastReportedGameSize=new N.Rectangle();this._booted=false;if(a.config){this.parseConfig(a.config)}this.setupScale(b,c)};N.ScaleManager.EXACT_FIT=0;N.ScaleManager.NO_SCALE=1;N.ScaleManager.SHOW_ALL=2;N.ScaleManager.RESIZE=3;N.ScaleManager.USER_SCALE=4;N.ScaleManager.MODES=['EXACT_FIT','NO_SCALE','SHOW_ALL','RESIZE','USER_SCALE'];N.ScaleManager.prototype={boot:function(){var b=this.compatibility;b.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS;if(!this.game.device.iPad&&!this.game.device.webApp&&!this.game.device.desktop){if(this.game.device.android&&!this.game.device.chrome){b.scrollTo=new N.Point(0,1)}else{b.scrollTo=new N.Point(0,0)}}if(this.game.device.desktop){b.orientationFallback='screen';b.clickTrampoline='when-not-mouse'}else{b.orientationFallback='';b.clickTrampoline=''}var c=this;this._orientationChange=function(a){return c.orientationChange(a)};this._windowResize=function(a){return c.windowResize(a)};window.addEventListener('orientationchange',this._orientationChange,false);window.addEventListener('resize',this._windowResize,false);if(this.compatibility.supportsFullScreen){this._fullScreenChange=function(a){return c.fullScreenChange(a)};this._fullScreenError=function(a){return c.fullScreenError(a)};document.addEventListener('webkitfullscreenchange',this._fullScreenChange,false);document.addEventListener('mozfullscreenchange',this._fullScreenChange,false);document.addEventListener('MSFullscreenChange',this._fullScreenChange,false);document.addEventListener('fullscreenchange',this._fullScreenChange,false);document.addEventListener('webkitfullscreenerror',this._fullScreenError,false);document.addEventListener('mozfullscreenerror',this._fullScreenError,false);document.addEventListener('MSFullscreenError',this._fullScreenError,false);document.addEventListener('fullscreenerror',this._fullScreenError,false)}this.game.onResume.add(this._gameResumed,this);this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.setGameSize(this.game.width,this.game.height);this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);if(N.FlexGrid){this.grid=new N.FlexGrid(this,this.width,this.height)}this._booted=true;if(this._pendingScaleMode!==null){this.scaleMode=this._pendingScaleMode;this._pendingScaleMode=null}},parseConfig:function(a){if(a.scaleMode!==undefined){if(this._booted){this.scaleMode=a.scaleMode}else{this._pendingScaleMode=a.scaleMode}}if(a.fullScreenScaleMode!==undefined){this.fullScreenScaleMode=a.fullScreenScaleMode}if(a.fullScreenTarget){this.fullScreenTarget=a.fullScreenTarget}this.pageAlignHorizontally=a.alignH||false;this.pageAlignVertically=a.alignV||false;if(a.scaleH&&a.scaleV){this.setUserScale(a.scaleH,a.scaleV,a.trimH,a.trimV)}},setupScale:function(a,b){var c;var d=new N.Rectangle();if(this.game.parent!==''){if(typeof this.game.parent==='string'){c=document.getElementById(this.game.parent)}else if(this.game.parent&&this.game.parent.nodeType===1){c=this.game.parent}}if(!c){this.parentNode=null;this.parentIsWindow=true;d.width=this.dom.visualBounds.width;d.height=this.dom.visualBounds.height;this.offset.set(0,0)}else{this.parentNode=c;this.parentIsWindow=false;this.getParentBounds(this._parentBounds,this.parentNode);d.width=this._parentBounds.width;d.height=this._parentBounds.height;this.offset.set(this._parentBounds.x,this._parentBounds.y)}var e=0;var f=0;if(typeof a==='number'){e=a}else{this.parentScaleFactor.x=parseInt(a,10)/100;e=d.width*this.parentScaleFactor.x}if(typeof b==='number'){f=b}else{this.parentScaleFactor.y=parseInt(b,10)/100;f=d.height*this.parentScaleFactor.y}e=Math.floor(e);f=Math.floor(f);this._gameSize.setTo(0,0,e,f);this.updateDimensions(e,f,false)},_gameResumed:function(){this.queueUpdate(true)},setGameSize:function(a,b){this._gameSize.setTo(0,0,a,b);if(this.currentScaleMode!==N.ScaleManager.RESIZE){this.updateDimensions(a,b,true)}this.queueUpdate(true)},setUserScale:function(a,b,c,d,e,f){this._userScaleFactor.setTo(a,b);this._userScaleTrim.setTo(c|0,d|0);if(e===undefined){e=true}if(f===undefined){f=true}if(e){this.queueUpdate(f)}},setResizeCallback:function(a,b){this.onResize=a;this.onResizeContext=b},signalSizeChange:function(){if(!N.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!N.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var a=this.width;var b=this.height;this._lastReportedCanvasSize.setTo(0,0,a,b);this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height);if(this.grid){this.grid.onResize(a,b)}this.onSizeChange.dispatch(this,a,b);if(this.currentScaleMode===N.ScaleManager.RESIZE){this.game.state.resize(a,b);this.game.load.resize(a,b)}}},setMinMax:function(a,b,c,d){this.minWidth=a;this.minHeight=b;if(typeof c!=='undefined'){this.maxWidth=c}if(typeof d!=='undefined'){this.maxHeight=d}},preUpdate:function(){if(this.game.time.time<(this._lastUpdate+this._updateThrottle)){return}var a=this._updateThrottle;this._updateThrottleReset=a>=400?0:100;this.dom.getOffset(this.game.canvas,this.offset);var b=this._parentBounds.width;var c=this._parentBounds.height;var d=this.getParentBounds(this._parentBounds);var e=d.width!==b||d.height!==c;var f=this.updateOrientationState();if(e||f){if(this.onResize){this.onResize.call(this.onResizeContext,this,d)}this.updateLayout();this.signalSizeChange()}var g=this._updateThrottle*2;if(this._updateThrottle<a){g=Math.min(a,this._updateThrottleReset)}this._updateThrottle=N.Math.clamp(g,25,this.trackParentInterval);this._lastUpdate=this.game.time.time},pauseUpdate:function(){this.preUpdate();this._updateThrottle=this.trackParentInterval},updateDimensions:function(a,b,c){this.width=a*this.parentScaleFactor.x;this.height=b*this.parentScaleFactor.y;this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/this.height;this.updateScalingAndBounds();if(c){this.game.renderer.resize(this.width,this.height);this.game.camera.setSize(this.width,this.height);this.game.world.resize(this.width,this.height)}},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.aspectRatio=this.width/this.height;if(this.game.canvas){this.dom.getOffset(this.game.canvas,this.offset)}this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);if(this.game.input&&this.game.input.scale){this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)}},forceOrientation:function(a,b){if(b===undefined){b=false}if(a===true&&b===true){console.warn('Phaser.ScaleManager: forceLandscape and forcePortrait cannot both be true.');return}this.forceLandscape=a;this.forcePortrait=b;this.queueUpdate(true)},classifyOrientation:function(a){if(a==='portrait-primary'||a==='portrait-secondary'){return'portrait'}else if(a==='landscape-primary'||a==='landscape-secondary'){return'landscape'}else{return null}},updateOrientationState:function(){var a=this.screenOrientation;var b=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.incorrectOrientation=(this.forceLandscape&&!this.isLandscape)||(this.forcePortrait&&!this.isPortrait);var c=a!==this.screenOrientation;var d=b!==this.incorrectOrientation;if(d){if(this.incorrectOrientation){this.enterIncorrectOrientation.dispatch()}else{this.leaveIncorrectOrientation.dispatch()}}if(c||d){this.onOrientationChange.dispatch(this,a,b)}return c||d},orientationChange:function(a){this.event=a;this.queueUpdate(true)},windowResize:function(a){this.event=a;this.queueUpdate(true)},scrollTop:function(){var a=this.compatibility.scrollTo;if(a){window.scrollTo(a.x,a.y)}},refresh:function(){this.scrollTop();this.queueUpdate(true)},updateLayout:function(){var a=this.currentScaleMode;if(a===N.ScaleManager.RESIZE){this.reflowGame();return}this.scrollTop();if(this.compatibility.forceMinimumDocumentHeight){document.documentElement.style.minHeight=window.innerHeight+'px'}if(this.incorrectOrientation){this.setMaximum()}else if(a===N.ScaleManager.EXACT_FIT){this.setExactFit()}else if(a===N.ScaleManager.SHOW_ALL){if(!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent){this.setShowAll(true);this.resetCanvas();this.setShowAll()}else{this.setShowAll()}}else if(a===N.ScaleManager.NO_SCALE){this.width=this.game.width;this.height=this.game.height}else if(a===N.ScaleManager.USER_SCALE){this.width=(this.game.width*this._userScaleFactor.x)-this._userScaleTrim.x;this.height=(this.game.height*this._userScaleFactor.y)-this._userScaleTrim.y}if(!this.compatibility.canExpandParent&&(a===N.ScaleManager.SHOW_ALL||a===N.ScaleManager.USER_SCALE)){var b=this.getParentBounds(this._tempBounds);this.width=Math.min(this.width,b.width);this.height=Math.min(this.height,b.height)}this.width=this.width|0;this.height=this.height|0;this.reflowCanvas()},getParentBounds:function(a,b){var c=a||new N.Rectangle();var d=b||this.boundingParent;var e=this.dom.visualBounds;var f=this.dom.layoutBounds;if(!d){c.setTo(0,0,e.width,e.height)}else{var g=d.getBoundingClientRect();var h=(d.offsetParent)?d.offsetParent.getBoundingClientRect():d.getBoundingClientRect();c.setTo(g.left-h.left,g.top-h.top,g.width,g.height);var i=this.windowConstraints;if(i.right){var j=i.right==='layout'?f:e;c.right=Math.min(c.right,j.width)}if(i.bottom){var j=i.bottom==='layout'?f:e;c.bottom=Math.min(c.bottom,j.height)}}c.setTo(Math.round(c.x),Math.round(c.y),Math.round(c.width),Math.round(c.height));return c},align:function(a,b){if(a!=null){this.pageAlignHorizontally=a}if(b!=null){this.pageAlignVertically=b}},alignCanvas:function(a,b){var c=this.getParentBounds(this._tempBounds);var d=this.game.canvas;var e=this.margin;if(a){e.left=e.right=0;var f=d.getBoundingClientRect();if(this.width<c.width&&!this.incorrectOrientation){var g=f.left-c.x;var h=(c.width/2)-(this.width/2);h=Math.max(h,0);var i=h-g;e.left=Math.round(i)}d.style.marginLeft=e.left+'px';if(e.left!==0){e.right=-(c.width-f.width-e.left);d.style.marginRight=e.right+'px'}}if(b){e.top=e.bottom=0;var f=d.getBoundingClientRect();if(this.height<c.height&&!this.incorrectOrientation){var g=f.top-c.y;var h=(c.height/2)-(this.height/2);h=Math.max(h,0);var i=h-g;e.top=Math.round(i)}d.style.marginTop=e.top+'px';if(e.top!==0){e.bottom=-(c.height-f.height-e.top);d.style.marginBottom=e.bottom+'px'}}e.x=e.left;e.y=e.top},reflowGame:function(){this.resetCanvas('','');var a=this.getParentBounds(this._tempBounds);this.updateDimensions(a.width,a.height,true)},reflowCanvas:function(){if(!this.incorrectOrientation){this.width=N.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width);this.height=N.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)}this.resetCanvas();if(!this.compatibility.noMargins){if(this.isFullScreen&&this._createdFullScreenTarget){this.alignCanvas(true,true)}else{this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)}}this.updateScalingAndBounds()},resetCanvas:function(a,b){if(a===undefined){a=this.width+'px'}if(b===undefined){b=this.height+'px'}var c=this.game.canvas;if(!this.compatibility.noMargins){c.style.marginLeft='';c.style.marginTop='';c.style.marginRight='';c.style.marginBottom=''}c.style.width=a;c.style.height=b},queueUpdate:function(a){if(a){this._parentBounds.width=0;this._parentBounds.height=0}this._updateThrottle=this._updateThrottleReset},reset:function(a){if(a&&this.grid){this.grid.reset()}},setMaximum:function(){this.width=this.dom.visualBounds.width;this.height=this.dom.visualBounds.height},setShowAll:function(a){var b=this.getParentBounds(this._tempBounds);var c=b.width;var d=b.height;var e;if(a){e=Math.max((d/this.game.height),(c/this.game.width))}else{e=Math.min((d/this.game.height),(c/this.game.width))}this.width=Math.round(this.game.width*e);this.height=Math.round(this.game.height*e)},setExactFit:function(){var a=this.getParentBounds(this._tempBounds);this.width=a.width;this.height=a.height;if(this.isFullScreen){return}if(this.maxWidth){this.width=Math.min(this.width,this.maxWidth)}if(this.maxHeight){this.height=Math.min(this.height,this.maxHeight)}},createFullScreenTarget:function(){var a=document.createElement('div');a.style.margin='0';a.style.padding='0';a.style.background='#000';return a},startFullScreen:function(a,b,c){if(this.isFullScreen){return false}if(!this.compatibility.supportsFullScreen){var d=this;setTimeout(function(){d.fullScreenError()},10);return}if(this.compatibility.clickTrampoline==='when-not-mouse'){var e=this.game.input;if(e.activePointer&&e.activePointer!==e.mousePointer&&(b||b!==false)){e.activePointer.addClickTrampoline('startFullScreen',this.startFullScreen,this,[a,false]);return}}if(a!==undefined&&this.game.renderType===N.CANVAS){this.game.stage.smoothed=a}var f=this.fullScreenTarget;if(!f){this.cleanupCreatedTarget();this._createdFullScreenTarget=this.createFullScreenTarget();f=this._createdFullScreenTarget}var g={targetElement:f};this.hasPhaserSetFullScreen=true;this.onFullScreenInit.dispatch(this,g);if(this._createdFullScreenTarget){var h=this.game.canvas;var i=h.parentNode;i.insertBefore(f,h);f.appendChild(h)}if(c===undefined){c={navigationUI:'hide'}}if(this.game.device.fullscreenKeyboard){f[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT)}else{f[this.game.device.requestFullscreen](c)}return true},stopFullScreen:function(){if(!this.isFullScreen||!this.compatibility.supportsFullScreen){return false}this.hasPhaserSetFullScreen=false;document[this.game.device.cancelFullscreen]();return true},cleanupCreatedTarget:function(){var a=this._createdFullScreenTarget;if(a&&a.parentNode){var b=a.parentNode;b.insertBefore(this.game.canvas,a);b.removeChild(a)}this._createdFullScreenTarget=null},prepScreenMode:function(a){var b=!!this._createdFullScreenTarget;var c=this._createdFullScreenTarget||this.fullScreenTarget;if(a){if(b||this.fullScreenScaleMode===N.ScaleManager.EXACT_FIT){if(c!==this.game.canvas){this._fullScreenRestore={targetWidth:c.style.width,targetHeight:c.style.height};c.style.width='100%';c.style.height='100%'}}}else{if(this._fullScreenRestore){c.style.width=this._fullScreenRestore.targetWidth;c.style.height=this._fullScreenRestore.targetHeight;this._fullScreenRestore=null}this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.resetCanvas()}},fullScreenChange:function(a){this.event=a;if(this.isFullScreen){this.prepScreenMode(true);this.updateLayout();this.queueUpdate(true)}else{this.prepScreenMode(false);this.cleanupCreatedTarget();this.updateLayout();this.queueUpdate(true)}this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(a){this.event=a;this.cleanupCreatedTarget();console.warn('Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API');this.onFullScreenError.dispatch(this)},scaleSprite:function(a,b,c,d){if(b===undefined){b=this.width}if(c===undefined){c=this.height}if(d===undefined){d=false}if(!a||!a.scale){return a}a.scale.x=1;a.scale.y=1;if((a.width<=0)||(a.height<=0)||(b<=0)||(c<=0)){return a}var e=b;var f=(a.height*b)/a.width;var g=(a.width*c)/a.height;var h=c;var i=(g>b);if(i){i=d}else{i=!d}if(i){a.width=Math.floor(e);a.height=Math.floor(f)}else{a.width=Math.floor(g);a.height=Math.floor(h)}return a},destroy:function(){this.game.onResume.remove(this._gameResumed,this);window.removeEventListener('orientationchange',this._orientationChange,false);window.removeEventListener('resize',this._windowResize,false);if(this.compatibility.supportsFullScreen){document.removeEventListener('webkitfullscreenchange',this._fullScreenChange,false);document.removeEventListener('mozfullscreenchange',this._fullScreenChange,false);document.removeEventListener('MSFullscreenChange',this._fullScreenChange,false);document.removeEventListener('fullscreenchange',this._fullScreenChange,false);document.removeEventListener('webkitfullscreenerror',this._fullScreenError,false);document.removeEventListener('mozfullscreenerror',this._fullScreenError,false);document.removeEventListener('MSFullscreenError',this._fullScreenError,false);document.removeEventListener('fullscreenerror',this._fullScreenError,false)}}};N.ScaleManager.prototype.constructor=N.ScaleManager;Object.defineProperty(N.ScaleManager.prototype,'boundingParent',{get:function(){if(this.parentIsWindow||(this.isFullScreen&&this.hasPhaserSetFullScreen&&!this._createdFullScreenTarget)){return null}var a=this.game.canvas&&this.game.canvas.parentNode;return a||null}});Object.defineProperty(N.ScaleManager.prototype,'scaleMode',{get:function(){return this._scaleMode},set:function(a){if(a!==this._scaleMode){if(!this.isFullScreen){this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.queueUpdate(true)}this._scaleMode=a}return this._scaleMode}});Object.defineProperty(N.ScaleManager.prototype,'fullScreenScaleMode',{get:function(){return this._fullScreenScaleMode},set:function(a){if(a!==this._fullScreenScaleMode){if(this.isFullScreen){this.prepScreenMode(false);this._fullScreenScaleMode=a;this.prepScreenMode(true);this.queueUpdate(true)}else{this._fullScreenScaleMode=a}}return this._fullScreenScaleMode}});Object.defineProperty(N.ScaleManager.prototype,'currentScaleMode',{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}});Object.defineProperty(N.ScaleManager.prototype,'pageAlignHorizontally',{get:function(){return this._pageAlignHorizontally},set:function(a){if(a!==this._pageAlignHorizontally){this._pageAlignHorizontally=a;this.queueUpdate(true)}}});Object.defineProperty(N.ScaleManager.prototype,'pageAlignVertically',{get:function(){return this._pageAlignVertically},set:function(a){if(a!==this._pageAlignVertically){this._pageAlignVertically=a;this.queueUpdate(true)}}});Object.defineProperty(N.ScaleManager.prototype,'isFullScreen',{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}});Object.defineProperty(N.ScaleManager.prototype,'isPortrait',{get:function(){return this.classifyOrientation(this.screenOrientation)==='portrait'}});Object.defineProperty(N.ScaleManager.prototype,'isLandscape',{get:function(){return this.classifyOrientation(this.screenOrientation)==='landscape'}});Object.defineProperty(N.ScaleManager.prototype,'isGamePortrait',{get:function(){return(this.height>this.width)}});Object.defineProperty(N.ScaleManager.prototype,'isGameLandscape',{get:function(){return(this.width>this.height)}});N.Utils.Debug=function(a){this.game=a;this.sprite=null;this.bmd=null;this.canvas=null;this.context=null;this.font='14px monospace';this.columnWidth=100;this.lineHeight=16;this.lineWidth=1;this.renderShadow=true;this.currentColor=null;this.currentX=0;this.currentY=0;this.currentAlpha=1;this.dirty=false;this.isDisabled=false;this._line=null;this._rect=null};N.Utils.Debug.GEOM_AUTO=0;N.Utils.Debug.GEOM_RECTANGLE=1;N.Utils.Debug.GEOM_CIRCLE=2;N.Utils.Debug.GEOM_POINT=3;N.Utils.Debug.GEOM_LINE=4;N.Utils.Debug.GEOM_ELLIPSE=5;N.Utils.Debug.prototype={boot:function(){if(this.game.renderType===N.CANVAS){this.context=this.game.context}else{this.bmd=new N.BitmapData(this.game,'__DEBUG',this.game.width,this.game.height,true);this.sprite=this.game.make.image(0,0,this.bmd);this.sprite.anchor.set(0,0);this.game.stage.addChild(this.sprite);this.game.scale.onSizeChange.add(this.resize,this);this.canvas=N.CanvasPool.create(this,this.game.width,this.game.height);this.context=this.canvas.getContext('2d')}this._line=new N.Line();this._rect=new N.Rectangle()},resize:function(){this.bmd.resize(this.game.width,this.game.height);this.canvas.width=this.game.width;this.canvas.height=this.game.height},preUpdate:function(){if(this.dirty&&this.sprite){this.bmd.clear();this.bmd.draw(this.canvas,0,0);this.context.clearRect(0,0,this.game.width,this.game.height);this.dirty=false}},reset:function(){if(this.context){this.context.clearRect(0,0,this.game.width,this.game.height)}if(this.sprite){this.bmd.clear()}},start:function(x,y,a,b){if(typeof x!=='number'){x=0}if(typeof y!=='number'){y=0}a=a||'rgb(255,255,255)';if(b===undefined){b=0}this.currentX=x;this.currentY=y;this.currentColor=a;this.columnWidth=b;this.dirty=true;this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=a;this.context.fillStyle=a;this.context.font=this.font;this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){var x=this.currentX;for(var i=0;i<arguments.length;i++){if(this.renderShadow){this.context.fillStyle='rgb(0,0,0)';this.context.fillText(arguments[i],x+1,this.currentY+1);this.context.fillStyle=this.currentColor}this.context.fillText(arguments[i],x,this.currentY);x+=this.columnWidth}this.currentY+=this.lineHeight},gameInfo:function(x,y,a){var b=this.game;this.start(x,y,a);this.line('Game ID '+b.id);this.line({1:'Canvas',2:'WebGL',3:'Headless',4:'WebGL Multitexture'}[b.renderType]+' ('+b.width+' x '+b.height+')');this.line('Paused: '+b.paused);this.line('Stepping: '+b.stepping+' ('+b.stepCount+')');this.stop()},state:function(x,y,a){var b=this.game.state;var c=Object.keys(b.states);this.start(x,y,a);for(var i=0;i<c.length;i++){var d=c[i];if(d===b.current){this.line((b._created?'* ':'> ')+d)}else if(d===b._pendingState){this.line('+ '+d)}else{this.line('  '+d)}}this.stop()},sound:function(x,y,a){var b=this.game.sound;this.start(x,y,a);if(b.noAudio){this.line('Audio is disabled')}else{this.line('Volume: '+b.volume.toFixed(2)+(b.mute?' (Mute)':''));this.line('Mute on pause: '+b.muteOnPause);this.line('Using: '+(b.usingWebAudio?('Web Audio - '+b.context.state):'Audio Tag'));this.line('Touch locked: '+b.touchLocked);this.line('Sounds: '+b._sounds.length)}this.stop()},soundInfo:function(a,x,y,b){this.start(x,y,b);this.line('Sound: '+a.key+'  Touch locked: '+a.game.sound.touchLocked);this.line('Is Ready?: '+this.game.cache.isSoundReady(a.key)+'  Pending Playback: '+a.pendingPlayback);this.line('Decoded: '+a.isDecoded+'  Decoding: '+a.isDecoding);this.line('Playing: '+a.isPlaying+'  Loop: '+a.loop);this.line('Time: '+(a.currentTime/1000).toFixed(3)+'s  Total: '+a.totalDuration.toFixed(3)+'s');this.line('Volume: '+a.volume.toFixed(2)+(a.mute?' (Mute)':''));this.line('Using: '+(a.usingWebAudio?'Web Audio':'Audio Tag'));if(a.usingWebAudio){this.line('  Source: '+(a.sourceId||'none'))}if(a.usingAudioTag&&a._sound){var c=a._sound;this.line('  currentSrc: '+c.currentSrc);this.line('  currentTime: '+c.currentTime);this.line('  duration: '+c.duration);this.line('  ended: '+c.ended);this.line('  loop: '+c.loop);this.line('  muted: '+c.muted);this.line('  paused: '+c.paused)}if(a.currentMarker!==''){this.line('Marker: '+a.currentMarker+'  Duration: '+a.duration.toFixed(3)+'s ('+a.durationMS+'ms)');this.line('Start: '+a.markers[a.currentMarker].start.toFixed(3)+'  Stop: '+a.markers[a.currentMarker].stop.toFixed(3));this.line('Position: '+a.position.toFixed(3))}this.stop()},camera:function(a,b,c){var d=a.deadzone;var e=a.target;var f=a.view;if(d){this._rect.setTo(f.x+d.x,f.y+d.y,d.width,d.height);this.rectangle(this._rect,b,c)}if(e){this._line.setTo(f.centerX,f.centerY,e.x,e.y);this.geom(this._line,b,c);this.geom(e,b,false,3)}},cameraInfo:function(a,x,y,b){var c=a.bounds;var d=a.deadzone;var e=a.target;var f=a.view;this.start(x,y,b);this.line('Camera ('+a.width+' x '+a.height+')');this.line('x: '+a.x+' y: '+a.y);this.line('Bounds: '+(c?('x: '+c.x+' y: '+c.y+' w: '+c.width+' h: '+c.height):'none'));this.line('View: x: '+f.x+' y: '+f.y+' w: '+f.width+' h: '+f.height);this.line('Center: x: '+a.centerX+' y: '+a.centerY);this.line('Deadzone: '+(d?('x: '+d.x+' y: '+d.y+' w: '+d.width+' h: '+d.height):d));this.line('Total in view: '+a.totalInView);this.line('At limit: x: '+a.atLimit.x+' y: '+a.atLimit.y);this.line('Target: '+(e?(e.name||e):'none'));this.stop()},timer:function(a,x,y,b){this.start(x,y,b);this.line('Timer (running: '+a.running+' expired: '+a.expired+')');this.line('Next Tick: '+a.next+' Duration: '+a.duration);this.line('Paused: '+a.paused+' Length: '+a.length);this.stop()},pointer:function(a,b,c,d,e,f){if(a==null){return}if(b===undefined){b=false}c=c||'rgba(0,255,0,0.5)';d=d||'rgba(255,255,0,0.5)';f=f||'rgba(255,0,0,0.5)';if(b===true&&a.isUp===true){return}this.start(a.x,a.y-150,e);this.context.beginPath();this.context.arc(a.x,a.y,a.circle.radius,0,Math.PI*2);if(a.active){this.context.fillStyle=a.isDown?c:d}else{this.context.fillStyle=f}this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(a.positionDown.x,a.positionDown.y);this.context.lineTo(a.position.x,a.position.y);this.context.lineWidth=2;this.context.stroke();this.context.closePath();var g=a.movementX;var h=a.movementY;if(g||h){this.context.beginPath();this.context.moveTo(g+a.position.x,h+a.position.y);this.context.lineTo(a.position.x,a.position.y);this.context.lineWidth=2;this.context.stroke();this.context.closePath()}this.line('ID: '+a.id+' Active: '+a.active);this.line('World X: '+a.worldX.toFixed(1)+' World Y: '+a.worldY.toFixed(1));this.line('Screen X: '+a.x.toFixed(1)+' Screen Y: '+a.y.toFixed(1)+' In: '+a.withinGame);this.line('Movement: X: '+g+' Y: '+h);this.line('Duration: '+a.duration+' ms');this.line('is Down: '+a.isDown+' is Up: '+a.isUp);this.line('Identifier: '+a.identifier+' Pointer ID: '+a.pointerId);if(a.isMouse){this.line('Buttons: '+this._pointerButtonIcon(a.leftButton)+' '+this._pointerButtonIcon(a.middleButton)+' '+this._pointerButtonIcon(a.rightButton))}this.stop()},_pointerButtonIcon:function(a){if(a.isDown){return'x'}else if(a.isUp){return'o'}return'-'},spriteInputInfo:function(a,x,y,b){this.start(x,y,b);this.line('Sprite Input: ('+a.width+' x '+a.height+')');this.line('x: '+a.input.pointerX().toFixed(1)+' y: '+a.input.pointerY().toFixed(1));this.line('over: '+a.input.pointerOver()+' duration: '+a.input.overDuration().toFixed(0));this.line('down: '+a.input.pointerDown()+' duration: '+a.input.downDuration().toFixed(0));this.line('just over: '+a.input.justOver()+' just out: '+a.input.justOut());this.stop()},key:function(a,x,y,b){this.start(x,y,b,150);this.line('Key:',a.keyCode,'isDown:',a.isDown);this.line('justDown:',a.justDown,'justUp:',a.justUp);this.line('Time Down:',a.timeDown.toFixed(0),'duration:',a.duration.toFixed(0));this.stop()},inputInfo:function(x,y,a,b){var c=this.game.input;if(b===undefined){b=true}this.start(x,y,a);this.line('Input');this.line('X: '+c.x+' Y: '+c.y);this.line('World X: '+c.worldX+' World Y: '+c.worldY);this.line('Scale X: '+c.scale.x.toFixed(2)+' Scale Y: '+c.scale.x.toFixed(2));this.line('Screen X: '+c.activePointer.screenX.toFixed(1)+' Screen Y: '+c.activePointer.screenY.toFixed(1));if(!b){this.stop();return}this.line('Sources:');this.line('  '+this._inputHandler(c.mouse,'mouse'));this.line('  '+this._inputHandler(c.mspointer,'mspointer'));this.line('  '+this._inputHandler(c.touch,'touch'));var d=c.pointers;var e=c.mousePointer;var f=N.PointerModes;var g=0;var h=0;this.line('Pointers:');this.line('  '+(e.isDown?'x':'o')+' '+f[e.pointerMode]+' '+e.identifier);for(var i=0;i<d.length;i++){var p=d[i];this.line('  '+(p.active?'+':'-')+' '+f[p.pointerMode]+' '+p.identifier);if(p.active){g+=1}else{h+=1}}this.line('  Active: '+g+' Free: '+h+' Max: '+c.maxPointers);this.stop()},inputHandler:function(a,b,x,y,c){this.start(x,y,c);this.line(b||'?');this.line('active: '+a.active);if(!a.active){this.stop();return}this.line('enabled: '+a.enabled);if('capture'in a){this.line('capture: '+a.capture)}if('preventDefault'in a){this.line('preventDefault: '+a.preventDefault)}if('event'in a){this.line('event: '+(a.event?a.event.type:a.event))}this.stop()},_inputHandler:function(a,b){return this._inputHandlerStatusIcon(a)+' '+b+' '+this._inputHandlerCaptureIcon(a)},_inputHandlerStatusIcon:function(a){if(!a.active){return' '}return a.enabled?'+':'-'},_inputHandlerCaptureIcon:function(a){if(!a.active){return' '}return(a.capture||a.preventDefault)?'*':' '},spriteBounds:function(a,b,c){var d=a.getBounds();d.x+=this.game.camera.x;d.y+=this.game.camera.y;this.rectangle(d,b,c)},ropeSegments:function(b,c,d){var e=b.segments;var f=this;e.forEach(function(a){f.rectangle(a,c,d)},this)},spriteInfo:function(a,x,y,b){this.start(x,y,b);this.line('Sprite: '+(a.name||'')+' ('+a.width+' x '+a.height+') anchor: '+a.anchor.x+' x '+a.anchor.y);this.line('x: '+a.x.toFixed(1)+' y: '+a.y.toFixed(1));this.line('angle: '+a.angle.toFixed(1)+' rotation: '+a.rotation.toFixed(1));this.line('visible: '+a.visible+' in camera: '+a.inCamera);this.line('bounds x: '+a._bounds.x.toFixed(1)+' y: '+a._bounds.y.toFixed(1)+' w: '+a._bounds.width.toFixed(1)+' h: '+a._bounds.height.toFixed(1));this.line('parent: '+(a.parent?(a.parent.name||'(DisplayObject)'):'(none)'));this.stop()},spriteCoords:function(a,x,y,b){this.start(x,y,b,100);if(a.name){this.line(a.name)}this.line('x:',a.x.toFixed(2),'y:',a.y.toFixed(2));this.line('pos x:',a.position.x.toFixed(2),'pos y:',a.position.y.toFixed(2));this.line('world x:',a.world.x.toFixed(2),'world y:',a.world.y.toFixed(2));this.stop()},lineInfo:function(a,x,y,b){this.start(x,y,b,80);this.line('start.x:',a.start.x.toFixed(2),'start.y:',a.start.y.toFixed(2));this.line('end.x:',a.end.x.toFixed(2),'end.y:',a.end.y.toFixed(2));this.line('length:',a.length.toFixed(2),'angle:',a.angle);this.stop()},pixel:function(x,y,a,b){b=b||2;this.start();this.context.fillStyle=a;this.context.fillRect(x,y,b,b);this.stop()},geom:function(a,b,c,d){if(c===undefined){c=true}if(d===undefined){d=0}b=b||'rgba(0,255,0,0.4)';this.start();this.context.fillStyle=b;this.context.strokeStyle=b;this.context.lineWidth=this.lineWidth;var e=N.Utils.Debug;if(d===e.GEOM_RECTANGLE||a instanceof N.Rectangle){if(c){this.context.fillRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height)}else{this.context.strokeRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height)}}else if(d===e.GEOM_CIRCLE||a instanceof N.Circle){this.context.beginPath();this.context.arc(a.x-this.game.camera.x,a.y-this.game.camera.y,a.radius,0,Math.PI*2,false);this.context.closePath();if(c){this.context.fill()}else{this.context.stroke()}}else if(d===e.GEOM_POINT||a instanceof N.Point){this.context.fillRect(a.x-this.game.camera.x,a.y-this.game.camera.y,4,4)}else if(d===e.GEOM_LINE||a instanceof N.Line){this.context.beginPath();this.context.moveTo((a.start.x+0.5)-this.game.camera.x,(a.start.y+0.5)-this.game.camera.y);this.context.lineTo((a.end.x+0.5)-this.game.camera.x,(a.end.y+0.5)-this.game.camera.y);this.context.closePath();this.context.stroke()}else if(d===e.GEOM_ELLIPSE||a instanceof N.Ellipse){this.context.beginPath();this.context.ellipse(a.centerX-this.game.camera.x,a.centerY-this.game.camera.y,a.width/2,a.height/2,0,2*Math.PI,false);this.context.closePath();if(c){this.context.fill()}else{this.context.stroke()}}this.stop()},rectangle:function(a,b,c){if(c===undefined){c=true}b=b||'rgba(0, 255, 0, 0.4)';this.start();if(c){this.context.fillStyle=b;this.context.fillRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height)}else{this.context.lineWidth=this.lineWidth;this.context.strokeStyle=b;this.context.strokeRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height)}this.stop()},text:function(a,x,y,b,c){b=b||'rgb(255,255,255)';c=c||this.font;this.start();this.context.font=c;if(this.renderShadow){this.context.fillStyle='rgb(0,0,0)';this.context.fillText(a,x+1,y+1)}this.context.fillStyle=b;this.context.fillText(a,x,y);this.stop()},quadTree:function(a,b){b=b||'rgba(255,0,0,0.3)';this.start();var c=a.bounds;if(a.nodes.length===0){this.context.strokeStyle=b;this.context.strokeRect(c.x,c.y,c.width,c.height);this.text('size: '+a.objects.length,c.x+4,c.y+16,'rgb(0,200,0)','12px Courier');this.context.strokeStyle='rgb(0,255,0)';for(var i=0;i<a.objects.length;i++){this.context.strokeRect(a.objects[i].x,a.objects[i].y,a.objects[i].width,a.objects[i].height)}}else{for(var i=0;i<a.nodes.length;i++){this.quadTree(a.nodes[i])}}this.stop()},body:function(a,b,c){if(a.body){this.start();if(a.body.type===N.Physics.ARCADE){N.Physics.Arcade.Body.render(this.context,a.body,b,c,this.lineWidth)}else if(a.body.type===N.Physics.NINJA){N.Physics.Ninja.Body.render(this.context,a.body,b,c)}else if(a.body.type===N.Physics.BOX2D){N.Physics.Box2D.renderBody(this.context,a.body,b)}this.stop()}},bodyInfo:function(a,x,y,b){if(a.body){this.start(x,y,b,210);if(a.body.type===N.Physics.ARCADE){N.Physics.Arcade.Body.renderBodyInfo(this,a.body)}else if(a.body.type===N.Physics.BOX2D){this.game.physics.box2d.renderBodyInfo(this,a.body)}this.stop()}},box2dWorld:function(){this.start();this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0);this.game.physics.box2d.renderDebugDraw(this.context);this.stop()},box2dBody:function(a,b){this.start();N.Physics.Box2D.renderBody(this.context,a,b);this.stop()},displayList:function(a){if(a===undefined){a=this.game.world}if(a.hasOwnProperty('renderOrderID')){console.log('['+a.renderOrderID+']',a)}else{console.log('[]',a)}if(a.children&&a.children.length>0){for(var i=0;i<a.children.length;i++){this.game.debug.displayList(a.children[i])}}},renderer:function(x,y,a){var r=this.game.renderer;var s=r.renderSession;this.start(x,y,a);this.line((r.gl?'WebGL':'Canvas')+' Renderer ('+r.width+' x '+r.height+')');this.line('autoResize: '+r.autoResize);this.line('clearBeforeRender: '+r.clearBeforeRender);this.line('resolution: '+r.resolution);this.line('transparent: '+r.transparent);this.line('renderSession:');if(r.gl){this.line('  currentBatchedTextures: ('+r.currentBatchedTextures.length+')');for(var i=0;i<r.currentBatchedTextures.length;i++){this.line('    '+r.currentBatchedTextures[i])}this.line('  drawCount: '+s.drawCount);this.line('  maxTextures: '+r.maxTextures);this.line('  maxTextureSize: '+r.maxTextureSize);this.line('  maxTextureAvailableSpace: '+s.maxTextureAvailableSpace);this.line('  roundPixels: '+s.roundPixels)}else{this.line('  roundPixels: '+s.roundPixels);this.line('  scaleMode: '+(s.scaleMode===0?'LINEAR':(s.scaleMode===1?'NEAREST':s.scaleMode)))}this.stop()},canvasPool:function(x,y,a,b){var c=N.CanvasPool;this.start(x,y,a,b||100);this.line('Canvas Pool');this.line('Used:',c.getTotal());this.line('Free:',c.getFree());this.line('Total:',c.length);this.stop()},physicsGroup:function(a,b,c,d){a.forEach(this.body,this,d,b,c)},phaser:function(x,y,a){this.text('Phaser v'+N.VERSION+' '+(this.game.renderType===N.WEBGL?'WebGL':'Canvas')+' '+(this.game.device.webAudio?'WebAudio':'HTML Audio'),x,y,a,this.font)},scale:function(x,y,a){this.start(x,y,a);var b=this.game.scale;var c=b.scaleFactorInversed;var d=b._parentBounds;var x=' x ';this.line('Game: '+this.game.width+x+this.game.height);this.line('Canvas: '+b.width+x+b.height+' ('+c.x.toFixed(2)+x+c.y.toFixed(2)+')'+' ['+b.aspectRatio.toFixed(2)+']');this.line('Mode: '+N.ScaleManager.MODES[b.currentScaleMode]+(b.currentScaleMode===N.ScaleManager.USER_SCALE?(' ('+b._userScaleFactor.x+x+b._userScaleFactor.y+')'):''));this.line('Parent: '+(b.parentIsWindow?'window':b.parentNode)+(d.empty?'':(' ('+d.width+x+d.height+')')));this.line('Screen: '+b.classifyOrientation(b.screenOrientation)+(b.incorrectOrientation?' (incorrect)':''));this.stop()},loader:function(a,x,y,b){var c=N.Utils.pad;this.start(x,y,b);if(a.hasLoaded){this.line('Complete'+(a.resetLocked?' [locked]':''))}else if(a.isLoading){this.line('Loading')}else{this.line('Not started')}if(!a.hasLoaded||a.resetLocked){this.line('Progress: '+(c(a.progress,3)+'%'));this.line('Files: '+a._loadedFileCount+' of '+a._totalFileCount);this.line('Packs: '+a._loadedPackCount+' of '+a._loadedPackCount)}this.stop()},device:function(x,y,a){var b=this.game.device;this.start(x,y,a);this.line('Device');this.line('Pointer Events: '+b.mspointer);this.line('Touch: '+b.touch);this.line('Web Audio: '+b.webAudio);this.line('WebGL: '+b.webGL);this.stop()},destroy:function(){N.CanvasPool.remove(this)}};N.Utils.Debug.prototype.constructor=N.Utils.Debug;N.DOM={getOffset:function(a,b){b=b||new N.Point();var c=a.getBoundingClientRect();var d=N.DOM.scrollY||0;var e=N.DOM.scrollX||0;var f=document.documentElement.clientTop||0;var g=document.documentElement.clientLeft||0;b.x=c.left+e-g;b.y=c.top+d-f;return b},getBounds:function(a,b){if(b===undefined){b=0}a=a&&!a.nodeType?a[0]:a;if(!a||a.nodeType!==1){return false}else{return this.calibrate(a.getBoundingClientRect(),b)}},calibrate:function(a,b){b=+b||0;var c={width:0,height:0,left:0,right:0,top:0,bottom:0};c.width=(c.right=a.right+b)-(c.left=a.left-b);c.height=(c.bottom=a.bottom+b)-(c.top=a.top-b);return c},getAspectRatio:function(a){a=a==null?this.visualBounds:a.nodeType===1?this.getBounds(a):a;var w=a.width;var h=a.height;if(typeof w==='function'){w=w.call(a)}if(typeof h==='function'){h=h.call(a)}return w/h},inLayoutViewport:function(a,b){var r=this.getBounds(a,b);return!!r&&r.bottom>=0&&r.right>=0&&r.top<=this.layoutBounds.width&&r.left<=this.layoutBounds.height},getScreenOrientation:function(a){var b=window.screen;var c=b.orientation||b.mozOrientation||b.msOrientation;if(c&&typeof c.type==='string'){return c.type}else if(typeof c==='string'){return c}var d='portrait-primary';var e='landscape-primary';if(a==='screen'){return(b.height>b.width)?d:e}else if(a==='viewport'){return(this.visualBounds.height>this.visualBounds.width)?d:e}else if(a==='window.orientation'&&typeof window.orientation==='number'){return(window.orientation===0||window.orientation===180)?d:e}else if(window.matchMedia){if(window.matchMedia('(orientation: portrait)').matches){return d}else if(window.matchMedia('(orientation: landscape)').matches){return e}}return(this.visualBounds.height>this.visualBounds.width)?d:e},visualBounds:new N.Rectangle(),layoutBounds:new N.Rectangle(),documentBounds:new N.Rectangle()};N.Device.whenReady(function(c){var e=window&&('pageXOffset'in window)?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft};var f=window&&('pageYOffset'in window)?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(N.DOM,'scrollX',{get:e});Object.defineProperty(N.DOM,'scrollY',{get:f});Object.defineProperty(N.DOM.visualBounds,'x',{get:e});Object.defineProperty(N.DOM.visualBounds,'y',{get:f});Object.defineProperty(N.DOM.layoutBounds,'x',{value:0});Object.defineProperty(N.DOM.layoutBounds,'y',{value:0});var g=c.desktop&&(document.documentElement.clientWidth<=window.innerWidth)&&(document.documentElement.clientHeight<=window.innerHeight);if(g){var h=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)};var i=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)};Object.defineProperty(N.DOM.visualBounds,'width',{get:h});Object.defineProperty(N.DOM.visualBounds,'height',{get:i});Object.defineProperty(N.DOM.layoutBounds,'width',{get:h});Object.defineProperty(N.DOM.layoutBounds,'height',{get:i})}else{Object.defineProperty(N.DOM.visualBounds,'width',{get:function(){return window.innerWidth}});Object.defineProperty(N.DOM.visualBounds,'height',{get:function(){return window.innerHeight}});Object.defineProperty(N.DOM.layoutBounds,'width',{get:function(){var a=document.documentElement.clientWidth;var b=window.innerWidth;return a<b?b:a}});Object.defineProperty(N.DOM.layoutBounds,'height',{get:function(){var a=document.documentElement.clientHeight;var b=window.innerHeight;return a<b?b:a}})}Object.defineProperty(N.DOM.documentBounds,'x',{value:0});Object.defineProperty(N.DOM.documentBounds,'y',{value:0});Object.defineProperty(N.DOM.documentBounds,'width',{get:function(){var d=document.documentElement;return Math.max(d.clientWidth,d.offsetWidth,d.scrollWidth)}});Object.defineProperty(N.DOM.documentBounds,'height',{get:function(){var d=document.documentElement;return Math.max(d.clientHeight,d.offsetHeight,d.scrollHeight)}})},null,true);N.ArraySet=function(a){this.position=0;this.list=a||[]};N.ArraySet.prototype={add:function(a){if(!this.exists(a)){this.list.push(a)}return a},getIndex:function(a){return this.list.indexOf(a)},getByKey:function(a,b){var i=this.list.length;while(i--){if(this.list[i][a]===b){return this.list[i]}}return null},exists:function(a){return(this.list.indexOf(a)>-1)},reset:function(){this.list.length=0},remove:function(a){var b=this.list.indexOf(a);if(b>-1){this.list.splice(b,1);return a}},setAll:function(a,b){var i=this.list.length;while(i--){if(this.list[i]){this.list[i][a]=b}}},callAll:function(a){var b=Array.prototype.slice.call(arguments,1);var i=this.list.length;while(i--){if(this.list[i]&&this.list[i][a]){this.list[i][a].apply(this.list[i],b)}}},removeAll:function(a){if(a===undefined){a=false}var i=this.list.length;while(i--){if(this.list[i]){var b=this.remove(this.list[i]);if(a){b.destroy()}}}this.position=0;this.list=[]}};Object.defineProperty(N.ArraySet.prototype,'total',{get:function(){return this.list.length}});Object.defineProperty(N.ArraySet.prototype,'first',{get:function(){this.position=0;if(this.list.length>0){return this.list[0]}else{return null}}});Object.defineProperty(N.ArraySet.prototype,'next',{get:function(){if(this.position<this.list.length){this.position++;return this.list[this.position]}else{return null}}});N.ArraySet.prototype.constructor=N.ArraySet;N.ArrayUtils={getRandomItem:function(a,b,c){if(a===null){return null}if(b===undefined){b=0}if(c===undefined){c=a.length}var d=b+Math.floor(Math.random()*c);return a[d]===undefined?null:a[d]},removeRandomItem:function(a,b,c){if(a==null){return null}if(b===undefined){b=0}if(c===undefined){c=a.length}var d=b+Math.floor(Math.random()*c);if(d<a.length){var e=a.splice(d,1);return e[0]===undefined?null:e[0]}else{return null}},remove:function(a,b,c){var d=a.length;if(b>=d||c===0){return}if(c==null){c=1}var e=d-c;for(var i=b;i<e;++i){a[i]=a[i+c]}a.length=e},shuffle:function(a){for(var i=a.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var b=a[i];a[i]=a[j];a[j]=b}return a},transposeMatrix:function(a){var b=a.length;var c=a[0].length;var d=new Array(c);for(var i=0;i<c;i++){d[i]=new Array(b);for(var j=b-1;j>-1;j--){d[i][j]=a[j][i]}}return d},rotateMatrix:function(a,b){if(typeof b!=='string'){b=((b%360)+360)%360}if(b===90||b===-270||b==='rotateLeft'){a=N.ArrayUtils.transposeMatrix(a);a=a.reverse()}else if(b===-90||b===270||b==='rotateRight'){a=a.reverse();a=N.ArrayUtils.transposeMatrix(a)}else if(Math.abs(b)===180||b==='rotate180'){for(var i=0;i<a.length;i++){a[i].reverse()}a=a.reverse()}return a},findClosest:function(a,b){if(!b.length){return NaN}else if(b.length===1||a<b[0]){return b[0]}var i=1;while(b[i]<a){i++}var c=b[i-1];var d=(i<b.length)?b[i]:Number.POSITIVE_INFINITY;return((d-a)<=(a-c))?d:c},rotateRight:function(a){var s=a.pop();a.unshift(s);return s},rotateLeft:function(a){var s=a.shift();a.push(s);return s},numberArray:function(a,b){if(b===undefined||b===null){b=a;a=0}var c=[];for(var i=a;i<=b;i++){c.push(i)}return c},numberArrayStep:function(a,b,c){if(a===undefined||a===null){a=0}if(b===undefined||b===null){b=a;a=0}if(c===undefined){c=1}var d=[];var e=Math.max(N.Math.roundAwayFromZero((b-a)/(c||1)),0);for(var i=0;i<e;i++){d.push(a);a+=c}return d}};N.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0};N.LinkedList.prototype={add:function(a){if(this.total===0&&this.first===null&&this.last===null){this.first=a;this.last=a;this.next=a;a.prev=this;this.total++;return a}this.last.next=a;a.prev=this.last;this.last=a;this.total++;return a},reset:function(){this.first=null;this.last=null;this.next=null;this.prev=null;this.total=0},remove:function(a){if(this.total===1){this.reset();a.next=a.prev=null;return}if(a===this.first){this.first=this.first.next}else if(a===this.last){this.last=this.last.prev}if(a.prev){a.prev.next=a.next}if(a.next){a.next.prev=a.prev}a.next=a.prev=null;if(this.first===null){this.last=null}this.total--},callAll:function(a){if(!this.first||!this.last){return}var b=this.first;do{if(b&&b[a]){b[a].call(b)}b=b.next}while(b!==this.last.next)}};N.LinkedList.prototype.constructor=N.LinkedList;N.Create=function(a){this.game=a;this.bmd=null;this.canvas=null;this.ctx=null;this.palettes=[{0:'#000',1:'#9D9D9D',2:'#FFF',3:'#BE2633',4:'#E06F8B',5:'#493C2B',6:'#A46422',7:'#EB8931',8:'#F7E26B',9:'#2F484E',A:'#44891A',B:'#A3CE27',C:'#1B2632',D:'#005784',E:'#31A2F2',F:'#B2DCEF'},{0:'#000',1:'#191028',2:'#46af45',3:'#a1d685',4:'#453e78',5:'#7664fe',6:'#833129',7:'#9ec2e8',8:'#dc534b',9:'#e18d79',A:'#d6b97b',B:'#e9d8a1',C:'#216c4b',D:'#d365c8',E:'#afaab9',F:'#f5f4eb'},{0:'#000',1:'#2234d1',2:'#0c7e45',3:'#44aacc',4:'#8a3622',5:'#5c2e78',6:'#aa5c3d',7:'#b5b5b5',8:'#5e606e',9:'#4c81fb',A:'#6cd947',B:'#7be2f9',C:'#eb8a60',D:'#e23d69',E:'#ffd93f',F:'#fff'},{0:'#000',1:'#fff',2:'#8b4131',3:'#7bbdc5',4:'#8b41ac',5:'#6aac41',6:'#3931a4',7:'#d5de73',8:'#945a20',9:'#5a4100',A:'#bd736a',B:'#525252',C:'#838383',D:'#acee8b',E:'#7b73de',F:'#acacac'},{0:'#000',1:'#191028',2:'#46af45',3:'#a1d685',4:'#453e78',5:'#7664fe',6:'#833129',7:'#9ec2e8',8:'#dc534b',9:'#e18d79',A:'#d6b97b',B:'#e9d8a1',C:'#216c4b',D:'#d365c8',E:'#afaab9',F:'#fff'}]};N.Create.PALETTE_ARNE=0;N.Create.PALETTE_JMP=1;N.Create.PALETTE_CGA=2;N.Create.PALETTE_C64=3;N.Create.PALETTE_JAPANESE_MACHINE=4;N.Create.prototype={texture:function(a,b,c,e,f,g,i,j){if(c===undefined){c=8}if(e===undefined){e=c}if(f===undefined){f=0}if(g===undefined){g=true}var w=b[0].length*c;var h=b.length*e;if(this.bmd===null){this.bmd=this.game.make.bitmapData();this.canvas=this.bmd.canvas;this.ctx=this.bmd.context}this.bmd.resize(w,h);this.bmd.clear();for(var y=0;y<b.length;y++){var k=b[y];for(var x=0;x<k.length;x++){var d=k[x];if(d!=='.'&&d!==' '){this.ctx.fillStyle=this.palettes[f][d];this.ctx.fillRect(x*c,y*e,c,e)}}}return g?this.bmd.generateTexture(a,i,j):this.copy()},grid:function(a,b,c,d,e,f,g,h,i){if(g===undefined){g=true}if(this.bmd===null){this.bmd=this.game.make.bitmapData();this.canvas=this.bmd.canvas;this.ctx=this.bmd.context}this.bmd.resize(b,c);this.ctx.fillStyle=f;for(var y=0;y<c;y+=e){this.ctx.fillRect(0,y,b,1)}for(var x=0;x<b;x+=d){this.ctx.fillRect(x,0,1,c)}return g?this.bmd.generateTexture(a,h,i):this.copy()},copy:function(a,x,y,b,c,d,e){if(a==null){a=this.game.make.bitmapData()}a.resize(this.bmd.width,this.bmd.height);return a.draw(this.bmd,x,y,b,c,d,e)}};N.Create.prototype.constructor=N.Create;N.FlexGrid=function(a,b,c){this.game=a.game;this.manager=a;this.width=b;this.height=c;this.boundsCustom=new N.Rectangle(0,0,b,c);this.boundsFluid=new N.Rectangle(0,0,b,c);this.boundsFull=new N.Rectangle(0,0,b,c);this.boundsNone=new N.Rectangle(0,0,b,c);this.positionCustom=new N.Point(0,0);this.positionFluid=new N.Point(0,0);this.positionFull=new N.Point(0,0);this.positionNone=new N.Point(0,0);this.scaleCustom=new N.Point(1,1);this.scaleFluid=new N.Point(1,1);this.scaleFluidInversed=new N.Point(1,1);this.scaleFull=new N.Point(1,1);this.scaleNone=new N.Point(1,1);this.customWidth=0;this.customHeight=0;this.customOffsetX=0;this.customOffsetY=0;this.ratioH=b/c;this.ratioV=c/b;this.multiplier=0;this.layers=[]};N.FlexGrid.prototype={setSize:function(a,b){this.width=a;this.height=b;this.ratioH=a/b;this.ratioV=b/a;this.scaleNone=new N.Point(1,1);this.boundsNone.width=this.width;this.boundsNone.height=this.height;this.refresh()},createCustomLayer:function(a,b,c,d){if(d===undefined){d=true}this.customWidth=a;this.customHeight=b;this.boundsCustom.width=a;this.boundsCustom.height=b;var e=new N.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);if(d){this.game.world.add(e)}this.layers.push(e);if(c){e.addMultiple(c)}return e},createFluidLayer:function(a,b){if(b===undefined){b=true}var c=new N.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);if(b){this.game.world.add(c)}this.layers.push(c);if(a){c.addMultiple(a)}return c},createFullLayer:function(a){var b=new N.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);this.game.world.add(b);this.layers.push(b);if(typeof a!=='undefined'){b.addMultiple(a)}return b},createFixedLayer:function(a){var b=new N.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);this.game.world.add(b);this.layers.push(b);if(typeof a!=='undefined'){b.addMultiple(a)}return b},reset:function(){var i=this.layers.length;while(i--){if(!this.layers[i].persist){this.layers[i].position=null;this.layers[i].scale=null;this.layers.slice(i,1)}}},onResize:function(a,b){this.ratioH=a/b;this.ratioV=b/a;this.refresh(a,b)},refresh:function(){this.multiplier=Math.min((this.manager.height/this.height),(this.manager.width/this.width));this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height);this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x);this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y);this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(a){this.manager.scaleSprite(a);a.x=this.manager.bounds.centerX;a.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+' x '+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,'rgba(255,0,0,0.9',false)}};N.FlexGrid.prototype.constructor=N.FlexGrid;N.FlexLayer=function(a,b,c,d){N.Group.call(this,a.game,null,'__flexLayer'+a.game.rnd.uuid(),false);this.manager=a.manager;this.grid=a;this.persist=false;this.position=b;this.bounds=c;this.scale=d;this.topLeft=c.topLeft;this.topMiddle=new N.Point(c.halfWidth,0);this.topRight=c.topRight;this.bottomLeft=c.bottomLeft;this.bottomMiddle=new N.Point(c.halfWidth,c.bottom);this.bottomRight=c.bottomRight};N.FlexLayer.prototype=Object.create(N.Group.prototype);N.FlexLayer.prototype.constructor=N.FlexLayer;N.FlexLayer.prototype.resize=function(){};N.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+' x '+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,'rgba(0,0,255,0.9',false);this.game.debug.geom(this.topLeft,'rgba(255,255,255,0.9');this.game.debug.geom(this.topMiddle,'rgba(255,255,255,0.9');this.game.debug.geom(this.topRight,'rgba(255,255,255,0.9')};N.Color={RED:0xff0000,ORANGE:0xff9900,YELLOW:0xffff00,GREEN:0x00ff00,AQUA:0x00ffff,BLUE:0x0000ff,VIOLET:0xff00ff,WHITE:0xffffff,BLACK:0,GRAY:0x666666,packPixel:function(r,g,b,a){if(N.Device.LITTLE_ENDIAN){return((a<<24)|(b<<16)|(g<<8)|r)>>>0}else{return((r<<24)|(g<<16)|(b<<8)|a)>>>0}},unpackPixel:function(a,b,c,d){if(b===undefined||b===null){b=N.Color.createColor()}if(c===undefined||c===null){c=false}if(d===undefined||d===null){d=false}if(N.Device.LITTLE_ENDIAN){b.a=((a&0xff000000)>>>24);b.b=((a&0x00ff0000)>>>16);b.g=((a&0x0000ff00)>>>8);b.r=((a&0x000000ff))}else{b.r=((a&0xff000000)>>>24);b.g=((a&0x00ff0000)>>>16);b.b=((a&0x0000ff00)>>>8);b.a=((a&0x000000ff))}b.color=a;b.rgba='rgba('+b.r+','+b.g+','+b.b+','+(b.a/255)+')';if(c){N.Color.RGBtoHSL(b.r,b.g,b.b,b)}if(d){N.Color.RGBtoHSV(b.r,b.g,b.b,b)}return b},fromRGBA:function(a,b){if(!b){b=N.Color.createColor()}b.r=((a&0xff000000)>>>24);b.g=((a&0x00ff0000)>>>16);b.b=((a&0x0000ff00)>>>8);b.a=((a&0x000000ff));b.rgba='rgba('+b.r+','+b.g+','+b.b+','+b.a+')';return b},toRGBA:function(r,g,b,a){return(r<<24)|(g<<16)|(b<<8)|a},toABGR:function(r,g,b,a){return((a<<24)|(b<<16)|(g<<8)|r)>>>0},hexToRGBArray:function(a){return[(a>>16&0xFF)/255,(a>>8&0xFF)/255,(a&0xFF)/255]},RGBArrayToHex:function(a){return((a[0]*255<<16)+(a[1]*255<<8)+a[2]*255)},RGBtoHSL:function(r,g,b,a){if(!a){a=N.Color.createColor(r,g,b,1)}r/=255;g/=255;b/=255;var c=Math.min(r,g,b);var e=Math.max(r,g,b);a.h=0;a.s=0;a.l=(e+c)/2;if(e!==c){var d=e-c;a.s=a.l>0.5?d/(2-e-c):d/(e+c);if(e===r){a.h=(g-b)/d+(g<b?6:0)}else if(e===g){a.h=(b-r)/d+2}else if(e===b){a.h=(r-g)/d+4}a.h/=6}return a},HSLtoRGB:function(h,s,l,a){if(!a){a=N.Color.createColor(l,l,l)}else{a.r=l;a.g=l;a.b=l}if(s!==0){var q=l<0.5?l*(1+s):l+s-l*s;var p=2*l-q;a.r=N.Color.hueToColor(p,q,h+1/3);a.g=N.Color.hueToColor(p,q,h);a.b=N.Color.hueToColor(p,q,h-1/3)}a.r=Math.floor((a.r*255|0));a.g=Math.floor((a.g*255|0));a.b=Math.floor((a.b*255|0));N.Color.updateColor(a);return a},RGBtoHSV:function(r,g,b,a){if(!a){a=N.Color.createColor(r,g,b,255)}r/=255;g/=255;b/=255;var c=Math.min(r,g,b);var e=Math.max(r,g,b);var d=e-c;a.h=0;a.s=e===0?0:d/e;a.v=e;if(e!==c){if(e===r){a.h=(g-b)/d+(g<b?6:0)}else if(e===g){a.h=(b-r)/d+2}else if(e===b){a.h=(r-g)/d+4}a.h/=6}return a},HSVtoRGB:function(h,s,v,a){if(a===undefined){a=N.Color.createColor(0,0,0,1,h,s,0,v)}var r,g,b;var i=Math.floor(h*6);var f=h*6-i;var p=v*(1-s);var q=v*(1-f*s);var t=v*(1-(1-f)*s);switch(i%6){case 0:r=v;g=t;b=p;break;case 1:r=q;g=v;b=p;break;case 2:r=p;g=v;b=t;break;case 3:r=p;g=q;b=v;break;case 4:r=t;g=p;b=v;break;case 5:r=v;g=p;b=q;break}a.r=Math.floor(r*255);a.g=Math.floor(g*255);a.b=Math.floor(b*255);N.Color.updateColor(a);return a},hueToColor:function(p,q,t){if(t<0){t+=1}if(t>1){t-=1}if(t<1/6){return p+(q-p)*6*t}if(t<1/2){return q}if(t<2/3){return p+(q-p)*(2/3-t)*6}return p},createColor:function(r,g,b,a,h,s,l,v){var c={r:r||0,g:g||0,b:b||0,a:a||1,h:h||0,s:s||0,l:l||0,v:v||0,color:0,color32:0,rgba:''};return N.Color.updateColor(c)},updateColor:function(a){a.rgba='rgba('+a.r.toFixed()+','+a.g.toFixed()+','+a.b.toFixed()+','+a.a.toString()+')';a.color=N.Color.getColor(a.r,a.g,a.b);a.color32=N.Color.getColor32(a.a*255,a.r,a.g,a.b);return a},getColor32:function(a,r,g,b){return a<<24|r<<16|g<<8|b},getColor:function(r,g,b){return r<<16|g<<8|b},RGBtoString:function(r,g,b,a,c){if(a===undefined){a=255}if(c===undefined){c='#'}if(c==='#'){return'#'+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1)}else{return'0x'+N.Color.componentToHex(a)+N.Color.componentToHex(r)+N.Color.componentToHex(g)+N.Color.componentToHex(b)}},hexToRGB:function(a){var b=N.Color.hexToColor(a);if(b){return N.Color.getColor32(b.a,b.r,b.g,b.b)}},hexToColor:function(a,c){a=a.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(m,r,g,b){return r+r+g+g+b+b});var d=(/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i).exec(a);if(d){var r=parseInt(d[1],16);var g=parseInt(d[2],16);var b=parseInt(d[3],16);if(!c){c=N.Color.createColor(r,g,b)}else{c.r=r;c.g=g;c.b=b}}return c},webToColor:function(a,b){if(!b){b=N.Color.createColor()}var c=(/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/).exec(a);if(c){b.r=~~Number(c[1]);b.g=~~Number(c[2]);b.b=~~Number(c[3]);b.a=c[4]!==undefined?Number(c[4]):1;N.Color.updateColor(b)}return b},valueToColor:function(a,b){if(!b){b=N.Color.createColor()}if(typeof a==='string'){if(a.indexOf('rgb')===0){return N.Color.webToColor(a,b)}else{b.a=1;return N.Color.hexToColor(a,b)}}else if(typeof a==='number'){var c=N.Color.getRGB(a);b.r=c.r;b.g=c.g;b.b=c.b;b.a=c.a/255;return b}else{return b}},componentToHex:function(a){var b=a.toString(16);return(b.length===1)?'0'+b:b},HSVColorWheel:function(s,v){if(s===undefined){s=1.0}if(v===undefined){v=1.0}var a=[];for(var c=0;c<=359;c++){a.push(N.Color.HSVtoRGB(c/359,s,v))}return a},HSLColorWheel:function(s,l){if(s===undefined){s=0.5}if(l===undefined){l=0.5}var a=[];for(var c=0;c<=359;c++){a.push(N.Color.HSLtoRGB(c/359,s,l))}return a},interpolateColor:function(a,c,d,e,f,i){if(f===undefined){f=255}if(i===undefined){i=0}var j=N.Color.getRGB(a);var k=N.Color.getRGB(c);if(i===0){var r=(((k.red-j.red)*e)/d)+j.red;var g=(((k.green-j.green)*e)/d)+j.green;var b=(((k.blue-j.blue)*e)/d)+j.blue}if(i===1){var l=N.Color.RGBtoHSV(j.r,j.g,j.b);var m=N.Color.RGBtoHSV(k.r,k.g,k.b);var n=m.h-l.h;var h;if(l.h>m.h){var o=m.h;m.h=l.h;l.h=o;n=-n;e=d-e}if(n>0.5){l.h=l.h+1;h=(((m.h-l.h)*e/d)+l.h)%1}if(n<=0.5){h=((m.h-l.h)*e/d)+l.h}var s=(((m.s-l.s)*e)/d)+l.s;var v=(((m.v-l.v)*e)/d)+l.v;var p=N.Color.HSVtoRGB(h,s,v,p);var r=p.r;var g=p.g;var b=p.b}return N.Color.getColor32(f,r,g,b)},interpolateColorWithRGB:function(a,r,g,b,c,d){var e=N.Color.getRGB(a);var f=(((r-e.red)*d)/c)+e.red;var h=(((g-e.green)*d)/c)+e.green;var i=(((b-e.blue)*d)/c)+e.blue;return N.Color.getColor(f,h,i)},interpolateRGB:function(a,c,d,e,f,h,i,j){var r=(((e-a)*j)/i)+a;var g=(((f-c)*j)/i)+c;var b=(((h-d)*j)/i)+d;return N.Color.getColor(r,g,b)},linear:function(a,b,t){return this.interpolateColor(a,b,1,t)},linearInterpolation:function(a,t){var k=N.Math.linear(0,a.length-1,t);var b=a[Math.floor(k)];var c=a[Math.ceil(k)];return this.linear(b,c,k%1)},getRandomColor:function(a,b,c){if(a===undefined){a=0}if(b===undefined){b=255}if(c===undefined){c=255}if(b>255||a>b){return N.Color.getColor(255,255,255)}var d=a+Math.round(Math.random()*(b-a));var e=a+Math.round(Math.random()*(b-a));var f=a+Math.round(Math.random()*(b-a));return N.Color.getColor32(c,d,e,f)},getRGB:function(a){if(a>16777215){return{alpha:a>>>24,red:a>>16&0xFF,green:a>>8&0xFF,blue:a&0xFF,a:a>>>24,r:a>>16&0xFF,g:a>>8&0xFF,b:a&0xFF}}else{return{alpha:255,red:a>>16&0xFF,green:a>>8&0xFF,blue:a&0xFF,a:255,r:a>>16&0xFF,g:a>>8&0xFF,b:a&0xFF}}},getWebRGB:function(a){if(typeof a==='object'){return'rgba('+a.r.toString()+','+a.g.toString()+','+a.b.toString()+','+(a.a/255).toString()+')'}else{var b=N.Color.getRGB(a);return'rgba('+b.r.toString()+','+b.g.toString()+','+b.b.toString()+','+(b.a/255).toString()+')'}},getAlpha:function(a){return a>>>24},getAlphaFloat:function(a){return(a>>>24)/255},getRed:function(a){return a>>16&0xFF},getGreen:function(a){return a>>8&0xFF},getBlue:function(a){return a&0xFF},blendNormal:function(a){return a},blendLighten:function(a,b){return(b>a)?b:a},blendDarken:function(a,b){return(b>a)?a:b},blendMultiply:function(a,b){return(a*b)/255},blendAverage:function(a,b){return(a+b)/2},blendAdd:function(a,b){return Math.min(255,a+b)},blendSubtract:function(a,b){return Math.max(0,a+b-255)},blendDifference:function(a,b){return Math.abs(a-b)},blendNegation:function(a,b){return 255-Math.abs(255-a-b)},blendScreen:function(a,b){return 255-(((255-a)*(255-b))>>8)},blendExclusion:function(a,b){return a+b-2*a*b/255},blendOverlay:function(a,b){return b<128?(2*a*b/255):(255-2*(255-a)*(255-b)/255)},blendSoftLight:function(a,b){return b<128?(2*((a>>1)+64))*(b/255):255-(2*(255-((a>>1)+64))*(255-b)/255)},blendHardLight:function(a,b){return N.Color.blendOverlay(b,a)},blendColorDodge:function(a,b){return b===255?b:Math.min(255,((a<<8)/(255-b)))},blendColorBurn:function(a,b){return b===0?b:Math.max(0,(255-((255-a)<<8)/b))},blendLinearDodge:function(a,b){return N.Color.blendAdd(a,b)},blendLinearBurn:function(a,b){return N.Color.blendSubtract(a,b)},blendLinearLight:function(a,b){return b<128?N.Color.blendLinearBurn(a,2*b):N.Color.blendLinearDodge(a,(2*(b-128)))},blendVividLight:function(a,b){return b<128?N.Color.blendColorBurn(a,2*b):N.Color.blendColorDodge(a,(2*(b-128)))},blendPinLight:function(a,b){return b<128?N.Color.blendDarken(a,2*b):N.Color.blendLighten(a,(2*(b-128)))},blendHardMix:function(a,b){return N.Color.blendVividLight(a,b)<128?0:255},blendReflect:function(a,b){return b===255?b:Math.min(255,(a*a/(255-b)))},blendGlow:function(a,b){return N.Color.blendReflect(b,a)},blendPhoenix:function(a,b){return Math.min(a,b)-Math.max(a,b)+255}};N.Physics=function(a,b){b=b||{};this.game=a;this.config=b;this.arcade=null;this.p2=null;this.ninja=null;this.box2d=null;this.chipmunk=null;this.matter=null;this.parseConfig()};N.Physics.ARCADE=0;N.Physics.P2JS=1;N.Physics.NINJA=2;N.Physics.BOX2D=3;N.Physics.CHIPMUNK=4;N.Physics.MATTERJS=5;N.Physics.prototype={parseConfig:function(){if((!this.config.hasOwnProperty('arcade')||this.config.arcade===true)&&N.Physics.hasOwnProperty('Arcade')){this.arcade=new N.Physics.Arcade(this.game)}if(this.config.hasOwnProperty('ninja')&&this.config.ninja===true&&N.Physics.hasOwnProperty('Ninja')){this.ninja=new N.Physics.Ninja(this.game)}if(this.config.hasOwnProperty('p2')&&this.config.p2===true&&N.Physics.hasOwnProperty('P2')){this.p2=new N.Physics.P2(this.game,this.config)}if(this.config.hasOwnProperty('box2d')&&this.config.box2d===true&&N.Physics.hasOwnProperty('BOX2D')){this.box2d=new N.Physics.Box2D(this.game,this.config)}if(this.config.hasOwnProperty('matter')&&this.config.matter===true&&N.Physics.hasOwnProperty('Matter')){this.matter=new N.Physics.Matter(this.game,this.config)}},startSystem:function(a){if(a===N.Physics.ARCADE){this.arcade=new N.Physics.Arcade(this.game)}else if(a===N.Physics.P2JS){if(this.p2===null){this.p2=new N.Physics.P2(this.game,this.config)}else{this.p2.reset()}}else if(a===N.Physics.NINJA){this.ninja=new N.Physics.Ninja(this.game)}else if(a===N.Physics.BOX2D){if(this.box2d===null){this.box2d=new N.Physics.Box2D(this.game,this.config)}else{this.box2d.reset()}}else if(a===N.Physics.MATTERJS){if(this.matter===null){this.matter=new N.Physics.Matter(this.game,this.config)}else{this.matter.reset()}}},enable:function(a,b,c){if(b===undefined){b=N.Physics.ARCADE}if(c===undefined){c=false}if(b===N.Physics.ARCADE){this.arcade.enable(a)}else if(b===N.Physics.P2JS&&this.p2){this.p2.enable(a,c)}else if(b===N.Physics.NINJA&&this.ninja){this.ninja.enableAABB(a)}else if(b===N.Physics.BOX2D&&this.box2d){this.box2d.enable(a)}else if(b===N.Physics.MATTERJS&&this.matter){this.matter.enable(a)}else{console.warn(a.key+' is attempting to enable a physics body using an unknown physics system.')}},preUpdate:function(){if(this.p2){this.p2.preUpdate()}if(this.box2d){this.box2d.preUpdate()}if(this.matter){this.matter.preUpdate()}},update:function(){if(this.p2){this.p2.update()}if(this.box2d){this.box2d.update()}if(this.matter){this.matter.update()}},setBoundsToWorld:function(){if(this.arcade){this.arcade.setBoundsToWorld()}if(this.ninja){this.ninja.setBoundsToWorld()}if(this.p2){this.p2.setBoundsToWorld()}if(this.box2d){this.box2d.setBoundsToWorld()}if(this.matter){this.matter.setBoundsToWorld()}},clear:function(){if(this.p2){this.p2.clear()}if(this.box2d){this.box2d.clear()}if(this.matter){this.matter.clear()}},reset:function(){if(this.p2){this.p2.reset()}if(this.box2d){this.box2d.reset()}if(this.matter){this.matter.reset()}},destroy:function(){if(this.p2){this.p2.destroy()}if(this.box2d){this.box2d.destroy()}if(this.matter){this.matter.destroy()}this.arcade=null;this.ninja=null;this.p2=null;this.box2d=null;this.matter=null}};N.Physics.prototype.constructor=N.Physics;N.Physics.Arcade=function(a){this.game=a;this.gravity=new N.Point();this.bounds=new N.Rectangle(0,0,a.world.width,a.world.height);this.checkCollision={up:true,down:true,left:true,right:true};this.maxObjects=10;this.maxLevels=4;this.OVERLAP_BIAS=4;this.forceX=false;this.sortDirection=N.Physics.Arcade.LEFT_RIGHT;this.skipQuadTree=true;this.isPaused=false;this.quadTree=new N.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._total=0;this.setBoundsToWorld()};N.Physics.Arcade.prototype.constructor=N.Physics.Arcade;N.Physics.Arcade.SORT_NONE=0;N.Physics.Arcade.LEFT_RIGHT=1;N.Physics.Arcade.RIGHT_LEFT=2;N.Physics.Arcade.TOP_BOTTOM=3;N.Physics.Arcade.BOTTOM_TOP=4;N.Physics.Arcade.prototype={setBounds:function(x,y,a,b){this.bounds.setTo(x,y,a,b)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(a,b){if(b===undefined){b=true}var i=1;if(Array.isArray(a)){i=a.length;while(i--){if(a[i]instanceof N.Group){this.enable(a[i].children,b)}else{this.enableBody(a[i]);if(b&&a[i].hasOwnProperty('children')&&a[i].children.length>0){this.enable(a[i],true)}}}}else if(a instanceof N.Group){this.enable(a.children,b)}else{this.enableBody(a);if(b&&a.hasOwnProperty('children')&&a.children.length>0){this.enable(a.children,true)}}},enableBody:function(a){if(a.hasOwnProperty('body')&&a.body===null){a.body=new N.Physics.Arcade.Body(a);if(a.parent&&a.parent instanceof N.Group){a.parent.addToHash(a)}}},updateMotion:function(a){if(a.allowRotation){var b=this.computeVelocity(0,a,a.angularVelocity,a.angularAcceleration,a.angularDrag,a.maxAngular)-a.angularVelocity;a.angularVelocity+=b;a.rotation+=(a.angularVelocity*0.001*this.game.time.delta)}a.velocity.x=this.computeVelocity(1,a,a.velocity.x,a.acceleration.x,a.drag.x,a.maxVelocity.x);a.velocity.y=this.computeVelocity(2,a,a.velocity.y,a.acceleration.y,a.drag.y,a.maxVelocity.y)},computeVelocity:function(a,b,c,d,e,f){if(f===undefined){f=10000}if(a===1&&b.allowGravity){c+=(this.gravity.x+b.gravity.x)*0.001*this.game.time.delta}else if(a===2&&b.allowGravity){c+=(this.gravity.y+b.gravity.y)*0.001*this.game.time.delta}if(d){c+=d*0.001*this.game.time.delta}else if(e&&b.allowDrag){e*=0.001*this.game.time.delta;if(c-e>0){c-=e}else if(c+e<0){c+=e}else{c=0}}if(c>f){c=f}else if(c<-f){c=-f}return c},overlap:function(a,b,c,d,e){c=c||null;d=d||null;e=e||c;this._total=0;this.collideObjects(a,b,c,d,e,true);return(this._total>0)},collide:function(a,b,c,d,e){c=c||null;d=d||null;e=e||c;this._total=0;this.collideObjects(a,b,c,d,e,false);return(this._total>0)},sortLeftRight:function(a,b){if(!a.body||!b.body){return 0}return a.body.x-b.body.x},sortRightLeft:function(a,b){if(!a.body||!b.body){return 0}return b.body.x-a.body.x},sortTopBottom:function(a,b){if(!a.body||!b.body){return 0}return a.body.y-b.body.y},sortBottomTop:function(a,b){if(!a.body||!b.body){return 0}return b.body.y-a.body.y},sort:function(a,b){if(a.physicsSortDirection!==null){b=a.physicsSortDirection}else if(b===undefined){b=this.sortDirection}if(b===N.Physics.Arcade.LEFT_RIGHT){a.hash.sort(this.sortLeftRight)}else if(b===N.Physics.Arcade.RIGHT_LEFT){a.hash.sort(this.sortRightLeft)}else if(b===N.Physics.Arcade.TOP_BOTTOM){a.hash.sort(this.sortTopBottom)}else if(b===N.Physics.Arcade.BOTTOM_TOP){a.hash.sort(this.sortBottomTop)}},collideObjects:function(a,b,c,d,e,f){if(!Array.isArray(a)&&Array.isArray(b)){for(var i=0;i<b.length;i++){if(!b[i]){continue}this.collideHandler(a,b[i],c,d,e,f)}}else if(Array.isArray(a)&&!Array.isArray(b)){for(var i=0;i<a.length;i++){if(!a[i]){continue}this.collideHandler(a[i],b,c,d,e,f)}}else if(Array.isArray(a)&&Array.isArray(b)){for(var i=0;i<a.length;i++){if(!a[i]){continue}for(var j=0;j<b.length;j++){if(!b[j]){continue}this.collideHandler(a[i],b[j],c,d,e,f)}}}else{this.collideHandler(a,b,c,d,e,f)}},collideHandler:function(a,b,c,d,e,f){if(b===undefined&&a.physicsType===N.GROUP){this.sort(a);this.collideGroupVsSelf(a,c,d,e,f);return}if(!a||!b||!a.exists||!b.exists){return}if(this.sortDirection!==N.Physics.Arcade.SORT_NONE){if(a.physicsType===N.GROUP){this.sort(a)}if(b.physicsType===N.GROUP){this.sort(b)}}if(a.physicsType===N.SPRITE){if(b.physicsType===N.SPRITE){this.collideSpriteVsSprite(a,b,c,d,e,f)}else if(b.physicsType===N.GROUP){this.collideSpriteVsGroup(a,b,c,d,e,f)}else if(b.physicsType===N.TILEMAPLAYER){this.collideSpriteVsTilemapLayer(a,b,c,d,e,f)}}else if(a.physicsType===N.GROUP){if(b.physicsType===N.SPRITE){this.collideSpriteVsGroup(b,a,c,d,e,f)}else if(b.physicsType===N.GROUP){this.collideGroupVsGroup(a,b,c,d,e,f)}else if(b.physicsType===N.TILEMAPLAYER){this.collideGroupVsTilemapLayer(a,b,c,d,e,f)}}else if(a.physicsType===N.TILEMAPLAYER){if(b.physicsType===N.SPRITE){this.collideSpriteVsTilemapLayer(b,a,c,d,e,f)}else if(b.physicsType===N.GROUP){this.collideGroupVsTilemapLayer(b,a,c,d,e,f)}}},collideSpriteVsSprite:function(a,b,c,d,e,f){if(!a.body||!b.body){return false}if(this.separate(a.body,b.body,d,e,f)){if(c){c.call(e,a,b)}this._total++}return true},collideSpriteVsGroup:function(a,b,c,d,e,f){if(b.length===0||!a.body){return}if(this.skipQuadTree||a.body.skipQuadTree){var g={};for(var i=0;i<b.hash.length;i++){var h=b.hash[i];if(!h||!h.exists||!h.body){continue}g=h.body.getBounds(g);if(this.sortDirection===N.Physics.Arcade.LEFT_RIGHT){if(a.body.right<g.x){break}else if(g.right<a.body.x){continue}}else if(this.sortDirection===N.Physics.Arcade.RIGHT_LEFT){if(a.body.x>g.right){break}else if(g.x>a.body.right){continue}}else if(this.sortDirection===N.Physics.Arcade.TOP_BOTTOM){if(a.body.bottom<g.y){break}else if(g.bottom<a.body.y){continue}}else if(this.sortDirection===N.Physics.Arcade.BOTTOM_TOP){if(a.body.y>g.bottom){break}else if(g.y>a.body.bottom){continue}}this.collideSpriteVsSprite(a,h,c,d,e,f)}}else{this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(b);var j=this.quadTree.retrieve(a);for(var i=0;i<j.length;i++){if(this.separate(a.body,j[i],d,e,f)){if(c){c.call(e,a,j[i].sprite)}this._total++}}}},collideGroupVsSelf:function(a,b,c,d,e){if(a.length===0){return}for(var i=0;i<a.hash.length;i++){var f={};var g=a.hash[i];if(!g||!g.exists||!g.body){continue}f=g.body.getBounds(f);for(var j=i+1;j<a.hash.length;j++){var h={};var k=a.hash[j];if(!k||!k.exists||!k.body){continue}h=k.body.getBounds(h);if(this.sortDirection===N.Physics.Arcade.LEFT_RIGHT){if(f.right<h.x){break}else if(h.right<f.x){continue}}else if(this.sortDirection===N.Physics.Arcade.RIGHT_LEFT){if(f.x>h.right){continue}else if(h.x>f.right){break}}else if(this.sortDirection===N.Physics.Arcade.TOP_BOTTOM){if(f.bottom<h.y){continue}else if(h.bottom<f.y){break}}else if(this.sortDirection===N.Physics.Arcade.BOTTOM_TOP){if(f.y>h.bottom){continue}else if(h.y>g.body.bottom){break}}this.collideSpriteVsSprite(g,k,b,c,d,e)}}},collideGroupVsGroup:function(a,b,c,d,e,f){if(a.length===0||b.length===0){return}for(var i=0;i<a.children.length;i++){if(a.children[i].exists){if(a.children[i].physicsType===N.GROUP){this.collideGroupVsGroup(a.children[i],b,c,d,e,f)}else{this.collideSpriteVsGroup(a.children[i],b,c,d,e,f)}}}},separate:function(a,b,c,d,e){if(!a.enable||!b.enable||a.checkCollision.none||b.checkCollision.none||!this.intersects(a,b)){return false}if(c&&c.call(d,a.sprite,b.sprite)===false){return false}if(a.isCircle&&b.isCircle){return this.separateCircle(a,b,e)}if(a.isCircle!==b.isCircle){var f=(a.isCircle)?b:a;var g=(a.isCircle)?a:b;var h={x:f.x,y:f.y,right:f.right,bottom:f.bottom};var i=g.center;if(i.y<h.y||i.y>h.bottom){if(i.x<h.x||i.x>h.right){return this.separateCircle(a,b,e)}}}var j=false;var k=false;if(this.forceX||Math.abs(this.gravity.y+a.gravity.y)<Math.abs(this.gravity.x+a.gravity.x)){j=this.separateX(a,b,e);if(this.intersects(a,b)){k=this.separateY(a,b,e)}}else{k=this.separateY(a,b,e);if(this.intersects(a,b)){j=this.separateX(a,b,e)}}var l=(j||k);if(l){if(e){if(a.onOverlap){a.onOverlap.dispatch(a.sprite,b.sprite)}if(b.onOverlap){b.onOverlap.dispatch(b.sprite,a.sprite)}}else{if(a.onCollide){a.onCollide.dispatch(a.sprite,b.sprite)}if(b.onCollide){b.onCollide.dispatch(b.sprite,a.sprite)}}}return l},intersects:function(a,b){if(a===b){return false}if(a.isCircle){if(b.isCircle){return N.Math.distance(a.center.x,a.center.y,b.center.x,b.center.y)<=(a.halfWidth+b.halfWidth)}else{return this.circleBodyIntersects(a,b)}}else if(b.isCircle){return this.circleBodyIntersects(b,a)}else{if(a.right<=b.position.x){return false}if(a.bottom<=b.position.y){return false}if(a.position.x>=b.right){return false}if(a.position.y>=b.bottom){return false}return true}},circleBodyIntersects:function(a,b){var x=N.Math.clamp(a.center.x,b.left,b.right);var y=N.Math.clamp(a.center.y,b.top,b.bottom);var c=(a.center.x-x)*(a.center.x-x);var d=(a.center.y-y)*(a.center.y-y);return(c+d)<=(a.halfWidth*a.halfWidth)},separateCircle:function(a,b,c){this.getOverlapX(a,b);this.getOverlapY(a,b);var d=b.center.x-a.center.x;var e=b.center.y-a.center.y;var f=Math.atan2(e,d);var g=0;if(a.isCircle!==b.isCircle){var h={x:(b.isCircle)?a.position.x:b.position.x,y:(b.isCircle)?a.position.y:b.position.y,right:(b.isCircle)?a.right:b.right,bottom:(b.isCircle)?a.bottom:b.bottom};var i={x:(a.isCircle)?a.center.x:b.center.x,y:(a.isCircle)?a.center.y:b.center.y,radius:(a.isCircle)?a.halfWidth:b.halfWidth};if(i.y<h.y){if(i.x<h.x){g=N.Math.distance(i.x,i.y,h.x,h.y)-i.radius}else if(i.x>h.right){g=N.Math.distance(i.x,i.y,h.right,h.y)-i.radius}}else if(i.y>h.bottom){if(i.x<h.x){g=N.Math.distance(i.x,i.y,h.x,h.bottom)-i.radius}else if(i.x>h.right){g=N.Math.distance(i.x,i.y,h.right,h.bottom)-i.radius}}g*=-1}else{g=(a.halfWidth+b.halfWidth)-N.Math.distance(a.center.x,a.center.y,b.center.x,b.center.y)}if(c||g===0||(a.immovable&&b.immovable)||a.customSeparateX||b.customSeparateX){if(g!==0){if(a.onOverlap){a.onOverlap.dispatch(a.sprite,b.sprite)}if(b.onOverlap){b.onOverlap.dispatch(b.sprite,a.sprite)}}return(g!==0)}var j={x:a.velocity.x*Math.cos(f)+a.velocity.y*Math.sin(f),y:-a.velocity.x*Math.sin(f)+a.velocity.y*Math.cos(f)};var k={x:b.velocity.x*Math.cos(f)+b.velocity.y*Math.sin(f),y:-b.velocity.x*Math.sin(f)+b.velocity.y*Math.cos(f)};var l=((a.mass-b.mass)*j.x+2*b.mass*k.x)/(a.mass+b.mass);var m=(2*a.mass*j.x+(b.mass-a.mass)*k.x)/(a.mass+b.mass);if(!a.immovable){a.velocity.x=(l*Math.cos(f)-j.y*Math.sin(f))*a.bounce.x;a.velocity.y=(j.y*Math.cos(f)+l*Math.sin(f))*a.bounce.y}if(!b.immovable){b.velocity.x=(m*Math.cos(f)-k.y*Math.sin(f))*b.bounce.x;b.velocity.y=(k.y*Math.cos(f)+m*Math.sin(f))*b.bounce.y}if(Math.abs(f)<Math.PI/2){if((a.velocity.x>0)&&!a.immovable&&(b.velocity.x>a.velocity.x)){a.velocity.x*=-1}else if((b.velocity.x<0)&&!b.immovable&&(a.velocity.x<b.velocity.x)){b.velocity.x*=-1}else if((a.velocity.y>0)&&!a.immovable&&(b.velocity.y>a.velocity.y)){a.velocity.y*=-1}else if((b.velocity.y<0)&&!b.immovable&&(a.velocity.y<b.velocity.y)){b.velocity.y*=-1}}else if(Math.abs(f)>Math.PI/2){if((a.velocity.x<0)&&!a.immovable&&(b.velocity.x<a.velocity.x)){a.velocity.x*=-1}else if((b.velocity.x>0)&&!b.immovable&&(a.velocity.x>b.velocity.x)){b.velocity.x*=-1}else if((a.velocity.y<0)&&!a.immovable&&(b.velocity.y<a.velocity.y)){a.velocity.y*=-1}else if((b.velocity.y>0)&&!b.immovable&&(a.velocity.x>b.velocity.y)){b.velocity.y*=-1}}if(!a.immovable){a.x+=(a.velocity.x*0.001*this.game.time.delta)-g*Math.cos(f);a.y+=(a.velocity.y*0.001*this.game.time.delta)-g*Math.sin(f)}if(!b.immovable){b.x+=(b.velocity.x*0.001*this.game.time.delta)+g*Math.cos(f);b.y+=(b.velocity.y*0.001*this.game.time.delta)+g*Math.sin(f)}if(a.onCollide){a.onCollide.dispatch(a.sprite,b.sprite)}if(b.onCollide){b.onCollide.dispatch(b.sprite,a.sprite)}return true},getOverlapX:function(a,b,c){var d=0;var e=a.deltaAbsX()+b.deltaAbsX()+this.OVERLAP_BIAS;if(a.deltaX()===0&&b.deltaX()===0){a.embedded=true;b.embedded=true}else if(a.deltaX()>b.deltaX()){d=a.right-b.x;if((d>e&&!c)||a.checkCollision.right===false||b.checkCollision.left===false){d=0}else{a.touching.none=false;a.touching.right=true;b.touching.none=false;b.touching.left=true}}else if(a.deltaX()<b.deltaX()){d=a.x-b.width-b.x;if((-d>e&&!c)||a.checkCollision.left===false||b.checkCollision.right===false){d=0}else{a.touching.none=false;a.touching.left=true;b.touching.none=false;b.touching.right=true}}a.overlapX=d;b.overlapX=d;return d},getOverlapY:function(a,b,c){var d=0;var e=a.deltaAbsY()+b.deltaAbsY()+this.OVERLAP_BIAS;if(a.deltaY()===0&&b.deltaY()===0){a.embedded=true;b.embedded=true}else if(a.deltaY()>b.deltaY()){d=a.bottom-b.y;if((d>e&&!c)||a.checkCollision.down===false||b.checkCollision.up===false){d=0}else{a.touching.none=false;a.touching.down=true;b.touching.none=false;b.touching.up=true}}else if(a.deltaY()<b.deltaY()){d=a.y-b.bottom;if((-d>e&&!c)||a.checkCollision.up===false||b.checkCollision.down===false){d=0}else{a.touching.none=false;a.touching.up=true;b.touching.none=false;b.touching.down=true}}a.overlapY=d;b.overlapY=d;return d},separateX:function(a,b,c){var d=this.getOverlapX(a,b,c);if(c||d===0||(a.immovable&&b.immovable)||a.customSeparateX||b.customSeparateX){return(d!==0)||(a.embedded&&b.embedded)}var e=a.velocity.x;var f=b.velocity.x;if(!a.immovable&&!b.immovable){d*=0.5;a.x-=d;b.x+=d;var g=Math.sqrt((f*f*b.mass)/a.mass)*((f>0)?1:-1);var h=Math.sqrt((e*e*a.mass)/b.mass)*((e>0)?1:-1);var i=(g+h)*0.5;g-=i;h-=i;a.velocity.x=i+g*a.bounce.x;b.velocity.x=i+h*b.bounce.x}else if(!a.immovable){a.x-=d;a.velocity.x=f-e*a.bounce.x;if(b.moves){a.y+=(b.y-b.prev.y)*b.friction.y}}else{b.x+=d;b.velocity.x=e-f*b.bounce.x;if(a.moves){b.y+=(a.y-a.prev.y)*a.friction.y}}return true},separateY:function(a,b,c){var d=this.getOverlapY(a,b,c);if(c||d===0||(a.immovable&&b.immovable)||a.customSeparateY||b.customSeparateY){return(d!==0)||(a.embedded&&b.embedded)}var e=a.velocity.y;var f=b.velocity.y;if(!a.immovable&&!b.immovable){d*=0.5;a.y-=d;b.y+=d;var g=Math.sqrt((f*f*b.mass)/a.mass)*((f>0)?1:-1);var h=Math.sqrt((e*e*a.mass)/b.mass)*((e>0)?1:-1);var i=(g+h)*0.5;g-=i;h-=i;a.velocity.y=i+g*a.bounce.y;b.velocity.y=i+h*b.bounce.y}else if(!a.immovable){a.y-=d;a.velocity.y=f-e*a.bounce.y;if(b.moves){a.x+=(b.x-b.prev.x)*b.friction.x}}else{b.y+=d;b.velocity.y=e-f*b.bounce.y;if(a.moves){b.x+=(a.x-a.prev.x)*a.friction.x}}return true},getObjectsUnderPointer:function(a,b,c,d){if(b.length===0||!a.exists){return}return this.getObjectsAtLocation(a.x,a.y,b,c,d,a)},getObjectsAtLocation:function(x,y,a,b,c,d){this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(a);var e=new N.Rectangle(x,y,1,1);var f=[];var g=this.quadTree.retrieve(e);for(var i=0;i<g.length;i++){if(g[i].hitTest(x,y)){if(b){b.call(c,d,g[i].sprite)}f.push(g[i].sprite)}}return f},moveToObject:function(a,b,c,d){if(c===undefined){c=60}if(d===undefined){d=0}var e=N.Point.angle(b,a);if(d>0){c=this.distanceBetween(a,b)/(d/1000)}a.body.velocity.setToPolar(e,c);return e},moveToPointer:function(a,b,c,d){if(b===undefined){b=60}c=c||this.game.input.activePointer;if(d===undefined){d=0}var e=this.angleToPointer(a,c);if(d>0){b=this.distanceToPointer(a,c)/(d/1000)}a.body.velocity.setToPolar(e,b);return e},moveToXY:function(a,x,y,b,c){if(b===undefined){b=60}if(c===undefined){c=0}var d=Math.atan2(y-a.y,x-a.x);if(c>0){b=this.distanceToXY(a,x,y)/(c/1000)}a.body.velocity.setToPolar(d,b);return d},velocityFromAngle:function(a,b,c){if(b===undefined){b=60}c=c||new N.Point();return c.setToPolar(a,b,true)},velocityFromRotation:function(a,b,c){if(b===undefined){b=60}c=c||new N.Point();return c.setToPolar(a,b)},accelerationFromRotation:function(a,b,c){if(b===undefined){b=60}c=c||new N.Point();return c.setToPolar(a,b)},accelerateToObject:function(a,b,c,d,e){if(c===undefined){c=60}if(d===undefined){d=1000}if(e===undefined){e=1000}var f=this.angleBetween(a,b);a.body.acceleration.setToPolar(f,c);a.body.maxVelocity.setTo(d,e);return f},accelerateToPointer:function(a,b,c,d,e){if(c===undefined){c=60}if(b===undefined){b=this.game.input.activePointer}if(d===undefined){d=1000}if(e===undefined){e=1000}var f=this.angleToPointer(a,b);a.body.acceleration.setToPolar(f,c);a.body.maxVelocity.setTo(d,e);return f},accelerateToXY:function(a,x,y,b,c,d){if(b===undefined){b=60}if(c===undefined){c=1000}if(d===undefined){d=1000}var e=this.angleToXY(a,x,y);a.body.acceleration.setTo(e,b);a.body.maxVelocity.setTo(c,d);return e},distanceBetween:function(a,b,c,d){if(c===undefined){c=false}var e;var f;if(d){e=a.centerX-b.centerX;f=a.centerY-b.centerY}else if(c){e=a.world.x-b.world.x;f=a.world.y-b.world.y}else{e=a.x-b.x;f=a.y-b.y}return Math.sqrt(e*e+f*f)},distanceToXY:function(a,x,y,b){if(b===undefined){b=false}var c=(b)?a.world.x-x:a.x-x;var d=(b)?a.world.y-y:a.y-y;return Math.sqrt(c*c+d*d)},distanceToPointer:function(a,b,c){if(b===undefined){b=this.game.input.activePointer}if(c===undefined){c=false}var d=(c)?a.world.x-b.worldX:a.x-b.worldX;var e=(c)?a.world.y-b.worldY:a.y-b.worldY;return Math.sqrt(d*d+e*e)},closest:function(a,b,c,d){var e=Infinity;var f=null;for(var i=0,len=b.length;i<len;i++){var g=b[i];var h=this.distanceBetween(a,g,c,d);if(h<e){f=g;e=h}}return f},farthest:function(a,b,c,d){var e=-1;var f=null;for(var i=0,len=b.length;i<len;i++){var g=b[i];var h=this.distanceBetween(a,g,c,d);if(h>e){f=g;e=h}}return f},angleBetween:function(a,b,c){if(c===undefined){c=false}if(c){return N.Point.angle(b.world,a.world)}else{return N.Point.angle(b,a)}},angleBetweenCenters:function(a,b){var c=b.centerX-a.centerX;var d=b.centerY-a.centerY;return Math.atan2(d,c)},angleToXY:function(a,x,y,b){if(b===undefined){b=false}if(b){return Math.atan2(y-a.world.y,x-a.world.x)}else{return Math.atan2(y-a.y,x-a.x)}},angleToPointer:function(a,b,c){if(b===undefined){b=this.game.input.activePointer}if(c===undefined){c=false}if(c){return Math.atan2(b.worldY-a.world.y,b.worldX-a.world.x)}else{return Math.atan2(b.worldY-a.y,b.worldX-a.x)}},worldAngleToPointer:function(a,b){return this.angleToPointer(a,b,true)}};N.Physics.Arcade.Body=function(a){this.sprite=a;this.game=a.game;this.type=N.Physics.ARCADE;this.enable=true;this.isCircle=false;this.radius=0;this.offset=new N.Point();this.position=new N.Point(a.x,a.y);this.prev=new N.Point(this.position.x,this.position.y);this.allowRotation=true;this.rotation=a.angle;this.preRotation=a.angle;this.width=a.width;this.height=a.height;this.sourceWidth=a.width;this.sourceHeight=a.height;if(a.texture){this.sourceWidth=a.texture.frame.width;this.sourceHeight=a.texture.frame.height}this.halfWidth=Math.abs(a.width/2);this.halfHeight=Math.abs(a.height/2);this.center=new N.Point(a.x+this.halfWidth,a.y+this.halfHeight);this.velocity=new N.Point();this.newVelocity=new N.Point();this.deltaMax=new N.Point();this.acceleration=new N.Point();this.allowDrag=true;this.drag=new N.Point();this.allowGravity=true;this.gravity=new N.Point();this.bounce=new N.Point();this.worldBounce=null;this.onWorldBounds=null;this.onCollide=null;this.onOverlap=null;this.maxVelocity=new N.Point(10000,10000);this.friction=new N.Point(1,0);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1000;this.mass=1;this.angle=0;this.speed=0;this.facing=N.NONE;this.immovable=false;this.moves=true;this.customSeparateX=false;this.customSeparateY=false;this.overlapX=0;this.overlapY=0;this.overlapR=0;this.embedded=false;this.collideWorldBounds=false;this.checkCollision={none:false,up:true,down:true,left:true,right:true};this.touching={none:true,up:false,down:false,left:false,right:false};this.wasTouching={none:true,up:false,down:false,left:false,right:false};this.blocked={none:true,up:false,down:false,left:false,right:false};this.tilePadding=new N.Point();this.dirty=false;this.skipQuadTree=false;this.syncBounds=false;this.isMoving=false;this.stopVelocityOnCollide=true;this.moveTimer=0;this.moveDistance=0;this.moveDuration=0;this.moveTarget=null;this.moveEnd=null;this.onMoveComplete=new N.Signal();this.movementCallback=null;this.movementCallbackContext=null;this._reset=true;this._sx=a.scale.x;this._sy=a.scale.y;this._dx=0;this._dy=0};N.Physics.Arcade.Body.prototype={updateBounds:function(){if(this.syncBounds){var b=this.sprite.getBounds();b.ceilAll();if(b.width!==this.width||b.height!==this.height){this.width=b.width;this.height=b.height;this._reset=true}}else{var a=Math.abs(this.sprite.scale.x);var c=Math.abs(this.sprite.scale.y);if(a!==this._sx||c!==this._sy){this.width=this.sourceWidth*a;this.height=this.sourceHeight*c;this._sx=a;this._sy=c;this._reset=true}}if(this._reset){this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.updateCenter()}},updateCenter:function(){this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},preUpdate:function(){if(!this.enable||this.game.physics.arcade.isPaused){return}this.dirty=true;this.wasTouching.none=this.touching.none;this.wasTouching.up=this.touching.up;this.wasTouching.down=this.touching.down;this.wasTouching.left=this.touching.left;this.wasTouching.right=this.touching.right;this.touching.none=true;this.touching.up=false;this.touching.down=false;this.touching.left=false;this.touching.right=false;this.blocked.none=true;this.blocked.up=false;this.blocked.down=false;this.blocked.left=false;this.blocked.right=false;this.overlapR=0;this.overlapX=0;this.overlapY=0;this.embedded=false;this.updateBounds();this.position.x=(this.sprite.world.x-(this.sprite.anchor.x*this.sprite.width))+this.sprite.scale.x*this.offset.x;this.position.x-=this.sprite.scale.x<0?this.width:0;this.position.y=(this.sprite.world.y-(this.sprite.anchor.y*this.sprite.height))+this.sprite.scale.y*this.offset.y;this.position.y-=this.sprite.scale.y<0?this.height:0;this.updateCenter();this.rotation=this.sprite.angle;this.preRotation=this.rotation;if(this._reset||this.sprite.fresh){this.prev.x=this.position.x;this.prev.y=this.position.y}if(this.moves){this.game.physics.arcade.updateMotion(this);this.newVelocity.set(this.velocity.x*0.001*this.game.time.delta,this.velocity.y*0.001*this.game.time.delta);this.position.x+=this.newVelocity.x;this.position.y+=this.newVelocity.y;this.updateCenter();if(this.position.x!==this.prev.x||this.position.y!==this.prev.y){this.angle=this.velocity.atan()}this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y);if(this.collideWorldBounds){if(this.checkWorldBounds()&&this.onWorldBounds){this.onWorldBounds.dispatch(this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)}}}this._dx=this.deltaX();this._dy=this.deltaY();this._reset=false},updateMovement:function(){var a=0;var b=(this.overlapX!==0||this.overlapY!==0);if(this.moveDuration>0){this.moveTimer+=this.game.time.delta;a=this.moveTimer/this.moveDuration}else{this.moveTarget.end.set(this.position.x,this.position.y);a=this.moveTarget.length/this.moveDistance}if(this.movementCallback){var c=this.movementCallback.call(this.movementCallbackContext,this,this.velocity,a)}if(b||a>=1||(c!==undefined&&c!==true)){this.stopMovement((a>=1)||(this.stopVelocityOnCollide&&b));return false}return true},stopMovement:function(a){if(this.isMoving){this.isMoving=false;if(a){this.velocity.set(0)}this.onMoveComplete.dispatch(this.sprite,(this.overlapX!==0||this.overlapY!==0))}},postUpdate:function(){if(!this.enable||!this.dirty){return}if(this.isMoving){this.updateMovement()}this.dirty=false;if(this.deltaX()<0){this.facing=N.LEFT}else if(this.deltaX()>0){this.facing=N.RIGHT}if(this.deltaY()<0){this.facing=N.UP}else if(this.deltaY()>0){this.facing=N.DOWN}if(this.moves){this._dx=this.deltaX();this._dy=this.deltaY();if(this.deltaMax.x!==0&&this._dx!==0){if(this._dx<0&&this._dx<-this.deltaMax.x){this._dx=-this.deltaMax.x}else if(this._dx>0&&this._dx>this.deltaMax.x){this._dx=this.deltaMax.x}}if(this.deltaMax.y!==0&&this._dy!==0){if(this._dy<0&&this._dy<-this.deltaMax.y){this._dy=-this.deltaMax.y}else if(this._dy>0&&this._dy>this.deltaMax.y){this._dy=this.deltaMax.y}}this.sprite.position.x+=this._dx;this.sprite.position.y+=this._dy;this._reset=true}this.updateCenter();if(this.allowRotation){this.sprite.angle+=this.deltaZ()}this.prev.x=this.position.x;this.prev.y=this.position.y},checkWorldBounds:function(){var a=this.position;var b=this.game.physics.arcade.bounds;var c=this.game.physics.arcade.checkCollision;var d=(this.worldBounce)?-this.worldBounce.x:-this.bounce.x;var e=(this.worldBounce)?-this.worldBounce.y:-this.bounce.y;if(a.x<b.x&&c.left){a.x=b.x;this.velocity.x*=d;this.blocked.left=true;this.blocked.none=false}else if(this.right>b.right&&c.right){a.x=b.right-this.width;this.velocity.x*=d;this.blocked.right=true;this.blocked.none=false}if(a.y<b.y&&c.up){a.y=b.y;this.velocity.y*=e;this.blocked.up=true;this.blocked.none=false}else if(this.bottom>b.bottom&&c.down){a.y=b.bottom-this.height;this.velocity.y*=e;this.blocked.down=true;this.blocked.none=false}return!this.blocked.none},moveFrom:function(a,b,c){if(b===undefined){b=this.speed}if(b===0){return false}var d;if(c===undefined){d=this.angle;c=this.game.math.radToDeg(d)}else{d=this.game.math.degToRad(c)}this.moveTimer=0;this.moveDuration=a;if(c===0||c===180){this.velocity.set(Math.cos(d)*b,0)}else if(c===90||c===270){this.velocity.set(0,Math.sin(d)*b)}else{this.velocity.setToPolar(d,b)}this.isMoving=true;return true},moveTo:function(a,b,c){var d=b/(a/1000);if(d===0){return false}var e;if(c===undefined){e=this.angle;c=this.game.math.radToDeg(e)}else{e=this.game.math.degToRad(c)}b=Math.abs(b);this.moveDuration=0;this.moveDistance=b;if(this.moveTarget===null){this.moveTarget=new N.Line();this.moveEnd=new N.Point()}this.moveTarget.fromAngle(this.x,this.y,e,b);this.moveEnd.set(this.moveTarget.end.x,this.moveTarget.end.y);this.moveTarget.setTo(this.x,this.y,this.x,this.y);if(c===0||c===180){this.velocity.set(Math.cos(e)*d,0)}else if(c===90||c===270){this.velocity.set(0,Math.sin(e)*d)}else{this.velocity.setToPolar(e,d)}this.isMoving=true;return true},setSize:function(a,b,c,d){if(c===undefined){c=this.offset.x}if(d===undefined){d=this.offset.y}this.sourceWidth=a;this.sourceHeight=b;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(c,d);this.updateCenter();this.isCircle=false;this.radius=0},setCircle:function(a,b,c){if(b===undefined){b=this.offset.x}if(c===undefined){c=this.offset.y}if(a>0){this.isCircle=true;this.radius=a;this.sourceWidth=a*2;this.sourceHeight=a*2;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(b,c);this.updateCenter()}else{this.isCircle=false}},reset:function(x,y){this.stop();this.position.x=(x-(this.sprite.anchor.x*this.sprite.width))+this.sprite.scale.x*this.offset.x;this.position.x-=this.sprite.scale.x<0?this.width:0;this.position.y=(y-(this.sprite.anchor.y*this.sprite.height))+this.sprite.scale.y*this.offset.y;this.position.y-=this.sprite.scale.y<0?this.height:0;this.prev.x=this.position.x;this.prev.y=this.position.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;this.updateBounds();this.updateCenter()},stop:function(){this.velocity.set(0);this.acceleration.set(0);this.speed=0;this.angularVelocity=0;this.angularAcceleration=0},getBounds:function(a){a.x=this.x;a.y=this.y;a.right=this.right;a.bottom=this.bottom;return a},hitTest:function(x,y){return(this.isCircle)?N.Circle.contains(this,x,y):N.Rectangle.contains(this,x,y)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return(this.blocked.left||this.blocked.right)},deltaAbsX:function(){return(this.deltaX()>0?this.deltaX():-this.deltaX())},deltaAbsY:function(){return(this.deltaY()>0?this.deltaY():-this.deltaY())},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation},destroy:function(){if(this.sprite.parent&&this.sprite.parent instanceof N.Group){this.sprite.parent.removeFromHash(this.sprite)}this.sprite.body=null;this.sprite=null}};Object.defineProperty(N.Physics.Arcade.Body.prototype,'left',{get:function(){return this.position.x}});Object.defineProperty(N.Physics.Arcade.Body.prototype,'right',{get:function(){return this.position.x+this.width}});Object.defineProperty(N.Physics.Arcade.Body.prototype,'top',{get:function(){return this.position.y}});Object.defineProperty(N.Physics.Arcade.Body.prototype,'bottom',{get:function(){return this.position.y+this.height}});Object.defineProperty(N.Physics.Arcade.Body.prototype,'x',{get:function(){return this.position.x},set:function(a){this.position.x=a}});Object.defineProperty(N.Physics.Arcade.Body.prototype,'y',{get:function(){return this.position.y},set:function(a){this.position.y=a}});N.Physics.Arcade.Body.render=function(a,b,c,d,e){if(d===undefined){d=true}c=c||'rgba(0,255,0,0.4)';a.fillStyle=c;a.strokeStyle=c;a.lineWidth=e||1;if(b.isCircle){a.beginPath();a.arc(b.center.x-b.game.camera.x,b.center.y-b.game.camera.y,b.halfWidth,0,2*Math.PI);if(d){a.fill()}else{a.stroke()}}else if(d){a.fillRect(b.position.x-b.game.camera.x,b.position.y-b.game.camera.y,b.width,b.height)}else{a.strokeRect(b.position.x-b.game.camera.x,b.position.y-b.game.camera.y,b.width,b.height)}};N.Physics.Arcade.Body.renderBodyInfo=function(a,b){a.line('x: '+b.x.toFixed(2),'y: '+b.y.toFixed(2),'width: '+b.width,'height: '+b.height);a.line('velocity x: '+b.velocity.x.toFixed(2),'y: '+b.velocity.y.toFixed(2),'deltaX: '+b._dx.toFixed(2),'deltaY: '+b._dy.toFixed(2));a.line('acceleration x: '+b.acceleration.x.toFixed(2),'y: '+b.acceleration.y.toFixed(2),'speed: '+b.speed.toFixed(2),'angle: '+b.angle.toFixed(2));a.line('gravity x: '+b.gravity.x,'y: '+b.gravity.y,'bounce x: '+b.bounce.x.toFixed(2),'y: '+b.bounce.y.toFixed(2));a.line('touching left: '+b.touching.left,'right: '+b.touching.right,'up: '+b.touching.up,'down: '+b.touching.down);a.line('blocked left: '+b.blocked.left,'right: '+b.blocked.right,'up: '+b.blocked.up,'down: '+b.blocked.down)};N.Physics.Arcade.Body.prototype.constructor=N.Physics.Arcade.Body;N.Physics.Arcade.TilemapCollision=function(){};N.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(a,b,c,d,e,f){if(!a.body){return}var g=b.getTiles(a.body.position.x-a.body.tilePadding.x-b.getTileOffsetX(),a.body.position.y-a.body.tilePadding.y-b.getTileOffsetY(),a.body.width+a.body.tilePadding.x,a.body.height+a.body.tilePadding.y,false,false);if(g.length===0){return}for(var i=0;i<g.length;i++){if(d){if(d.call(e,a,g[i])){if(this.separateTile(i,a.body,g[i],b,f)){this._total++;if(c){c.call(e,a,g[i])}}}}else if(this.separateTile(i,a.body,g[i],b,f)){this._total++;if(c){c.call(e,a,g[i])}}}},collideGroupVsTilemapLayer:function(a,b,c,d,e,f){if(a.length===0){return}for(var i=0;i<a.children.length;i++){if(a.children[i].exists){this.collideSpriteVsTilemapLayer(a.children[i],b,c,d,e,f)}}},separateTile:function(i,a,b,c,d){if(!a.enable){return false}var e=c.getTileOffsetX();var f=c.getTileOffsetY();if(!b.intersects((a.position.x-e),(a.position.y-f),(a.right-e),(a.bottom-f))){return false}else if(d){return true}if(b.collisionCallback&&!b.collisionCallback.call(b.collisionCallbackContext,a.sprite,b)){return false}else if(typeof b.layer.callbacks!=='undefined'&&b.layer.callbacks[b.index]&&!b.layer.callbacks[b.index].callback.call(b.layer.callbacks[b.index].callbackContext,a.sprite,b)){return false}if(!b.faceLeft&&!b.faceRight&&!b.faceTop&&!b.faceBottom){return false}var g=0;var h=0;var j=0;var k=1;if(a.deltaAbsX()>a.deltaAbsY()){j=-1}else if(a.deltaAbsX()<a.deltaAbsY()){k=-1}if(a.deltaX()!==0&&a.deltaY()!==0&&(b.faceLeft||b.faceRight)&&(b.faceTop||b.faceBottom)){j=Math.min(Math.abs((a.position.x-e)-b.right),Math.abs((a.right-e)-b.left));k=Math.min(Math.abs((a.position.y-f)-b.bottom),Math.abs((a.bottom-f)-b.top))}if(j<k){if(b.faceLeft||b.faceRight){g=this.tileCheckX(a,b,c);if(g!==0&&!b.intersects((a.position.x-e),(a.position.y-f),(a.right-e),(a.bottom-f))){return true}}if(b.faceTop||b.faceBottom){h=this.tileCheckY(a,b,c)}}else{if(b.faceTop||b.faceBottom){h=this.tileCheckY(a,b,c);if(h!==0&&!b.intersects((a.position.x-e),(a.position.y-f),(a.right-e),(a.bottom-f))){return true}}if(b.faceLeft||b.faceRight){g=this.tileCheckX(a,b,c)}}return(g!==0||h!==0)},tileCheckX:function(a,b,c){var d=0;var e=c.getTileOffsetX();if(a.deltaX()<0&&!a.blocked.left&&b.collideRight&&a.checkCollision.left){if(b.faceRight&&(a.x-e)<b.right){d=(a.x-e)-b.right;if(d<-this.TILE_BIAS){d=0}}}else if(a.deltaX()>0&&!a.blocked.right&&b.collideLeft&&a.checkCollision.right){if(b.faceLeft&&(a.right-e)>b.left){d=(a.right-e)-b.left;if(d>this.TILE_BIAS){d=0}}}if(d!==0){if(a.customSeparateX){a.overlapX=d}else{this.processTileSeparationX(a,d)}}return d},tileCheckY:function(a,b,c){var d=0;var e=c.getTileOffsetY();if(a.deltaY()<0&&!a.blocked.up&&b.collideDown&&a.checkCollision.up){if(b.faceBottom&&(a.y-e)<b.bottom){d=(a.y-e)-b.bottom;if(d<-this.TILE_BIAS){d=0}}}else if(a.deltaY()>0&&!a.blocked.down&&b.collideUp&&a.checkCollision.down){if(b.faceTop&&(a.bottom-e)>b.top){d=(a.bottom-e)-b.top;if(d>this.TILE_BIAS){d=0}}}if(d!==0){if(a.customSeparateY){a.overlapY=d}else{this.processTileSeparationY(a,d)}}return d},processTileSeparationX:function(a,x){if(x<0){a.blocked.left=true;a.blocked.none=false}else if(x>0){a.blocked.right=true;a.blocked.none=false}a.position.x-=x;if(a.bounce.x===0){a.velocity.x=0}else{a.velocity.x=-a.velocity.x*a.bounce.x}},processTileSeparationY:function(a,y){if(y<0){a.blocked.up=true;a.blocked.none=false}else if(y>0){a.blocked.down=true;a.blocked.none=false}a.position.y-=y;if(a.bounce.y===0){a.velocity.y=0}else{a.velocity.y=-a.velocity.y*a.bounce.y}}};N.Utils.mixinPrototype(N.Physics.Arcade.prototype,N.Physics.Arcade.TilemapCollision.prototype);p2.Body.prototype.parent=null;p2.Spring.prototype.parent=null;N.Physics.P2=function(a,b){this.game=a;if(b===undefined){b={gravity:[0,0],broadphase:new p2.SAPBroadphase()}}else{if(!b.hasOwnProperty('gravity')){b.gravity=[0,0]}if(!b.hasOwnProperty('broadphase')){b.broadphase=new p2.SAPBroadphase()}}this.config=b;this.world=new p2.World(this.config);this.frameRate=1/60;this.useElapsedTime=false;this.paused=false;this.materials=[];this.gravity=new N.Physics.P2.InversePointProxy(this,this.world.gravity);this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new N.Signal();this.onBodyRemoved=new N.Signal();this.onSpringAdded=new N.Signal();this.onSpringRemoved=new N.Signal();this.onConstraintAdded=new N.Signal();this.onConstraintRemoved=new N.Signal();this.onContactMaterialAdded=new N.Signal();this.onContactMaterialRemoved=new N.Signal();this.postBroadphaseCallback=null;this.callbackContext=null;this.onBeginContact=new N.Signal();this.onEndContact=new N.Signal();if(b.hasOwnProperty('mpx')&&b.hasOwnProperty('pxm')&&b.hasOwnProperty('mpxi')&&b.hasOwnProperty('pxmi')){this.mpx=b.mpx;this.mpxi=b.mpxi;this.pxm=b.pxm;this.pxmi=b.pxmi}this.world.on('beginContact',this.beginContactHandler,this);this.world.on('endContact',this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new N.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new N.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new N.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=[];this._toRemove=[];this._collisionGroupID=2;this._boundsLeft=true;this._boundsRight=true;this._boundsTop=true;this._boundsBottom=true;this._boundsOwnGroup=false;this.setBoundsToWorld(true,true,true,true,false)};N.Physics.P2.prototype={removeBodyNextStep:function(a){this._toRemove.push(a)},preUpdate:function(){var i=this._toRemove.length;while(i--){this.removeBody(this._toRemove[i])}this._toRemove.length=0},enable:function(a,b,c){if(b===undefined){b=false}if(c===undefined){c=true}var i=1;if(Array.isArray(a)){i=a.length;while(i--){if(a[i]instanceof N.Group){this.enable(a[i].children,b,c)}else{this.enableBody(a[i],b);if(c&&a[i].hasOwnProperty('children')&&a[i].children.length>0){this.enable(a[i],b,true)}}}}else if(a instanceof N.Group){this.enable(a.children,b,c)}else{this.enableBody(a,b);if(c&&a.hasOwnProperty('children')&&a.children.length>0){this.enable(a.children,b,true)}}},enableBody:function(a,b){if(a.hasOwnProperty('body')&&a.body===null){a.body=new N.Physics.P2.Body(this.game,a,a.x,a.y,1);a.body.debug=b;if(typeof a.anchor!=='undefined'){a.anchor.set(0.5)}}},setImpactEvents:function(a){if(a){this.world.on('impact',this.impactHandler,this)}else{this.world.off('impact',this.impactHandler,this)}},setPostBroadphaseCallback:function(a,b){this.postBroadphaseCallback=a;this.callbackContext=b;if(a!==null){this.world.on('postBroadphase',this.postBroadphaseHandler,this)}else{this.world.off('postBroadphase',this.postBroadphaseHandler,this)}},postBroadphaseHandler:function(a){if(!this.postBroadphaseCallback||a.pairs.length===0){return}for(var i=a.pairs.length-2;i>=0;i-=2){if(a.pairs[i].parent&&a.pairs[i+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,a.pairs[i].parent,a.pairs[i+1].parent)){a.pairs.splice(i,2)}}},impactHandler:function(c){if(c.bodyA.parent&&c.bodyB.parent){var a=c.bodyA.parent;var b=c.bodyB.parent;if(a._bodyCallbacks[c.bodyB.id]){a._bodyCallbacks[c.bodyB.id].call(a._bodyCallbackContext[c.bodyB.id],a,b,c.shapeA,c.shapeB)}if(b._bodyCallbacks[c.bodyA.id]){b._bodyCallbacks[c.bodyA.id].call(b._bodyCallbackContext[c.bodyA.id],b,a,c.shapeB,c.shapeA)}if(a._groupCallbacks[c.shapeB.collisionGroup]){a._groupCallbacks[c.shapeB.collisionGroup].call(a._groupCallbackContext[c.shapeB.collisionGroup],a,b,c.shapeA,c.shapeB)}if(b._groupCallbacks[c.shapeA.collisionGroup]){b._groupCallbacks[c.shapeA.collisionGroup].call(b._groupCallbackContext[c.shapeA.collisionGroup],b,a,c.shapeB,c.shapeA)}}},beginContactHandler:function(a){if(a.bodyA&&a.bodyB){this.onBeginContact.dispatch(a.bodyA,a.bodyB,a.shapeA,a.shapeB,a.contactEquations);if(a.bodyA.parent){a.bodyA.parent.onBeginContact.dispatch(a.bodyB.parent,a.bodyB,a.shapeA,a.shapeB,a.contactEquations)}if(a.bodyB.parent){a.bodyB.parent.onBeginContact.dispatch(a.bodyA.parent,a.bodyA,a.shapeB,a.shapeA,a.contactEquations)}}},endContactHandler:function(a){if(a.bodyA&&a.bodyB){this.onEndContact.dispatch(a.bodyA,a.bodyB,a.shapeA,a.shapeB);if(a.bodyA.parent){a.bodyA.parent.onEndContact.dispatch(a.bodyB.parent,a.bodyB,a.shapeA,a.shapeB)}if(a.bodyB.parent){a.bodyB.parent.onEndContact.dispatch(a.bodyA.parent,a.bodyA,a.shapeB,a.shapeA)}}},setBoundsToWorld:function(a,b,c,d,e){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,a,b,c,d,e)},setWorldMaterial:function(a,b,c,d,e){if(b===undefined){b=true}if(c===undefined){c=true}if(d===undefined){d=true}if(e===undefined){e=true}if(b&&this.walls.left){this.walls.left.shapes[0].material=a}if(c&&this.walls.right){this.walls.right.shapes[0].material=a}if(d&&this.walls.top){this.walls.top.shapes[0].material=a}if(e&&this.walls.bottom){this.walls.bottom.shapes[0].material=a}},updateBoundsCollisionGroup:function(a){if(a===undefined){a=true}var b=(a)?this.boundsCollisionGroup.mask:this.everythingCollisionGroup.mask;if(this.walls.left){this.walls.left.shapes[0].collisionGroup=b}if(this.walls.right){this.walls.right.shapes[0].collisionGroup=b}if(this.walls.top){this.walls.top.shapes[0].collisionGroup=b}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionGroup=b}this._boundsOwnGroup=a},setBounds:function(x,y,a,b,c,d,e,f,g){if(c===undefined){c=this._boundsLeft}if(d===undefined){d=this._boundsRight}if(e===undefined){e=this._boundsTop}if(f===undefined){f=this._boundsBottom}if(g===undefined){g=this._boundsOwnGroup}this.setupWall(c,'left',x,y,1.5707963267948966,g);this.setupWall(d,'right',x+a,y,-1.5707963267948966,g);this.setupWall(e,'top',x,y,-3.141592653589793,g);this.setupWall(f,'bottom',x,y+b,0,g);this._boundsLeft=c;this._boundsRight=d;this._boundsTop=e;this._boundsBottom=f;this._boundsOwnGroup=g},setupWall:function(a,b,x,y,c,d){if(a){if(this.walls[b]){this.walls[b].position=[this.pxmi(x),this.pxmi(y)]}else{this.walls[b]=new p2.Body({mass:0,position:[this.pxmi(x),this.pxmi(y)],angle:c});this.walls[b].addShape(new p2.Plane());this.world.addBody(this.walls[b])}if(d){this.walls[b].shapes[0].collisionGroup=this.boundsCollisionGroup.mask}}else if(this.walls[b]){this.world.removeBody(this.walls[b]);this.walls[b]=null}},pause:function(){this.paused=true},resume:function(){this.paused=false},update:function(){if(this.paused){return}if(this.useElapsedTime){this.world.step(0.001*this.game.time.delta)}else{this.world.step(this.frameRate)}},reset:function(){this.world.on('beginContact',this.beginContactHandler,this);this.world.on('endContact',this.endContactHandler,this);this.nothingCollisionGroup=new N.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new N.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new N.Physics.P2.CollisionGroup(2147483648);this._collisionGroupID=2;this.setBoundsToWorld(true,true,true,true,false)},clear:function(){this.world.time=0;this.world.fixedStepTime=0;if(this.world.solver&&this.world.solver.equations.length){this.world.solver.removeAllEquations()}var a=this.world.constraints;for(var i=a.length-1;i>=0;i--){this.world.removeConstraint(a[i])}var b=this.world.bodies;for(var i=b.length-1;i>=0;i--){this.world.removeBody(b[i])}var c=this.world.springs;for(var i=c.length-1;i>=0;i--){this.world.removeSpring(c[i])}var d=this.world.contactMaterials;for(var i=d.length-1;i>=0;i--){this.world.removeContactMaterial(d[i])}this.world.off('beginContact',this.beginContactHandler,this);this.world.off('endContact',this.endContactHandler,this);this.postBroadphaseCallback=null;this.callbackContext=null;this.impactCallback=null;this.collisionGroups=[];this._toRemove=[];this.boundsCollidesWith=[];this.walls={left:null,right:null,top:null,bottom:null}},destroy:function(){this.clear();this.game=null},addBody:function(a){if(a.data.world){return false}else{this.world.addBody(a.data);this.onBodyAdded.dispatch(a);return true}},removeBody:function(a){if(a.data.world===this.world){this.world.removeBody(a.data);this.onBodyRemoved.dispatch(a)}return a},addSpring:function(a){if(a instanceof N.Physics.P2.Spring||a instanceof N.Physics.P2.RotationalSpring){this.world.addSpring(a.data)}else{this.world.addSpring(a)}this.onSpringAdded.dispatch(a);return a},removeSpring:function(a){if(a instanceof N.Physics.P2.Spring||a instanceof N.Physics.P2.RotationalSpring){this.world.removeSpring(a.data)}else{this.world.removeSpring(a)}this.onSpringRemoved.dispatch(a);return a},createDistanceConstraint:function(a,b,c,d,e,f){a=this.getBody(a);b=this.getBody(b);if(!a||!b){console.warn('Cannot create Constraint, invalid body objects given')}else{return this.addConstraint(new N.Physics.P2.DistanceConstraint(this,a,b,c,d,e,f))}},createGearConstraint:function(a,b,c,d){a=this.getBody(a);b=this.getBody(b);if(!a||!b){console.warn('Cannot create Constraint, invalid body objects given')}else{return this.addConstraint(new N.Physics.P2.GearConstraint(this,a,b,c,d))}},createRevoluteConstraint:function(a,b,c,d,e,f){a=this.getBody(a);c=this.getBody(c);if(!a||!c){console.warn('Cannot create Constraint, invalid body objects given')}else{return this.addConstraint(new N.Physics.P2.RevoluteConstraint(this,a,b,c,d,e,f))}},createLockConstraint:function(a,b,c,d,e){a=this.getBody(a);b=this.getBody(b);if(!a||!b){console.warn('Cannot create Constraint, invalid body objects given')}else{return this.addConstraint(new N.Physics.P2.LockConstraint(this,a,b,c,d,e))}},createPrismaticConstraint:function(a,b,c,d,e,f,g){a=this.getBody(a);b=this.getBody(b);if(!a||!b){console.warn('Cannot create Constraint, invalid body objects given')}else{return this.addConstraint(new N.Physics.P2.PrismaticConstraint(this,a,b,c,d,e,f,g))}},addConstraint:function(a){this.world.addConstraint(a);this.onConstraintAdded.dispatch(a);return a},removeConstraint:function(a){this.world.removeConstraint(a);this.onConstraintRemoved.dispatch(a);return a},addContactMaterial:function(a){this.world.addContactMaterial(a);this.onContactMaterialAdded.dispatch(a);return a},removeContactMaterial:function(a){this.world.removeContactMaterial(a);this.onContactMaterialRemoved.dispatch(a);return a},getContactMaterial:function(a,b){return this.world.getContactMaterial(a,b)},setMaterial:function(a,b){var i=b.length;while(i--){b[i].setMaterial(a)}},createMaterial:function(a,b){a=a||'';var c=new N.Physics.P2.Material(a);this.materials.push(c);if(typeof b!=='undefined'){b.setMaterial(c)}return c},createContactMaterial:function(a,b,c){if(a===undefined){a=this.createMaterial()}if(b===undefined){b=this.createMaterial()}var d=new N.Physics.P2.ContactMaterial(a,b,c);return this.addContactMaterial(d)},getBodies:function(){var a=[];var i=this.world.bodies.length;while(i--){a.push(this.world.bodies[i].parent)}return a},getBody:function(a){if(a instanceof p2.Body){return a}else if(a instanceof N.Physics.P2.Body){return a.data}else if(a['body']&&a['body'].type===N.Physics.P2JS){return a.body.data}return null},getSprings:function(){var a=[];var i=this.world.springs.length;while(i--){a.push(this.world.springs[i].parent)}return a},getConstraints:function(){var a=[];var i=this.world.constraints.length;while(i--){a.push(this.world.constraints[i])}return a},hitTest:function(a,b,c,d){if(b===undefined){b=this.world.bodies}if(c===undefined){c=5}if(d===undefined){d=false}var e=[this.pxmi(a.x),this.pxmi(a.y)];var f=[];var i=b.length;while(i--){if(b[i]instanceof N.Physics.P2.Body&&!(d&&b[i].data.type===p2.Body.STATIC)){f.push(b[i].data)}else if(b[i]instanceof p2.Body&&b[i].parent&&!(d&&b[i].type===p2.Body.STATIC)){f.push(b[i])}else if(b[i]instanceof N.Sprite&&b[i].hasOwnProperty('body')&&!(d&&b[i].body.data.type===p2.Body.STATIC)){f.push(b[i].body.data)}}return this.world.hitTest(e,f,c)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(a){var b=Math.pow(2,this._collisionGroupID);if(this.walls.left){this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|b}if(this.walls.right){this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|b}if(this.walls.top){this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|b}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|b}this._collisionGroupID++;var c=new N.Physics.P2.CollisionGroup(b);this.collisionGroups.push(c);if(a){this.setCollisionGroup(a,c)}return c},setCollisionGroup:function(a,b){if(a instanceof N.Group){for(var i=0;i<a.total;i++){if(a.children[i]['body']&&a.children[i]['body'].type===N.Physics.P2JS){a.children[i].body.setCollisionGroup(b)}}}else{a.body.setCollisionGroup(b)}},createSpring:function(a,b,c,d,e,f,g,h,i){a=this.getBody(a);b=this.getBody(b);if(!a||!b){console.warn('Cannot create Spring, invalid body objects given')}else{return this.addSpring(new N.Physics.P2.Spring(this,a,b,c,d,e,f,g,h,i))}},createRotationalSpring:function(a,b,c,d,e){a=this.getBody(a);b=this.getBody(b);if(!a||!b){console.warn('Cannot create Rotational Spring, invalid body objects given')}else{return this.addSpring(new N.Physics.P2.RotationalSpring(this,a,b,c,d,e))}},createBody:function(x,y,a,b,c,d){if(b===undefined){b=false}var e=new N.Physics.P2.Body(this.game,null,x,y,a);if(d){var f=e.addPolygon(c,d);if(!f){return false}}if(b){this.world.addBody(e.data)}return e},createParticle:function(x,y,a,b,c,d){if(b===undefined){b=false}var e=new N.Physics.P2.Body(this.game,null,x,y,a);if(d){var f=e.addPolygon(c,d);if(!f){return false}}if(b){this.world.addBody(e.data)}return e},convertCollisionObjects:function(a,b,c){if(c===undefined){c=true}var d=[];for(var i=0,len=a.collision[b].length;i<len;i++){var e=a.collision[b][i];var f=e.polyline||e.polygon;if(f){var g=this.createBody(e.x,e.y,0,c,{},f)}else if(e.rectangle){var g=this.createBody(e.x,e.y,0,c);g.addRectangle(e.width,e.height,e.width/2,e.height/2)}if(g){d.push(g)}}return d},clearTilemapLayerBodies:function(a,b){b=a.getLayer(b);var i=a.layers[b].bodies.length;while(i--){a.layers[b].bodies[i].destroy()}a.layers[b].bodies.length=0},convertTilemap:function(a,b,c,d){b=a.getLayer(b);if(c===undefined){c=true}if(d===undefined){d=true}this.clearTilemapLayerBodies(a,b);var e=0;var f=0;var g=0;for(var y=0,h=a.layers[b].height;y<h;y++){e=0;for(var x=0,w=a.layers[b].width;x<w;x++){var i=a.layers[b].data[y][x];if(i&&i.index>-1&&i.collides){if(d){var j=a.getTileRight(b,x,y);if(e===0){f=i.x*i.width;g=i.y*i.height;e=i.width}if(j&&j.collides){e+=i.width}else{var k=this.createBody(f,g,0,false);k.addRectangle(e,i.height,e/2,i.height/2,0);if(c){this.addBody(k)}a.layers[b].bodies.push(k);e=0}}else{var k=this.createBody(i.x*i.width,i.y*i.height,0,false);k.addRectangle(i.width,i.height,i.width/2,i.height/2,0);if(c){this.addBody(k)}a.layers[b].bodies.push(k)}}}}return a.layers[b].bodies},mpx:function(v){return v*=20},pxm:function(v){return v*0.05},mpxi:function(v){return v*=-20},pxmi:function(v){return v*-0.05}};Object.defineProperty(N.Physics.P2.prototype,'friction',{get:function(){return this.world.defaultContactMaterial.friction},set:function(a){this.world.defaultContactMaterial.friction=a}});Object.defineProperty(N.Physics.P2.prototype,'restitution',{get:function(){return this.world.defaultContactMaterial.restitution},set:function(a){this.world.defaultContactMaterial.restitution=a}});Object.defineProperty(N.Physics.P2.prototype,'contactMaterial',{get:function(){return this.world.defaultContactMaterial},set:function(a){this.world.defaultContactMaterial=a}});Object.defineProperty(N.Physics.P2.prototype,'applySpringForces',{get:function(){return this.world.applySpringForces},set:function(a){this.world.applySpringForces=a}});Object.defineProperty(N.Physics.P2.prototype,'applyDamping',{get:function(){return this.world.applyDamping},set:function(a){this.world.applyDamping=a}});Object.defineProperty(N.Physics.P2.prototype,'applyGravity',{get:function(){return this.world.applyGravity},set:function(a){this.world.applyGravity=a}});Object.defineProperty(N.Physics.P2.prototype,'solveConstraints',{get:function(){return this.world.solveConstraints},set:function(a){this.world.solveConstraints=a}});Object.defineProperty(N.Physics.P2.prototype,'time',{get:function(){return this.world.time}});Object.defineProperty(N.Physics.P2.prototype,'emitImpactEvent',{get:function(){return this.world.emitImpactEvent},set:function(a){this.world.emitImpactEvent=a}});Object.defineProperty(N.Physics.P2.prototype,'sleepMode',{get:function(){return this.world.sleepMode},set:function(a){this.world.sleepMode=a}});Object.defineProperty(N.Physics.P2.prototype,'total',{get:function(){return this.world.bodies.length}});N.Physics.P2.FixtureList=function(a){if(!Array.isArray(a)){a=[a]}this.rawList=a;this.init();this.parse(this.rawList)};N.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(b,c){var d=function(a){a.collisionGroup=b};this.getFixtures(c).forEach(d)},setMask:function(b,c){var d=function(a){a.collisionMask=b};this.getFixtures(c).forEach(d)},setSensor:function(b,c){var d=function(a){a.sensor=b};this.getFixtures(c).forEach(d)},setMaterial:function(b,c){var d=function(a){a.material=b};this.getFixtures(c).forEach(d)},getFixtures:function(b){var c=[];if(b){if(!(b instanceof Array)){b=[b]}var d=this;b.forEach(function(a){if(d.namedFixtures[a]){c.push(d.namedFixtures[a])}});return this.flatten(c)}else{return this.allFixtures}},getFixtureByKey:function(a){return this.namedFixtures[a]},getGroup:function(a){return this.groupedFixtures[a]},parse:function(){var a,value,_ref,_results;_ref=this.rawList;_results=[];for(a in _ref){value=_ref[a];if(!isNaN(a-0)){this.groupedFixtures[a]=this.groupedFixtures[a]||[];this.groupedFixtures[a]=this.groupedFixtures[a].concat(value)}else{this.namedFixtures[a]=this.flatten(value)}_results.push(this.allFixtures=this.flatten(this.groupedFixtures))}},flatten:function(b){var c,self;c=[];self=arguments.callee;b.forEach(function(a){return Array.prototype.push.apply(c,(Array.isArray(a)?self(a):[a]))});return c}};N.Physics.P2.PointProxy=function(a,b){this.world=a;this.destination=b};N.Physics.P2.PointProxy.prototype.constructor=N.Physics.P2.PointProxy;Object.defineProperty(N.Physics.P2.PointProxy.prototype,'x',{get:function(){return this.world.mpx(this.destination[0])},set:function(a){this.destination[0]=this.world.pxm(a)}});Object.defineProperty(N.Physics.P2.PointProxy.prototype,'y',{get:function(){return this.world.mpx(this.destination[1])},set:function(a){this.destination[1]=this.world.pxm(a)}});Object.defineProperty(N.Physics.P2.PointProxy.prototype,'mx',{get:function(){return this.destination[0]},set:function(a){this.destination[0]=a}});Object.defineProperty(N.Physics.P2.PointProxy.prototype,'my',{get:function(){return this.destination[1]},set:function(a){this.destination[1]=a}});N.Physics.P2.InversePointProxy=function(a,b){this.world=a;this.destination=b};N.Physics.P2.InversePointProxy.prototype.constructor=N.Physics.P2.InversePointProxy;Object.defineProperty(N.Physics.P2.InversePointProxy.prototype,'x',{get:function(){return this.world.mpxi(this.destination[0])},set:function(a){this.destination[0]=this.world.pxmi(a)}});Object.defineProperty(N.Physics.P2.InversePointProxy.prototype,'y',{get:function(){return this.world.mpxi(this.destination[1])},set:function(a){this.destination[1]=this.world.pxmi(a)}});Object.defineProperty(N.Physics.P2.InversePointProxy.prototype,'mx',{get:function(){return this.destination[0]},set:function(a){this.destination[0]=-a}});Object.defineProperty(N.Physics.P2.InversePointProxy.prototype,'my',{get:function(){return this.destination[1]},set:function(a){this.destination[1]=-a}});N.Physics.P2.Body=function(a,b,x,y,c){b=b||null;x=x||0;y=y||0;if(c===undefined){c=1}this.game=a;this.world=a.physics.p2;this.sprite=b;this.type=N.Physics.P2JS;this.offset=new N.Point();this.data=new p2.Body({position:[this.world.pxmi(x),this.world.pxmi(y)],mass:c});this.data.parent=this;this.velocity=new N.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new N.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new N.Point();this.onBeginContact=new N.Signal();this.onEndContact=new N.Signal();this.collidesWith=[];this.removeNextStep=false;this.debugBody=null;this.dirty=false;this._collideWorldBounds=true;this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this._reset=false;if(b){this.setRectangleFromSprite(b);if(b.exists){this.game.physics.p2.addBody(this)}}};N.Physics.P2.Body.prototype={createBodyCallback:function(a,b,c){var d=-1;if(a['id']){d=a.id}else if(a['body']){d=a.body.id}if(d>-1){if(b===null){delete(this._bodyCallbacks[d]);delete(this._bodyCallbackContext[d])}else{this._bodyCallbacks[d]=b;this._bodyCallbackContext[d]=c}}},createGroupCallback:function(a,b,c){if(b===null){delete(this._groupCallbacks[a.mask]);delete(this._groupCallbackContext[a.mask])}else{this._groupCallbacks[a.mask]=b;this._groupCallbackContext[a.mask]=c}},getCollisionMask:function(){var a=0;if(this._collideWorldBounds){a=this.game.physics.p2.boundsCollisionGroup.mask}for(var i=0;i<this.collidesWith.length;i++){a=a|this.collidesWith[i].mask}return a},updateCollisionMask:function(a){var b=this.getCollisionMask();if(a===undefined){for(var i=this.data.shapes.length-1;i>=0;i--){this.data.shapes[i].collisionMask=b}}else{a.collisionMask=b}},setCollisionGroup:function(a,b){var c=this.getCollisionMask();if(b===undefined){for(var i=this.data.shapes.length-1;i>=0;i--){this.data.shapes[i].collisionGroup=a.mask;this.data.shapes[i].collisionMask=c}}else{b.collisionGroup=a.mask;b.collisionMask=c}},clearCollision:function(a,b,c){if(a===undefined){a=true}if(b===undefined){b=true}if(c===undefined){for(var i=this.data.shapes.length-1;i>=0;i--){if(a){this.data.shapes[i].collisionGroup=null}if(b){this.data.shapes[i].collisionMask=null}}}else{if(a){c.collisionGroup=null}if(b){c.collisionMask=null}}if(a){this.collidesWith.length=0}},removeCollisionGroup:function(a,b,c){if(b===undefined){b=true}var d;if(Array.isArray(a)){for(var i=0;i<a.length;i++){d=this.collidesWith.indexOf(a[i]);if(d>-1){this.collidesWith.splice(d,1);if(b){delete(this._groupCallbacks[a.mask]);delete(this._groupCallbackContext[a.mask])}}}}else{d=this.collidesWith.indexOf(a);if(d>-1){this.collidesWith.splice(d,1);if(b){delete(this._groupCallbacks[a.mask]);delete(this._groupCallbackContext[a.mask])}}}var e=this.getCollisionMask();if(c===undefined){for(var i=this.data.shapes.length-1;i>=0;i--){this.data.shapes[i].collisionMask=e}}else{c.collisionMask=e}},collides:function(a,b,c,d){if(Array.isArray(a)){for(var i=0;i<a.length;i++){if(this.collidesWith.indexOf(a[i])===-1){this.collidesWith.push(a[i]);if(b){this.createGroupCallback(a[i],b,c)}}}}else if(this.collidesWith.indexOf(a)===-1){this.collidesWith.push(a);if(b){this.createGroupCallback(a,b,c)}}var e=this.getCollisionMask();if(d===undefined){for(var i=this.data.shapes.length-1;i>=0;i--){this.data.shapes[i].collisionMask=e}}else{d.collisionMask=e}},adjustCenterOfMass:function(){this.data.adjustCenterOfMass();this.shapeChanged()},getVelocityAtPoint:function(a,b){return this.data.getVelocityAtPoint(a,b)},applyDamping:function(a){this.data.applyDamping(a)},applyImpulse:function(a,b,c){this.data.applyImpulse(a,[this.world.pxmi(b),this.world.pxmi(c)])},applyImpulseLocal:function(a,b,c){this.data.applyImpulseLocal(a,[this.world.pxmi(b),this.world.pxmi(c)])},applyForce:function(a,b,c){this.data.applyForce(a,[this.world.pxmi(b),this.world.pxmi(c)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0;this.data.angularDamping=0},toLocalFrame:function(a,b){return this.data.toLocalFrame(a,b)},toWorldFrame:function(a,b){return this.data.toWorldFrame(a,b)},rotateLeft:function(a){this.data.angularVelocity=this.world.pxm(-a)},rotateRight:function(a){this.data.angularVelocity=this.world.pxm(a)},moveForward:function(a){var b=this.world.pxmi(-a);var c=this.data.angle+Math.PI/2;this.data.velocity[0]=b*Math.cos(c);this.data.velocity[1]=b*Math.sin(c)},moveBackward:function(a){var b=this.world.pxmi(-a);var c=this.data.angle+Math.PI/2;this.data.velocity[0]=-(b*Math.cos(c));this.data.velocity[1]=-(b*Math.sin(c))},thrust:function(a){var b=this.world.pxmi(-a);var c=this.data.angle+Math.PI/2;this.data.force[0]+=b*Math.cos(c);this.data.force[1]+=b*Math.sin(c)},thrustLeft:function(a){var b=this.world.pxmi(-a);var c=this.data.angle;this.data.force[0]+=b*Math.cos(c);this.data.force[1]+=b*Math.sin(c)},thrustRight:function(a){var b=this.world.pxmi(-a);var c=this.data.angle;this.data.force[0]-=b*Math.cos(c);this.data.force[1]-=b*Math.sin(c)},reverse:function(a){var b=this.world.pxmi(-a);var c=this.data.angle+Math.PI/2;this.data.force[0]-=b*Math.cos(c);this.data.force[1]-=b*Math.sin(c)},moveLeft:function(a){this.data.velocity[0]=this.world.pxmi(-a)},moveRight:function(a){this.data.velocity[0]=this.world.pxmi(a)},moveUp:function(a){this.data.velocity[1]=this.world.pxmi(-a)},moveDown:function(a){this.data.velocity[1]=this.world.pxmi(a)},preUpdate:function(){this.dirty=true;if(this.removeNextStep){this.removeFromWorld();this.removeNextStep=false}},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x;this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y;if(!this.fixedRotation){this.sprite.rotation=this.data.angle}if(this.debugBody){this.debugBody.updateSpriteTransform()}this.dirty=false},reset:function(x,y,a,b){if(a===undefined){a=false}if(b===undefined){b=false}this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();if(a){this.setZeroDamping()}if(b){this.mass=1}this.x=x;this.y=y},addToWorld:function(){if(this.game.physics.p2._toRemove){for(var i=0;i<this.game.physics.p2._toRemove.length;i++){if(this.game.physics.p2._toRemove[i]===this){this.game.physics.p2._toRemove.splice(i,1)}}}if(this.data.world!==this.game.physics.p2.world){this.game.physics.p2.addBody(this)}},removeFromWorld:function(){if(this.data.world===this.game.physics.p2.world){this.game.physics.p2.removeBodyNextStep(this)}},destroy:function(){this.removeFromWorld();this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};if(this.debugBody){this.debugBody.destroy(true,true)}this.debugBody=null;if(this.sprite){this.sprite.body=null;this.sprite=null}},clearShapes:function(){var i=this.data.shapes.length;while(i--){this.data.removeShape(this.data.shapes[i])}this.shapeChanged()},addShape:function(a,b,c,d){if(b===undefined){b=0}if(c===undefined){c=0}if(d===undefined){d=0}this.data.addShape(a,[this.world.pxmi(b),this.world.pxmi(c)],d);this.shapeChanged();return a},addCircle:function(a,b,c,d){var e=new p2.Circle({radius:this.world.pxm(a)});return this.addShape(e,b,c,d)},addRectangle:function(a,b,c,d,e){var f=new p2.Box({width:this.world.pxm(a),height:this.world.pxm(b)});return this.addShape(f,c,d,e)},addPlane:function(a,b,c){var d=new p2.Plane();return this.addShape(d,a,b,c)},addParticle:function(a,b,c){var d=new p2.Particle();return this.addShape(d,a,b,c)},addLine:function(a,b,c,d){var e=new p2.Line({length:this.world.pxm(a)});return this.addShape(e,b,c,d)},addCapsule:function(a,b,c,d,e){var f=new p2.Capsule({length:this.world.pxm(a),radius:this.world.pxm(b)});return this.addShape(f,c,d,e)},addPolygon:function(a,b){a=a||{};if(!Array.isArray(b)){b=Array.prototype.slice.call(arguments,1)}var c=[];if(b.length===1&&Array.isArray(b[0])){c=b[0].slice(0)}else if(Array.isArray(b[0])){c=b.slice()}else if(typeof b[0]==='number'){for(var i=0,len=b.length;i<len;i+=2){c.push([b[i],b[i+1]])}}var d=c.length-1;if(c[d][0]===c[0][0]&&c[d][1]===c[0][1]){c.pop()}for(var p=0;p<c.length;p++){c[p][0]=this.world.pxmi(c[p][0]);c[p][1]=this.world.pxmi(c[p][1])}var e=this.data.fromPolygon(c,a);this.shapeChanged();return e},removeShape:function(a){var b=this.data.removeShape(a);this.shapeChanged();return b},setCircle:function(a,b,c,d){this.clearShapes();return this.addCircle(a,b,c,d)},setRectangle:function(a,b,c,d,e){if(a===undefined){a=16}if(b===undefined){b=16}this.clearShapes();return this.addRectangle(a,b,c,d,e)},setRectangleFromSprite:function(a){if(a===undefined){a=this.sprite}this.clearShapes();return this.addRectangle(a.width,a.height,0,0,a.rotation)},setMaterial:function(a,b){if(b===undefined){for(var i=this.data.shapes.length-1;i>=0;i--){this.data.shapes[i].material=a}}else{b.material=a}},shapeChanged:function(){if(this.debugBody){this.debugBody.draw()}},addPhaserPolygon:function(a,b){var c=this.game.cache.getPhysicsData(a,b);var d=[];for(var i=0;i<c.length;i++){var e=c[i];var f=this.addFixture(e);d[e.filter.group]=d[e.filter.group]||[];d[e.filter.group]=d[e.filter.group].concat(f);if(e.fixtureKey){d[e.fixtureKey]=f}}this.data.aabbNeedsUpdate=true;this.shapeChanged();return d},addFixture:function(a){var b=[];if(a.circle){var c=new p2.Circle({radius:this.world.pxm(a.circle.radius)});c.collisionGroup=a.filter.categoryBits;c.collisionMask=a.filter.maskBits;c.sensor=a.isSensor;var d=p2.vec2.create();d[0]=this.world.pxmi(a.circle.position[0]-this.sprite.width/2);d[1]=this.world.pxmi(a.circle.position[1]-this.sprite.height/2);this.data.addShape(c,d);b.push(c)}else{var e=a.polygons;var f=p2.vec2.create();for(var i=0;i<e.length;i++){var g=e[i];var h=[];for(var s=0;s<g.length;s+=2){h.push([this.world.pxmi(g[s]),this.world.pxmi(g[s+1])])}var c=new p2.Convex({vertices:h});for(var j=0;j!==c.vertices.length;j++){var v=c.vertices[j];p2.vec2.sub(v,v,c.centerOfMass)}p2.vec2.scale(f,c.centerOfMass,1);f[0]-=this.world.pxmi(this.sprite.width/2);f[1]-=this.world.pxmi(this.sprite.height/2);c.updateTriangles();c.updateCenterOfMass();c.updateBoundingRadius();c.collisionGroup=a.filter.categoryBits;c.collisionMask=a.filter.maskBits;c.sensor=a.isSensor;this.data.addShape(c,f);b.push(c)}}return b},loadPolygon:function(a,b,d){if(a===null){var e=b}else{var e=this.game.cache.getPhysicsData(a,b)}if(typeof d!=='number'){d=1}var f=p2.vec2.create();for(var i=0;i<e.length;i++){var g=[];for(var s=0;s<e[i].shape.length;s+=2){g.push([this.world.pxmi(e[i].shape[s]*d),this.world.pxmi(e[i].shape[s+1]*d)])}var c=new p2.Convex({vertices:g});for(var j=0;j!==c.vertices.length;j++){var v=c.vertices[j];p2.vec2.sub(v,v,c.centerOfMass)}p2.vec2.scale(f,c.centerOfMass,1);f[0]-=this.world.pxmi(this.sprite.width/2);f[1]-=this.world.pxmi(this.sprite.height/2);c.updateTriangles();c.updateCenterOfMass();c.updateBoundingRadius();this.data.addShape(c,f)}this.data.aabbNeedsUpdate=true;this.shapeChanged();return true}};N.Physics.P2.Body.prototype.constructor=N.Physics.P2.Body;N.Physics.P2.Body.DYNAMIC=1;N.Physics.P2.Body.STATIC=2;N.Physics.P2.Body.KINEMATIC=4;Object.defineProperty(N.Physics.P2.Body.prototype,'static',{get:function(){return(this.data.type===N.Physics.P2.Body.STATIC)},set:function(a){if(a&&this.data.type!==N.Physics.P2.Body.STATIC){this.data.type=N.Physics.P2.Body.STATIC;this.mass=0}else if(!a&&this.data.type===N.Physics.P2.Body.STATIC){this.data.type=N.Physics.P2.Body.DYNAMIC;this.mass=1}}});Object.defineProperty(N.Physics.P2.Body.prototype,'dynamic',{get:function(){return(this.data.type===N.Physics.P2.Body.DYNAMIC)},set:function(a){if(a&&this.data.type!==N.Physics.P2.Body.DYNAMIC){this.data.type=N.Physics.P2.Body.DYNAMIC;this.mass=1}else if(!a&&this.data.type===N.Physics.P2.Body.DYNAMIC){this.data.type=N.Physics.P2.Body.STATIC;this.mass=0}}});Object.defineProperty(N.Physics.P2.Body.prototype,'kinematic',{get:function(){return(this.data.type===N.Physics.P2.Body.KINEMATIC)},set:function(a){if(a&&this.data.type!==N.Physics.P2.Body.KINEMATIC){this.data.type=N.Physics.P2.Body.KINEMATIC;this.mass=4}else if(!a&&this.data.type===N.Physics.P2.Body.KINEMATIC){this.data.type=N.Physics.P2.Body.STATIC;this.mass=0}}});Object.defineProperty(N.Physics.P2.Body.prototype,'allowSleep',{get:function(){return this.data.allowSleep},set:function(a){if(a!==this.data.allowSleep){this.data.allowSleep=a}}});Object.defineProperty(N.Physics.P2.Body.prototype,'angle',{get:function(){return N.Math.wrapAngle(N.Math.radToDeg(this.data.angle))},set:function(a){this.data.angle=N.Math.degToRad(N.Math.wrapAngle(a))}});Object.defineProperty(N.Physics.P2.Body.prototype,'angularDamping',{get:function(){return this.data.angularDamping},set:function(a){this.data.angularDamping=a}});Object.defineProperty(N.Physics.P2.Body.prototype,'angularForce',{get:function(){return this.data.angularForce},set:function(a){this.data.angularForce=a}});Object.defineProperty(N.Physics.P2.Body.prototype,'angularVelocity',{get:function(){return this.data.angularVelocity},set:function(a){this.data.angularVelocity=a}});Object.defineProperty(N.Physics.P2.Body.prototype,'damping',{get:function(){return this.data.damping},set:function(a){this.data.damping=a}});Object.defineProperty(N.Physics.P2.Body.prototype,'fixedRotation',{get:function(){return this.data.fixedRotation},set:function(a){if(a!==this.data.fixedRotation){this.data.fixedRotation=a}}});Object.defineProperty(N.Physics.P2.Body.prototype,'inertia',{get:function(){return this.data.inertia},set:function(a){this.data.inertia=a}});Object.defineProperty(N.Physics.P2.Body.prototype,'mass',{get:function(){return this.data.mass},set:function(a){if(a!==this.data.mass){this.data.mass=a;this.data.updateMassProperties()}}});Object.defineProperty(N.Physics.P2.Body.prototype,'motionState',{get:function(){return this.data.type},set:function(a){if(a!==this.data.type){this.data.type=a}}});Object.defineProperty(N.Physics.P2.Body.prototype,'rotation',{get:function(){return this.data.angle},set:function(a){this.data.angle=a}});Object.defineProperty(N.Physics.P2.Body.prototype,'sleepSpeedLimit',{get:function(){return this.data.sleepSpeedLimit},set:function(a){this.data.sleepSpeedLimit=a}});Object.defineProperty(N.Physics.P2.Body.prototype,'x',{get:function(){return this.world.mpxi(this.data.position[0])},set:function(a){this.data.position[0]=this.world.pxmi(a)}});Object.defineProperty(N.Physics.P2.Body.prototype,'y',{get:function(){return this.world.mpxi(this.data.position[1])},set:function(a){this.data.position[1]=this.world.pxmi(a)}});Object.defineProperty(N.Physics.P2.Body.prototype,'id',{get:function(){return this.data.id}});Object.defineProperty(N.Physics.P2.Body.prototype,'debug',{get:function(){return(this.debugBody!==null)},set:function(a){if(a&&!this.debugBody){this.debugBody=new N.Physics.P2.BodyDebug(this.game,this.data)}else if(!a&&this.debugBody){this.debugBody.destroy();this.debugBody=null}}});Object.defineProperty(N.Physics.P2.Body.prototype,'collideWorldBounds',{get:function(){return this._collideWorldBounds},set:function(a){if(a&&!this._collideWorldBounds){this._collideWorldBounds=true;this.updateCollisionMask()}else if(!a&&this._collideWorldBounds){this._collideWorldBounds=false;this.updateCollisionMask()}}});N.Physics.P2.BodyDebug=function(a,b,c){N.Group.call(this,a);var d={pixelsPerLengthUnit:a.physics.p2.mpx(1),debugPolygons:false,lineWidth:1,alpha:0.5};this.settings=Object.assign(d,c);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu=-1*this.ppu;this.body=b;this.canvas=new N.Graphics(a);this.canvas.alpha=this.settings.alpha;this.add(this.canvas);this.draw();this.updateSpriteTransform()};N.Physics.P2.BodyDebug.prototype=Object.create(N.Group.prototype);N.Physics.P2.BodyDebug.prototype.constructor=N.Physics.P2.BodyDebug;Object.assign(N.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu;this.position.y=this.body.position[1]*this.ppu;this.rotation=this.body.angle},draw:function(){var a,child,color,i,j,lineColor,lw,obj,offset,sprite,v,verts,vrot,_j,_ref1;obj=this.body;sprite=this.canvas;sprite.clear();color=parseInt(this.randomPastelHex(),16);lineColor=0xff0000;lw=this.lineWidth;if(obj instanceof p2.Body&&obj.shapes.length){var l=obj.shapes.length;i=0;while(i!==l){child=obj.shapes[i];offset=child.position||0;a=child.angle||0;if(child instanceof p2.Circle){this.drawCircle(sprite,offset[0]*this.ppu,offset[1]*this.ppu,a,child.radius*this.ppu,color,lw)}else if(child instanceof p2.Capsule){this.drawCapsule(sprite,offset[0]*this.ppu,offset[1]*this.ppu,a,child.length*this.ppu,child.radius*this.ppu,lineColor,color,lw)}else if(child instanceof p2.Plane){this.drawPlane(sprite,offset[0]*this.ppu,-offset[1]*this.ppu,color,lineColor,lw*5,lw*10,lw*10,this.ppu*100,a)}else if(child instanceof p2.Line){this.drawLine(sprite,child.length*this.ppu,lineColor,lw)}else if(child instanceof p2.Box){this.drawRectangle(sprite,offset[0]*this.ppu,offset[1]*this.ppu,a,child.width*this.ppu,child.height*this.ppu,lineColor,color,lw)}else if(child instanceof p2.Convex){verts=[];vrot=p2.vec2.create();for(j=_j=0,_ref1=child.vertices.length;_ref1>=0?_j<_ref1:_j>_ref1;j=_ref1>=0?++_j:--_j){v=child.vertices[j];p2.vec2.rotate(vrot,v,a);verts.push([(vrot[0]+offset[0])*this.ppu,-(vrot[1]+offset[1])*this.ppu])}this.drawConvex(sprite,verts,child.triangles,lineColor,color,lw,this.settings.debugPolygons,[offset[0]*this.ppu,-offset[1]*this.ppu])}i++}}},drawRectangle:function(g,x,y,a,w,h,b,c,d){if(d===undefined){d=1}if(b===undefined){b=0x000000}g.lineStyle(d,b,1);g.beginFill(c);g.drawRect(x-w/2,y-h/2,w,h)},drawCircle:function(g,x,y,a,b,c,d){if(d===undefined){d=1}if(c===undefined){c=0xffffff}g.lineStyle(d,0x000000,1);g.beginFill(c,1.0);g.drawCircle(x,y,-b*2);g.endFill();g.moveTo(x,y);g.lineTo(x+b*Math.cos(-a),y+b*Math.sin(-a))},drawLine:function(g,a,b,c){if(c===undefined){c=1}if(b===undefined){b=0x000000}g.lineStyle(c*5,b,1);g.moveTo(-a/2,0);g.lineTo(a/2,0)},drawConvex:function(g,a,b,c,d,e,f,h){var j,i,v,v0,v1,x,x0,x1,y,y0,y1;if(e===undefined){e=1}if(c===undefined){c=0x000000}if(!f){g.lineStyle(e,c,1);g.beginFill(d);i=0;while(i!==a.length){v=a[i];x=v[0];y=v[1];if(i===0){g.moveTo(x,-y)}else{g.lineTo(x,-y)}i++}g.endFill();if(a.length>2){g.moveTo(a[a.length-1][0],-a[a.length-1][1]);return g.lineTo(a[0][0],-a[0][1])}}else{j=[0xff0000,0x00ff00,0x0000ff];i=0;while(i!==a.length+1){v0=a[i%a.length];v1=a[(i+1)%a.length];x0=v0[0];y0=v0[1];x1=v1[0];y1=v1[1];g.lineStyle(e,j[i%j.length],1);g.moveTo(x0,-y0);g.lineTo(x1,-y1);g.drawCircle(x0,-y0,e*2);i++}g.lineStyle(e,0x000000,1);return g.drawCircle(h[0],h[1],e*2)}},drawPath:function(g,a,b,c,d){var e,i,lastx,lasty,p1x,p1y,p2x,p2y,p3x,p3y,v,x,y;if(d===undefined){d=1}if(b===undefined){b=0x000000}g.lineStyle(d,b,1);if(typeof c==='number'){g.beginFill(c)}lastx=null;lasty=null;i=0;while(i<a.length){v=a[i];x=v[0];y=v[1];if(x!==lastx||y!==lasty){if(i===0){g.moveTo(x,y)}else{p1x=lastx;p1y=lasty;p2x=x;p2y=y;p3x=a[(i+1)%a.length][0];p3y=a[(i+1)%a.length][1];e=((p2x-p1x)*(p3y-p1y))-((p3x-p1x)*(p2y-p1y));if(e!==0){g.lineTo(x,y)}}lastx=x;lasty=y}i++}if(typeof c==='number'){g.endFill()}if(a.length>2&&typeof c==='number'){g.moveTo(a[a.length-1][0],a[a.length-1][1]);g.lineTo(a[0][0],a[0][1])}},drawPlane:function(g,a,b,c,d,e,f,h,i,j){var k,xd,yd;if(e===undefined){e=1}if(c===undefined){c=0xffffff}g.lineStyle(e,d,11);g.beginFill(c);k=i;g.moveTo(a,-b);xd=a+Math.cos(j)*this.game.width;yd=b+Math.sin(j)*this.game.height;g.lineTo(xd,-yd);g.moveTo(a,-b);xd=a+Math.cos(j)*-this.game.width;yd=b+Math.sin(j)*-this.game.height;g.lineTo(xd,-yd)},drawCapsule:function(g,x,y,a,b,d,e,f,h){if(h===undefined){h=1}if(e===undefined){e=0x000000}g.lineStyle(h,e,1);var c=Math.cos(a);var s=Math.sin(a);g.beginFill(f,1);g.drawCircle(-b/2*c+x,-b/2*s+y,-d*2);g.drawCircle(b/2*c+x,b/2*s+y,-d*2);g.endFill();g.lineStyle(h,e,0);g.beginFill(f,1);g.moveTo(-b/2*c+d*s+x,-b/2*s+d*c+y);g.lineTo(b/2*c+d*s+x,b/2*s+d*c+y);g.lineTo(b/2*c-d*s+x,b/2*s-d*c+y);g.lineTo(-b/2*c-d*s+x,-b/2*s-d*c+y);g.endFill();g.lineStyle(h,e,1);g.moveTo(-b/2*c+d*s+x,-b/2*s+d*c+y);g.lineTo(b/2*c+d*s+x,b/2*s+d*c+y);g.moveTo(-b/2*c-d*s+x,-b/2*s-d*c+y);g.lineTo(b/2*c-d*s+x,b/2*s-d*c+y)},randomPastelHex:function(){var a,green,mix,red;mix=[255,255,255];red=Math.floor(Math.random()*256);green=Math.floor(Math.random()*256);a=Math.floor(Math.random()*256);red=Math.floor((red+3*mix[0])/4);green=Math.floor((green+3*mix[1])/4);a=Math.floor((a+3*mix[2])/4);return this.rgbToHex(red,green,a)},rgbToHex:function(r,g,b){return this.componentToHex(r)+this.componentToHex(g)+this.componentToHex(b)},componentToHex:function(c){var a;a=c.toString(16);if(a.length===2){return a}else{return a+'0'}}});N.Physics.P2.Spring=function(a,b,c,d,e,f,g,h,i,j){this.game=a.game;this.world=a;if(d===undefined){d=1}if(e===undefined){e=100}if(f===undefined){f=1}d=a.pxm(d);var k={restLength:d,stiffness:e,damping:f};if(typeof g!=='undefined'&&g!==null){k.worldAnchorA=[a.pxm(g[0]),a.pxm(g[1])]}if(typeof h!=='undefined'&&h!==null){k.worldAnchorB=[a.pxm(h[0]),a.pxm(h[1])]}if(typeof i!=='undefined'&&i!==null){k.localAnchorA=[a.pxm(i[0]),a.pxm(i[1])]}if(typeof j!=='undefined'&&j!==null){k.localAnchorB=[a.pxm(j[0]),a.pxm(j[1])]}this.data=new p2.LinearSpring(b,c,k);this.data.parent=this};N.Physics.P2.Spring.prototype.constructor=N.Physics.P2.Spring;N.Physics.P2.RotationalSpring=function(a,b,c,d,e,f){this.game=a.game;this.world=a;if(d===undefined){d=null}if(e===undefined){e=100}if(f===undefined){f=1}if(d){d=a.pxm(d)}var g={restAngle:d,stiffness:e,damping:f};this.data=new p2.RotationalSpring(b,c,g);this.data.parent=this};N.Physics.P2.Spring.prototype.constructor=N.Physics.P2.Spring;N.Physics.P2.Material=function(a){this.name=a;p2.Material.call(this)};N.Physics.P2.Material.prototype=Object.create(p2.Material.prototype);N.Physics.P2.Material.prototype.constructor=N.Physics.P2.Material;N.Physics.P2.ContactMaterial=function(a,b,c){p2.ContactMaterial.call(this,a,b,c)};N.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype);N.Physics.P2.ContactMaterial.prototype.constructor=N.Physics.P2.ContactMaterial;N.Physics.P2.CollisionGroup=function(a){this.mask=a};N.Physics.P2.DistanceConstraint=function(a,b,c,d,e,f,g){if(d===undefined){d=100}if(e===undefined){e=[0,0]}if(f===undefined){f=[0,0]}if(g===undefined){g=Number.MAX_VALUE}this.game=a.game;this.world=a;d=a.pxm(d);e=[a.pxmi(e[0]),a.pxmi(e[1])];f=[a.pxmi(f[0]),a.pxmi(f[1])];var h={distance:d,localAnchorA:e,localAnchorB:f,maxForce:g};p2.DistanceConstraint.call(this,b,c,h)};N.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype);N.Physics.P2.DistanceConstraint.prototype.constructor=N.Physics.P2.DistanceConstraint;N.Physics.P2.GearConstraint=function(a,b,c,d,e){if(d===undefined){d=0}if(e===undefined){e=1}this.game=a.game;this.world=a;var f={angle:d,ratio:e};p2.GearConstraint.call(this,b,c,f)};N.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype);N.Physics.P2.GearConstraint.prototype.constructor=N.Physics.P2.GearConstraint;N.Physics.P2.LockConstraint=function(a,b,c,d,e,f){if(d===undefined){d=[0,0]}if(e===undefined){e=0}if(f===undefined){f=Number.MAX_VALUE}this.game=a.game;this.world=a;d=[a.pxm(d[0]),a.pxm(d[1])];var g={localOffsetB:d,localAngleB:e,maxForce:f};p2.LockConstraint.call(this,b,c,g)};N.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype);N.Physics.P2.LockConstraint.prototype.constructor=N.Physics.P2.LockConstraint;N.Physics.P2.PrismaticConstraint=function(a,b,c,d,e,f,g,h){if(d===undefined){d=true}if(e===undefined){e=[0,0]}if(f===undefined){f=[0,0]}if(g===undefined){g=[0,0]}if(h===undefined){h=Number.MAX_VALUE}this.game=a.game;this.world=a;e=[a.pxmi(e[0]),a.pxmi(e[1])];f=[a.pxmi(f[0]),a.pxmi(f[1])];var i={localAnchorA:e,localAnchorB:f,localAxisA:g,maxForce:h,disableRotationalLock:!d};p2.PrismaticConstraint.call(this,b,c,i)};N.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype);N.Physics.P2.PrismaticConstraint.prototype.constructor=N.Physics.P2.PrismaticConstraint;N.Physics.P2.RevoluteConstraint=function(a,b,c,d,e,f,g){if(f===undefined){f=Number.MAX_VALUE}if(g===undefined){g=null}this.game=a.game;this.world=a;c=[a.pxmi(c[0]),a.pxmi(c[1])];e=[a.pxmi(e[0]),a.pxmi(e[1])];if(g){g=[a.pxmi(g[0]),a.pxmi(g[1])]}var h={worldPivot:g,localPivotA:c,localPivotB:e,maxForce:f};p2.RevoluteConstraint.call(this,b,d,h)};N.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype);N.Physics.P2.RevoluteConstraint.prototype.constructor=N.Physics.P2.RevoluteConstraint;N.ImageCollection=function(a,b,c,d,e,f,g){if(c===undefined||c<=0){c=32}if(d===undefined||d<=0){d=32}if(e===undefined){e=0}if(f===undefined){f=0}this.name=a;this.firstgid=b|0;this.imageWidth=c|0;this.imageHeight=d|0;this.imageMargin=e|0;this.imageSpacing=f|0;this.properties=g||{};this.images=[];this.total=0};N.ImageCollection.prototype={containsImageIndex:function(a){return(a>=this.firstgid&&a<(this.firstgid+this.total))},addImage:function(a,b){this.images.push({gid:a,image:b});this.total++}};N.ImageCollection.prototype.constructor=N.ImageCollection;N.Tile=function(a,b,x,y,c,d){this.layer=a;this.index=b;this.x=x;this.y=y;this.rotation=0;this.flipped=false;this.worldX=x*c;this.worldY=y*d;this.width=c;this.height=d;this.centerX=Math.abs(c/2);this.centerY=Math.abs(d/2);this.alpha=1;this.properties={};this.scanned=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false;this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.collisionCallback=null;this.collisionCallbackContext=this;this.debug=false};N.Tile.prototype={containsPoint:function(x,y){return!(x<this.worldX||y<this.worldY||x>this.right||y>this.bottom)},intersects:function(x,y,a,b){if(a<=this.worldX){return false}if(b<=this.worldY){return false}if(x>=this.worldX+this.width){return false}if(y>=this.worldY+this.height){return false}return true},setCollisionCallback:function(a,b){this.collisionCallback=a;this.collisionCallbackContext=b},destroy:function(){this.collisionCallback=null;this.collisionCallbackContext=null;this.properties=null},setCollision:function(a,b,c,d){this.collideLeft=a;this.collideRight=b;this.collideUp=c;this.collideDown=d;this.faceLeft=a;this.faceRight=b;this.faceTop=c;this.faceBottom=d},resetCollision:function(){this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false},isInteresting:function(a,b){if(a&&b){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback)}else if(a){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown)}else if(b){return(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight)}return false},copy:function(a){this.index=a.index;this.alpha=a.alpha;this.properties=a.properties;this.collideUp=a.collideUp;this.collideDown=a.collideDown;this.collideLeft=a.collideLeft;this.collideRight=a.collideRight;this.collisionCallback=a.collisionCallback;this.collisionCallbackContext=a.collisionCallbackContext}};N.Tile.prototype.constructor=N.Tile;Object.defineProperty(N.Tile.prototype,'collides',{get:function(){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown)}});Object.defineProperty(N.Tile.prototype,'canCollide',{get:function(){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback)}});Object.defineProperty(N.Tile.prototype,'left',{get:function(){return this.worldX}});Object.defineProperty(N.Tile.prototype,'right',{get:function(){return this.worldX+this.width}});Object.defineProperty(N.Tile.prototype,'top',{get:function(){return this.worldY}});Object.defineProperty(N.Tile.prototype,'bottom',{get:function(){return this.worldY+this.height}});N.Tilemap=function(a,b,c,d,e,f){this.game=a;this.key=b;var g=N.TilemapParser.parse(this.game,b,c,d,e,f);if(g===null){return}this.width=g.width;this.height=g.height;this.tileWidth=g.tileWidth;this.tileHeight=g.tileHeight;this.orientation=g.orientation;this.format=g.format;this.version=g.version;this.properties=g.properties;this.widthInPixels=g.widthInPixels;this.heightInPixels=g.heightInPixels;this.layers=g.layers;this.tilesets=g.tilesets;this.imagecollections=g.imagecollections;this.tiles=g.tiles;this.objects=g.objects;this.objectsMap=g.objectsMap;this.collideIndexes=[];this.collision=g.collision;this.images=g.images;this.enableDebug=false;this.currentLayer=0;this.debugMap=[];this._results=[];this._tempA=0;this._tempB=0};N.Tilemap.CSV=0;N.Tilemap.TILED_JSON=1;N.Tilemap.NORTH=0;N.Tilemap.EAST=1;N.Tilemap.SOUTH=2;N.Tilemap.WEST=3;N.Tilemap.prototype={create:function(a,b,c,d,e,f){if(f===undefined){f=this.game.world}this.width=b;this.height=c;this.setTileSize(d,e);this.layers.length=0;return this.createBlankLayer(a,b,c,d,e,f)},setTileSize:function(a,b){this.tileWidth=a;this.tileHeight=b;this.widthInPixels=this.width*a;this.heightInPixels=this.height*b},addTilesetImage:function(a,b,c,d,e,f,g){if(a===undefined){return null}if(c===undefined){c=this.tileWidth}if(d===undefined){d=this.tileHeight}if(e===undefined){e=0}if(f===undefined){f=0}if(g===undefined){g=0}if(c===0){c=32}if(d===0){d=32}var h=null;if(b===undefined||b===null){b=a}if(N.BitmapData&&b instanceof N.BitmapData){h=b.canvas}else{if(!this.game.cache.checkImageKey(b)){console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+b+'"');return null}h=this.game.cache.getImage(b)}var j=this.getTilesetIndex(a);if(j===null&&this.format===N.Tilemap.TILED_JSON){console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+a+'"');console.log('Tilesets: ',this.tilesets);return null}if(this.tilesets[j]){this.tilesets[j].setImage(h);return this.tilesets[j]}else{var k=new N.Tileset(a,g,c,d,e,f,{});k.setImage(h);this.tilesets.push(k);var i=this.tilesets.length-1;var x=e;var y=e;var l=0;var m=0;var n=0;for(var t=g;t<g+k.total;t++){this.tiles[t]=[x,y,i];x+=c+f;l++;if(l===k.total){break}m++;if(m===k.columns){x=e;y+=d+f;m=0;n++;if(n===k.rows){break}}}return k}},createFromObjects:function(a,b,c,d,e,f,g,h,j,k){if(e===undefined){e=true}if(f===undefined){f=false}if(g===undefined){g=this.game.world}if(h===undefined){h=N.Sprite}if(j===undefined){j=true}if(k===undefined){k=true}var l=this.objects[a];if(!l){console.warn('Tilemap.createFromObjects: Invalid object layer name given: '+a);console.log('Object layers: ',this.objects);return}var m=[];var n=[];var o=typeof b;if(o==='number'){this.getObjects(a,'gid',b,m)}else if(o==='string'){this.getObjects(a,'name',b,m)}else if(Array.isArray(b)){this.getObjects(a,b[0],b[1],m)}else if(b===null){m=l}for(var i=0;i<m.length;i++){var p=m[i];var q=new h(this.game,parseFloat(p.x),parseFloat(p.y),c,d);q.name=p.name;q.autoCull=f;q.exists=e;q.visible=p.visible;if(k){if(p.width){q.width=p.width}if(p.height){q.height=p.height}}if(p.rotation){q.angle=p.rotation}if(j&&p.gid){q.y-=q.height}if(g!==null){g.add(q)}var r=p.properties;for(var s in r){N.Utils.setProperty(q,s,r[s])}n.push(q)}return n},createFromTiles:function(a,b,c,d,e,f){if(typeof a==='number'){a=[a]}if(b===undefined||b===null){b=[]}else if(typeof b==='number'){b=[b]}d=this.getLayer(d);if(e===undefined){e=this.game.world}if(f===undefined){f={}}if(f.customClass===undefined){f.customClass=N.Sprite}if(f.adjustY===undefined){f.adjustY=true}var g=this.layers[d].width;var h=this.layers[d].height;this.copy(0,0,g,h,d);if(this._results.length<2){return 0}var j=0;var k;for(var i=1,len=this._results.length;i<len;i++){if(a.indexOf(this._results[i].index)!==-1){k=new f.customClass(this.game,this._results[i].worldX,this._results[i].worldY,c);for(var l in f){k[l]=f[l]}e.add(k);j++}}if(b.length===1){for(i=0;i<a.length;i++){this.replace(a[i],b[0],0,0,g,h,d)}}else if(b.length>1){for(i=0;i<a.length;i++){this.replace(a[i],b[i],0,0,g,h,d)}}return j},createLayer:function(a,b,c,d){if(b===undefined){b=this.game.width}if(c===undefined){c=this.game.height}if(d===undefined){d=this.game.world}var e=a;if(typeof a==='string'){e=this.getLayerIndex(a)}if(e===null||e>this.layers.length){console.warn('Tilemap.createLayer: Invalid layer ID given: "'+a+'"');console.log('Layers: ',this.layers);return}if(b===undefined||b<=0){b=Math.min(this.game.width,this.layers[e].widthInPixels)}else if(b>this.game.width){b=this.game.width}if(c===undefined||c<=0){c=Math.min(this.game.height,this.layers[e].heightInPixels)}else if(c>this.game.height){c=this.game.height}if(this.enableDebug){console.group('Tilemap.createLayer');console.log('Name:',this.layers[e].name);console.log('Size:',b,'x',c);console.log('Tileset:',this.tilesets[0].name,'index:',e)}var f=d.add(new N.TilemapLayer(this.game,this,e,b,c));if(this.enableDebug){console.groupEnd()}return f},createBlankLayer:function(a,b,c,d,e,f){if(f===undefined){f=this.game.world}if(this.getLayerIndex(a)!==null){console.warn('Tilemap.createBlankLayer: Layer with matching name already exists: '+a);return}var g={name:a,x:0,y:0,width:b,height:c,widthInPixels:b*d,heightInPixels:c*e,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:null};var i;var j=[];for(var y=0;y<c;y++){i=[];for(var x=0;x<b;x++){i.push(new N.Tile(g,-1,x,y,d,e))}j.push(i)}g.data=j;this.layers.push(g);this.currentLayer=this.layers.length-1;var w=g.widthInPixels;var h=g.heightInPixels;if(w>this.game.width){w=this.game.width}if(h>this.game.height){h=this.game.height}var j=new N.TilemapLayer(this.game,this,this.layers.length-1,w,h);j.name=a;return f.add(j)},getIndex:function(a,b){for(var i=0;i<a.length;i++){if(a[i].name===b){return i}}return null},getLayerIndex:function(a){return this.getIndex(this.layers,a)},getObject:function(a){return this.objectsMap[a]||null},getObjects:function(a,b,c,d){var e=this.objects[a];var f=e.length;if(d===undefined){d=[]}for(var i=0;i<f;i++){var g=e[i];if(g[b]===c){d.push(g)}}return d},getTilesetIndex:function(a){return this.getIndex(this.tilesets,a)},getImageIndex:function(a){return this.getIndex(this.images,a)},setTileIndexCallback:function(a,b,c,d){d=this.getLayer(d);if(typeof a==='number'){if(b===null){delete this.layers[d].callbacks[a]}else{this.layers[d].callbacks[a]={callback:b,callbackContext:c}}}else{for(var i=0,len=a.length;i<len;i++){if(b===null){delete this.layers[d].callbacks[a[i]]}else{this.layers[d].callbacks[a[i]]={callback:b,callbackContext:c}}}}},setTileLocationCallback:function(x,y,a,b,c,d,e){e=this.getLayer(e);this.copy(x,y,a,b,e);if(this._results.length<2){return}for(var i=1;i<this._results.length;i++){this._results[i].setCollisionCallback(c,d)}},setCollision:function(a,b,c,d){if(b===undefined){b=true}if(d===undefined){d=true}c=this.getLayer(c);if(typeof a==='number'){return this.setCollisionByIndex(a,b,c,true)}else if(Array.isArray(a)){for(var i=0;i<a.length;i++){this.setCollisionByIndex(a[i],b,c,false)}if(d){this.calculateFaces(c)}}},setCollisionBetween:function(a,b,c,d,e){if(c===undefined){c=true}if(e===undefined){e=true}d=this.getLayer(d);if(a>b){return}for(var f=a;f<=b;f++){this.setCollisionByIndex(f,c,d,false)}if(e){this.calculateFaces(d)}},setCollisionByExclusion:function(a,b,c,d){if(b===undefined){b=true}if(d===undefined){d=true}c=this.getLayer(c);for(var i=0,len=this.tiles.length;i<len;i++){if(a.indexOf(i)===-1){this.setCollisionByIndex(i,b,c,false)}}if(d){this.calculateFaces(c)}},setCollisionByIndex:function(a,b,c,d){if(b===undefined){b=true}if(c===undefined){c=this.currentLayer}if(d===undefined){d=true}if(b){this.collideIndexes.push(a)}else{var i=this.collideIndexes.indexOf(a);if(i>-1){this.collideIndexes.splice(i,1)}}for(var y=0;y<this.layers[c].height;y++){for(var x=0;x<this.layers[c].width;x++){var e=this.layers[c].data[y][x];if(e&&e.index===a){if(b){e.setCollision(true,true,true,true)}else{e.resetCollision()}e.faceTop=b;e.faceBottom=b;e.faceLeft=b;e.faceRight=b}}}if(d){this.calculateFaces(c)}return c},getLayer:function(a){if(a===undefined){a=this.currentLayer}else if(typeof a==='string'){var b=a;a=this.getLayerIndex(a);if(a===null){console.warn('No such layer name: '+b)}}else if(a instanceof N.TilemapLayer){a=a.index}return a},setPreventRecalculate:function(a){if(a===true&&this.preventingRecalculate!==true){this.preventingRecalculate=true;this.needToRecalculate={}}if(a===false&&this.preventingRecalculate===true){this.preventingRecalculate=false;for(var i in this.needToRecalculate){this.calculateFaces(i)}this.needToRecalculate=false}},calculateFaces:function(a){if(this.preventingRecalculate){this.needToRecalculate[a]=true;return}var b=null;var c=null;var d=null;var e=null;for(var y=0,h=this.layers[a].height;y<h;y++){for(var x=0,w=this.layers[a].width;x<w;x++){var f=this.layers[a].data[y][x];if(f){b=this.getTileAbove(a,x,y);c=this.getTileBelow(a,x,y);d=this.getTileLeft(a,x,y);e=this.getTileRight(a,x,y);if(f.collides){f.faceTop=true;f.faceBottom=true;f.faceLeft=true;f.faceRight=true}if(b&&b.collides){f.faceTop=false}if(c&&c.collides){f.faceBottom=false}if(d&&d.collides){f.faceLeft=false}if(e&&e.collides){f.faceRight=false}}}}},getTileAbove:function(a,x,y){if(y>0){return this.layers[a].data[y-1][x]}return null},getTileBelow:function(a,x,y){if(y<this.layers[a].height-1){return this.layers[a].data[y+1][x]}return null},getTileLeft:function(a,x,y){if(x>0){return this.layers[a].data[y][x-1]}return null},getTileRight:function(a,x,y){if(x<this.layers[a].width-1){return this.layers[a].data[y][x+1]}return null},setLayer:function(a){a=this.getLayer(a);if(this.layers[a]){this.currentLayer=a}},hasTile:function(x,y,a){a=this.getLayer(a);if(this.layers[a].data[y]===undefined||this.layers[a].data[y][x]===undefined){return false}return(this.layers[a].data[y][x].index>-1)},removeTile:function(x,y,a){a=this.getLayer(a);if(x>=0&&x<this.layers[a].width&&y>=0&&y<this.layers[a].height){if(this.hasTile(x,y,a)){var b=this.layers[a].data[y][x];this.layers[a].data[y][x]=new N.Tile(this.layers[a],-1,x,y,this.tileWidth,this.tileHeight);this.layers[a].dirty=true;this.calculateFaces(a);return b}}},removeTileWorldXY:function(x,y,a,b,c){c=this.getLayer(c);x=this.game.math.snapToFloor(x,a)/a;y=this.game.math.snapToFloor(y,b)/b;return this.removeTile(x,y,c)},putTile:function(a,x,y,b){if(a===null){return this.removeTile(x,y,b)}b=this.getLayer(b);if(x>=0&&x<this.layers[b].width&&y>=0&&y<this.layers[b].height){var c;if(a instanceof N.Tile){c=a.index;if(this.hasTile(x,y,b)){this.layers[b].data[y][x].copy(a)}else{this.layers[b].data[y][x]=new N.Tile(b,c,x,y,a.width,a.height)}}else{c=a;if(this.hasTile(x,y,b)){this.layers[b].data[y][x].index=c}else{this.layers[b].data[y][x]=new N.Tile(this.layers[b],c,x,y,this.tileWidth,this.tileHeight)}}if(this.collideIndexes.indexOf(c)>-1){this.layers[b].data[y][x].setCollision(true,true,true,true)}else{this.layers[b].data[y][x].resetCollision()}this.layers[b].dirty=true;this.calculateFaces(b);return this.layers[b].data[y][x]}return null},putTileWorldXY:function(a,x,y,b,c,d){d=this.getLayer(d);x=this.game.math.snapToFloor(x,b)/b;y=this.game.math.snapToFloor(y,c)/c;return this.putTile(a,x,y,d)},searchTileIndex:function(a,b,d,e,f){if(b===undefined){b=0}if(d===undefined){d=false}e=this.getLayer(e);var c=0;var g=this.layers[e].height;var h=this.layers[e].width;var i=this.layers[e].data;var j,tile;if(f){var k=[]}if(d){for(var y=g-1;y>=0;y--){j=i[y];for(var x=h-1;x>=0;x--){tile=j[x];if(tile.index===a){if(c>=b){if(f){k.push(tile)}else{return tile}}else{c++}}}}}else{for(var y=0;y<g;y++){j=i[y];for(var x=0;x<h;x++){tile=j[x];if(tile.index===a){if(c>=b){if(f){k.push(tile)}else{return tile}}else{c++}}}}}return f?k:null},getTile:function(x,y,a,b){if(b===undefined){b=false}a=this.getLayer(a);if(x>=0&&x<this.layers[a].width&&y>=0&&y<this.layers[a].height){if(this.layers[a].data[y][x].index===-1){if(b){return this.layers[a].data[y][x]}else{return null}}else{return this.layers[a].data[y][x]}}else{return null}},getTileWorldXY:function(x,y,a,b,c,d){if(a===undefined){a=this.tileWidth}if(b===undefined){b=this.tileHeight}c=this.getLayer(c);x=this.game.math.snapToFloor(x,a)/a;y=this.game.math.snapToFloor(y,b)/b;return this.getTile(x,y,c,d)},copy:function(x,y,a,b,c){c=this.getLayer(c);if(!this.layers[c]){this._results.length=0;return}if(x===undefined){x=0}if(y===undefined){y=0}if(a===undefined){a=this.layers[c].width}if(b===undefined){b=this.layers[c].height}if(x<0){x=0}if(y<0){y=0}if(a>this.layers[c].width){a=this.layers[c].width}if(b>this.layers[c].height){b=this.layers[c].height}this._results.length=0;this._results.push({x:x,y:y,width:a,height:b,layer:c});for(var d=y;d<y+b;d++){for(var e=x;e<x+a;e++){this._results.push(this.layers[c].data[d][e])}}return this._results},paste:function(x,y,a,b){if(x===undefined){x=0}if(y===undefined){y=0}b=this.getLayer(b);if(!a||a.length<2){return}var c=x-a[1].x;var d=y-a[1].y;for(var i=1;i<a.length;i++){this.layers[b].data[d+a[i].y][c+a[i].x].copy(a[i])}this.layers[b].dirty=true;this.calculateFaces(b)},swap:function(a,b,x,y,c,d,e){e=this.getLayer(e);this.copy(x,y,c,d,e);if(this._results.length<2){return}this._tempA=a;this._tempB=b;this._results.forEach(this.swapHandler,this);this.paste(x,y,this._results,e)},swapHandler:function(a){if(a.index===this._tempA){a.index=this._tempB}else if(a.index===this._tempB){a.index=this._tempA}},forEach:function(a,b,x,y,c,d,e){e=this.getLayer(e);this.copy(x,y,c,d,e);if(this._results.length<2){return}this._results.forEach(a,b);this.paste(x,y,this._results,e)},replace:function(a,b,x,y,c,d,e){e=this.getLayer(e);this.copy(x,y,c,d,e);if(this._results.length<2){return}for(var i=1;i<this._results.length;i++){if(this._results[i].index===a){this._results[i].index=b}}this.paste(x,y,this._results,e)},random:function(x,y,a,b,c){c=this.getLayer(c);this.copy(x,y,a,b,c);if(this._results.length<2){return}var d=[];for(var t=1;t<this._results.length;t++){if(this._results[t].index){var e=this._results[t].index;if(d.indexOf(e)===-1){d.push(e)}}}for(var i=1;i<this._results.length;i++){this._results[i].index=this.game.rnd.pick(d)}this.paste(x,y,this._results,c)},shuffle:function(x,y,a,b,c){c=this.getLayer(c);this.copy(x,y,a,b,c);if(this._results.length<2){return}var d=[];for(var t=1;t<this._results.length;t++){if(this._results[t].index){d.push(this._results[t].index)}}N.ArrayUtils.shuffle(d);for(var i=1;i<this._results.length;i++){this._results[i].index=d[i-1]}this.paste(x,y,this._results,c)},fill:function(a,x,y,b,c,d){d=this.getLayer(d);this.copy(x,y,b,c,d);if(this._results.length<2){return}for(var i=1;i<this._results.length;i++){this._results[i].index=a}this.paste(x,y,this._results,d)},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){var a='';var b=[''];for(var y=0;y<this.layers[this.currentLayer].height;y++){for(var x=0;x<this.layers[this.currentLayer].width;x++){a+='%c  ';if(this.layers[this.currentLayer].data[y][x]>1){if(this.debugMap[this.layers[this.currentLayer].data[y][x]]){b.push('background: '+this.debugMap[this.layers[this.currentLayer].data[y][x]])}else{b.push('background: #ffffff')}}else{b.push('background: rgb(0, 0, 0)')}}a+='\n'}b[0]=a;console.log.apply(console,b)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};N.Tilemap.prototype.constructor=N.Tilemap;Object.defineProperty(N.Tilemap.prototype,'layer',{get:function(){return this.layers[this.currentLayer]},set:function(a){if(a!==this.currentLayer){this.setLayer(a)}}});N.TilemapLayer=function(a,b,c,d,e){d|=0;e|=0;N.Sprite.call(this,a,0,0);this.map=b;this.index=c;this.layer=b.layers[c];this.canvas=N.CanvasPool.create(this,d,e);this.context=this.canvas.getContext('2d');this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas,null,this.game.resolution)));this.type=N.TILEMAPLAYER;this.physicsType=N.TILEMAPLAYER;this.renderSettings={enableScrollDelta:true,overdrawRatio:0.20,copyCanvas:null};this.debug=false;this.exists=true;this.debugSettings={missingImageFill:'rgb(255,255,255)',debuggedTileOverfill:'rgba(0,255,0,0.4)',forceFullRedraw:true,debugAlpha:0.5,facingEdgeStroke:'rgba(0,255,0,1)',collidingTileOverfill:'rgba(0,255,0,0.2)'};this.scrollFactorX=1;this.scrollFactorY=1;this.dirty=true;this.rayStepRate=4;this._wrap=false;this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:b.tileWidth,tileHeight:b.tileHeight,cw:b.tileWidth,ch:b.tileHeight,tilesets:[]};this._scrollX=0;this._scrollY=0;this.tileOffset=new N.Point(this.layer.offsetX||0,this.layer.offsetY||0);this._results=[];if(!a.device.canvasBitBltShift){this.renderSettings.copyCanvas=N.TilemapLayer.ensureSharedCopyCanvas()}this.fixedToCamera=true};N.TilemapLayer.prototype=Object.create(N.Sprite.prototype);N.TilemapLayer.prototype.constructor=N.TilemapLayer;N.TilemapLayer.prototype.preUpdateCore=N.Component.Core.preUpdate;N.TilemapLayer.sharedCopyCanvas=null;N.TilemapLayer.ensureSharedCopyCanvas=function(){if(!this.sharedCopyCanvas){this.sharedCopyCanvas=N.CanvasPool.create(this,2,2)}return this.sharedCopyCanvas};N.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()};N.TilemapLayer.prototype.postUpdate=function(){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x;this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y};N.TilemapLayer.prototype._renderCanvas=function(a){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x;this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderCanvas.call(this,a)};N.TilemapLayer.prototype._renderWebGL=function(a){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x;this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderWebGL.call(this,a)};N.TilemapLayer.prototype.destroy=function(){N.CanvasPool.remove(this);N.Component.Destroy.prototype.destroy.call(this)};N.TilemapLayer.prototype.resize=function(a,b){this.canvas.width=a;this.canvas.height=b;this.texture.frame.resize(a,b);this.texture.width=a;this.texture.height=b;this.texture.crop.width=a;this.texture.crop.height=b;this.texture.baseTexture.width=a;this.texture.baseTexture.height=b;this.texture.baseTexture.dirty();this.texture.requiresUpdate=true;this.texture._updateUvs();this.dirty=true};N.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)};N.TilemapLayer.prototype.getTileOffsetX=function(){return this.tileOffset.x||((!this.fixedToCamera)?this.position.x:0)};N.TilemapLayer.prototype.getTileOffsetY=function(){return this.tileOffset.y||((!this.fixedToCamera)?this.position.y:0)};N.TilemapLayer.prototype._fixX=function(x){if(this.scrollFactorX===1||(this.scrollFactorX===0&&this.position.x===0)){return x}if(this.scrollFactorX===0&&this.position.x!==0){return x-this.position.x}return this._scrollX+(x-(this._scrollX/this.scrollFactorX))};N.TilemapLayer.prototype._unfixX=function(x){if(this.scrollFactorX===1){return x}return(this._scrollX/this.scrollFactorX)+(x-this._scrollX)};N.TilemapLayer.prototype._fixY=function(y){if(this.scrollFactorY===1||(this.scrollFactorY===0&&this.position.y===0)){return y}if(this.scrollFactorY===0&&this.position.y!==0){return y-this.position.y}return this._scrollY+(y-(this._scrollY/this.scrollFactorY))};N.TilemapLayer.prototype._unfixY=function(y){if(this.scrollFactorY===1){return y}return(this._scrollY/this.scrollFactorY)+(y-this._scrollY)};N.TilemapLayer.prototype.getTileX=function(x){return Math.floor(this._fixX(x)/this._mc.tileWidth)};N.TilemapLayer.prototype.getTileY=function(y){return Math.floor(this._fixY(y)/this._mc.tileHeight)};N.TilemapLayer.prototype.getTileXY=function(x,y,a){a.x=this.getTileX(x);a.y=this.getTileY(y);return a};N.TilemapLayer.prototype.getRayCastTiles=function(a,b,c,d){if(!b){b=this.rayStepRate}if(c===undefined){c=false}if(d===undefined){d=false}var e=!(c||d);var f=a.coordinatesOnLine(b);var g=[];var h=new N.Point();var i=this.map.layers[this.map.getLayer(this)];var j=i.data;var k=i.width;var l=i.height;for(var t=0;t<f.length;t++){var m=f[t];this.getTileXY(m[0],m[1],h);var x=h.x;var y=h.y;if(x<0||x>=k||y<0||y>=l){continue}var n=j[y][x];if(g.indexOf(n)===-1&&(e||n.isInteresting(c,d))){g.push(n)}}return g};N.TilemapLayer.prototype.getTiles=function(x,y,a,b,c,d){if(c===undefined){c=false}if(d===undefined){d=false}var e=!(c||d);x=this._fixX(x);y=this._fixY(y);var f=Math.floor(x/(this._mc.cw*this.scale.x));var g=Math.floor(y/(this._mc.ch*this.scale.y));var h=Math.ceil((x+a)/(this._mc.cw*this.scale.x))-f;var i=Math.ceil((y+b)/(this._mc.ch*this.scale.y))-g;while(this._results.length){this._results.pop()}for(var j=g;j<g+i;j++){for(var k=f;k<f+h;k++){var l=this.layer.data[j];if(l&&l[k]){if(e||l[k].isInteresting(c,d)){this._results.push(l[k])}}}}return this._results.slice()};N.TilemapLayer.prototype.resolveTileset=function(a){var b=this._mc.tilesets;if(a<2000){while(b.length<a){b.push(undefined)}}var c=this.map.tiles[a]&&this.map.tiles[a][2];if(c!==null){var d=this.map.tilesets[c];if(d&&d.containsTileIndex(a)){return(b[a]=d)}}return(b[a]=null)};N.TilemapLayer.prototype.resetTilesetCache=function(){var a=this._mc.tilesets;while(a.length){a.pop()}};N.TilemapLayer.prototype.setScale=function(a,b){a=a||1;b=b||a;for(var y=0;y<this.layer.data.length;y++){var c=this.layer.data[y];for(var x=0;x<c.length;x++){var d=c[x];d.width=this.map.tileWidth*a;d.height=this.map.tileHeight*b;d.worldX=d.x*d.width;d.worldY=d.y*d.height}}this.scale.setTo(a,b)};N.TilemapLayer.prototype.shiftCanvas=function(a,x,y){var b=a.canvas;var c=b.width-Math.abs(x);var d=b.height-Math.abs(y);var e=0;var f=0;var g=x;var h=y;if(x<0){e=-x;g=0}if(y<0){f=-y;h=0}var i=this.renderSettings.copyCanvas;if(i){if(i.width<c||i.height<d){i.width=c;i.height=d}var j=i.getContext('2d');j.clearRect(0,0,c,d);j.drawImage(b,e,f,c,d,0,0,c,d);a.clearRect(g,h,c,d);a.drawImage(i,0,0,c,d,g,h,c,d)}else{a.save();a.globalCompositeOperation='copy';a.drawImage(b,e,f,c,d,g,h,c,d);a.restore()}};N.TilemapLayer.prototype.renderRegion=function(a,b,c,d,e,f){var g=this.context;var h=this.layer.width;var i=this.layer.height;var j=this._mc.tileWidth;var k=this._mc.tileHeight;var l=this._mc.tilesets;var m=NaN;if(!this._wrap){if(c<=e){c=Math.max(0,c);e=Math.min(h-1,e)}if(d<=f){d=Math.max(0,d);f=Math.min(i-1,f)}}var n=(c*j)-a;var o=(d*k)-b;var p=(c+((1<<20)*h))%h;var q=(d+((1<<20)*i))%i;var r,ty,x,y,xmax,ymax;for(y=q,ymax=f-d,ty=o;ymax>=0;y++,ymax--,ty+=k){if(y>=i){y-=i}var s=this.layer.data[y];for(x=p,xmax=e-c,r=n;xmax>=0;x++,xmax--,r+=j){if(x>=h){x-=h}var t=s[x];if(!t||t.index<0){continue}var u=t.index;var v=l[u];if(v===undefined){v=this.resolveTileset(u)}if(t.alpha!==m&&!this.debug){g.globalAlpha=t.alpha;m=t.alpha}if(v){if(t.rotation||t.flipped){g.save();g.translate(r+t.centerX,ty+t.centerY);g.rotate(t.rotation);if(t.flipped){g.scale(-1,1)}v.draw(g,-t.centerX,-t.centerY,u);g.restore()}else{v.draw(g,r,ty,u)}}else if(this.debugSettings.missingImageFill){g.fillStyle=this.debugSettings.missingImageFill;g.fillRect(r,ty,j,k)}if(t.debug&&this.debugSettings.debuggedTileOverfill){g.fillStyle=this.debugSettings.debuggedTileOverfill;g.fillRect(r,ty,j,k)}}}};N.TilemapLayer.prototype.renderDeltaScroll=function(a,b){var c=this._mc.scrollX;var d=this._mc.scrollY;var e=this.canvas.width;var f=this.canvas.height;var g=this._mc.tileWidth;var h=this._mc.tileHeight;var i=0;var j=-g;var k=0;var l=-h;if(a<0){i=e+a;j=e-1}else if(a>0){j=a}if(b<0){k=f+b;l=f-1}else if(b>0){l=b}this.shiftCanvas(this.context,a,b);i=Math.floor((i+c)/g);j=Math.floor((j+c)/g);k=Math.floor((k+d)/h);l=Math.floor((l+d)/h);if(i<=j){this.context.clearRect(((i*g)-c),0,(j-i+1)*g,f);var m=Math.floor((0+d)/h);var n=Math.floor((f-1+d)/h);this.renderRegion(c,d,i,m,j,n)}if(k<=l){this.context.clearRect(0,((k*h)-d),e,(l-k+1)*h);var o=Math.floor((0+c)/g);var p=Math.floor((e-1+c)/g);this.renderRegion(c,d,o,k,p,l)}};N.TilemapLayer.prototype.renderFull=function(){var a=this._mc.scrollX;var b=this._mc.scrollY;var c=this.canvas.width;var d=this.canvas.height;var e=this._mc.tileWidth;var f=this._mc.tileHeight;var g=Math.floor(a/e);var h=Math.floor((c-1+a)/e);var i=Math.floor(b/f);var j=Math.floor((d-1+b)/f);this.context.clearRect(0,0,c,d);this.renderRegion(a,b,g,i,h,j)};N.TilemapLayer.prototype.render=function(){var a=false;if(!this.visible){return}if(this.dirty||this.layer.dirty){this.layer.dirty=false;a=true}var b=this.canvas.width;var c=this.canvas.height;var d=this._scrollX|0;var e=this._scrollY|0;var f=this._mc;var g=f.scrollX-d;var h=f.scrollY-e;if(!a&&g===0&&h===0&&f.renderWidth===b&&f.renderHeight===c){return}this.context.save();f.scrollX=d;f.scrollY=e;if(f.renderWidth!==b||f.renderHeight!==c){f.renderWidth=b;f.renderHeight=c}if(this.debug){this.context.globalAlpha=this.debugSettings.debugAlpha;if(this.debugSettings.forceFullRedraw){a=true}}if(!a&&this.renderSettings.enableScrollDelta&&(Math.abs(g)+Math.abs(h))<Math.min(b,c)){this.renderDeltaScroll(g,h)}else{this.renderFull()}if(this.debug){this.context.globalAlpha=1;this.renderDebug()}this.texture.baseTexture.dirty();this.dirty=false;this.context.restore();return true};N.TilemapLayer.prototype.renderDebug=function(){var a=this._mc.scrollX;var b=this._mc.scrollY;var c=this.context;var d=this.canvas.width;var e=this.canvas.height;var f=this.layer.width;var g=this.layer.height;var h=this._mc.tileWidth;var i=this._mc.tileHeight;var j=Math.floor(a/h);var k=Math.floor((d-1+a)/h);var l=Math.floor(b/i);var m=Math.floor((e-1+b)/i);var n=(j*h)-a;var o=(l*i)-b;var p=(j+((1<<20)*f))%f;var q=(l+((1<<20)*g))%g;var r,ty,x,y,xmax,ymax;c.strokeStyle=this.debugSettings.facingEdgeStroke;for(y=q,ymax=m-l,ty=o;ymax>=0;y++,ymax--,ty+=i){if(y>=g){y-=g}var s=this.layer.data[y];for(x=p,xmax=k-j,r=n;xmax>=0;x++,xmax--,r+=h){if(x>=f){x-=f}var t=s[x];if(!t||t.index<0||!t.collides){continue}if(this.debugSettings.collidingTileOverfill){c.fillStyle=this.debugSettings.collidingTileOverfill;c.fillRect(r,ty,this._mc.cw,this._mc.ch)}if(this.debugSettings.facingEdgeStroke){c.beginPath();if(t.faceTop){c.moveTo(r,ty);c.lineTo(r+this._mc.cw,ty)}if(t.faceBottom){c.moveTo(r,ty+this._mc.ch);c.lineTo(r+this._mc.cw,ty+this._mc.ch)}if(t.faceLeft){c.moveTo(r,ty);c.lineTo(r,ty+this._mc.ch)}if(t.faceRight){c.moveTo(r+this._mc.cw,ty);c.lineTo(r+this._mc.cw,ty+this._mc.ch)}c.closePath();c.stroke()}}}};Object.defineProperty(N.TilemapLayer.prototype,'wrap',{get:function(){return this._wrap},set:function(a){this._wrap=a;this.dirty=true}});Object.defineProperty(N.TilemapLayer.prototype,'scrollX',{get:function(){return this._scrollX},set:function(a){this._scrollX=a}});Object.defineProperty(N.TilemapLayer.prototype,'scrollY',{get:function(){return this._scrollY},set:function(a){this._scrollY=a}});Object.defineProperty(N.TilemapLayer.prototype,'collisionWidth',{get:function(){return this._mc.cw},set:function(a){this._mc.cw=a|0;this.dirty=true}});Object.defineProperty(N.TilemapLayer.prototype,'collisionHeight',{get:function(){return this._mc.ch},set:function(a){this._mc.ch=a|0;this.dirty=true}});N.TilemapParser={INSERT_NULL:false,parse:function(a,b,c,d,e,f){if(c===undefined){c=32}if(d===undefined){d=32}if(e===undefined){e=10}if(f===undefined){f=10}if(b===undefined){return this.getEmptyData()}if(b===null){return this.getEmptyData(c,d,e,f)}var g=a.cache.getTilemapData(b);if(g){if(g.format===N.Tilemap.CSV){return this.parseCSV(b,g.data,c,d)}else if(!g.format||g.format===N.Tilemap.TILED_JSON){return this.parseTiledJSON(g.data)}}else{console.warn('No map data found for key "%s"',b)}},parseCSV:function(a,b,c,d){var e=this.getEmptyData();b=b.trim();var f=[];var g=b.split('\n');var h=g.length;var i=0;for(var y=0;y<g.length;y++){f[y]=[];var j=g[y].split(',');for(var x=0;x<j.length;x++){f[y][x]=new N.Tile(e.layers[0],parseInt(j[x],10),x,y,c,d)}if(i===0){i=j.length}}e.format=N.Tilemap.CSV;e.name=a;e.width=i;e.height=h;e.tileWidth=c;e.tileHeight=d;e.widthInPixels=i*c;e.heightInPixels=h*d;e.layers[0].width=i;e.layers[0].height=h;e.layers[0].widthInPixels=e.widthInPixels;e.layers[0].heightInPixels=e.heightInPixels;e.layers[0].data=f;return e},getEmptyData:function(a,b,c,d){return{width:(c!==undefined&&c!==null)?c:0,height:(d!==undefined&&d!==null)?d:0,tileWidth:(a!==undefined&&a!==null)?a:0,tileHeight:(b!==undefined&&b!==null)?b:0,orientation:'orthogonal',version:'1',properties:{},widthInPixels:0,heightInPixels:0,layers:[{name:'layer',x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}],images:[],objects:{},collision:{},tilesets:[],tiles:[]}},getEmptyObject:function(){return{id:undefined,x:undefined,y:undefined,width:undefined,height:undefined,rotation:undefined,visible:undefined,name:undefined,type:undefined,ellipse:false,gid:null,point:false,polygon:null,polyline:null,properties:null,rectangle:false,template:null,text:null}},createObject:function(a){var b=Object.assign(this.getEmptyObject(),a);b.rectangle=!b.ellipse&&!b.gid&&!b.point&&!b.polygon&&!b.polyline&&!b.template&&!b.text;var c=b.properties;if(c&&Array.isArray(c)){var d={};for(var i=0,len=c.length;i<len;i++){var e=c[i];d[e.name]=e.value}b.properties=d}return b},parseObjectGroup:function(a,b,c,d,e,f){var d=d||a.name;var e=e||{x:0,y:0};if(!d){console.warn('No name found for objectGroup',a)}if(e.x===undefined||e.y===undefined){console.warn('Malformed xy properties in relativePosition',e)}b[d]=b[d]||[];c[d]=c[d]||[];for(var v=0,len=a.objects.length;v<len;v++){var o=a.objects[v];var g=this.createObject(o);g.x+=e.x;g.y+=e.y;b[d].push(g);if(g.id){f[g.id]=g}if(o.polyline){g.polyline=[];for(var p=0;p<o.polyline.length;p++){g.polyline.push([o.polyline[p].x,o.polyline[p].y])}c[d].push(g)}else if(o.polygon){g.polygon=[];for(var p=0;p<o.polygon.length;p++){g.polygon.push([o.polygon[p].x,o.polygon[p].y])}c[d].push(g)}else if(o.ellipse||o.rectangle){c[d].push(g)}}return{objectsCollection:b,collisionCollection:c}},parseTiledJSON:function(a){if(a.orientation!=='orthogonal'){console.warn('Phaser CE supports only orthogonal maps. This map\'s orientation is "%s".',a.orientation);return null}var b={width:a.width,height:a.height,tileWidth:a.tilewidth,tileHeight:a.tileheight,orientation:a.orientation,format:N.Tilemap.TILED_JSON,version:a.version,properties:a.properties,widthInPixels:a.width*a.tilewidth,heightInPixels:a.height*a.tileheight};var c=[];for(var i=0;i<a.layers.length;i++){if(a.layers[i].type!=='tilelayer'){continue}var d=a.layers[i];if(!d.compression&&d.encoding&&d.encoding==='base64'){var e=window.atob(d.data);var f=e.length;var g=new Array(f);for(var j=0;j<f;j+=4){g[j/4]=(e.charCodeAt(j)|e.charCodeAt(j+1)<<8|e.charCodeAt(j+2)<<16|e.charCodeAt(j+3)<<24)>>>0}d.data=g;delete d.encoding}else if(d.compression){console.warn('Layer compression is unsupported, skipping layer "%s".',d.name);continue}var h={name:d.name,x:d.x,y:d.y,width:d.width,height:d.height,widthInPixels:d.width*a.tilewidth,heightInPixels:d.height*a.tileheight,alpha:d.opacity,offsetX:d.offsetx,offsetY:d.offsety,visible:d.visible,properties:{},indexes:[],callbacks:[],bodies:[]};if(d.properties){h.properties=d.properties}var x=0;var l=[];var m=[];var n,flipped,flippedVal,D;for(var t=0,f=d.data.length;t<f;t++){n=0;flipped=false;D=d.data[t];flippedVal=0;if(D>0x20000000){if(D>0x80000000){D-=0x80000000;flippedVal+=4}if(D>0x40000000){D-=0x40000000;flippedVal+=2}if(D>0x20000000){D-=0x20000000;flippedVal+=1}switch(flippedVal){case 5:n=Math.PI/2;break;case 6:n=Math.PI;break;case 3:n=3*Math.PI/2;break;case 4:n=0;flipped=true;break;case 7:n=Math.PI/2;flipped=true;break;case 2:n=Math.PI;flipped=true;break;case 1:n=3*Math.PI/2;flipped=true;break}}if(D>0){var o=new N.Tile(h,D,x,m.length,a.tilewidth,a.tileheight);o.rotation=n;o.flipped=flipped;if(flippedVal!==0){o.flippedVal=flippedVal}l.push(o)}else if(N.TilemapParser.INSERT_NULL){l.push(null)}else{l.push(new N.Tile(h,-1,x,m.length,a.tilewidth,a.tileheight))}x++;if(x===d.width){m.push(l);x=0;l=[]}}h.data=m;c.push(h)}b.layers=c;var p=[];for(var i=0;i<a.layers.length;i++){if(a.layers[i].type!=='imagelayer'){continue}var q=a.layers[i];var r={name:q.name,image:q.image,x:q.x,y:q.y,alpha:q.opacity,visible:q.visible,properties:{}};if(q.properties){r.properties=q.properties}p.push(r)}b.images=p;var s=[];var u={};var v=[];var w=null;for(var i=0;i<a.tilesets.length;i++){var z=a.tilesets[i];if(z.source){console.warn('Phaser CE can\'t load external tilesets (%s). Embed the tileset and then export the map again. https://github.com/photonstorm/phaser-ce/issues/273',z.source)}else if(z.image){var A=new N.Tileset(z.name,z.firstgid,z.tilewidth,z.tileheight,z.margin,z.spacing,z.properties);if(z.tileproperties){A.tileProperties=z.tileproperties}A.updateTileData(z.imagewidth,z.imageheight);s.push(A)}else if(z.tiles){var B=new N.ImageCollection(z.name,z.firstgid,z.tilewidth,z.tileheight,z.margin,z.spacing,z.properties);for(var C in z.tiles){var r=z.tiles[C].image;var D=z.firstgid+parseInt(C,10);B.addImage(D,r)}v.push(B)}else{throw new Error('Tileset '+z.name+' has no `image` or `tiles` property.');}for(var C in z.tiles){var E=z.tiles[C].objectgroup;if(!E){continue}u[parseInt(C,10)+z.firstgid]=E}if(w){w.lastgid=z.firstgid-1}w=z}if(s.length===0&&v.length===0){throw new Error('This tilemap has no tilesets.');}b.tilesets=s;b.imagecollections=v;var F={};var G={};var H={};for(var i=0;i<a.layers.length;i++){if(a.layers[i].type!=='objectgroup'){continue}var E=a.layers[i];this.parseObjectGroup(E,F,G,undefined,undefined,H)}b.objects=F;b.collision=G;b.objectsMap=H;b.tiles=[];for(var i=0;i<b.tilesets.length;i++){var z=b.tilesets[i];var x=z.tileMargin;var y=z.tileMargin;var I=0;var J=0;var K=0;for(var t=z.firstgid;t<z.firstgid+z.total;t++){b.tiles[t]=[x,y,i];x+=z.tileWidth+z.tileSpacing;I++;if(I===z.total){break}J++;if(J===z.columns){x=z.tileMargin;y+=z.tileHeight+z.tileSpacing;J=0;K++;if(K===z.rows){break}}}}var h;var o;var L;var z;for(var i=0;i<b.layers.length;i++){h=b.layers[i];G[h.name]=[];z=null;for(var j=0;j<h.data.length;j++){l=h.data[j];for(var k=0;k<l.length;k++){o=l[k];if(o===null||o.index<0){continue}L=b.tiles[o.index][2];z=b.tilesets[L];if(z.tileProperties&&z.tileProperties[o.index-z.firstgid]){o.properties=N.Utils.mixin(z.tileProperties[o.index-z.firstgid],o.properties)}var E=u[o.index];if(E){this.parseObjectGroup(E,b.objects,b.collision,o.layer.name,{x:o.worldX+E.x,y:o.worldY+E.y},H)}}}}return b}};N.Tileset=function(a,b,c,d,e,f,g){if(c===undefined||c<=0){c=32}if(d===undefined||d<=0){d=32}if(e===undefined){e=0}if(f===undefined){f=0}this.name=a;this.firstgid=b|0;this.tileWidth=c|0;this.tileHeight=d|0;this.tileMargin=e|0;this.tileSpacing=f|0;this.properties=g||{};this.image=null;this.rows=0;this.columns=0;this.total=0;this.drawCoords=[]};N.Tileset.prototype={draw:function(a,x,y,b){var c=(b-this.firstgid)<<1;if(c>=0&&(c+1)<this.drawCoords.length){a.drawImage(this.image,this.drawCoords[c],this.drawCoords[c+1],this.tileWidth,this.tileHeight,x,y,this.tileWidth,this.tileHeight)}},containsTileIndex:function(a){return(a>=this.firstgid&&a<(this.firstgid+this.total))},setImage:function(a){this.image=a;this.updateTileData(a.width,a.height)},setSpacing:function(a,b){this.tileMargin=a|0;this.tileSpacing=b|0;if(this.image){this.updateTileData(this.image.width,this.image.height)}},updateTileData:function(a,b){var c=(b-this.tileMargin*2+this.tileSpacing)/(this.tileHeight+this.tileSpacing);var d=(a-this.tileMargin*2+this.tileSpacing)/(this.tileWidth+this.tileSpacing);if(c%1!==0||d%1!==0){console.warn('Phaser.Tileset - \'%s\' image tile area (%s x %s) is not a whole multiple of tile size (%s x %s + %s + %s)',this.name,a,b,this.tileWidth,this.tileHeight,this.tileMargin,this.tileSpacing)}c=Math.floor(c);d=Math.floor(d);if((this.rows&&this.rows!==c)||(this.columns&&this.columns!==d)){console.warn('Phaser.Tileset - Tile layout from image \'%s\' (%s rows by %s columns) differs from tileset \'%s\' (%s rows by %s columns)',this.image.name,d,c,this.name,this.columns,this.rows)}this.rows=c;this.columns=d;this.total=c*d;this.drawCoords.length=0;var e=this.tileMargin;var f=this.tileMargin;for(var y=0;y<this.rows;y++){for(var x=0;x<this.columns;x++){this.drawCoords.push(e);this.drawCoords.push(f);e+=this.tileWidth+this.tileSpacing}e=this.tileMargin;f+=this.tileHeight+this.tileSpacing}}};N.Tileset.prototype.constructor=N.Tileset;N.Particle=function(a,x,y,b,c){N.Sprite.call(this,a,x,y,b,c);this.autoScale=false;this.autoScaleFps=0;this.scaleData=null;this._s=0;this.autoAlpha=false;this.autoAlphaFps=0;this.alphaData=null;this._a=0};N.Particle.prototype=Object.create(N.Sprite.prototype);N.Particle.prototype.constructor=N.Particle;N.Particle.prototype.update=function(){if(this.autoScale){this._s-=this.game.time.delta*0.001*this.autoScaleFps;var s=Math.round(this._s);if(s>0){this.scale.set(this.scaleData[s].x,this.scaleData[s].y)}else{this.autoScale=false}}if(this.autoAlpha){this._a-=this.game.time.delta*0.001*this.autoAlphaFps;var a=Math.round(this._a);if(a>0){this.alpha=this.alphaData[a].v}else{this.autoAlpha=false}}};N.Particle.prototype.onEmit=function(){};N.Particle.prototype.setAlphaData=function(a,b){this.alphaData=a;this._a=a.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=true;this.autoAlphaFps=b};N.Particle.prototype.setScaleData=function(a,b){this.scaleData=a;this._s=a.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=true;this.autoScaleFps=b};N.Particle.prototype.reset=function(x,y,a){N.Component.Reset.prototype.reset.call(this,x,y,a);this.alpha=1;this.scale.set(1);this.autoScale=false;this.autoAlpha=false;return this};N.Particles=function(a){this.game=a;this.emitters={};this.ID=0};N.Particles.prototype={add:function(a){this.emitters[a.id]=a;return a},remove:function(a){delete this.emitters[a.id]}};N.Particles.prototype.constructor=N.Particles;N.Particles.Arcade={};N.Particles.Arcade.Emitter=function(a,x,y,b){this.maxParticles=b||50;N.Group.call(this,a);this._id=this.game.particles.ID++;this.name='emitter'+this.id;this.type=N.EMITTER;this.physicsType=N.GROUP;this.area=new N.Rectangle(x,y,1,1);this.minAngle=null;this.maxAngle=null;this.minSpeed=0;this.maxSpeed=100;this.minParticleSpeed=new N.Point(-100,-100);this.maxParticleSpeed=new N.Point(100,100);this.minParticleScale=1;this.maxParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=360;this.minParticleAlpha=1;this.maxParticleAlpha=1;this.alphaData=null;this.particleClass=N.Particle;this.particleDrag=new N.Point();this.angularDrag=0;this.frequency=100;this.lifespan=2000;this.bounce=new N.Point();this.on=false;this.particleAnchor=new N.Point(0.5,0.5);this.blendMode=N.blendModes.NORMAL;this.emitX=x;this.emitY=y;this.autoScale=false;this.autoScaleFps=this.game.time.desiredFps;this.autoAlpha=false;this.autoAlphaFps=this.game.time.desiredFps;this.particleBringToTop=false;this.particleSendToBack=false;this.counts={emitted:0,failed:0,totalEmitted:0,totalFailed:0};this._gravity=new N.Point(0,100);this._minParticleScale=new N.Point(1,1);this._maxParticleScale=new N.Point(1,1);this._total=0;this._timer=0;this._counter=0;this._flowQuantity=0;this._flowTotal=0;this._explode=true;this._frames=null};N.Particles.Arcade.Emitter.prototype=Object.create(N.Group.prototype);N.Particles.Arcade.Emitter.prototype.constructor=N.Particles.Arcade.Emitter;N.Particles.Arcade.Emitter.prototype.update=function(){this.counts.emitted=0;this.counts.failed=0;if(this.on&&this.game.time.deltaTotal>=this._timer){this._timer=this.game.time.deltaTotal+this.frequency;if(this._flowTotal!==0){if(this._flowQuantity>0){for(var i=0;i<this._flowQuantity;i++){if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=false;break}}}}else if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=false}}}else if(this.emitParticle()){this._counter++;if(this._total>0&&this._counter>=this._total){this.on=false}}}var i=this.children.length;while(i--){if(this.children[i].exists){this.children[i].update()}}};N.Particles.Arcade.Emitter.prototype.makeParticles=function(a,b,c,d,e,f){if(b===undefined){b=0}if(c===undefined){c=this.maxParticles}if(d===undefined){d=false}if(e===undefined){e=false}if(f===undefined){f=null}var g;var i=0;var h=a;var j=b;this._frames=b;if(c>this.maxParticles){this.maxParticles=c}while(i<c){if(Array.isArray(a)){h=this.game.rnd.pick(a)}if(Array.isArray(b)){j=this.game.rnd.pick(b)}g=new this.particleClass(this.game,0,0,h,j,f);this.game.physics.arcade.enable(g,false);g.body.checkCollision.none=!d;g.body.collideWorldBounds=e;g.body.skipQuadTree=true;g.exists=false;g.visible=false;g.anchor.copyFrom(this.particleAnchor);this.add(g);i++}return this};N.Particles.Arcade.Emitter.prototype.kill=function(){this.on=false;this.alive=false;this.exists=false;return this};N.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=true;this.exists=true;return this};N.Particles.Arcade.Emitter.prototype.explode=function(a,b){if(b===undefined){b=this.maxParticles}this._flowTotal=0;this.start(true,a,0,b,false);return this};N.Particles.Arcade.Emitter.prototype.flow=function(a,b,c,d,e){if(b===undefined||b===null){b=250}if(c===undefined||c===0){c=1}if(d===undefined){d=-1}if(e===undefined){e=true}if(c>this.maxParticles){c=this.maxParticles}this._counter=0;this._flowQuantity=c;this._flowTotal=d;if(e){this.start(true,a,b,c);this._counter+=c;this.on=true;this._timer=this.game.time.deltaTotal+b}else{this.start(false,a,b,c)}return this};N.Particles.Arcade.Emitter.prototype.start=function(a,b,c,d,e){if(a===undefined){a=true}if(b===undefined){b=0}if(c===undefined||c===null){c=250}if(d===undefined){d=0}if(e===undefined){e=false}if(d>this.maxParticles){d=this.maxParticles}this.revive();this.visible=true;this.lifespan=b;this.frequency=c;if(a||e){for(var i=0;i<d;i++){this.emitParticle()}}else{this.on=true;this._total=d;this._counter=0;this._timer=this.game.time.deltaTotal+c}return this};N.Particles.Arcade.Emitter.prototype.emitParticle=function(x,y,a,b){if(x===undefined){x=null}if(y===undefined){y=null}var c=this.getNextParticle();if(c===null){this.counts.failed++;this.counts.totalFailed++;return false}this.counts.emitted++;this.counts.totalEmitted++;var d=this.game.rnd;if(a!==undefined&&b!==undefined){c.loadTexture(a,b)}else if(a!==undefined){c.loadTexture(a);c.frame=Array.isArray(this._frames)?d.pick(this._frames):this._frames}var e=this.emitX;var f=this.emitY;if(x!==null){e=x}else if(this.width>1){e=d.between(this.left,this.right)}if(y!==null){f=y}else if(this.height>1){f=d.between(this.top,this.bottom)}this.resetParticle(c,e,f);return true};N.Particles.Arcade.Emitter.prototype.getNextParticle=function(){var i=this.length;while(i--){var a=this.next();if(!a.exists){return a}}return null};N.Particles.Arcade.Emitter.prototype.resetParticle=function(a,x,y){var b=this.game.rnd;a.reset(x,y);a.angle=0;a.lifespan=this.lifespan;if(this.particleBringToTop){this.bringToTop(a)}else if(this.particleSendToBack){this.sendToBack(a)}if(this.autoScale){a.setScaleData(this.scaleData,this.autoScaleFps)}else if(this.minParticleScale!==1||this.maxParticleScale!==1){a.scale.set(b.realInRange(this.minParticleScale,this.maxParticleScale))}else if((this._minParticleScale.x!==this._maxParticleScale.x)||(this._minParticleScale.y!==this._maxParticleScale.y)){a.scale.set(b.realInRange(this._minParticleScale.x,this._maxParticleScale.x),b.realInRange(this._minParticleScale.y,this._maxParticleScale.y))}else{a.scale.set(this._minParticleScale.x,this._minParticleScale.y)}if(this.autoAlpha){a.setAlphaData(this.alphaData,this.autoAlphaFps)}else{a.alpha=b.realInRange(this.minParticleAlpha,this.maxParticleAlpha)}a.blendMode=this.blendMode;var c=a.body;c.updateBounds();c.bounce.copyFrom(this.bounce);c.drag.copyFrom(this.particleDrag);if(this.minAngle!=null&&this.maxAngle!=null){this.game.physics.arcade.velocityFromAngle((this.minAngle===this.maxAngle)?this.minAngle:b.between(this.minAngle,this.maxAngle),(this.minSpeed===this.maxSpeed)?this.minSpeed:b.between(this.minSpeed,this.maxSpeed),c.velocity)}else{c.velocity.x=b.between(this.minParticleSpeed.x,this.maxParticleSpeed.x);c.velocity.y=b.between(this.minParticleSpeed.y,this.maxParticleSpeed.y)}c.angularVelocity=b.between(this.minRotation,this.maxRotation);c.gravity.copyFrom(this.gravity);c.angularDrag=this.angularDrag;a.onEmit()};N.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this);N.Group.prototype.destroy.call(this,true,false)};N.Particles.Arcade.Emitter.prototype.setSize=function(a,b){this.area.width=a;this.area.height=b;return this};N.Particles.Arcade.Emitter.prototype.setSpeed=function(a,b,c,d){this.setXSpeed(a,b);this.setYSpeed(c,d);return this};N.Particles.Arcade.Emitter.prototype.setXSpeed=function(a,b){a=a||0;b=b||0;this.minParticleSpeed.x=a;this.maxParticleSpeed.x=b;return this};N.Particles.Arcade.Emitter.prototype.setYSpeed=function(a,b){a=a||0;b=b||0;this.minParticleSpeed.y=a;this.maxParticleSpeed.y=b;return this};N.Particles.Arcade.Emitter.prototype.setRotation=function(a,b){a=a||0;b=b||0;this.minRotation=a;this.maxRotation=b;return this};N.Particles.Arcade.Emitter.prototype.setAlpha=function(a,b,c,d,e){if(a===undefined){a=1}if(b===undefined){b=1}if(c===undefined){c=0}if(d===undefined){d=N.Easing.Linear.None}if(e===undefined){e=false}this.minParticleAlpha=a;this.maxParticleAlpha=b;this.autoAlpha=false;if(c>0&&a!==b){var f={v:a};var g=this.game.make.tween(f).to({v:b},c,d);g.yoyo(e);this.alphaData=g.generateData(this.game.time.desiredFps);this.autoAlphaFps=this.game.time.desiredFps;this.alphaData.reverse();this.autoAlpha=true}return this};N.Particles.Arcade.Emitter.prototype.setScale=function(a,b,c,d,e,f,g){if(a===undefined){a=1}if(b===undefined){b=1}if(c===undefined){c=1}if(d===undefined){d=1}if(e===undefined){e=0}if(f===undefined){f=N.Easing.Linear.None}if(g===undefined){g=false}this.minParticleScale=1;this.maxParticleScale=1;this._minParticleScale.set(a,c);this._maxParticleScale.set(b,d);this.autoScale=false;if(e>0&&((a!==b)||(c!==d))){var h={x:a,y:c};var i=this.game.make.tween(h).to({x:b,y:d},e,f);i.yoyo(g);this.scaleData=i.generateData(this.game.time.desiredFps);this.autoScaleFps=this.game.time.desiredFps;this.scaleData.reverse();this.autoScale=true}return this};N.Particles.Arcade.Emitter.prototype.setAngle=function(a,b,c,d){this.minAngle=a;this.maxAngle=b;if(c!=null){this.minSpeed=c}if(d!=null){this.maxSpeed=d}return this};N.Particles.Arcade.Emitter.prototype.setGravity=function(x,y){x=x||0;y=y||0;this._gravity.set(x,y);return this};N.Particles.Arcade.Emitter.prototype.at=function(a){if(a.center){this.emitX=a.center.x;this.emitY=a.center.y}else{this.emitX=a.world.x+(a.anchor.x*a.width);this.emitY=a.world.y+(a.anchor.y*a.height)}return this};Object.defineProperty(N.Particles.Arcade.Emitter.prototype,'gravity',{get:function(){return this._gravity},set:function(a){if(typeof a==='number'){this._gravity.y=a}else{this._gravity=a}}});Object.defineProperty(N.Particles.Arcade.Emitter.prototype,'id',{get:function(){return this._id}});Object.defineProperty(N.Particles.Arcade.Emitter.prototype,'width',{get:function(){return this.area.width},set:function(a){this.area.width=a}});Object.defineProperty(N.Particles.Arcade.Emitter.prototype,'height',{get:function(){return this.area.height},set:function(a){this.area.height=a}});Object.defineProperty(N.Particles.Arcade.Emitter.prototype,'x',{get:function(){return this.emitX},set:function(a){this.emitX=a}});Object.defineProperty(N.Particles.Arcade.Emitter.prototype,'y',{get:function(){return this.emitY},set:function(a){this.emitY=a}});Object.defineProperty(N.Particles.Arcade.Emitter.prototype,'left',{get:function(){return Math.floor(this.x-(this.area.width/2))}});Object.defineProperty(N.Particles.Arcade.Emitter.prototype,'right',{get:function(){return Math.floor(this.x+(this.area.width/2))}});Object.defineProperty(N.Particles.Arcade.Emitter.prototype,'top',{get:function(){return Math.floor(this.y-(this.area.height/2))}});Object.defineProperty(N.Particles.Arcade.Emitter.prototype,'bottom',{get:function(){return Math.floor(this.y+(this.area.height/2))}});Object.defineProperty(N.Particles.Arcade.Emitter.prototype,'output',{get:function(){return 1000*this._flowQuantity/this.frequency}});Object.defineProperty(N.Particles.Arcade.Emitter.prototype,'lifespanOutput',{get:function(){return(this.lifespan===0?Infinity:this.lifespan)*this._flowQuantity/this.frequency}});Object.defineProperty(N.Particles.Arcade.Emitter.prototype,'remainder',{get:function(){return this.maxParticles-this.lifespanOutput}});N.Weapon=function(a,b){N.Plugin.call(this,a,b);this.bullets=null;this.autoExpandBulletsGroup=false;this.autofire=false;this.shots=0;this.fireLimit=0;this.fireRate=100;this.fireRateVariance=0;this.fireFrom=new N.Rectangle(0,0,1,1);this.fireAngle=N.ANGLE_UP;this.bulletInheritSpriteSpeed=false;this.bulletAnimation='';this.bulletFrameRandom=false;this.bulletFrameCycle=false;this.bulletWorldWrap=false;this.bulletWorldWrapPadding=0;this.bulletAngleOffset=0;this.bulletAngleVariance=0;this.bulletSpeed=200;this.bulletSpeedVariance=0;this.bulletLifespan=0;this.bulletKillDistance=0;this.bulletGravity=new N.Point(0,0);this.bulletRotateToVelocity=false;this.bulletKey='';this.bulletFrame='';this._bulletClass=N.Bullet;this._bulletCollideWorldBounds=false;this._bulletKillType=N.Weapon.KILL_WORLD_BOUNDS;this._data={customBody:false,width:0,height:0,offsetX:0,offsetY:0};this.bounds=new N.Rectangle();this.bulletBounds=a.world.bounds;this.bulletFrames=[];this.bulletFrameIndex=0;this.anims={};this.onFire=new N.Signal();this.onKill=new N.Signal();this.onFireLimit=new N.Signal();this.trackedSprite=null;this.trackedPointer=null;this.multiFire=false;this._hasFired=false;this.trackRotation=false;this.trackOffset=new N.Point();this._nextFire=0;this._tempNextFire=0;this._rotatedPoint=new N.Point()};N.Weapon.prototype=Object.create(N.Plugin.prototype);N.Weapon.prototype.constructor=N.Weapon;N.Weapon.KILL_NEVER=0;N.Weapon.KILL_LIFESPAN=1;N.Weapon.KILL_DISTANCE=2;N.Weapon.KILL_WEAPON_BOUNDS=3;N.Weapon.KILL_CAMERA_BOUNDS=4;N.Weapon.KILL_WORLD_BOUNDS=5;N.Weapon.KILL_STATIC_BOUNDS=6;N.Weapon.prototype.createBullets=function(a,b,c,d){if(a===undefined){a=1}if(d===undefined){d=this.game.world}if(this.bullets&&!this.bullets.game){this.bullets=null}if(!this.bullets){this.bullets=this.game.add.physicsGroup(N.Physics.ARCADE,d);this.bullets.classType=this._bulletClass}if(a!==0){if(a===-1){this.autoExpandBulletsGroup=true;a=1}this.bullets.createMultiple(a,b,c);this.bullets.setAll('data.bulletManager',this);this.bulletKey=b;this.bulletFrame=c}return this};N.Weapon.prototype.forEach=function(a,b){this.bullets.forEachExists(a,b,arguments);return this};N.Weapon.prototype.pauseAll=function(){this.bullets.setAll('body.enable',false);return this};N.Weapon.prototype.resumeAll=function(){this.bullets.setAll('body.enable',true);return this};N.Weapon.prototype.killAll=function(){this.bullets.callAllExists('kill',true);this.bullets.setAll('body.enable',true);return this};N.Weapon.prototype.resetShots=function(a){this.shots=0;if(a!==undefined){this.fireLimit=a}return this};N.Weapon.prototype.destroy=function(){this.parent.remove(this,false);this.bullets.destroy();this.game=null;this.parent=null;this.active=false;this.visible=false};N.Weapon.prototype.update=function(){if(this._bulletKillType===N.Weapon.KILL_WEAPON_BOUNDS){if(this.trackedSprite){this.trackedSprite.updateTransform();this.bounds.centerOn(this.trackedSprite.worldPosition.x,this.trackedSprite.worldPosition.y)}else if(this.trackedPointer){this.bounds.centerOn(this.trackedPointer.worldX,this.trackedPointer.worldY)}}if(this.autofire){this.fire()}};N.Weapon.prototype.postRender=function(){if(!this.multiFire||!this._hasFired){return}this._hasFired=false;this._nextFire=this._tempNextFire};N.Weapon.prototype.trackSprite=function(a,b,c,d){if(b===undefined){b=0}if(c===undefined){c=0}if(d===undefined){d=false}this.trackedPointer=null;this.trackedSprite=a;this.trackRotation=d;this.trackOffset.set(b,c);return this};N.Weapon.prototype.trackPointer=function(a,b,c){if(a===undefined){a=this.game.input.activePointer}if(b===undefined){b=0}if(c===undefined){c=0}this.trackedPointer=a;this.trackedSprite=null;this.trackRotation=false;this.trackOffset.set(b,c);return this};N.Weapon.prototype.fireMany=function(b,c){this.multiFire=true;var d=[];var e=this;if(c||this.trackedSprite||this.trackedPointer){b.forEach(function(a){d.push(e.fire(c,null,null,a.x,a.y))})}else{b.forEach(function(a){d.push(e.fire(a))})}return d};N.Weapon.prototype.fireOffset=function(a,b){if(a===undefined){a=0}if(b===undefined){b=0}return this.fire(null,null,null,a,b)};N.Weapon.prototype.fire=function(a,x,y,b,c){if(x===undefined){x=null}if(y===undefined){y=null}if(this.game.time.deltaTotal<this._nextFire||(this.fireLimit>0&&this.shots===this.fireLimit)){return null}var d=this.bulletSpeed;if(this.bulletSpeedVariance!==0){d+=N.Math.between(-this.bulletSpeedVariance,this.bulletSpeedVariance)}if(a){if(this.fireFrom.width>1){this.fireFrom.centerOn(a.x,a.y)}else{this.fireFrom.x=a.x;this.fireFrom.y=a.y}}else if(this.trackedSprite){if(this.trackRotation){this._rotatedPoint.set(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y);this._rotatedPoint.rotate(this.trackedSprite.world.x,this.trackedSprite.world.y,this.trackedSprite.worldRotation);if(this.fireFrom.width>1){this.fireFrom.centerOn(this._rotatedPoint.x,this._rotatedPoint.y)}else{this.fireFrom.x=this._rotatedPoint.x;this.fireFrom.y=this._rotatedPoint.y}}else if(this.fireFrom.width>1){this.fireFrom.centerOn(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y)}else{this.fireFrom.x=this.trackedSprite.world.x+this.trackOffset.x;this.fireFrom.y=this.trackedSprite.world.y+this.trackOffset.y}if(this.bulletInheritSpriteSpeed){d+=this.trackedSprite.body.speed}}else if(this.trackedPointer){if(this.fireFrom.width>1){this.fireFrom.centerOn(this.trackedPointer.world.x+this.trackOffset.x,this.trackedPointer.world.y+this.trackOffset.y)}else{this.fireFrom.x=this.trackedPointer.world.x+this.trackOffset.x;this.fireFrom.y=this.trackedPointer.world.y+this.trackOffset.y}}if(b!==undefined){this.fireFrom.x+=b}if(c!==undefined){this.fireFrom.y+=c}var e=(this.fireFrom.width>1)?this.fireFrom.randomX:this.fireFrom.x;var f=(this.fireFrom.height>1)?this.fireFrom.randomY:this.fireFrom.y;var g=(this.trackRotation)?this.trackedSprite.angle:this.fireAngle;if(x!==null&&y!==null){g=this.game.math.radToDeg(Math.atan2(y-f,x-e))}if(this.bulletAngleVariance!==0){g+=N.Math.between(-this.bulletAngleVariance,this.bulletAngleVariance)}var h=0;var i=0;if(g===0||g===180){h=Math.cos(this.game.math.degToRad(g))*d}else if(g===90||g===270){i=Math.sin(this.game.math.degToRad(g))*d}else{h=Math.cos(this.game.math.degToRad(g))*d;i=Math.sin(this.game.math.degToRad(g))*d}var j=null;if(this.autoExpandBulletsGroup){j=this.bullets.getFirstExists(false,true,e,f,this.bulletKey,this.bulletFrame);j.data.bulletManager=this}else{j=this.bullets.getFirstExists(false)}if(j){j.reset(e,f);j.data.fromX=e;j.data.fromY=f;j.data.killType=this.bulletKillType;j.data.killDistance=this.bulletKillDistance;j.data.rotateToVelocity=this.bulletRotateToVelocity;if(this.bulletKillType===N.Weapon.KILL_LIFESPAN){j.lifespan=this.bulletLifespan}j.angle=g+this.bulletAngleOffset;if(this.bulletAnimation!==''){if(j.animations.getAnimation(this.bulletAnimation)===null){var k=this.anims[this.bulletAnimation];j.animations.add(k.name,k.frames,k.frameRate,k.loop,k.useNumericIndex)}j.animations.play(this.bulletAnimation)}else if(this.bulletFrameCycle){j.frame=this.bulletFrames[this.bulletFrameIndex];this.bulletFrameIndex++;if(this.bulletFrameIndex>=this.bulletFrames.length){this.bulletFrameIndex=0}}else if(this.bulletFrameRandom){j.frame=this.bulletFrames[Math.floor(Math.random()*this.bulletFrames.length)]}if(j.data.bodyDirty){if(this._data.customBody){j.body.setSize(this._data.width,this._data.height,this._data.offsetX,this._data.offsetY)}j.body.collideWorldBounds=this.bulletCollideWorldBounds;j.data.bodyDirty=false}j.body.velocity.set(h,i);j.body.gravity.set(this.bulletGravity.x,this.bulletGravity.y);var l=0;if(this.bulletSpeedVariance!==0){var m=this.fireRate;m+=N.Math.between(-this.fireRateVariance,this.fireRateVariance);if(m<0){m=0}l=this.game.time.deltaTotal+m}else{l=this.game.time.deltaTotal+this.fireRate}if(this.multiFire){if(!this._hasFired){this._hasFired=true;this._tempNextFire=l;this.shots++}}else{this._nextFire=l;this.shots++}this.onFire.dispatch(j,this,d);if(this.fireLimit>0&&this.shots===this.fireLimit){this.onFireLimit.dispatch(this,this.fireLimit)}}return j};N.Weapon.prototype.fireAtPointer=function(a){if(a===undefined){a=this.game.input.activePointer}return this.fire(null,a.worldX,a.worldY)};N.Weapon.prototype.fireAtSprite=function(a){return this.fire(null,a.world.x,a.world.y)};N.Weapon.prototype.fireAtXY=function(x,y){return this.fire(null,x,y)};N.Weapon.prototype.setBulletBodyOffset=function(a,b,c,d){if(c===undefined){c=0}if(d===undefined){d=0}this._data.customBody=true;this._data.width=a;this._data.height=b;this._data.offsetX=c;this._data.offsetY=d;this.bullets.callAll('body.setSize','body',a,b,c,d);this.bullets.setAll('data.bodyDirty',false);return this};N.Weapon.prototype.setBulletFrames=function(a,b,c,d){if(c===undefined){c=true}if(d===undefined){d=false}this.bulletFrames=N.ArrayUtils.numberArray(a,b);this.bulletFrameIndex=0;this.bulletFrameCycle=c;this.bulletFrameRandom=d;return this};N.Weapon.prototype.addBulletAnimation=function(a,b,c,d,e){this.anims[a]={name:a,frames:b,frameRate:c,loop:d,useNumericIndex:e};this.bullets.callAll('animations.add','animations',a,b,c,d,e);this.bulletAnimation=a;return this};N.Weapon.prototype.debug=function(x,y,a){if(x===undefined){x=16}if(y===undefined){y=32}if(a===undefined){a=false}this.game.debug.text('Weapon Plugin',x,y);this.game.debug.text('Bullets Alive: '+this.bullets.total+' - Total: '+this.bullets.length,x,y+24);if(a){this.bullets.forEachExists(this.game.debug.body,this.game.debug,'rgba(255, 0, 255, 0.8)')}};Object.defineProperty(N.Weapon.prototype,'bulletClass',{get:function(){return this._bulletClass},set:function(a){this._bulletClass=a;if(this.bullets){this.bullets.classType=this._bulletClass}}});Object.defineProperty(N.Weapon.prototype,'bulletKillType',{get:function(){return this._bulletKillType},set:function(a){switch(a){case N.Weapon.KILL_STATIC_BOUNDS:case N.Weapon.KILL_WEAPON_BOUNDS:this.bulletBounds=this.bounds;break;case N.Weapon.KILL_CAMERA_BOUNDS:this.bulletBounds=this.game.camera.view;break;case N.Weapon.KILL_WORLD_BOUNDS:this.bulletBounds=this.game.world.bounds;break}this._bulletKillType=a}});Object.defineProperty(N.Weapon.prototype,'bulletCollideWorldBounds',{get:function(){return this._bulletCollideWorldBounds},set:function(a){this._bulletCollideWorldBounds=a;this.bullets.setAll('body.collideWorldBounds',a);this.bullets.setAll('data.bodyDirty',false)}});Object.defineProperty(N.Weapon.prototype,'x',{get:function(){return this.fireFrom.x},set:function(a){this.fireFrom.x=a}});Object.defineProperty(N.Weapon.prototype,'y',{get:function(){return this.fireFrom.y},set:function(a){this.fireFrom.y=a}});N.Bullet=function(a,x,y,b,c){N.Sprite.call(this,a,x,y,b,c);this.anchor.set(0.5);this.data={bulletManager:null,fromX:0,fromY:0,bodyDirty:true,rotateToVelocity:false,killType:0,killDistance:0}};N.Bullet.prototype=Object.create(N.Sprite.prototype);N.Bullet.prototype.constructor=N.Bullet;N.Bullet.prototype.kill=function(){this.alive=false;this.exists=false;this.visible=false;this.data.bulletManager.onKill.dispatch(this);return this};N.Bullet.prototype.update=function(){if(!this.exists){return}if(this.data.killType>N.Weapon.KILL_LIFESPAN){if(this.data.killType===N.Weapon.KILL_DISTANCE){if(this.game.physics.arcade.distanceToXY(this,this.data.fromX,this.data.fromY,true)>this.data.killDistance){this.kill()}}else if(!this.data.bulletManager.bulletBounds.intersects(this)){this.kill()}}if(this.data.rotateToVelocity){this.rotation=this.body.velocity.atan()}if(this.data.bulletManager.bulletWorldWrap){this.game.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding)}};N.Video=function(a,b,c){if(b===undefined){b=null}if(c===undefined){c=null}this.game=a;this.key=b;this.width=0;this.height=0;this.type=N.VIDEO;this.disableTextureUpload=false;this.touchLocked=false;this.onPlay=new N.Signal();this.onChangeSource=new N.Signal();this.onComplete=new N.Signal();this.onAccess=new N.Signal();this.onError=new N.Signal();this.onTimeout=new N.Signal();this.onTouchUnlock=new N.Signal();this.playWhenUnlocked=true;this.timeout=15000;this._timeOutID=null;this.video=null;this.videoStream=null;this.isStreaming=false;this.retryLimit=20;this.retry=0;this.retryInterval=500;this._retryID=null;this._codeMuted=false;this._muted=false;this._codePaused=false;this._paused=false;this._pending=false;this._pendingChangeSource=false;this._autoplay=false;this._endCallback=null;this._playCallback=null;if(b&&this.game.cache.checkVideoKey(b)){var d=this.game.cache.getVideo(b);if(d.isBlob){this.createVideoFromBlob(d.data)}else{this.video=d.data}this.width=this.video.videoWidth;this.height=this.video.videoHeight}else if(c){this.createVideoFromURL(c,false)}if(this.video&&!c){this.baseTexture=new PIXI.BaseTexture(this.video,null,this.game.resolution);this.baseTexture.forceLoaded(this.width,this.height)}else{this.baseTexture=new PIXI.BaseTexture(N.Cache.DEFAULT.baseTexture.source,null,this.game.resolution);this.baseTexture.forceLoaded(this.width,this.height)}this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new N.Frame(0,0,0,this.width,this.height,'video');this.texture.setFrame(this.textureFrame);this.texture.valid=false;if(b!==null&&this.video){this.texture.valid=this.video.canplay}this.snapshot=null;if(N.BitmapData){this.snapshot=new N.BitmapData(this.game,'',this.width,this.height)}if(this.game.device.needsTouchUnlock()){this.setTouchLock()}else if(d){d.locked=false}};N.Video.prototype={connectToMediaStream:function(a,b){if(a&&b){this.video=a;this.videoStream=b;this.isStreaming=true;this.baseTexture.source=this.video;this.updateTexture(null,this.video.videoWidth,this.video.videoHeight);this.onAccess.dispatch(this)}return this},startMediaStream:function(a,b,c,d){if(a===undefined){a=false}if(b===undefined){b=null}if(c===undefined){c=null}if(d===undefined){d=true}if(!this.game.device.getUserMedia){this.onError.dispatch(this,'No getUserMedia');return false}if(this.videoStream!==null){if(this.videoStream.active){this.videoStream.active=false}else{this.videoStream.stop()}}this.removeVideoElement();this.video=document.createElement('video');this.video.setAttribute('autoplay','autoplay');this.video.setAttribute('playsinline','playsinline');if(b!==null){this.video.width=b}if(c!==null){this.video.height=c}this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),this.timeout);if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){navigator.mediaDevices.getUserMedia({audio:a,video:d}).then(this.getUserMediaSuccess.bind(this)).catch(this.getUserMediaError.bind(this))}else{try{navigator.getUserMedia({audio:a,video:d},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(error){this.getUserMediaError(error)}}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID);this.onTimeout.dispatch(this)},getUserMediaError:function(a){clearTimeout(this._timeOutID);this.onError.dispatch(this,a)},getUserMediaSuccess:function(d){clearTimeout(this._timeOutID);this.videoStream=d;if(this.video.mozSrcObject!==undefined){this.video.mozSrcObject=d}else if(this.video.srcObject!==undefined){this.video.srcObject=d}else{this.video.src=(window.URL&&window.URL.createObjectURL(d))||d}var e=this;this.video.onloadeddata=function(){var c=10;function checkStream(){if(c>0){if(e.video.videoWidth>0){var a=e.video.videoWidth;var b=e.video.videoHeight;if(isNaN(e.video.videoHeight)){b=a/(4/3)}e.video.play();e.isStreaming=true;e.baseTexture.source=e.video;e.updateTexture(null,a,b);e.onAccess.dispatch(e)}else{window.setTimeout(checkStream,500)}}else{console.warn('Unable to connect to video stream. Webcam error?')}c--}checkStream()}},createVideoFromBlob:function(b){var c=this;this.video=document.createElement('video');this.video.controls=false;this.video.setAttribute('autoplay','autoplay');this.video.setAttribute('playsinline','playsinline');this.video.addEventListener('loadeddata',function(a){c.updateTexture(a)},true);this.video.src=window.URL.createObjectURL(b);this.video.canplay=true;return this},createVideoFromURL:function(a,b,c){if(b===undefined){b=false}if(this.texture){this.texture.valid=false}this.video=document.createElement('video');this.video.controls=false;if(b){this.video.setAttribute('autoplay','autoplay')}if(c!==undefined){this.video.crossOrigin=c}this.video.setAttribute('playsinline','playsinline');this.video.src=a;this.video.canplay=true;this.video.load();this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval);this.key=a;return this},updateTexture:function(a,b,c){var d=false;if(b===undefined||b===null){b=this.video.videoWidth;d=true}if(c===undefined||c===null){c=this.video.videoHeight}this.width=b;this.height=c;if(this.baseTexture.source!==this.video){this.baseTexture.source=this.video}this.baseTexture.forceLoaded(b,c);this.texture.frame.resize(b,c);this.texture.width=b;this.texture.height=c;this.texture.valid=true;if(this.snapshot){this.snapshot.resize(b,c)}if(d&&this.key!==null){this.onChangeSource.dispatch(this,b,c);if(this._autoplay){this.video.play();this.onPlay.dispatch(this,this.loop,this.playbackRate)}}},complete:function(){this.onComplete.dispatch(this)},play:function(a,b){if(this._pendingChangeSource){return this}if(a===undefined){a=false}if(b===undefined){b=1}if(this.game.sound.onMute){this.game.sound.onMute.add(this.setMute,this);this.game.sound.onUnMute.add(this.unsetMute,this);if(this.game.sound.mute){this.setMute()}}this.game.onPause.add(this.setPause,this);this.game.onResume.add(this.setResume,this);this._endCallback=this.complete.bind(this);this.video.addEventListener('ended',this._endCallback,true);this.video.addEventListener('webkitendfullscreen',this._endCallback,true);if(a){this.video.loop=true}else{this.video.loop=false}this.video.playbackRate=b;if(this.touchLocked){this._pending=true}else{this._pending=false;if(this.key!==null){if(this.video.readyState!==4){this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)}else{this._playCallback=this.playHandler.bind(this);this.video.addEventListener('playing',this._playCallback,true)}}this.video.play();this.onPlay.dispatch(this,a,b)}return this},playHandler:function(){this.video.removeEventListener('playing',this._playCallback,true);this.updateTexture()},stop:function(){if(this.game.sound.onMute){this.game.sound.onMute.remove(this.setMute,this);this.game.sound.onUnMute.remove(this.unsetMute,this)}this.game.onPause.remove(this.setPause,this);this.game.onResume.remove(this.setResume,this);if(this.isStreaming){if(this.video.mozSrcObject){this.video.mozSrcObject.stop();this.video.src=null}else if(this.video.srcObject){this.video.srcObject.stop();this.video.src=null}else{this.video.src='';if(this.videoStream.active){this.videoStream.active=false}else if(this.videoStream.getTracks){this.videoStream.getTracks().forEach(function(a){a.stop()})}else{this.videoStream.stop()}}this.videoStream=null;this.isStreaming=false}else{this.video.removeEventListener('ended',this._endCallback,true);this.video.removeEventListener('webkitendfullscreen',this._endCallback,true);this.video.removeEventListener('playing',this._playCallback,true);if(this.touchLocked){this._pending=false}else{this.video.pause()}}return this},add:function(a){if(Array.isArray(a)){for(var i=0;i<a.length;i++){if(a[i].loadTexture){a[i].loadTexture(this)}}}else{a.loadTexture(this)}return this},addToWorld:function(x,y,a,b,c,d){c=c||1;d=d||1;var e=this.game.add.image(x,y,this);e.anchor.set(a,b);e.scale.set(c,d);return e},render:function(){if(!this.disableTextureUpload&&this.playing){this.baseTexture.dirty()}},setMute:function(){if(this._muted){return}this._muted=true;this.video.muted=true},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;this.video.muted=false},setPause:function(){if(this._paused||this.touchLocked){return}this._paused=true;this.video.pause()},setResume:function(){if(!this._paused||this._codePaused||this.touchLocked){return}this._paused=false;if(!this.video.ended){this.video.play()}},changeSource:function(a,b){if(b===undefined){b=true}this.texture.valid=false;this.video.pause();this._pendingChangeSource=true;this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval);this.video.src=a;this.video.load();this._autoplay=b;if(!b){this.paused=true}return this},checkVideoProgress:function(){if(this.video.readyState===4){this._pendingChangeSource=false;this.updateTexture()}else{this.retry--;if(this.retry>0){this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)}else{console.warn('Phaser.Video: Unable to start downloading video in time',this.isStreaming)}}},setTouchLock:function(){this.game.input.addTouchLockCallback(this.unlock,this,true);this.touchLocked=true},unlock:function(){this.touchLocked=false;if(this.playWhenUnlocked){this.video.play();this.onPlay.dispatch(this,this.loop,this.playbackRate)}if(this.key){var a=this.game.cache.getVideo(this.key);if(a&&!a.isBlob){a.locked=false}}this.onTouchUnlock.dispatch(this);return true},grab:function(a,b,c){if(a===undefined){a=false}if(b===undefined){b=1}if(c===undefined){c=null}if(this.snapshot===null){console.warn('Video.grab cannot run because Phaser.BitmapData is unavailable');return}if(a){this.snapshot.cls()}this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,b,c);return this.snapshot},removeVideoElement:function(){if(!this.video){return}if(this.video.parentNode){this.video.parentNode.removeChild(this.video)}while(this.video.hasChildNodes()){this.video.removeChild(this.video.firstChild)}this.video.removeAttribute('autoplay');this.video.removeAttribute('src');this.video=null},destroy:function(){this.stop();this.removeVideoElement();if(this.touchLocked){this.game.input.removeTouchLockCallback(this.unlock,this)}if(this._retryID){window.clearTimeout(this._retryID)}}};Object.defineProperty(N.Video.prototype,'currentTime',{get:function(){return(this.video)?this.video.currentTime:0},set:function(a){this.video.currentTime=a}});Object.defineProperty(N.Video.prototype,'duration',{get:function(){return(this.video)?this.video.duration:0}});Object.defineProperty(N.Video.prototype,'progress',{get:function(){return(this.video)?(this.video.currentTime/this.video.duration):0}});Object.defineProperty(N.Video.prototype,'mute',{get:function(){return this._muted},set:function(a){a=a||null;if(a){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(N.Video.prototype,'paused',{get:function(){return this._paused},set:function(a){a=a||null;if(this.touchLocked){return}if(a){if(this._paused){return}this._codePaused=true;this.setPause()}else{if(!this._paused){return}this._codePaused=false;this.setResume()}}});Object.defineProperty(N.Video.prototype,'volume',{get:function(){return(this.video)?this.video.volume:1},set:function(a){if(a<0){a=0}else if(a>1){a=1}if(this.video){this.video.volume=a}}});Object.defineProperty(N.Video.prototype,'playbackRate',{get:function(){return(this.video)?this.video.playbackRate:1},set:function(a){if(this.video){this.video.playbackRate=a}}});Object.defineProperty(N.Video.prototype,'loop',{get:function(){return(this.video)?this.video.loop:false},set:function(a){if(a&&this.video){this.video.loop=true}else if(this.video){this.video.loop=false}}});Object.defineProperty(N.Video.prototype,'playing',{get:function(){return(this.video)?!(this.video.paused&&this.video.ended):false}});N.Video.prototype.constructor=N.Video;if(PIXI.blendModes===undefined){PIXI.blendModes=N.blendModes}if(PIXI.scaleModes===undefined){PIXI.scaleModes=N.scaleModes}if(PIXI.Texture.emptyTexture===undefined){PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture())}if(PIXI.DisplayObject._tempMatrix===undefined){PIXI.DisplayObject._tempMatrix=new N.Matrix()}PIXI.TextureSilentFail=true;PIXI.canUseNewCanvasBlendModes=function(){return N.Device.canUseMultiply};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=N}exports.Phaser=N}else if(typeof define!=='undefined'&&define.amd){define('Phaser',(function(){return M.Phaser=N})())}else{M.Phaser=N}if(GameGlobal){GameGlobal.Phaser=N}return N}).call(this);